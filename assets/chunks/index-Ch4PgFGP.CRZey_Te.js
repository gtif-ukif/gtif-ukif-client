const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/index.SQjXTsAm.js","assets/chunks/main.9p9Qk2JP.js","assets/chunks/lit-element.CIht5NN8.js","assets/chunks/WMTS.B-JsNFwq.js","assets/chunks/Group.ovD7bfEG.js","assets/chunks/extent.B6zYA2nd.js","assets/chunks/GeoJSON.Bn398gYN.js","assets/chunks/index.Du0sVlOV.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/getElement.CdRlZPdn.js","assets/chunks/addCommonStyleSheet.Bb-Xf-sd.js"])))=>i.map(i=>d[i]);
import{h as O,ao as ve,a2 as ae,p as M,ap as re,v as ee,c as Y,o as X,j,e as K,k as a,N as q,G as me,x as de,q as ge,a5 as he}from"./framework.CqSXN63J.js";import{t as xe}from"./main.9p9Qk2JP.js";import"./index.CjNDjUO8.js";import{_ as Ce,x as k,u as Pe,s as oe,a as te,o as we,r as Se,d as se,g as Q,y as _e,k as P,z as w,A as S,B as Te,l as B,n as Le,C as Ne,v as Oe,t as Me,h as ke,D as Be,E as ie,F as E,p as Ge,G as ne}from"./eo-dash.XVF27zDV.js";import{i as je}from"./easing-CH0-9wR8.CTB3jml5.js";import Ae from"./EodashMapBtns-BjF8Yrpd.E2JtBu7M.js";import"./index.Du0sVlOV.js";import"./GeoJSON.Bn398gYN.js";import"./lit-element.CIht5NN8.js";import"./WMTS.B-JsNFwq.js";import"./Group.ovD7bfEG.js";import"./extent.B6zYA2nd.js";import"./commonjsHelpers.BosuxZz1.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.Bb-Xf-sd.js";import"./WKT.C5Hr-LXE.js";import"./item.Bx-rtsOD.js";import"./ExportState-D6CBpKUU.CTznIPEb.js";import"./PopUp-C6HJH8wM.BlCuBF-p.js";import"./forwardRefs-D3na5VY2.vtZFcHXC.js";import"./transition-Bp5R_Vzd.wkbJPZzT.js";import"./main.Bj1tI2P-.js";import"./sequential.BcvVcPN9.js";import"./orient2d.DArCjZZA.js";import"./VImg-CWCCg87G.b0C-A3C5.js";import"./EodashItemFilter-CAlyUnje.CAh_FBCl.js";import"./handling-7IVxQxtQ.CntThCiW.js";import"./async-Byq11ZKl.B-wBChOY.js";import"./utils.BJtOAKhC.js";import"./index.CxojoGlr.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.RlppLW26.js";import"./index.BUIxO2d3.js";const le=async(e,p,u)=>{B.debug("Creating layers config",e,p,u);const o=[],r={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const i of p){let t;if(u){const s=typeof u=="string"?new Date(u):u;t=await i.createLayersJson(s)}else t=await i.createLayersJson(void 0);t.forEach(s=>{s.properties.layerControlExpand=!0,s.properties.layerControlToolsExpand=!0}),r.layers.push(...t)}if(e!=null&&e.links){const i=e.links.filter(t=>Array.isArray(t.roles)&&(t.roles.includes("disable")||t.roles.includes("hidden")));i.length>0&&i.forEach(t=>{const s=t.id,l=r.layers.find(T=>T.properties.id.split(";:;")[0]===s);l&&(Array.isArray(t.roles)&&t.roles.includes("disable")?l.properties.visible=!1:Array.isArray(t.roles)&&t.roles.includes("hidden")&&(l.properties.layerControlHide=!0))})}o.push(r);const f=await ne.getIndicatorLayers(e),m=ne.getObservationPointsLayer(p);m&&r.layers.push(m);const b={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},c=f.filter(i=>i.properties.group==="baselayer");if(c.length){let i=0,t=0;for(let s=0;s<c.length;s++){const l=c[s];"visible"in l.properties||(l.properties.visible=!1),l.properties.visible&&(i++,t=s)}i===0&&(c[0].properties.visible=!0),i>0&&c.forEach((s,l)=>{l!==t?s.properties.visible=!1:s.properties.visible=!0}),b.layers.push(...c),b.layers.forEach(s=>{s.properties.layerControlExclusive=!0})}else b.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});b.layers.length&&o.unshift(b);const _={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},g=f.filter(i=>i.properties.group==="overlay");return g.length&&(_.layers.push(...g),o.push(_)),o};let W=null;const ze=(e,p)=>{const u=o=>{var b;const r=o.map,f=(b=e.value)==null?void 0:b.lonLatCenter,m=r==null?void 0:r.getView().getZoom();f&&!Number.isNaN(f[0])&&!Number.isNaN(f[1])&&!Number.isNaN(m)&&(p.value=[f[0],f[1],m])};ee(()=>{var o,r;(r=(o=e.value)==null?void 0:o.map)==null||r.on("moveend",u)}),de(()=>{var o,r;(r=(o=e.value)==null?void 0:o.map)==null||r.un("moveend",u)})},pe=(e,p,u,o,r,f,m,b)=>{B.debug("InitMap",e.value,p.value,u.values,o.value);const _=ge(b?[p,o,b]:[p,o],async(g,i)=>{var R,x,L,J,Z,D,U,A,$,z,I,n,d,h,y;const[t,s,l]=b?g:[g[0],g[1],null],[T,F,G]=b?i:[i[0],i[1],null];if(t){B.debug("Selected Indicator watch triggered",t,s),((R=e==null?void 0:e.value)==null?void 0:R.id)==="main"&&W!==null&&((x=e==null?void 0:e.value)==null||x.map.setView(W),W=null);let v=[];const C=(t==null?void 0:t.id)===(T==null?void 0:T.id)&&(s!==F||l&&(l==null?void 0:l.id)!==(G==null?void 0:G.id)),{selectedCompareStac:V}=oe(te());if(((L=e==null?void 0:e.value)==null?void 0:L.id)==="main"?await Be(t):V.value!==null&&(W=((J=e==null?void 0:e.value)==null?void 0:J.map.getView())??null,e.value.sync=f.value),C){v=await le(t,u,l??s),B.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(v))),r.value=v,ie(((Z=e.value)==null?void 0:Z.id)==="compare"?"compareTime:updated":"time:updated",e.value,v);return}let N=null;const H=(U=(D=t==null?void 0:t.extent)==null?void 0:D.temporal)==null?void 0:U.interval;if(H&&H.length>0&&H[0].length>1&&(N=new Date(H[0][1]),B.debug("Indicator load: found stac extent, setting time to latest value",N)),(!l&&N!==null&&N.toISOString()!==o.value&&!E.value||E.value&&!o.value&&N)&&(o.value=N.toISOString()),v=await le(t,u,l??s),m&&!l&&((A=e==null?void 0:e.value)==null?void 0:A.id)==="main"&&($=t.extent)!=null&&$.spatial.bbox&&!(E.value&&((z=k.value)!=null&&z[0])&&((I=k.value)!=null&&I[1]))){const fe=(n=t.extent)==null?void 0:n.spatial.bbox[0],be=Ge([...fe]),ye=xe(be,"EPSG:4326",(h=(d=e.value)==null?void 0:d.map)==null?void 0:h.getView().getProjection());e.value.zoomExtent=ye}B.debug("Assigned layers",JSON.parse(JSON.stringify(v))),r.value=v,await ie(((y=e.value)==null?void 0:y.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,r.value)}},{immediate:!0});de(()=>{_()})},ue=(e,p)=>{Le(async(u,o)=>{if(u.includes("compare"))return;const r=[];for(const f of e)r.push(...await f.getToolTipProperties());p.value=r,B.debug("Updated tooltip properties",p.value)})},Ie="#cursor-coordinates[data-v-965b3ae7]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:10px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media(max-width:959px){#cursor-coordinates[data-v-965b3ae7]{display:none}}#scale-line[data-v-965b3ae7]{position:fixed;left:24px;bottom:28px;color:#fff}@media(max-width:959px){#scale-line[data-v-965b3ae7]{bottom:102px}}[data-v-965b3ae7] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-965b3ae7] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-965b3ae7]{position:fixed;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-965b3ae7]>*{pointer-events:auto}",Ve=[".enabled"],Fe=[".center",".zoom",".layers",".controls"],Re=[".propertyTransform"],Je=[".layers"],Ze=[".propertyTransform"],De={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Ue={key:1,id:"scale-line",ref:"scale-line"};var ce;const $e={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,p;return[((e=k.value)==null?void 0:e[0])??15,((p=k.value)==null?void 0:p[1])??48]}},zoom:{type:Number,default:((ce=k.value)==null?void 0:ce[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0,enableGlobe:!0,searchParams:{}})}},async setup(e){var I;let p,u;const o=e,{width:r}=Pe(),f=n=>{if(typeof n=="number")return n;if(typeof n=="string"){const d=n.split("/"),h=r.value;return h<960?parseInt(d[0])||1:h<1920?parseInt(d[1]||d[0])||1:parseInt(d[2]||d[1]||d[0])||1}return 1},m=O(()=>f(o.btnsPosition.x)),b=O(()=>f(o.btnsPosition.y)),c=O(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0,enableGlobe:o.btns.enableGlobe??!0,searchParams:o.btns.searchParams}));c.value.enableGlobe&&([p,u]=ve(()=>he(()=>import("./index.SQjXTsAm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),await p,u());const _=ae("scale-line"),g=ae("cursor-coords"),i=M([]),t=M([]),s=O(()=>{const n={Attribution:{collapsible:!0}};return o.enableScaleLine&&_.value&&(n.ScaleLine={target:_.value}),o.enableCursorCoordinates&&g.value&&(n.MousePosition={projection:"EPSG:4326",coordinateFormat:d=>`${d[1].toFixed(3)} °N, ${d[0].toFixed(3)} °E`,target:g.value}),n}),l=re(o.center),T=re(((I=k.value)==null?void 0:I[2])??o.zoom),F=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),G=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),R={duration:1200,easing:je},x=M(null),L=M(null),{selectedCompareStac:J}=oe(te()),Z=O(()=>o.enableCompare&&J.value?"":"first");ze(x,k),ee(()=>{const{selectedCompareStac:n,selectedStac:d,selectedItem:h}=oe(te());we.value=x.value,o.enableCompare&&(Se.value=L.value),o.enableCompare&&(pe(L,n,ke,se,G,x,!1),ue(Q,t)),pe(x,d,Q,se,F,L,o.zoomToExtent,h)}),ue(Q,i);const D=O(()=>({visibility:i.value.length?"visible":"hidden"})),U=O(()=>({visibility:t.value.length?"visible":"hidden"})),A=n=>{const d=n==="main"?i:t,h=n=="main"?Oe:Me;return y=>{const v=JSON.parse(Ne.render(JSON.stringify(d.value),{...h.value??{}})),C=v==null?void 0:v.find(V=>V.id===y.key);if(C){if(typeof y.value=="object"&&(y.value=JSON.stringify(y.value)),!isNaN(Number(y.value))){const V=isNaN(Number(C.decimals))?4:Number(C.decimals);y.value=Number(y.value).toFixed(V).toString()}return{key:C.title||C.id,value:y.value+" "+(C.appendix||"")}}}},{mainRect:$}=_e(),z=M(0);return ee(()=>{const n=document.querySelector("eo-dash");z.value=($.value.top||(n==null?void 0:n.getBoundingClientRect().top))??0}),(n,d)=>(X(),Y("span",null,[j("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":Z.value},[j("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:x,id:"main",".animationOptions":R,".center":a(l),".zoom":a(T),".layers":F.value,".controls":s.value},[j("eox-map-tooltip",{style:q(D.value),".propertyTransform":A("main")},null,44,Re)],40,Fe),j("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:L,".layers":G.value},[j("eox-map-tooltip",{style:q(U.value),".propertyTransform":A("compare")},null,44,Ze)],40,Je)],40,Ve),e.enableCursorCoordinates?(X(),Y("div",De,null,512)):K("v-if",!0),e.enableScaleLine?(X(),Y("span",Ue,null,512)):K("v-if",!0),j("div",{class:"map-buttons-container",style:q(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0; top: ${z.value}px;`)},[K(" prettier-ignore "),me(Ae,{style:q({gridColumn:(a(P)||a(w)||a(S))&&!a(Te)?m.value:"12",gridRow:b.value}),exportMap:a(P)||a(w)||a(S)?c.value.exportMap:!1,changeProjection:a(P)||a(w)||a(S)?c.value.changeProjection:!1,compareIndicators:a(P)||a(w)||a(S)?c.value.compareIndicators:!1,backToPOIs:a(P)||a(w)||a(S)?c.value.backToPOIs:!1,enableSearch:a(P)||a(w)||a(S)?c.value.enableSearch:!1,enableZoom:a(P)||a(w)||a(S)?c.value.enableZoom:!1,enableGlobe:a(P)||a(w)||a(S)?c.value.enableGlobe:!1,searchParams:c.value.searchParams},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom","enableGlobe","searchParams"])],4)]))}},To=Ce($e,[["styles",[Ie]],["__scopeId","data-v-965b3ae7"]]);export{To as default};
