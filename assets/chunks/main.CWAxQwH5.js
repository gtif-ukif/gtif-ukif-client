var ci=Object.defineProperty;var rt=n=>{throw TypeError(n)};var hi=(n,e,t)=>e in n?ci(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var M=(n,e,t)=>hi(n,typeof e!="symbol"?e+"":e,t),Ne=(n,e,t)=>e.has(n)||rt("Cannot "+t);var v=(n,e,t)=>(Ne(n,e,"read from private field"),t?t.call(n):e.get(n)),x=(n,e,t)=>e.has(n)?rt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),P=(n,e,t,i)=>(Ne(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),T=(n,e,t)=>(Ne(n,e,"access private method"),t);import{i as Je,x as z,E as di}from"./lit-element.C0HUAAc_.js";import{P as Et,V as Z,a as Le,n as ui,b as Be,s as gi,I as mi,M as I,c as fi,d as pi,e as Ft,p as _i,f as yi,g as vi,R as bi,h as at,K as Ci,T as wi,i as Ze,r as Lt,j as xi,k as He,D as be,l as lt,C as Si,m as Pi,o as It,q as Ti,t as Ei,u as Fi,v as Li,w as Ii,x as ki,y as Mi,z as Ri,A as Ni,B as Ai,E as Vi,F as Oi,X as Di,W as Gi,G as ji,H as zi,J as Ui,O as Bi,L as Zi,N as Hi,S as kt,Q as Mt,U as Wi,Y as $i,Z as G,_ as Q,$ as Ie,a0 as we,a1 as se,a2 as ct,a3 as j,a4 as qi,a5 as Rt,a6 as ht,a7 as Qe,a8 as dt,a9 as Ki,aa as Yi,ab as Xi,ac as Ji,ad as Qi}from"./WMTS.D-lC2MIp.js";import{Q as es,I as ts,F as is,R as F,S as ut,T as Nt,U as ss,V as et,W as ns,X as os,E as D,b as tt,x as At,t as rs,d as We,C as Ae,g as R,Y as Vt,Z as as,B as Ot,u as it,l as B,_ as Dt,M as $e,L as ls,n as Gt,$ as cs,h as hs,a0 as ds,O as us,a1 as gs,a2 as ms,a3 as fs,i as ps}from"./extent.CajDHjk1.js";import{S as _s,f as ys,r as vs,g as E,P as ke,s as xe,h as Se,a as k,d as U,L as q,i as gt,c as bs,b as jt,M as zt,G as Cs,j as L,k as Pe,l as Ut,m as ws,n as xs,o as Ss,p as Ps,q as Ts,e as Me,u as V,v as st,w as Es,x as Fs,R as Ls,y as Te,z as Is,A as Bt,B as Zt,C as Ht,D as ks,E as Ms}from"./GeoJSON.Br7Jz3X5.js";import{C as oe,a as mt,L as qe}from"./Group.DfJ6KxFj.js";import{g as Rs}from"./getElement.CdRlZPdn.js";import{e as Ns,a as As}from"./addCommonStyleSheet.B9YrlOoW.js";const Vs=':root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.ol-overviewmap .ol-viewport:hover{cursor:pointer}';class Re extends _s{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Re(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const o=this.flatCoordinates,r=e-o[0],a=t-o[1],l=r*r+a*a;if(l<s){if(l===0)for(let h=0;h<this.stride;++h)i[h]=o[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=o[0]+h*r,i[1]=o[1]+h*a;for(let c=2;c<this.stride;++c)i[c]=o[c]}return i.length=this.stride,l}return s}containsXY(e,t){const i=this.flatCoordinates,s=e-i[0],o=t-i[1];return s*s+o*o<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return es(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(ts(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:is(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let o=1;o<t;++o)s[t+o]=e[o];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let o=ys(s,0,e,this.stride);s[o++]=s[0]+t;for(let r=1,a=this.stride;r<a;++r)s[o++]=s[r];s.length=o,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter(vs(i,0,i.length,s,e,t,i)),this.changed()}}Re.prototype.transform;const me={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class fe extends tt{constructor(e,t){super(e),this.feature=t}}function Os(n,e){const t=[];for(let i=0;i<e.length;++i){const o=e[i].getGeometry();Wt(n,o,t)}return t}function pe(n,e){return At(n[0],n[1],e[0],e[1])}function W(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function _e(n,e,t){let i,s;e<t?(i=e,s=t):(i=t,s=e);const o=Math.ceil(i),r=Math.floor(s);if(o>r){const l=$(n,i),h=$(n,s);return pe(l,h)}let a=0;if(i<o){const l=$(n,i),h=W(n,o);a+=pe(l,h)}if(r<s){const l=W(n,r),h=$(n,s);a+=pe(l,h)}for(let l=o;l<r-1;++l){const h=W(n,l),c=W(n,l+1);a+=pe(h,c)}return a}function Wt(n,e,t){if(e instanceof q){ye(n,e.getCoordinates(),!1,t);return}if(e instanceof jt){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s)ye(n,i[s],!1,t);return}if(e instanceof ke){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s)ye(n,i[s],!0,t);return}if(e instanceof zt){const i=e.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length;a<l;++a)ye(n,r[a],!0,t)}return}if(e instanceof Cs){const i=e.getGeometries();for(let s=0;s<i.length;++s)Wt(n,i[s],t);return}}const Ve={index:-1,endIndex:NaN};function Ds(n,e,t,i){const s=n[0],o=n[1];let r=1/0,a=-1,l=NaN;for(let g=0;g<e.targets.length;++g){const d=e.targets[g],u=d.coordinates;let m=1/0,f;for(let p=0;p<u.length-1;++p){const _=u[p],y=u[p+1],w=$t(s,o,_,y);w.squaredDistance<m&&(m=w.squaredDistance,f=p+w.along)}m<r&&(r=m,d.ring&&e.targetIndex===g&&(d.endIndex>d.startIndex?f<d.startIndex&&(f+=u.length):d.endIndex<d.startIndex&&f>d.startIndex&&(f-=u.length)),l=f,a=g)}const h=e.targets[a];let c=h.ring;if(e.targetIndex===a&&c){const g=$(h.coordinates,l),d=t.getPixelFromCoordinate(g);Se(d,e.startPx)>i&&(c=!1)}if(c){const g=h.coordinates,d=g.length,u=h.startIndex,m=l;if(u<m){const f=_e(g,u,m);_e(g,u,m-d)<f&&(l-=d)}else{const f=_e(g,u,m);_e(g,u,m+d)<f&&(l+=d)}}return Ve.index=a,Ve.endIndex=l,Ve}function ye(n,e,t,i){const s=n[0],o=n[1];for(let r=0,a=e.length-1;r<a;++r){const l=e[r],h=e[r+1],c=$t(s,o,l,h);if(c.squaredDistance===0){const g=r+c.along;i.push({coordinates:e,ring:t,startIndex:g,endIndex:g});return}}}const Oe={along:0,squaredDistance:0};function $t(n,e,t,i){const s=t[0],o=t[1],r=i[0],a=i[1],l=r-s,h=a-o;let c=0,g=s,d=o;return(l!==0||h!==0)&&(c=We(((n-s)*l+(e-o)*h)/(l*l+h*h),0,1),g+=l*c,d+=h*c),Oe.along=c,Oe.squaredDistance=rs(At(n,e,g,d),10),Oe}function $(n,e){const t=n.length;let i=Math.floor(e);const s=e-i;i>=t?i-=t:i<0&&(i+=t);let o=i+1;o>=t&&(o-=t);const r=n[i],a=r[0],l=r[1],h=n[o],c=h[0]-a,g=h[1]-l;return[a+c*s,l+g*s]}class Gs extends Et{constructor(e){const t=e;t.stopDown||(t.stopDown=ns),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Us(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:os,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=(o,r,a)=>{const l=r||new Re([NaN,NaN]),h=E(o[0]),c=xe(h,E(o[o.length-1]));return l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_),l};else{let o;s==="Point"?o=U:s==="LineString"?o=q:s==="Polygon"&&(o=ke),i=(r,a,l)=>(a?s==="Polygon"?r[0].length?a.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(r,this.geometryLayout_):a=new o(r,this.geometryLayout_),a)}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Z({source:new Le({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:js(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:ui,this.freehandCondition_,e.freehand?this.freehandCondition_=Be:this.freehandCondition_=e.freehandCondition?e.freehandCondition:gi,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(mi.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Be:t=e:t=pi,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===D.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===I.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===I.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===I.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===I.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===I.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===I.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===I.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new fi(I.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),o=F([i,s]),r=this.traceSource_.getFeaturesInExtent(o);if(r.length===0)return;const a=Os(e.coordinate,r);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let o=Math.floor(t);o===t&&(o-=1),i=o-s+1}else{const s=Math.floor(e);let o=Math.ceil(t);o===t&&(o+=1),i=s-o+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const o=Math.ceil(t);let r=Math.floor(i);r===i&&(r-=1);for(let a=o;a<=r;++a)s.push(W(e.coordinates,a))}else{const o=Math.floor(t);let r=Math.ceil(i);r===i&&(r+=1);for(let a=o;a>=r;--a)s.push(W(e.coordinates,a))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&Se(t.startPx,e.pixel)<this.snapTolerance_)return;const i=Ds(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex;const o=$(s.coordinates,s.endIndex),r=this.getMap().getPixelFromCoordinate(o);e.coordinate=o,e.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,s=t[0]-i[0],o=t[1]-i[1],r=s*s+o*o;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let s=!1,o=[this.finishCoordinate_];const r=this.mode_;if(r==="Point")i=!0;else if(r==="Circle")i=this.sketchCoords_.length===2;else if(r==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(r==="Polygon"){const a=this.sketchCoords_;s=a[0].length>this.minPoints_,o=[a[0][0],a[0][a[0].length-2]],t?o=[a[0][0]]:o=[a[0][0],a[0][a[0].length-2]]}if(s){const a=this.getMap();for(let l=0,h=o.length;l<h;l++){const c=o[l],g=a.getPixelFromCoordinate(c),d=e[0]-g[0],u=e[1]-g[1],m=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(d*d+u*u)<=m,i){this.finishCoordinate_=c;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new k(new U(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new k);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new q(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=gt(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new k(new q(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new k,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new fe(me.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),o=gt(this.geometryLayout_);let r,a;for(;e.length<o;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(r=this.sketchCoords_[0],a=r[r.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(r=this.sketchCoords_,a=r[r.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,o;const r=this.mode_;return r==="LineString"||r==="Circle"?(this.finishCoordinate_=e.slice(),o=this.sketchCoords_,o.length>=this.maxPoints_&&(this.freehand_?o.pop():s=!0),o.push(e.slice()),this.geometryFunction_(o,t,i)):r==="Polygon"&&(o=this.sketchCoords_[0],o.length>=this.maxPoints_&&(this.freehand_?o.pop():s=!0),o.push(e.slice()),s&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let o=0;o<e;++o){let r;if(s==="LineString"||s==="Circle"){if(r=this.sketchCoords_,r.splice(-2,1),r.length>=2){this.finishCoordinate_=r[r.length-2].slice();const a=this.finishCoordinate_.slice();r[r.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(r,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){r=this.sketchCoords_[0],r.splice(-2,1);const a=this.sketchLine_.getGeometry();if(r.length>=2){const l=r[r.length-2].slice();r[r.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(r),this.geometryFunction_(this.sketchCoords_,t,i)}if(r.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),s=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,s),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new bs([t])):this.type_==="MultiLineString"?e.setGeometry(new jt([t])):this.type_==="MultiPolygon"&&e.setGeometry(new zt([t])),this.dispatchEvent(new fe(me.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new fe(me.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let r=0;r<e.length;r++)this.addToDrawing_(e[r]);const o=e[e.length-1];this.sketchFeature_=this.addToDrawing_(o),this.modifyDrawing_(o)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new k(new U(s)),this.updateSketchFeatures_(),this.dispatchEvent(new fe(me.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function js(){const n=Ft();return function(e,t){return n[e.getGeometry().getType()]}}function zs(){return function(n,e,t){const i=F([n[0],n[n.length-1]].map(function(o){return E(o)})),s=[[ut(i),Nt(i),ss(i),et(i),ut(i)]];return e?e.setCoordinates(s):e=new ke(s),e}}function Us(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const ft=0,ne=1,pt=[0,0,0,0],K=[],De={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ge extends tt{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class Bs extends Et{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:_i,this.defaultDeleteCondition_=function(i){return yi(i)&&vi(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Be,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new bi,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Z({source:new Le({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Hs(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new oe(this.source_.getFeatures()),this.source_.addEventListener(at.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(at.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(mt.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(mt.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(i.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(D.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new oe;const i=this.featuresBeingModified_.getArray();for(let s=0,o=t.length;s<o;++s){const r=t[s].feature;r&&!i.includes(r)&&this.featuresBeingModified_.push(r)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ge(De.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(D.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(s){e===s.feature&&i.push(s)});for(let s=i.length-1;s>=0;--s){const o=i[s];for(let r=this.dragSegments_.length-1;r>=0;--r)this.dragSegments_[r][0]===o&&this.dragSegments_.splice(r,1);t.remove(o)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),s={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s],a={feature:e,geometry:t,depth:[s],index:s,segment:[r,r]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length-1;s<o;++s){const r=i.slice(s,s+2),a={feature:e,geometry:t,index:s,segment:r};this.rBush_.insert(F(r),a)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length-1;a<l;++a){const h=r.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(F(h),c)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length-1;a<l;++a){const h=r.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(F(h),c)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,o=i.length;s<o;++s){const r=i[s];for(let a=0,l=r.length;a<l;++a){const h=r[a];for(let c=0,g=h.length-1;c<g;++c){const d=h.slice(c,c+2),u={feature:e,geometry:t,depth:[a,s],index:c,segment:d};this.rBush_.insert(F(d),u)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),s={feature:e,geometry:t,index:ft,segment:[i,i]},o={feature:e,geometry:t,index:ne,segment:[i,i]},r=[s,o];s.featureSegments=r,o.featureSegments=r,this.rBush_.insert(Ae(i),s);let a=t;this.rBush_.insert(a.getExtent(),o)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let s=0;s<i.length;++s){const o=i[s],r=this.SEGMENT_WRITERS_[o.getType()];r(e,o)}}createOrUpdateVertexFeature_(e,t,i,s){let o=this.vertexFeature_;return o?o.getGeometry().setCoordinates(e):(o=new k(new U(e)),this.vertexFeature_=o,this.overlay_.getSource().addFeature(o)),o.set("features",t),o.set("geometries",i),o.set("existing",s),o}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==I.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=I.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==I.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const t=this.vertexFeature_;if(!t)return;this.getMap().getView().getProjection();const i=[],s=t.getGeometry().getCoordinates(),o=F([s]),r=this.rBush_.getInExtent(o),a={};r.sort(Zs);for(let l=0,h=r.length;l<h;++l){const c=r[l],g=c.segment;let d=R(c.geometry);const u=c.depth;if(u&&(d+="-"+u.join("-")),a[d]||(a[d]=new Array(2)),c.geometry.getType()==="Circle"&&c.index===ne){const m=yt(e,c);L(m,s)&&!a[d][0]&&(this.dragSegments_.push([c,0]),a[d][0]=c);continue}if(L(g[0],s)&&!a[d][0]){this.dragSegments_.push([c,0]),a[d][0]=c;continue}if(L(g[1],s)&&!a[d][1]){if(a[d][0]&&a[d][0].index===0){let m=c.geometry.getCoordinates();switch(c.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":m=m[u[1]];case"Polygon":if(c.index!==m[u[0]].length-2)continue;break}}this.dragSegments_.push([c,1]),a[d][1]=c;continue}R(g)in this.vertexSegments_&&!a[d][0]&&!a[d][1]&&i.push(c)}return i}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([o])=>o));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],s=[];for(let o=0,r=this.dragSegments_.length;o<r;++o){const a=this.dragSegments_[o],l=a[0],h=l.feature;i.includes(h)||i.push(h);const c=l.geometry;s.includes(c)||s.push(c);const g=l.depth;let d;const u=l.segment,m=a[1];for(;t.length<c.getStride();)t.push(u[m][t.length]);switch(c.getType()){case"Point":d=t,u[0]=t,u[1]=t;break;case"MultiPoint":d=c.getCoordinates(),d[l.index]=t,u[0]=t,u[1]=t;break;case"LineString":d=c.getCoordinates(),d[l.index+m]=t,u[m]=t;break;case"MultiLineString":d=c.getCoordinates(),d[g[0]][l.index+m]=t,u[m]=t;break;case"Polygon":d=c.getCoordinates(),d[g[0]][l.index+m]=t,u[m]=t;break;case"MultiPolygon":d=c.getCoordinates(),d[g[1]][g[0]][l.index+m]=t,u[m]=t;break;case"Circle":const f=c;if(u[0]=t,u[1]=t,l.index===ft)this.changingFeature_=!0,f.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let p=Se(E(f.getCenter()),E(t));f.setRadius(p),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(c,d)}this.createOrUpdateVertexFeature_(t,i,s,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i!=null&&i.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){const s=this.vertexFeature_.getGeometry().getCoordinates();for(let o=i.length-1;o>=0;--o)this.insertVertex_(i[o],s);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],s=i.geometry;if(s.getType()==="Circle"){const o=s,r=o.getCenter(),a=i.featureSegments[0],l=i.featureSegments[1];a.segment[0]=r,a.segment[1]=r,l.segment[0]=r,l.segment[1]=r,this.rBush_.update(Ae(r),a);let h=o;this.rBush_.update(h.getExtent(),l)}else this.rBush_.update(F(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ge(De.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const t=this.getMap(),i=t.getPixelFromCoordinate(e);t.getView().getProjection();const s=function(a,l){return _t(e,a)-_t(e,l)};let o,r;if(this.hitDetection_){const a=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(i,(l,h,c)=>{c&&c.getType()==="Point"&&(c=new U(Pe(c.getCoordinates())));const g=c||l.getGeometry();if(g&&g.getType()==="Point"&&l instanceof k&&this.features_.getArray().includes(l)){r=g;const d=l.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:l,geometry:r,segment:[d,d]}]}return!0},{layerFilter:a})}if(!o){const a=Ut(Ae(e,pt)),l=t.getView().getResolution()*this.pixelTolerance_,h=ws(Vt(a,l,pt));o=this.rBush_.getInExtent(h)}if(o&&o.length>0){const a=o.sort(s)[0],l=a.segment;let h=yt(e,a);const c=t.getPixelFromCoordinate(h);let g=Se(i,c);if(r||g<=this.pixelTolerance_){const d={};if(d[R(l)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-e[0],this.delta_[1]=h[1]-e[1]),a.geometry.getType()==="Circle"&&a.index===ne)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[a.feature],[a.geometry],this.snappedToVertex_);else{const u=t.getPixelFromCoordinate(l[0]),m=t.getPixelFromCoordinate(l[1]),f=xe(c,u),p=xe(c,m);if(g=Math.sqrt(Math.min(f,p)),this.snappedToVertex_=g<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=f>p?l[1]:l[0]),this.createOrUpdateVertexFeature_(h,[a.feature],[a.geometry],this.snappedToVertex_);const _={};_[R(a.geometry)]=!0;for(let y=1,w=o.length;y<w;++y){const O=o[y].segment;if(L(l[0],O[0])&&L(l[1],O[1])||L(l[0],O[1])&&L(l[1],O[0])){const ot=R(o[y].geometry);ot in _||(_[ot]=!0,d[R(O)]=!0)}else break}}this.vertexSegments_=d;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,s=e.feature,o=e.geometry,r=e.depth,a=e.index;let l;for(;t.length<o.getStride();)t.push(0);switch(o.getType()){case"MultiLineString":l=o.getCoordinates(),l[r[0]].splice(a+1,0,t);break;case"Polygon":l=o.getCoordinates(),l[r[0]].splice(a+1,0,t);break;case"MultiPolygon":l=o.getCoordinates(),l[r[1]][r[0]].splice(a+1,0,t);break;case"LineString":l=o.getCoordinates(),l.splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(o,l);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(o,a,r,1);const c={segment:[i[0],t],feature:s,geometry:o,depth:r,index:a};h.insert(F(c.segment),c),this.dragSegments_.push([c,1]);const g={segment:[t,i[1]],feature:s,geometry:o,depth:r,index:a+1};return h.insert(F(g.segment),g),this.dragSegments_.push([g,0]),!0}updatePointer_(e){var t;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates()}getPoint(){var t;const e=(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates();return e?Pe(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(F([e])).some(({segment:i})=>L(i[0],e)||L(i[1],e))}removePoint(e){if(e&&(e=E(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=I.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([s])=>s));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ge(De.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,s,o,r,a,l,h,c,g,d,u,m;for(l=e.length-1;l>=0;--l)r=e[l],u=r[0],m=R(u.feature),u.depth&&(m+="-"+u.depth.join("-")),m in t||(t[m]={}),r[1]===0?(t[m].right=u,t[m].index=u.index):r[1]==1&&(t[m].left=u,t[m].index=u.index+1);for(m in t){switch(d=t[m].right,c=t[m].left,h=t[m].index,g=h-1,c!==void 0?u=c:u=d,g<0&&(g=0),a=u.geometry,o=a.getCoordinates(),s=o,i=!1,a.getType()){case"MultiLineString":o[u.depth[0]].length>2&&(o[u.depth[0]].splice(h,1),i=!0);break;case"LineString":o.length>2&&(o.splice(h,1),i=!0);break;case"MultiPolygon":s=s[u.depth[1]];case"Polygon":s=s[u.depth[0]],s.length>4&&(h==s.length-1&&(h=0),s.splice(h,1),i=!0,h===0&&(s.pop(),s.push(s[0]),g=s.length-1));break}if(i){this.setGeometryCoordinates_(a,o);const f=[];if(c!==void 0&&(this.rBush_.remove(c),f.push(c.segment[0])),d!==void 0&&(this.rBush_.remove(d),f.push(d.segment[1])),c!==void 0&&d!==void 0){const p={depth:u.depth,feature:u.feature,geometry:u.geometry,index:g,segment:f};this.rBush_.insert(F(p.segment),p)}this.updateSegmentIndices_(a,h,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(F([e])).some(({segment:i})=>!(L(i[0],e)||L(i[1],e)))}insertPoint(e){var s;const t=e?E(e,this.getMap().getView().getProjection()):(s=this.vertexFeature_)==null?void 0:s.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((o,r)=>o||this.insertVertex_(r,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,s){this.rBush_.forEachInExtent(e.getExtent(),function(o){o.geometry===e&&(i===void 0||o.depth===void 0||as(o.depth,i))&&o.index>t&&(o.index+=s)})}}function Zs(n,e){return n.index-e.index}function _t(n,e,t){const i=e.geometry;if(i.getType()==="Circle"){let o=i;if(e.index===ne){const r=xe(o.getCenter(),E(n)),a=Math.sqrt(r)-o.getRadius();return a*a}}const s=E(n);return K[0]=E(e.segment[0]),K[1]=E(e.segment[1]),Ss(s,K)}function yt(n,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===ne)return Pe(i.getClosestPoint(E(n)));const s=E(n);return K[0]=E(e.segment[0]),K[1]=E(e.segment[1]),Pe(xs(s,K))}function Hs(){const n=Ft();return function(e,t){return n.Point}}const Ws='.geolocation{top:85px;left:.5em}.geolocation button{background:var(--primary);color:var(--on-primary)}.geolocation button>svg{fill:var(--on-primary);min-inline-size:1.25rem!important;max-inline-size:1.25rem!important;min-block-size:1.25rem!important;max-block-size:1.25rem!important}.ol-touch.geolocation{top:100px}.loading-indicator{position:absolute;pointer-events:none!important;display:flex;align-items:center;justify-content:center;background-color:#0000}.loading-indicator.small{bottom:.5em;left:.5em;width:30px;height:30px}.loading-indicator.fullscreen{width:100%;height:100%}.disabled{filter:brightness(1.7);pointer-events:none}.ol-unselectable{pointer-events:none}.ol-control{background:none}.ol-control button,.ol-control button:hover,.ol-control button:focus{--_round: 32px;border-radius:var(--_round);background:var(--primary);color:var(--on-primary);width:32px;height:32px;cursor:pointer;border:none;outline:none;pointer-events:all;position:relative;font-size:1rem}.ol-control button:hover:after{background-size:15000%;opacity:.1;transition:background-size var(--speed2) linear;content:"";position:absolute;top:0;right:0;bottom:0;left:0;z-index:1;border-radius:inherit;inline-size:100%;block-size:100%;background-position:center;background-image:radial-gradient(circle,currentColor 1%,transparent 1%)}.ol-control button.ol-zoom-in,.ol-control button.ol-zoom-in:hover{border-top-left-radius:var(--_round);border-top-right-radius:var(--_round);border-bottom-left-radius:.5rem;border-bottom-right-radius:.5rem;margin-bottom:.125rem}.ol-control button.ol-zoom-out,.ol-control button.ol-zoom-out:hover{border-top-left-radius:.5rem;border-top-right-radius:.5rem;border-bottom-left-radius:var(--_round);border-bottom-right-radius:var(--_round)}';/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const $s=(n,e,t)=>{for(const i of e)if(i[0]===n)return(0,i[1])();return t==null?void 0:t()};var Ee,qt;class qs extends Je{constructor(){super();x(this,Ee);this.value=50,this.enabled="true"}static get properties(){return{value:{attribute:"value",type:Number},enabled:{attribute:"enabled",type:String}}}render(){return z`
      <style>
        :host {
          display: block;
          --thumb-size: 3rem;
        }
        .eox-map-compare {
          --thumb-bgc: #fff;
          --thumb-w: var(--thumb-size);

          position: relative;
          height: 100%;
        }
        .eox-map-compare::after {
          content: "";
          display: block;
        }
        .eox-map-compare__first,
        .eox-map-compare__second {
          height: 100%;
          object-fit: cover;
          position: absolute;
          top: 0;
          width: 100%;
        }
        .eox-map-compare__first {
          clip-path: polygon(
            0% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            0% 100%
          );
        }
        .eox-map-compare__second {
          clip-path: polygon(
            100% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            100% 100%
          );
        }
        .eox-map-compare__range {
          background-color: transparent;
          box-sizing: border-box;
          font-family: inherit;
          height: 100%;
          margin: 0;
          outline: none;
          position: absolute;
          top: 0;
          width: 100%;
          pointer-events: none;
        }
        .eox-map-compare__range::-moz-range-thumb {
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          background: transparent;
          border: none;
        }
        .eox-map-compare__range::-webkit-slider-thumb {
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          position: relative;
          background: transparent;
          border: none;
        }
        .eox-map-compare__range::-moz-range-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
        }
        .eox-map-compare__range::-webkit-slider-runnable-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
          height: 100%;
        }
        .eox-map-compare__range,
        .eox-map-compare__range::-webkit-slider-runnable-track,
        .eox-map-compare__range::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
        }
        .slider-bar,
        .slider-thumb {
          position: absolute;
          box-shadow: 0 0.125rem 0.125rem 0 rgb(0 0 0 / 0.32);
        }
        .slider-bar {
          pointer-events: none;
          top: 0;
          width: 0.3rem;
          height: 100%;
          background-color: var(--thumb-bgc);
          z-index: 2;
          left: calc(${this.value}% - 0.15rem);
          -webkit-clip-path: inset(0 -5px 0 -5px);
          clip-path: inset(0 -5px 0 -5px);
        }
        .slider-thumb {
          pointer-events: none;
          top: calc(50% - var(--thumb-size) / 2);
          background: var(--primary);
          z-index: 3;
          width: var(--thumb-size);
          aspect-ratio: 1;
          left: calc(${this.value}% - var(--thumb-size) / 2);
          border-radius: 50%;
          padding: 0.7rem;
          color: var(--on-primary);
          display: flex;
          align-items: center;
          justify-content: center;
          box-sizing: border-box;
        }
        .slider-thumb svg {
          fill: currentColor;
        }
      </style>
      ${$s(this.enabled,[["first",()=>z`<slot name="first"></slot>`],["second",()=>z`<slot name="second"></slot>`]],()=>z`
          <div class="eox-map-compare">
            <div class="eox-map-compare__first">
              <slot name="first"></slot>
            </div>
            <div class="eox-map-compare__second">
              <slot name="second"></slot>
            </div>
            <input
              type="range"
              class="eox-map-compare__range"
              min="0"
              max="100"
              value=${this.value}
              @input=${T(this,Ee,qt)}
            />
            <div class="slider-bar"></div>
            <div class="slider-thumb">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <title>arrow-left-right</title>
                <path
                  d="M6.45,17.45L1,12L6.45,6.55L7.86,7.96L4.83,11H19.17L16.14,7.96L17.55,6.55L23,12L17.55,17.45L16.14,16.04L19.17,13H4.83L7.86,16.04L6.45,17.45Z"
                />
              </svg>
            </div>
          </div>
        `)}
    `}}Ee=new WeakSet,qt=function(t){this.value=parseInt(t.target.value)};customElements.define("eox-map-compare",qs);const Kt={dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"};function Yt(n,e,t,i=!1,s=!1,o=!0){const r=i?[n.feature]:n.features;s&&e.getSource().clear();const a=e.getSource().getFeatures();if(!e.get("multipleFeatures")&&(a.length||r.length>1))return console.error("Multiple features detected!");r.forEach(c=>{const g=c.getGeometry();if(g instanceof q){const u=Ps(g,{radius:6378137,projection:t.projection});c.set("measure",u)}else if(g instanceof ke){const u=Ts(g,{radius:6378137,projection:t.projection});c.set("measure",u)}const d=R(c);c.set("id",d),c.setId(d)}),!i&&r.length&&(e.getSource().addFeatures(r),t.map.getView().fit(e.getSource().getExtent(),{duration:o?750:0}));const l=new Me,h=JSON.parse(l.writeFeatures(r,Kt));(i||s)&&vt(t,"drawend",n,h),vt(t,"addfeatures",n,h)}function vt(n,e,t,i){const s=new CustomEvent(e,{detail:{originalEvent:t,geoJSON:i}});n.dispatchEvent(s)}function Xt(n){n.setRotation(n.getRotation())}function Ks(n,e){const o=n.readFeatures(e)[0].getGeometry().getCoordinates();if(o&&o.length>0){const r=o[0][0][0];return r>=-180&&r<=180?"EPSG:4326":"EPSG:3857"}}function Ys(n,e,t,i=!1,s=!0){try{const o=Xs(n);if(!o){console.error("Unsupported format or invalid data");return}const r=Ks(o,n),a=o.readFeatures(n,{dataProjection:r||Kt.dataProjection,featureProjection:t.projection});Yt({features:a},e,t,!1,i,s)}catch(o){console.error("Error parsing data:",o)}}function Xs(n){return Js(n)?new Me:Qs(n)?new Ci({extractStyles:!1}):en(n)?new wi:null}function Js(n){try{const e=JSON.parse(n);return e.type==="FeatureCollection"||e.type==="Feature"}catch{return!1}}function Qs(n){return n.includes("<kml")&&n.includes("</kml>")}function en(n){try{const e=JSON.parse(n);return e.type==="Topology"&&e.objects}catch{return!1}}function tn(n,e,t=void 0){Ze.defs(n,e),Lt(Ze),typeof t<"u"&&V(n).setExtent(t)}async function sn(n){return Lt(Ze),await xi(n)}function nn(n){return new Me().writeFeaturesObject(n)}function Jt(n,e,t=void 0){return t||(t="EPSG:4326"),st(n,e,t)}function Qt(n,e,t=void 0){return t||(t="EPSG:4326"),Es(n,e,t)}function bt(n,e=!1){e?(n.addInteraction(new He({condition:lt})),"ontouchstart"in window||navigator.maxTouchPoints>0?n.addInteraction(new be({condition:function(i){return this.getPointerCount()===2||lt(i)}})):n.addInteraction(new be)):(n.addInteraction(new He),n.addInteraction(new be))}function on(n){n.getInteractions().getArray().forEach(e=>{(e instanceof He||e instanceof be)&&n.removeInteraction(e)})}function rn(n,e,t=.001){let i=!0;for(let s=n.length-1;s>=0;--s)if(!an(n[s],e[s],t)){i=!1;break}return i}function an(n,e,t=.001){return Math.abs(n-e)<t}function ei(n){if(n){const e=n;return!L(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90?Fs(e):e}return[0,0]}function ln(n,e,t){const i=Object.assign({},t);if(n.interactions[i.id])throw Error(`Interaction with id: ${i.id} already exists.`);i.modify=typeof i.modify=="boolean"?i.modify:!0;const s=e.getSource();i.type==="Box"&&(i.geometryFunction=zs(),i.type="Circle");const o=new Gs({...i,source:s});i.active===!1&&o.setActive(!1),o.on("drawend",l=>{e.get("isDrawingEnabled")&&Yt(l,e,n,!0)}),n.map.addInteraction(o),n.interactions[i.id]=o;const r=new Bs({source:s});r.setActive(i.modify),n.map.addInteraction(r),n.interactions[`${i.id}_modify`]=r;const a=()=>{n.getLayerById(e.get("id"))||(n.removeInteraction(i.id),n.removeInteraction(`${i.id}_modify`),n.map.getLayerGroup().un("change",a))};n.map.getLayerGroup().on("change",a)}const S={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class ti extends Ot{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Si,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(S.ELEMENT,this.handleElementChanged),this.addChangeListener(S.MAP,this.handleMapChanged),this.addChangeListener(S.OFFSET,this.handleOffsetChanged),this.addChangeListener(S.POSITION,this.handlePositionChanged),this.addChangeListener(S.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(S.ELEMENT)}getId(){return this.id}getMap(){return this.get(S.MAP)||null}getOffset(){return this.get(S.OFFSET)}getPosition(){return this.get(S.POSITION)}getPositioning(){return this.get(S.POSITIONING)}handleElementChanged(){Pi(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var t;this.mapPostrenderListenerKey&&((t=this.element)==null||t.remove(),it(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=B(e,It.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(S.ELEMENT,e)}setMap(e){this.set(S.MAP,e)}setOffset(e){this.set(S.OFFSET,e)}setPosition(e){this.set(S.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(S.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),o=this.getRect(s,[Ti(s),Ei(s)]);e=e||{};const r=e.margin===void 0?20:e.margin;if(!Dt(i,o)){const a=o[0]-i[0],l=i[2]-o[2],h=o[1]-i[1],c=i[3]-o[3],g=[0,0];if(a<0?g[0]=a-r:l<0&&(g[0]=Math.abs(l)+r),h<0?g[1]=h-r:c<0&&(g[1]=Math.abs(c)+r),g[0]!==0||g[1]!==0){const d=t.getView().getCenterInternal(),u=t.getPixelFromCoordinateInternal(d);if(!u)return;const m=[u[0]+g[0],u[1]+g[1]],f=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(m),duration:f.duration,easing:f.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,o=i.top+window.pageYOffset;return[s,o,s+t[0],o+t[1]]}setPositioning(e){this.set(S.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(e,t){const i=this.element.style,s=this.getOffset(),o=this.getPositioning();this.setVisible(!0);const r=`${e[0]+s[0]}px`,a=`${e[1]+s[1]}px`;let l="0%",h="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?l="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(l="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?h="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${r}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}class cn extends Je{static get properties(){return{feature:{attribute:!1,property:!0,type:Object},propertyTransform:{attribute:!1,property:!0,type:Function}}}constructor(){super(),this.feature=null,this.propertyTransform=(e,t)=>e}render(){return this.feature?z` <style>
            ul {
              margin: 0;
              padding: 1rem 1rem 1rem 2rem;
              border-radius: 0.5rem;
              max-width: 250px;
              font-size: small;
              background-color: var(--inverse-surface);
              color: var(--inverse-on-surface);
              box-shadow: 0 0.25rem 0.5rem 0 rgb(0 0 0 / 0.4);
              line-height: normal;
              white-space: normal;
            }
            span {
              font-weight: bold;
            }
          </style>
          <ul>
            ${Object.entries(this.feature.getProperties()).map(([e,t])=>this.propertyTransform({key:e,value:t},this.feature)).filter(e=>e).map(({key:e,value:t})=>z`<li><span>${e}</span>: ${t}</li>`)}
          </ul>`:di}}customElements.define("eox-map-tooltip",cn);class hn extends Fi{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Li,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,s){const o=V(i),r=this.getProjection();r&&r!==o&&(t=Ii(r,o,e,t),e=st(e,o,r));const a={url:this.url_,params:{...this.params_,...s},projection:r||o};return ki(a,e,t)}getLegendUrl(e,t){return Mi({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=Ri({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(o,r)=>(this.image.setImage(o),this.imageLoadFunction_(this.image,r),Ni(o))})),super.getImageInternal(e,t,i,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const dn={GeoJSON:Me,MVT:Zi},un={Group:qe,Image:Oi,Tile:Vi,Vector:Z,VectorTile:Ai},gn={ImageWMS:hn,OSM:Bi,Tile:Ui,TileWMS:zi,Vector:Le,VectorTile:ji,WMTS:Gi,XYZ:Di};function ee(n,e,t=!0){var r;e=JSON.parse(JSON.stringify(e));const s={...window.eoxMapAdvancedOlLayers,...un}[e.type];if(!s)throw new Error(`Layer type ${e.type} not supported!`);const o=new s({...e,...e.type!=="MapboxStyle"&&e.source&&{source:ii(e.source)},...e.type==="Group"&&{layers:[]},...e.properties,style:void 0});if(o.set("_jsonDefinition",e,!0),e.type==="Group"){const a=e.layers.reverse().map(l=>ee(n,l));a.forEach(l=>l.set("_group",o,!0)),o.setLayers(new oe(a))}if("style"in e&&o.setStyle(e.style),t&&((r=e.interactions)!=null&&r.length))for(let a=0;a<e.interactions.length;a++){const l=e.interactions[a];si(n,o,l)}return oi(o,e),o}function ii(n){const t={...window.eoxMapAdvancedOlSources,...gn}[n.type];if(n&&!t)throw new Error(`Source type ${n.type} not supported!`);const i={...window.eoxMapAdvancedOlFormats,...dn},s=wn(n);return new t({...n,..."format"in n&&n.type!=="WMTS"&&{format:new i[typeof n.format=="object"?n.format.type:n.format]({...typeof n.format=="object"&&{...n.format}})},..."source"in n&&{source:ii(n.source)},..."tileGrid"in n&&{tileGrid:s},..."projection"in n&&{projection:V(n.projection)}})}function si(n,e,t){t.type==="draw"?ln(n,e,t.options):t.type==="select"?pn(n,e,t.options):t.type==="clusterExplode"&&Cn(n,e,t.options)}function ni(n,e,t){var o,r,a,l;const i=t.get("_jsonDefinition");if(e.type!==i.type||e.type!=="MapboxStyle"&&((o=e.source)==null?void 0:o.type)!==((r=i.source)==null?void 0:r.type))throw new Error("Layers are not compatible to be updated");const s=ee(n,e,!1);if(e.type!=="MapboxStyle"&&JSON.stringify(e.source)!==JSON.stringify(i.source)&&t.setSource(s.getSource()),e.type==="MapboxStyle"&&JSON.stringify(e.properties.mapboxStyle)!==JSON.stringify(i.properties.mapboxStyle)&&(t.getLayers().clear(),t.applyMapboxStyle(e.properties.mapboxStyle,e.properties.applyOptions)),["Vector","VectorTile"].includes(e.type)&&JSON.stringify(e.style)!==JSON.stringify(i.style)&&t.setStyle(s.getStyle()),JSON.stringify(e.properties)!==JSON.stringify(i.properties)&&t.setProperties(e.properties),e.visible!==i.visible&&t.setVisible(e.visible),e.opacity&&e.opacity!==i.opacity&&t.setOpacity(e.opacity),JSON.stringify(e.interactions)!==JSON.stringify(i.interactions)&&((a=i.interactions)==null||a.forEach(h=>{const c=e.interactions.find(g=>{var d,u;return g.type===h.type&&((d=g.options)==null?void 0:d.id)===((u=h.options)==null?void 0:u.id)});c?c.type==="draw"?(n.interactions[c.options.id].setActive(c.options.active),n.interactions[`${c.options.id}_modify`].setActive(c.options.modify)):(n.selectInteractions[c.options.id]||n.interactions[c.options.id]).setActive(c.options.active):h.type==="select"?n.removeSelect(h.options.id):n.removeInteraction(h.options.id)}),(l=e.interactions)==null||l.forEach(h=>{i.interactions.find(g=>{var d,u;return g.type===h.type&&((d=g.options)==null?void 0:d.id)===((u=h.options)==null?void 0:u.id)})||si(n,t,h)})),e.type==="Group"){const h=e.layers.map(u=>{var m;return(m=u.properties)==null?void 0:m.id}),c=t.getLayers();c.getArray().slice().forEach(u=>{h.includes(u.get("id"))||c.remove(u)}),e.layers.forEach(u=>{const m=u.properties.id;if(c.getArray().map(f=>f.get("id")).includes(m))ni(n,u,n.getLayerById(m));else{const f=ee(n,u);c.push(f)}});const d=h.toReversed();c.getArray().sort((u,m)=>d.indexOf(u.get("id"))-d.indexOf(m.get("id"))),c.changed()}return oi(t,e),t.set("_jsonDefinition",e,!0),t}const mn=(n,e)=>e?[...e].reverse().map(t=>ee(n,t)):[];function oi(n,e){n.on("change:opacity",()=>{e.opacity=n.getOpacity()}),n.on("change:visible",()=>{e.visible=n.getVisible()}),n.on("change:zIndex",()=>{e.zIndex=n.getZIndex()}),n.on("propertychange",t=>{t.key!=="map"&&(e.properties[t.key]=t.target.get(t.key))})}class fn{constructor(e,t,i){M(this,"panIntoFeature",(e,t)=>{const i=e instanceof k||e instanceof Ls?e.getGeometry().getExtent():e;this.eoxMap.map.getView().fit(i,t||{duration:750})});var c,g;this.eoxMap=e,this.selectLayer=t,this.options=i,this.active=i.active||t.getVisible(),this.panIn=i.panIn||!1,this.tooltip=i.tooltip!==!1,this.selectedFids=[];const s=this.eoxMap.map.getOverlayById("eox-map-tooltip");let o;this.tooltip&&(s?(this.tooltipElement=s.getElement(),o=s):(this.tooltipElement=this.eoxMap.querySelector("eox-map-tooltip")||this.eoxMap.querySelector("[is=eox-map-tooltip]")||((c=i.overlay)==null?void 0:c.element),this.tooltipElement&&(o=new ti({element:this.tooltipElement,position:void 0,offset:[0,0],positioning:"top-left",className:"eox-map-tooltip",id:"eox-map-tooltip",...i.overlay}),this.eoxMap.map.addOverlay(o))));const r=()=>{o&&i.condition==="pointermove"&&o.setPosition(void 0)};e.map.on("change:target",d=>{var u,m;(u=d.oldValue)==null||u.removeEventListener("pointerleave",r),(m=d.target.getTargetElement())==null||m.addEventListener("pointerleave",r)}),(g=e.map.getTargetElement())==null||g.addEventListener("pointerleave",r);let a;if(this.options.layer)a=this.options.layer;else{const d=this.selectLayer.get("_jsonDefinition");a={...d,style:i.style,properties:{id:this.selectLayer.get("id")+"_select"},source:{type:d.type}}}a.renderMode="vector",delete a.interactions,this.selectStyleLayer=ee(e,a),this.selectStyleLayer.setSource(this.selectLayer.getSource()),this.selectStyleLayer.setMap(this.eoxMap.map);const l=this.selectStyleLayer.getStyleFunction();this.selectStyleLayer.setStyle((d,u)=>this.selectedFids.length&&this.selectedFids.includes(this.getId(d))?l(d,u):null),this.listener=d=>{if(!this.active||d.dragging)return;const u=this.eoxMap.map.getView().getZoom();if(u<this.selectLayer.getMinZoom()||u>this.selectLayer.getMaxZoom())return;const m=this.eoxMap.map.forEachFeatureAtPixel(d.pixel,y=>y,{layerFilter:y=>y===this.selectLayer}),f=m?[this.getId(m)]:[],p=this.selectedFids[0]!==f[0];if(this.selectedFids=f,p&&(this.selectStyleLayer.changed(),m&&this.panIn&&this.panIntoFeature(m)),o){const y=d.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",w=d.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";o.setPositioning(`${w}-${y}`),o.setPosition(m?d.coordinate:null),m&&this.tooltipElement&&(this.tooltipElement.feature=m)}const _=new CustomEvent("select",{detail:{id:i.id,originalEvent:d,feature:m}});this.eoxMap.dispatchEvent(_)},this.eoxMap.map.on(i.condition||"click",this.listener),this.selectLayer.on("change:opacity",()=>{this.selectStyleLayer.setOpacity(this.selectLayer.getOpacity())}),this.selectLayer.on("change:visible",()=>{const d=this.selectLayer.getVisible();this.selectStyleLayer.setVisible(d),this.setActive(d)}),this.changeSourceListener=()=>{this.selectStyleLayer.setSource(this.selectLayer.getSource())},this.selectLayer.on("change:source",this.changeSourceListener);const h=()=>{var d,u;e.getLayerById(t.get("id"))?((d=this.selectStyleLayer)==null||d.setMap(this.eoxMap.map),o==null||o.setMap(this.eoxMap.map)):((u=this.selectStyleLayer)==null||u.setMap(null),o==null||o.setMap(null))};e.map.getLayerGroup().on("change",h),this.pointerMoveListener=d=>{var u;d.dragging||(e.map.getTargetElement().style.cursor=e.map.hasFeatureAtPixel(d.pixel,{layerFilter:m=>{var f,p;return(p=(f=m.get("_jsonDefinition"))==null?void 0:f.interactions)==null?void 0:p.find(_=>{var y;return _.type=="select"&&((y=_.options)==null?void 0:y.condition)==="click"})},...i.atPixelOptions})?i.cursor||"pointer":(u=this.eoxMap.interactions.drawInteraction)!=null&&u.getActive()?"crosshair":"auto")},e.map.on("pointermove",this.pointerMoveListener)}setActive(e){this.active=e}highlightById(e,t){if(this.selectedFids=e,e.length&&t){const i=Gt();if(this.selectLayer instanceof Z)for(let s=0;s<this.selectedFids.length;s++){const o=this.selectedFids[s],r=this.selectLayer.getSource().getFeatureById(o);r&&r.getGeometry()&&$e(i,r.getGeometry().getExtent())}else{const s=this.eoxMap.map,o=this.selectLayer.getFeaturesInExtent(s.getView().calculateExtent(s.getSize()));for(let r=0;r<o.length;r++){const a=o[r];this.selectedFids.includes(this.getId(a))&&$e(i,a.getGeometry().getExtent())}}ls(i)||this.panIntoFeature(i,t)}this.selectStyleLayer.changed()}remove(){this.selectStyleLayer.setMap(null),delete this.eoxMap.selectInteractions[this.options.id],this.selectLayer.un("change:source",this.changeSourceListener),this.eoxMap.map.un(this.options.condition||"click",this.listener),this.eoxMap.map.un("pointermove",this.pointerMoveListener)}getId(e){if(this.options.idProperty)return e.get(this.options.idProperty);if(e.getId()!==void 0)return e.getId();if(e.get("id")!==void 0)return e.get("id");if(R(e)!==void 0)return R(e);throw Error("No feature id found. Please provide which feature property should be taken instead using idProperty.")}}function pn(n,e,t){if(n.interactions[t.id])throw Error(`Interaction with id: ${t.id} already exists.`);return n.selectInteractions[t.id]=new fn(n,e,t),n.selectInteractions[t.id]}const _n=1,yn=28,vn=Math.PI/2;var A,re,N,C,Ke,H,Fe,Ce,ri,Ye;class bn extends Hi{constructor(t,i,s){super(s);x(this,C);x(this,A,null);x(this,re,null);x(this,N,null);x(this,Fe,t=>new Promise(i=>{const s=this.eoxMap.map.getView().getZoom(),o={...v(this,A).fitOptions};o.callback=r=>{var a,l;i(this.eoxMap.map.getView().getZoom()!==s),(l=(a=v(this,A).fitOptions).callback)==null||l.call(a,r)},this.eoxMap.map.getView().fit(t,o)}));this.clusterLayer=i,this.eoxMap=t;const o={maxZoom:20,atPixelOptions:{},fitOptions:{duration:500,padding:[40,40,40,40]}},r=structuredClone(s);r.fitOptions&&(o.fitOptions={...o.fitOptions,...r.fitOptions},delete r.fitOptions),P(this,A,{...o,...r}),this.active=s.active||i.getVisible();const a=new Z;a.setStyle(s.style),P(this,re,a.getStyleFunction())}handleEvent(t){if(!this.getActive())return!0;if(t.type==="pointermove"){const i=this.eoxMap.map.hasFeatureAtPixel(t.pixel,{layerFilter:s=>s===this.clusterLayer,...v(this,A).atPixelOptions});return this.eoxMap.map.getTargetElement().style.cursor=i?"pointer":"default",!i}if(t.type==="click"){const i=this.eoxMap.map.getFeaturesAtPixel(t.pixel,{layerFilter:a=>a===this.clusterLayer,...v(this,A).atPixelOptions});if(i.length===0)return T(this,C,H).call(this),!0;const s=i[0],o=s.get("features");if(o.length===1)return T(this,C,Ke).call(this,t,o[0]),T(this,C,H).call(this),!0;if(v(this,N)&&v(this,N)===s){const a=T(this,C,ri).call(this,s,t.coordinate);T(this,C,Ke).call(this,t,a.feature)}if(this.eoxMap.map.getView().getZoom()>v(this,A).maxZoom-1)return T(this,C,Ce).call(this,s),!1;const r=Gt();return o.forEach(a=>{$e(r,a.getGeometry().getExtent())}),cs(r)<100?(T(this,C,Ce).call(this,s),!1):(v(this,Fe).call(this,r).then(a=>{a||T(this,C,Ce).call(this,s)}),!1)}return!0}setActive(t){t||(T(this,C,H).call(this),this.eoxMap.map.getTargetElement().style.cursor="default"),super.setActive(t)}setMap(t){t||(T(this,C,H).call(this),this.eoxMap.map.getTargetElement().style.cursor="default"),super.setMap(t)}remove(){this.setMap(null)}}A=new WeakMap,re=new WeakMap,N=new WeakMap,C=new WeakSet,Ke=function(t,i){const s=new CustomEvent("clusterSelect",{detail:{originalEvent:t,feature:i}});this.eoxMap.dispatchEvent(s)},H=function(){v(this,N)&&(v(this,N).setStyle(void 0),P(this,N,null))},Fe=new WeakMap,Ce=function(t){v(this,N)&&T(this,C,H).call(this);const i=t.getGeometry().getCoordinates(),s=t.get("features"),o=T(this,C,Ye).call(this,s.length,i,this.eoxMap.map.getView().getResolution()).reduce((r,a,l)=>{const h=new U(a),c=new q([i,a]);r.unshift(new kt({geometry:c,stroke:new Mt({color:"rgba(50, 50, 50, 0.5)",width:2.5})}));const g=new k({...s[l].getProperties()}),d=v(this,re).call(this,g,this.eoxMap.map.getView().getResolution());return d!=null&&d.length&&d.forEach(u=>{const m=u.clone();m.setGeometry(h),r.unshift(m)}),r},[]);t.setStyle(o),P(this,N,t)},ri=function(t,i){const s=t.get("features"),o=T(this,C,Ye).call(this,s.length,t.getGeometry().getCoordinates(),this.eoxMap.map.getView().getResolution());let r=1/0,a;for(let l=0,h=o.length;l<h;++l){const c=(i[0]-o[l][0])**2+(i[1]-o[l][1])**2;c<r&&(a=l,r=c)}return{feature:s[a],coords:o[a]}},Ye=function(t,i,s){let r=_n*yn*(2+t)/(Math.PI*2);const a=Math.PI*2/t,l=[];let h;r=Math.max(r,35)*s;for(let c=0;c<t;++c)h=vn+c*a,l.push([i[0]+r*Math.cos(h),i[1]+r*Math.sin(h)]);return l};function Cn(n,e,t){if(n.interactions[t.id])throw Error(`Interaction with id: ${t.id} already exists.`);const i=new bn(n,e,t);n.interactions[t.id]=i,n.map.addInteraction(i)}function wn(n){let e;if(!(!n||!("tileGrid"in n))){if(n.type==="WMTS"){const i=V("EPSG:3857").getExtent(),s=hs(i)/128,o=new Array(19),r=new Array(19);for(let a=0;a<19;++a)o[a]=s/Math.pow(2,a),r[a]=a;e=new Wi({resolutions:o,origin:et(i),projection:n.tileGrid.projection||"EPSG:3857",matrixIds:r,...n.tileGrid})}else e=$i({...n.tileGrid});return e}}function nt(n,e){return ai(n.map.getLayers().getArray()).find(i=>i.get("id")===e)}function ai(n){const e=[];e.push(...n);let t=e.filter(i=>i instanceof qe);for(;t.length;){const i=[];for(let s=0;s<t.length;s++){const o=t[s].getLayers().getArray();e.push(...o),i.push(...o.filter(r=>r instanceof qe))}t=i}return e}function Xe(n){const e=Object.assign({},n.animationOptions),t=n.map.getView();if(Xt(t),!e||!Object.keys(e).length){t.setCenter(n.center),t.setZoom(n.zoom);return}e.center=ei(n.center),e.zoom=n.zoom,t.animate(e)}const je="units",xn=[1,2,5],te=25.4/.28;class Sn extends G{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+Q,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(je,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(je)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(je,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,s=this.getUnits(),o=s=="degrees"?"degrees":"m";let r=Te(i,e.resolution,t,o);const a=this.minWidth_*(this.dpi_||te)/te,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||te)/te:void 0;let h=a*r,c="";if(s=="degrees"){const w=Is.degrees;h*=w,h<w/60?(c="",r*=3600):h<w?(c="",r*=60):c=""}else if(s=="imperial")h<.9144?(c="in",r/=.0254):h<1609.344?(c="ft",r/=.3048):(c="mi",r/=1609.344);else if(s=="nautical")r/=1852,c="NM";else if(s=="metric")h<1e-6?(c="nm",r*=1e9):h<.001?(c="m",r*=1e6):h<1?(c="mm",r*=1e3):h<1e3?c="m":(c="km",r/=1e3);else if(s=="us")h<.9144?(c="in",r*=39.37):h<1609.344?(c="ft",r/=.30480061):(c="mi",r/=1609.3472);else throw new Error("Invalid units");let g=3*Math.floor(Math.log(a*r)/Math.log(10)),d,u,m,f=0,p,_;for(;;){m=Math.floor(g/3);const w=Math.pow(10,m);if(d=xn[(g%3+3)%3]*w,u=Math.round(d/r),isNaN(u)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&u>=l){d=f,u=p,m=_;break}else if(u>=a)break;f=d,p=u,_=m,++g}const y=this.scaleBar_?this.createScaleBar(u,d,c):d.toFixed(m<0?-m:0)+" "+c;this.renderedHTML_!=y&&(this.innerElement_.innerHTML=y,this.renderedHTML_=y),this.renderedWidth_!=u&&(this.innerElement_.style.width=u+"px",this.renderedWidth_=u),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const s=this.getScaleForResolution(),o=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),r=this.scaleBarSteps_,a=e/r,l=[this.createMarker("absolute")];for(let c=0;c<r;++c){const g=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${g}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||r===2?this.createStepText(c,e,!1,t,i):"")+"</div>")}return l.push(this.createStepText(r,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+o+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,s,o){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+o),l=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${i?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=Te(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||te,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const Ct=["fullscreenchange","webkitfullscreenchange"],wt={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class Pn extends G{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const s=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=s,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(D.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Q} ${Ie}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(xt(t))if(St(t))En(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?Tn(i):li(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=St(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(we(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(wt.ENTERFULLSCREEN)):(we(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(wt.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(se.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(se.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,s=e.length;i<s;++i)it(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();xt(i)?this.element.classList.remove(ct):this.element.classList.add(ct);for(let s=0,o=Ct.length;s<o;++s)e.push(B(i,Ct[s],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function xt(n){const e=n.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&n.fullscreenEnabled)}function St(n){return!!(n.webkitIsFullScreen||n.fullscreenElement)}function li(n){n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function Tn(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():li(n)}function En(n){n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}const ie={VERTICAL:0,HORIZONTAL:1};class Fn extends G{constructor(e){e=e||{},super({target:e.target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=ie.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+Q;const s=this.element;s.className=t+" "+Q+" "+Ie,s.appendChild(i),s.addEventListener(j.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),s.addEventListener(j.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),s.addEventListener(j.POINTERUP,this.handleDraggerEnd_.bind(this),!1),s.addEventListener(D.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(D.CLICK,ds,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const s=getComputedStyle(e);t-=parseFloat(s.paddingRight)+parseFloat(s.paddingLeft),i-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom);const o=e.firstElementChild,r=getComputedStyle(o),a=o.offsetWidth+parseFloat(r.marginRight)+parseFloat(r.marginLeft),l=o.offsetHeight+parseFloat(r.marginTop)+parseFloat(r.marginBottom);return this.thumbSize_=[a,l],t>i?(this.direction_=ie.HORIZONTAL,this.widthLimit_=t-a):(this.direction_=ie.VERTICAL,this.heightLimit_=i-l),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),s=this.getResolutionForPosition_(i),o=t.getConstrainedZoom(t.getZoomForResolution(s));t.animateInternal({zoom:o,duration:this.duration_,easing:qi})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,s=this.handleDraggerEnd_,o=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(B(o,j.POINTERMOVE,i,this),B(o,j.POINTERUP,s,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,s=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(s),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(it),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==ie.HORIZONTAL?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return this.direction_===ie.HORIZONTAL?i=e/this.widthLimit_:i=t/this.heightLimit_,We(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return We(1-t(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}}const ze=.75,ve=.1;class Ln extends G{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",i=e.tipLabel!==void 0?e.tipLabel:"Overview map",s=e.collapseLabel!==void 0?e.collapseLabel:"";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s;const o=e.label!==void 0?e.label:"";typeof o=="string"?(this.label_=document.createElement("span"),this.label_.textContent=o):this.label_=o;const r=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=i,a.appendChild(r),a.addEventListener(D.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new Rt({view:e.view,controls:new oe,interactions:new oe});this.ovmap_=l,e.layers&&e.layers.forEach(function(_){l.addLayer(_)});const h=document.createElement("div");h.className="ol-overviewmap-box",h.style.boxSizing="border-box",this.boxOverlay_=new ti({position:[0,0],positioning:"center-center",element:h}),this.ovmap_.addOverlay(this.boxOverlay_);const c=t+" "+Q+" "+Ie+(this.collapsed_&&this.collapsible_?" "+ht:"")+(this.collapsible_?"":" ol-uncollapsible"),g=this.element;g.className=c,g.appendChild(this.ovmapDiv_),g.appendChild(a);const d=this.boxOverlay_,u=this.boxOverlay_.getElement(),m=_=>({clientX:_.clientX,clientY:_.clientY}),f=function(_){const y=m(_),w=l.getEventCoordinate(y);d.setPosition(w)},p=_=>{const y=l.getEventCoordinateInternal(_),w=this.getMap();w.getView().setCenterInternal(y);const O=w.getOwnerDocument();O.removeEventListener("pointermove",f),O.removeEventListener("pointerup",p)};this.ovmapDiv_.addEventListener("pointerdown",_=>{const y=this.getMap().getOwnerDocument();_.target===u&&y.addEventListener("pointermove",f),y.addEventListener("pointerup",p)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const i=t.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(B(e,us.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const i=e.getView();i&&this.bindView_(i),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===se.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else!this.ovmap_.isRendered()&&(e.key===se.TARGET||e.key===se.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new Qe({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(dt.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(e){e.removeChangeListener(dt.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),o=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&gs(o,this.viewExtent_))return;this.viewExtent_=o;const r=t.getSize(),l=t.getView().calculateExtentInternal(r),h=t.getPixelFromCoordinateInternal(et(o)),c=t.getPixelFromCoordinateInternal(Nt(o)),g=Math.abs(h[0]-c[0]),d=Math.abs(h[1]-c[1]),u=r[0],m=r[1];g<u*ve||d<m*ve||g>u*ze||d>m*ze?this.resetExtent_():Dt(l,o)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),o=e.getView().calculateExtentInternal(i),r=t.getView(),a=Math.log(ze/ve)/Math.LN2,l=1/(Math.pow(2,a/2)*ve);ms(o,l),r.fitInternal(Bt(o))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),s=e.getView(),o=t.getView(),r=this.rotateWithView_?0:-s.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),h=s.getCenter(),c=s.getResolution(),g=o.getResolution(),d=i[0]*c/g,u=i[1]*c/g;if(a.setPosition(h),l){l.style.width=d+"px",l.style.height=u+"px";const m="rotate("+r+"rad)";l.style.transform=m}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=fs(this.ovmap_,It.POSTRENDER,e=>{delete this.ovmapPostrenderKey_,this.updateBox_()}))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(ht),this.collapsed_?we(this.collapseLabel_,this.label_):we(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}class In extends G{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null;const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",s=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",o=document.createElement("button");o.setAttribute("type","button"),o.title=s,o.appendChild(typeof i=="string"?document.createTextNode(i):i),o.addEventListener(D.CLICK,this.handleClick_.bind(this),!1);const r=t+" "+Q+" "+Ie,a=this.element;a.className=r,a.appendChild(o)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?Ut(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(Bt(i))}}const Ue="projection",Pt="coordinateFormat";class kn extends G{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(Ue,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Pt)}getProjection(){return this.get(Ue)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(B(t,j.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(B(t,j.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Pt,e)}setProjection(e){this.set(Ue,V(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const o=this.getProjection();o?this.transform_=Zt(this.mapProjection_,o):this.transform_=Ht}const s=this.getMap().getCoordinateFromPixelInternal(e);if(s){if(this.transform_(s,s),this.wrapX_){const r=this.getProjection()||this.mapProjection_;ks(s,r)}const o=this.getCoordinateFormat();o?t=o(s):t=s.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const b={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Mn={ERROR:"error"};class Rn extends tt{constructor(e){super(Mn.ERROR),this.code=e.code,this.message=e.message}}class Nn extends Ot{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Ht,this.watchId_=void 0,this.addChangeListener(b.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(b.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Zt(V("EPSG:4326"),e),this.position_&&this.set(b.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(b.ACCURACY,t.accuracy),this.set(b.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(b.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(b.HEADING,t.heading===null?void 0:ps(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(b.POSITION,i.slice()),this.set(b.SPEED,t.speed===null?void 0:t.speed);const s=Ms(this.position_,t.accuracy);s.applyTransform(this.transform_),this.set(b.ACCURACY_GEOMETRY,s),this.changed()}positionError_(e){this.dispatchEvent(new Rn(e))}getAccuracy(){return this.get(b.ACCURACY)}getAccuracyGeometry(){return this.get(b.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(b.ALTITUDE)}getAltitudeAccuracy(){return this.get(b.ALTITUDE_ACCURACY)}getHeading(){return this.get(b.HEADING)}getPosition(){return this.get(b.POSITION)}getProjection(){return this.get(b.PROJECTION)}getSpeed(){return this.get(b.SPEED)}getTracking(){return this.get(b.TRACKING)}getTrackingOptions(){return this.get(b.TRACKING_OPTIONS)}setProjection(e){this.set(b.PROJECTION,V(e))}setTracking(e){this.set(b.TRACKING,e)}setTrackingOptions(e){this.set(b.TRACKING_OPTIONS,e)}}class An extends G{constructor(e){const t=e||{},i=document.createElement("div");i.className="geolocation ol-unselectable ol-control";const s=document.createElement("button");s.title="Show your location",s.innerHTML=t.buttonIcon?`
      <img src="${t.buttonIcon}" alt="Geolocation" />
    `:`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>crosshairs-gps</title><path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M3.05,13H1V11H3.05C3.5,6.83 6.83,3.5 11,3.05V1H13V3.05C17.17,3.5 20.5,6.83 20.95,11H23V13H20.95C20.5,17.17 17.17,20.5 13,20.95V23H11V20.95C6.83,20.5 3.5,17.17 3.05,13M12,5A7,7 0 0,0 5,12A7,7 0 0,0 12,19A7,7 0 0,0 19,12A7,7 0 0,0 12,5Z" /></svg>
    `,i.appendChild(s),super({element:i}),this._centerWhenReady=t.centerWhenReady,this._highAccuracy=t.highAccuracy,this._trackAccuracy=t.trackAccuracy,this._trackHeading=t.trackHeading,this._positionFeature=new k({geometry:new U([NaN,NaN]),heading:0}),this._source=new Le({features:[this._positionFeature]}),this._trackAccuracy&&(this._accuracyFeature=new k,this._accuracyFeature.setStyle(new kt({fill:new Ki({color:"rgba(0, 0, 0, 0.2)"}),stroke:new Mt({width:2,color:"rgba(0, 0, 0, 0.7)"})})),this._source.addFeature(this._accuracyFeature)),this._layer=new Z({source:this._source}),t.style&&this._layer.setStyle(t.style),s.addEventListener("click",this.centerOnPosition.bind(this),!1)}setMap(e){this._layer.setMap(e),super.setMap(e),e&&this._centerWhenReady&&this.initGeolocation()}initGeolocation(){return new Promise((e,t)=>{const i=this.getMap();i&&(this._geolocation=new Nn({tracking:!0,trackingOptions:{enableHighAccuracy:this._highAccuracy},projection:i.getView().getProjection()})),this._centerWhenReady&&this._geolocation.once("change:position",s=>{i.getView().setCenter(s.target.getPosition())}),this._geolocation.on("error",s=>t(s)),this._geolocation.on("change:accuracyGeometry",()=>{this._trackAccuracy&&this._accuracyFeature.setGeometry(this._geolocation.getAccuracyGeometry())}),this._geolocation.on("change:heading",s=>{this._trackHeading&&this._highAccuracy&&this._positionFeature.set("heading",s.target.getHeading())}),this._geolocation.on("change:position",()=>{const s=this._geolocation.getPosition();this._positionFeature.getGeometry().setCoordinates(s||null),e(s)})})}getElement(){return this.element}async centerOnPosition(){var e,t;try{await this.initGeolocation();const i=(e=this._geolocation)==null?void 0:e.getPosition();i&&((t=this.getMap())==null||t.getView().setCenter(i))}catch(i){console.error(i)}}}class Vn extends G{constructor(e){const t=e||{};t.opacity===void 0&&(t.opacity=1),t.type===void 0&&(t.type="small");const i=document.createElement("div");i.className="LoadingIndicator ol-unselectable ol-control",i.classList.add("loading-indicator"),i.style.opacity=String(t.opacity),t.spinnerSvg?i.innerHTML=t.spinnerSvg:i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="50" height="50" style="shape-rendering: auto; display: block; background: transparent;" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="164.93361431346415 56.97787143782138" r="35" stroke-width="12" stroke="#1a467c" fill="none" cy="50" cx="50">
      <animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="1.2222222222222223s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
      </circle></g></svg>`,t.type==="fullscreen"?i.classList.add("fullscreen"):i.classList.add("small"),super({element:i})}setMap(e){super.setMap(e),e&&(e.on("loadstart",()=>{this.getElement().style.visibility="visible"}),e.on("loadend",()=>{this.getElement().style.visibility="hidden"}))}getElement(){return this.element}}const On={Zoom:Ji,Rotate:Xi,ScaleLine:Sn,FullScreen:Pn,ZoomSlider:Fn,Attribution:Yi,OverviewMap:Ln,ZoomToExtent:In,MousePosition:kn,Geolocation:An,LoadingIndicator:Vn};function Dn(n,e,t,i){e&&e[t]?JSON.stringify(e[t])!==JSON.stringify(i)&&(n.removeControl(t),Tt(n,t,i)):Tt(n,t,i)}function Tt(n,e,t){const i=Object.assign({},t);t&&t.layers&&(i.layers=mn(n,t.layers));const s=new On[e](i);n.map.addControl(s),n.mapControls[e]=s}function Gn(n,e){let t;const i=(n==null?void 0:n.length)&&rn(n,e.map.getView().getCenter());return n&&!i&&(!e.projection||e.projection==="EPSG:3857"?t=ei(n):t=n),t}function jn(n,e){if(!n||!n.length)return;const t=e.map.getView();return Xt(t),setTimeout(()=>t.fit(n,e.animationOptions),0),n}function zn(n,e,t){const i=n;if(e){const s=Object.keys(e),o=Object.keys(i);for(let r=0,a=s.length;r<a;r++){const l=s[r];o.includes(l)||t.removeControl(l)}}if(i){const s=Object.keys(n);for(let o=0,r=s.length;o<r;o++){const a=s[o];Dn(t,e,a,n[a])}}return i}function Un(n){return JSON.parse(JSON.stringify(n)).reverse()}function Bn(n,e,t){const i=Un(n);e&&e.forEach(l=>{var h,c;if(!((h=l.properties)!=null&&h.id)||!i.find(g=>g.properties.id===l.properties.id)){const g=nt(t,(c=l.properties)==null?void 0:c.id),u=g.get("_jsonDefinition").interactions;u==null||u.forEach(m=>{m.type==="select"?t.removeSelect(m.options.id):t.removeInteraction(m.options.id)}),t.map.removeLayer(g)}}),i.forEach(l=>{t.addOrUpdateLayer(l)});const s=i.map(l=>{var h;return(h=l.properties)==null?void 0:h.id});t.map.getLayers().getArray().sort((l,h)=>s.indexOf(l.get("id"))-s.indexOf(h.get("id")));let o=t.map.getLayers().getArray().reduce((l,h)=>{var c,g,d,u,m,f,p,_;return l.maxZoom=(g=(c=t.config)==null?void 0:c.view)!=null&&g.maxZoom?(u=(d=t.config)==null?void 0:d.view)==null?void 0:u.maxZoom:l.maxZoom===void 0||h.get("maxZoom")<l.maxZoom?h.get("maxZoom"):l.maxZoom,l.minZoom=(f=(m=t.config)==null?void 0:m.view)!=null&&f.minZoom?(_=(p=t.config)==null?void 0:p.view)==null?void 0:_.minZoom:l.minZoom===void 0||h.get("minZoom")>l.minZoom?h.get("minZoom"):l.minZoom,l},{minZoom:0,maxZoom:1/0});t.map.getLayers().getArray().map(l=>l.setMinZoom(l.get("minZoom")-1e-12));const r=t.map.getView().getMinZoom(),a=t.map.getView().getMaxZoom();return r!==o.minZoom&&t.map.getView().setMinZoom(o.minZoom>=0?o.minZoom:0),a!==o.maxZoom&&t.map.getView().setMaxZoom(o.maxZoom),t.map.on("moveend",()=>{var c;if(!((c=t==null?void 0:t.controls)!=null&&c.Zoom))return;const l=t.renderRoot.querySelector("button.ol-zoom-out"),h=t.renderRoot.querySelector("button.ol-zoom-in");t.map.getView().getZoom()>=o.maxZoom?h==null||h.classList.add("disabled"):h==null||h.classList.remove("disabled"),t.map.getView().getZoom()-1e-12<=o.minZoom?l==null||l.classList.add("disabled"):l==null||l.classList.remove("disabled")}),i}function Zn(n,e){return n?(on(e.map),bt(e.map,!0)):bt(e.map),n}function Hn(n,e){var t,i,s,o,r,a,l,h;return Object.assign(e,{...(n==null?void 0:n.animationOptions)!==void 0?{animationOptions:n.animationOptions}:{},projection:((t=n==null?void 0:n.view)==null?void 0:t.projection)||"EPSG:3857",layers:(n==null?void 0:n.layers)||[],controls:(n==null?void 0:n.controls)||{},...(n==null?void 0:n.preventScroll)!==void 0&&e.preventScroll===void 0?{preventScroll:n==null?void 0:n.preventScroll}:{},zoom:((i=n==null?void 0:n.view)==null?void 0:i.zoom)||0,center:((s=n==null?void 0:n.view)==null?void 0:s.center)||[0,0],zoomExtent:(o=n==null?void 0:n.view)==null?void 0:o.zoomExtent}),(r=n==null?void 0:n.view)!=null&&r.minZoom&&e.map.getView().setMinZoom((a=n==null?void 0:n.view)==null?void 0:a.minZoom),(l=n==null?void 0:n.view)!=null&&l.maxZoom&&e.map.getView().setMaxZoom((h=n==null?void 0:n.view)==null?void 0:h.maxZoom),n}function Wn(n,e,t){let i=e;const s=t.map.getView();if(n&&V(n)&&n!==s.getProjection().getCode()){const o=st(s.getCenter(),s.getProjection().getCode(),n),r=V(n),a=s.getResolution(),l=s.getProjection().getMetersPerUnit(),h=r.getMetersPerUnit(),c=Te(s.getProjection(),1/l,s.getCenter(),"m")*l,g=Te(r,1/h,o,"m")*h,d=a*c/g,u=new Qe({zoom:s.getZoom(),center:o,resolution:d,rotation:s.getRotation(),projection:n});["change:center","change:resolution","change:rotation","propertychange"].forEach(f=>{const p=s.getListeners(f);if(p!=null&&p.length)for(let _=p.length-1;_>=0;_--){const y=p[_];s.un(f,y),u.on(f,y)}}),t.map.setView(u),t.getFlatLayersArray(t.map.getLayers().getArray()).filter(f=>f instanceof Z).forEach(f=>f.getSource().refresh()),i=n,t.center=o}return i}function $n(n,e){return n&&setTimeout(()=>{const t=Rs(n);t&&(e.clientHeight<1&&!t.zoom?t.map.setView(e.map.getView()):e.map.setView(t.map.getView()))}),n}function qn(n){return n.projection==="EPSG:4326"?n.map.getView().getCenter():Jt(n.map.getView().getCenter(),n.projection)}function Kn(n){const e=n.map.getView().calculateExtent(n.map.getSize());return n.projection==="EPSG:4326"?e:Qt(e,n.projection)}function Yn(n,e){var o;n.interactions||(n.interactions=[]);const t=(o=n.properties)==null?void 0:o.id,i=t?nt(e,t):!1;let s;return i?(ni(e,n,i),s=i):(s=ee(e,n),e.map.addLayer(s)),s}function Xn(n,e){e.map.removeInteraction(e.interactions[n]),delete e.interactions[n],e.interactions[`${n}_modify`]&&(e.map.removeInteraction(e.interactions[`${n}_modify`]),delete e.interactions[`${n}_modify`])}function Jn(n,e){e.selectInteractions[n].remove(),delete e.selectInteractions[n]}function Qn(n,e){e.map.removeControl(e.mapControls[n]),delete e.mapControls[n]}function eo(n,e){e.map.once("change:target",t=>{t.target.getView().setCenter(e.center)}),e.map.setTarget(e.renderRoot.querySelector("div")),n?e.map.getView().fit(n,e.animationOptions):Xe(e),e.map.on("loadend",()=>{e.dispatchEvent(new CustomEvent("loadend",{detail:e.map}))}),e.dispatchEvent(new CustomEvent("mapmounted",{detail:e.map}))}As();var ae,Y,X,le,ce,he,de,ue,ge,J;class to extends Je{constructor(){super();x(this,ae);x(this,Y);x(this,X);x(this,le);x(this,ce);x(this,he);x(this,de);x(this,ue,[0,0]);x(this,ge,0);x(this,J,"EPSG:3857");M(this,"parseFeature",nn);M(this,"parseTextToFeature",Ys);M(this,"registerProjectionFromCode",sn);M(this,"registerProjection",tn);M(this,"getFlatLayersArray",ai);M(this,"transform",Jt);M(this,"transformExtent",Qt);M(this,"buffer",Vt);this.map=new Rt({controls:[],interactions:Qi({altShiftDragRotate:!1,pinchRotate:!1}),layers:[],view:new Qe({center:[0,0],zoom:0,projection:this.projection})}),this.interactions={},this.selectInteractions={},this.mapControls={}}static get properties(){return{center:{attribute:!1,type:Array},layers:{attribute:!1,type:Array},preventScroll:{attribute:"prevent-scroll",type:Boolean},config:{attribute:!1,type:Object},sync:{attribute:"sync",type:String},projection:{attribute:"projection",type:String},map:{attribute:!1,state:!0},intersections:{attribute:!1,state:!0,type:Object},selectInteractions:{attribute:!1,state:!0,type:Object},mapControls:{attribute:!1,state:!0,type:Object}}}set center(t){const i=Gn(t,this);i!==void 0&&(P(this,ue,i),Xe(this))}get center(){return v(this,ue)}get lonLatCenter(){return qn(this)}get lonLatExtent(){return Kn(this)}set zoom(t){t!==void 0&&(P(this,ge,t),Xe(this))}get zoom(){return v(this,ge)}set zoomExtent(t){P(this,ae,jn(t,this))}set controls(t){P(this,Y,zn(t,v(this,Y),this))}get controls(){return v(this,Y)}set layers(t){P(this,X,Bn(t,v(this,X),this))}get layers(){return v(this,X)}set preventScroll(t){P(this,le,Zn(t,this))}get preventScroll(){return v(this,le)}set config(t){P(this,ce,Hn(t,this))}get config(){return v(this,ce)}set animationOptions(t){P(this,he,t)}get animationOptions(){return v(this,he)}set projection(t){P(this,J,Wn(t,v(this,J),this))}get projection(){return v(this,J)||"EPSG:3857"}set sync(t){P(this,de,$n(t,this))}get sync(){return v(this,de)}addOrUpdateLayer(t){return Yn(t,this)}removeInteraction(t){Xn(t,this)}removeSelect(t){Jn(t,this)}removeControl(t){Qn(t,this)}getLayerById(t){return nt(this,t)}firstUpdated(){eo(v(this,ae),this)}render(){return z`
      <style>
        :host {
          display: block;
        }
        .eox-map-tooltip {
          pointer-events: none !important;
        }
        ${Vs}
        ${Ns}
        ${Ws}
      </style>
      <div style="width: 100%; height: 100%"></div>
      <slot></slot>
    `}}ae=new WeakMap,Y=new WeakMap,X=new WeakMap,le=new WeakMap,ce=new WeakMap,he=new WeakMap,de=new WeakMap,ue=new WeakMap,ge=new WeakMap,J=new WeakMap;customElements.define("eox-map",to);export{to as EOxMap};
