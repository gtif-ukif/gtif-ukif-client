import"./main.B8yLADIV.js";import"./main.ByxKJHqZ.js";import"./main.CR5ksgcV.js";import{_ as Y,s as Z,a as $,r as ee,o as ae,y as te,k as oe,D as se,V as H,F as re,G as ne,n as ie,H as le,I as ce,J as ue}from"./eo-dash.DvnkodTU.js";import{c as pe,j as de,P as ve}from"./ProcessList-BoMw0E3B.DHUQG67q.js";import{o as K,i as _,h as fe}from"./handling-sUbtW4UG.DTmDxG6I.js";import{u as me,d as ye}from"./async-BoNCzhXX.em3idhPj.js";import{p as d,ai as P,h as C,q as L,c as B,o as y,G as he,e as w,j as ge,k as h,N as be,ao as E,b as G,w as M,a as S,v as q,P as xe}from"./framework.3XVMDcJ_.js";import"./lit-element.C0HUAAc_.js";import"./addCommonStyleSheet.Bt3uj5nH.js";import"./sequential.BHUe01AH.js";import"./orient2d.DArCjZZA.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.CBzmZSrJ.js";import"./when.BR7zwNJC.js";import"./getElement.CdRlZPdn.js";import"./GeoJSON.Br7Jz3X5.js";import"./extent.CajDHjk1.js";import"./WKT.CRW3-4HE.js";import"./browser.CQpScIU-.js";import"./commonjsHelpers.BosuxZz1.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./index.DCVKSTf4.js";import"./item.Bx-rtsOD.js";import"./index-oT3WQNKR.N-_pcwDP.js";import"./VTooltip-zPHaRSil.DwU8kuYI.js";import"./forwardRefs-C4TxeJqn.Cee7SwtR.js";import"./transition-LPw0BvKH.DRBnEUHb.js";const Ce=({selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o,mapElement:a})=>{const m=ne(le);q(async()=>{((a==null?void 0:a.layers.length)??0)>1?await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o}):m.once(async()=>{await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,loading:u,processResults:s,isPolling:o})})});const g=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";ie(async(b,f)=>{b===g&&await _({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:c,chartSpec:l,isProcessed:i,processResults:s,loading:u,isPolling:o})})};function we(r,n,c,l){const i=async o=>{await l()},s=async()=>{await xe(()=>{var o;(o=n.value)==null||o.addEventListener("change",i)})},u=()=>{var o;(o=n.value)==null||o.removeEventListener("change",i)};L(c,o=>{var a;r.value=((a=o==null?void 0:o.options)==null?void 0:a.execute)||!1}),q(()=>{L(r,async o=>{o?await s():u()},{immediate:!0})})}const ke="eox-chart{--background-color: transparent;padding-top:1em}eox-jsonform{padding:.7em;min-height:0px}",_e={ref:"container",class:"pb-4"},Pe=[".schema"],Be=[".spec",".dataValues",".opt"],Le={class:"mt-4 text-right"},Te={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(r){const n=d(null),c=d(null),l=d(!1),i=d(null),s=P("jsonformEl"),u=P("chartElRef"),o=C(()=>{var t;return(t=T.value)==null?void 0:t.links.filter(e=>e.endpoint==="eoxhub_workspaces").length}),a=P("container"),m=d(!1),g=d(!1),b=d(!1),f=d([]),z=C(()=>!g.value&&(!!i.value||!!n.value)&&!!s.value),{selectedStac:T,selectedCompareStac:U}=Z($()),k=r.enableCompare?U:T,x=r.enableCompare?ee:ae,j=r.enableCompare?te:oe,V=r.enableCompare?pe:de,Q=C(()=>{var t;return j.value+((t=x.value)==null?void 0:t.id)});Ce({selectedStac:k,mapElement:x.value,jsonformEl:s,jsonformSchema:i,chartSpec:n,isProcessed:l,processResults:f,loading:m,isPolling:b});const W=()=>{f.value.forEach(t=>{var p;if(!t)return;let e="";typeof t=="string"?(e=t.includes("/")?t.split("/").pop()??"":t,e=e.includes("?")?e.split("?")[0]:e):e=((p=k.value)==null?void 0:p.id)+"_process_results.json",ye(e,t)})},D=async()=>{var I,N,O;const e=(R=>{var A,J;for(const F in R.properties)if((J=(A=R.properties[F])==null?void 0:A.options)!=null&&J.drawtools)return F})(i.value);if(e&&Array.isArray((I=s.value)==null?void 0:I.value[e])&&!((N=s.value)!=null&&N.value[e].length)){l.value=!1,n.value=null;return}const v=(O=s.value)==null?void 0:O.editor.validate();if(v!=null&&v.length){console.warn("[eodash] Form validation failed",v);return}f.value=[],await fe({jobs:V,selectedStac:k,jsonformEl:s,jsonformSchema:i,chartSpec:n,chartData:c,loading:m,isPolling:b,processResults:f,mapElement:x.value}),l.value=!0,o.value&&me(V,j.value)};we(g,s,i,D);const X=C(()=>{var e,p,v;const t={};return(e=n.value)!=null&&e.height||(t.height=Math.max((((p=a.value)==null?void 0:p.offsetHeight)??0)-(((v=s.value)==null?void 0:v.offsetHeight)??0),200)+"px"),t});return L(u,t=>{r.enableCompare?ce.value=t:ue.value=t}),(t,e)=>(y(),B("div",_e,[he(ve,{"map-element":h(x),"enable-compare":r.enableCompare},null,8,["map-element","enable-compare"]),i.value?(y(),B("eox-jsonform",{key:Q.value,ref_key:"jsonformEl",ref:s,".schema":i.value},null,40,Pe)):w("v-if",!0),l.value&&n.value?(y(),B("eox-chart",{key:1,ref_key:"chartElRef",ref:u,class:"chart",".spec":E(n.value),".dataValues":E(c.value),"onClick:item":e[0]||(e[0]=(...p)=>h(K)&&h(K)(...p)),style:be(X.value),".opt":r.vegaEmbedOptions},null,44,Be)):w("v-if",!0),ge("div",Le,[z.value?(y(),G(H,{key:0,loading:m.value,style:{"margin-right":"20px"},"append-icon":[h(se)],onClick:D,color:"primary"},{default:M(()=>[...e[1]||(e[1]=[S(" Execute ",-1)])]),_:1},8,["loading","append-icon"])):w("v-if",!0),f.value.length&&l.value&&!o.value?(y(),G(H,{key:1,color:"primary","append-icon":[h(re)],onClick:W},{default:M(()=>[...e[2]||(e[2]=[S(" Download ",-1)])]),_:1},8,["append-icon"])):w("v-if",!0)])],512))}},ra=Y(Te,[["styles",[ke]]]);export{ra as default};
