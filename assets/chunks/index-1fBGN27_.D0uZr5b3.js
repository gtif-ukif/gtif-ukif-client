import"./main.BKF07vjz.js";import"./index.BHUyMZJk.js";import{_ as me,x as _,u as ge,s as E,a as ee,o as he,r as xe,d as te,g as W,y as Ce,k as T,z as N,A as O,l as k,n as Pe,B as Se,v as we,t as Te,h as Ne,C as Oe,D as ae,E as Y,p as Le,F as re}from"./eo-dash.CezI0U6A.js";import{i as Me}from"./easing-CH0-9wR8.CTB3jml5.js";import _e from"./EodashMapBtns-D28yx-YS.53tz024Y.js";import{h as L,ai as se,p as M,ao as ne,v as oe,c as X,o as K,j as z,e as Q,k as r,N as D,G as ke,x as ue,q as Be}from"./framework.3XVMDcJ_.js";import"./lit-element.C0HUAAc_.js";import"./WMTS.RT2X-Ydu.js";import"./Group.DfJ6KxFj.js";import"./extent.CajDHjk1.js";import"./GeoJSON.BZT5TuW2.js";import"./index.Rf_EwgyP.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.Bt3uj5nH.js";import"./WKT.CT1EjoBW.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.Bx-rtsOD.js";import"./ExportState-DyFxaxxx.UhyE7CUz.js";import"./PopUp-CRiYloeP.DgrW592z.js";import"./forwardRefs-DBV6wnvE.Dm1ly1By.js";import"./transition-z6sJX2ml.D9gqZ-Dw.js";import"./VImg-Dk0VwjPj.BbbbGU-G.js";import"./EodashItemFilter-kfgEFJfw.B0APD55q.js";import"./handling-DPq27dpS.DM-3-SMa.js";import"./async-32h0p58v.BTiUjnS1.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.B2l2EfPR.js";import"./index.BUIxO2d3.js";const ie=async(e,o,p)=>{k.debug("Creating layers config",e,o,p);const t=[],s={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const d of o){let a;if(p){const n=typeof p=="string"?new Date(p):p;a=await d.createLayersJson(n)}else a=await d.createLayersJson(void 0);a.forEach(n=>{n.properties.layerControlExpand=!0,n.properties.layerControlToolsExpand=!0}),s.layers.push(...a)}t.push(s);const v=await re.getIndicatorLayers(e),f=re.getObservationPointsLayer(o);f&&s.layers.unshift(f);const u={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},b=v.filter(d=>d.properties.group==="baselayer");if(b.length){let d=0,a=0;for(let n=0;n<b.length;n++){const l=b[n];"visible"in l.properties||(l.properties.visible=!1),l.properties.visible&&(d++,a=n)}d===0&&(b[0].properties.visible=!0),d>0&&b.forEach((n,l)=>{l!==a?n.properties.visible=!1:n.properties.visible=!0}),u.layers.push(...b),u.layers.forEach(n=>{n.properties.layerControlExclusive=!0})}else u.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});u.layers.length&&t.push(u);const C={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},m=v.filter(d=>d.properties.group==="overlay");return m.length&&(C.layers.push(...m),t.unshift(C)),t};let q=null;const Ie=(e,o)=>{const p=t=>{var u;const s=t.map,v=(u=e.value)==null?void 0:u.lonLatCenter,f=s==null?void 0:s.getView().getZoom();v&&!Number.isNaN(v[0])&&!Number.isNaN(v[1])&&!Number.isNaN(f)&&(o.value=[v[0],v[1],f])};oe(()=>{var t,s;(s=(t=e.value)==null?void 0:t.map)==null||s.on("moveend",p)}),ue(()=>{var t,s;(s=(t=e.value)==null?void 0:t.map)==null||s.un("moveend",p)})},le=(e,o,p,t,s,v,f,u)=>{k.debug("InitMap",e.value,o.value,p.values,t.value);const C=Be(u?[o,t,u]:[o,t],async(m,d)=>{var P,J,R,A,Z,V,U,F,G,i,c,h,y,I,x,j;const[a,n,l]=u?m:[m[0],m[1],null],[B,H,g]=u?d:[d[0],d[1],null];if(a){k.debug("Selected Indicator watch triggered",a,n),((P=e==null?void 0:e.value)==null?void 0:P.id)==="main"&&q!==null&&((J=e==null?void 0:e.value)==null||J.map.setView(q),q=null);let S=[];const de=(a==null?void 0:a.id)===(B==null?void 0:B.id)&&(n!==H||l&&(l==null?void 0:l.id)!==(g==null?void 0:g.id)),{selectedCompareStac:fe}=E(ee());if(((R=e==null?void 0:e.value)==null?void 0:R.id)==="main"?await Oe(a):fe.value!==null&&(q=((A=e==null?void 0:e.value)==null?void 0:A.map.getView())??null,e.value.sync=v.value),de){S=await ie(a,p,l??n),k.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(S))),s.value=S,ae(((Z=e.value)==null?void 0:Z.id)==="compare"?"compareTime:updated":"time:updated",e.value,S);return}let w=null;const $=(U=(V=a==null?void 0:a.extent)==null?void 0:V.temporal)==null?void 0:U.interval;if($&&$.length>0&&$[0].length>1&&(w=new Date($[0][1]),k.debug("Indicator load: found stac extent, setting time to latest value",w)),(!l&&w!==null&&w.toISOString()!==t.value&&!Y.value||Y.value&&!t.value&&w)&&(t.value=w.toISOString()),S=await ie(a,p,l??n),f&&!l&&((F=e==null?void 0:e.value)==null?void 0:F.id)==="main"&&(G=a.extent)!=null&&G.spatial.bbox&&!(Y.value&&((i=_.value)!=null&&i[0])&&((c=_.value)!=null&&c[1]))){const ve=(h=a.extent)==null?void 0:h.spatial.bbox[0],ye=Le([...ve]),be=(x=e.value)==null?void 0:x.transformExtent(ye,"EPSG:4326",(I=(y=e.value)==null?void 0:y.map)==null?void 0:I.getView().getProjection());e.value.zoomExtent=be}k.debug("Assigned layers",JSON.parse(JSON.stringify(S))),s.value=S,await ae(((j=e.value)==null?void 0:j.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,s.value)}},{immediate:!0});ue(()=>{C()})},ce=(e,o)=>{Pe(async(p,t)=>{if(p.includes("compare"))return;const s=[];for(const v of e)s.push(...await v.getToolTipProperties());o.value=s,k.debug("Updated tooltip properties",o.value)})},je="#cursor-coordinates[data-v-5143a869]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:11px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media (max-width: 959px){#cursor-coordinates[data-v-5143a869]{display:none}}#scale-line[data-v-5143a869]{position:fixed;left:24px;bottom:28px;color:#fff}@media (max-width: 959px){#scale-line[data-v-5143a869]{bottom:102px}}[data-v-5143a869] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-5143a869] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-5143a869]{position:fixed;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-5143a869]>*{pointer-events:auto}",ze=[".enabled"],Ve=[".center",".zoom",".layers",".controls"],Fe=[".propertyTransform"],Ge=[".layers"],Je=[".propertyTransform"],Re={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Ae={key:1,id:"scale-line",ref:"scale-line"};var pe;const Ze={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=_.value)==null?void 0:e[0])??15,((o=_.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((pe=_.value)==null?void 0:pe[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0,searchParams:{}})}},setup(e){var G;const o=e,{width:p}=ge(),t=i=>{if(typeof i=="number")return i;if(typeof i=="string"){const c=i.split("/"),h=p.value;return h<960?parseInt(c[0])||1:h<1920?parseInt(c[1]||c[0])||1:parseInt(c[2]||c[1]||c[0])||1}return 1},s=L(()=>t(o.btnsPosition.x)),v=L(()=>t(o.btnsPosition.y)),f=L(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0,searchParams:o.btns.searchParams})),u=se("scale-line"),b=se("cursor-coords"),C=M([]),m=M([]),d=L(()=>{const i={Attribution:{collapsible:!0}};return o.enableScaleLine&&u.value&&(i.ScaleLine={target:u.value}),o.enableCursorCoordinates&&b.value&&(i.MousePosition={projection:"EPSG:4326",coordinateFormat:c=>`${c[1].toFixed(3)} °N, ${c[0].toFixed(3)} °E`,target:b.value}),i}),a=ne(o.center),n=ne(((G=_.value)==null?void 0:G[2])??o.zoom),l=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),B=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),H={duration:1200,easing:Me},g=M(null),P=M(null),{selectedCompareStac:J}=E(ee()),R=L(()=>o.enableCompare&&J.value?"":"first");Ie(g,_),oe(()=>{const{selectedCompareStac:i,selectedStac:c,selectedItem:h}=E(ee());he.value=g.value,o.enableCompare&&(xe.value=P.value),o.enableCompare&&(le(P,i,Ne,te,B,g,!1),ce(W,m)),le(g,c,W,te,l,P,o.zoomToExtent,h)}),ce(W,C);const A=L(()=>({visibility:C.value.length?"visible":"hidden"})),Z=L(()=>({visibility:m.value.length?"visible":"hidden"})),V=i=>{const c=i==="main"?C:m,h=i=="main"?we:Te;return y=>{const I=JSON.parse(Se.render(JSON.stringify(c.value),{...h.value??{}})),x=I==null?void 0:I.find(j=>j.id===y.key);if(x){if(typeof y.value=="object"&&(y.value=JSON.stringify(y.value)),!isNaN(Number(y.value))){const j=isNaN(Number(x.decimals))?4:Number(x.decimals);y.value=Number(y.value).toFixed(j).toString()}return{key:x.title||x.id,value:y.value+" "+(x.appendix||"")}}}},{mainRect:U}=Ce(),F=M(0);return oe(()=>{const i=document.querySelector("eo-dash");F.value=(U.value.top||(i==null?void 0:i.getBoundingClientRect().top))??0}),(i,c)=>(K(),X("span",null,[z("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":R.value},[z("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:g,id:"main",".animationOptions":H,".center":r(a),".zoom":r(n),".layers":l.value,".controls":d.value},[z("eox-map-tooltip",{style:D(A.value),".propertyTransform":V("main")},null,44,Fe)],40,Ve),z("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:P,".layers":B.value},[z("eox-map-tooltip",{style:D(Z.value),".propertyTransform":V("compare")},null,44,Je)],40,Ge)],40,ze),e.enableCursorCoordinates?(K(),X("div",Re,null,512)):Q("v-if",!0),e.enableScaleLine?(K(),X("span",Ae,null,512)):Q("v-if",!0),z("div",{class:"map-buttons-container",style:D(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0; top: ${F.value}px;`)},[Q(" prettier-ignore "),ke(_e,{style:D({gridColumn:r(T)||r(N)||r(O)?s.value:"12",gridRow:v.value}),exportMap:r(T)||r(N)||r(O)?f.value.exportMap:!1,changeProjection:r(T)||r(N)||r(O)?f.value.changeProjection:!1,compareIndicators:r(T)||r(N)||r(O)?f.value.compareIndicators:!1,backToPOIs:r(T)||r(N)||r(O)?f.value.backToPOIs:!1,enableSearch:r(T)||r(N)||r(O)?f.value.enableSearch:!1,enableZoom:r(T)||r(N)||r(O)?f.value.enableZoom:!1,searchParams:f.value.searchParams},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom","searchParams"])],4)]))}},xo=me(Ze,[["styles",[je]],["__scopeId","data-v-5143a869"]]);export{xo as default};
