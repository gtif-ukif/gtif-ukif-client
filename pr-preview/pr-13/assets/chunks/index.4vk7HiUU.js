const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/raw.DxtaBMev.js","assets/chunks/basedecoder.B2c5_Eok.js","assets/chunks/lzw.BikwkTY2.js","assets/chunks/jpeg.CbvpOiPg.js","assets/chunks/deflate.B4_27dB1.js","assets/chunks/pako.esm.BkaqWuDM.js","assets/chunks/packbits.D6Qr5eNi.js","assets/chunks/lerc.CPxTxhBR.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/GeoJSON.Bn398gYN.js","assets/chunks/extent.B6zYA2nd.js","assets/chunks/WMTS.B-JsNFwq.js","assets/chunks/Group.ovD7bfEG.js","assets/chunks/WKT.C5Hr-LXE.js","assets/chunks/framework.DJUgTTK8.js","assets/chunks/item.Bx-rtsOD.js","assets/chunks/index.Du0sVlOV.js","assets/chunks/webimage.CU41Mh7j.js"])))=>i.map(i=>d[i]);
var eg=Object.defineProperty;var tg=(n,e,t)=>e in n?eg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var de=(n,e,t)=>tg(n,typeof e!="symbol"?e+"":e,t);import{a8 as rg,a as Ut,v as he,t as ut,aq as ng,ar as ig,as as Ra,M as uo,b as ki,c as dl,P as Un,L as br,d as jt,at as pl,au as sg,j as og,F as ag,G as wi,S as rc,ao as lg,aj as Ts,ak as vi,av as nc,I as gi,W as rt,T as gl,am as ug,al as ic,aw as cg,an as ml,n as lf,X as xr,R as uf,ah as hg,a1 as cf,U as Ti,a2 as fg,ax as Si,ai as dg,o as pg,m as gg,ay as sc,ac as oc,C as yl,x as Pa,e as Ss,h as mg,A as Aa,y as Ia,z as yg,az as ac,N as _g,Q as bg}from"./GeoJSON.Bn398gYN.js";import{P as xg,_ as Rs,K as Ps,Q as hf,c as Lt,a as _l,R as bl,z as Eg,ai as wg,ar as vg,f as ir,a1 as Ri,L as co,v as sr,I as Bn,h as nt,d as De,k as Gn,ab as In,g as me,a9 as ff,e as Tg,a4 as Sg,E as pt,al as Rg,ag as Pg,Z as Ag,n as $i,l as gr,Y as xl,u as As,a2 as df,q as Wt,b as pf,N as Ig,V as Is,$ as lc,aj as Lg,a8 as Pi,S as Cg,U as Fg,an as uc,m as Mg,a3 as Og,C as Ng}from"./extent.B6zYA2nd.js";import{ae as ho,af as q,ag as X,ah as B,ai as Ls,aj as Dg,ak as Ur,al as te,am as T,an as ue,ao as Pe,ap as At,aq as Wn,ar as Fr,as as Ai,at as gf,au as Cs,av as Fs,aw as z,ax as v,ay as N,az as fo,aA as Ve,aB as lt,aC as El,aD as mf,aE as Ms,aF as qr,aG as Ug,aH as Ee,aI as wt,aJ as tr,T as Bg,K as Gg,aK as zg,aL as kg,V as ji,Q as Mr,S as rr,aM as La,a9 as Or,aN as Jr,a as Br,aO as $g,aP as ee,aQ as wl,aR as Zt,aS as jg,aT as vl,aU as Ca,aV as Fa,aW as kr,aX as Vg,aY as Ko,aZ as Xg,a_ as Ma,a$ as yf,b0 as vn,b1 as Vi,b2 as Wg,b3 as Zg,b4 as pe,b5 as Ii,b6 as Li,b7 as _t,b8 as ln,b9 as fn,ba as qg,bb as re,bc as cc,bd as Hg,be as Yg,h as Nr,bf as $r,bg as po,bh as _f,bi as Qr,bj as Kg,bk as Jg,bl as Qg,bm as em,bn as go,bo as tm,bp as Xi,bq as rm,br as nm,bs as im,bt as sm,J as Tl,Y as Vr,bu as dn,bv as om,bw as am,bx as lm,by as Jo,bz as Wi,A as Zn,u as pn,v as Sl,bA as vr,bB as bf,bC as xf,bD as um,j as cm,G as qn,L as Rl,F as Pl,X as Os,bE as Ef,W as hm,H as fm,B as Cn,E as Ns,bF as dm,bG as pm,a5 as Ds,bH as hc,bI as gm,bJ as mo,a7 as mm,bK as wf,bL as ym,r as _m,bM as Al,bN as Oa,bO as vf,bP as fc,bQ as Us,bR as Tf,bS as bm,bT as Sf,bU as xm,bV as Em,bW as wm,bX as vm,bY as Tm,bZ as Sm,i as Rm,b_ as Pm}from"./WMTS.B-JsNFwq.js";import{T as Rf,W as Am}from"./WKT.C5Hr-LXE.js";import{C as Im,b as Na,L as Il}from"./Group.ovD7bfEG.js";import{g as Pf}from"./commonjsHelpers.BosuxZz1.js";import{a5 as Xr}from"./framework.DJUgTTK8.js";import{S as Lm,a as Cm,u as Ll,b as Af,C as Da,I as Bs,M as Fm,A as os,c as ai,d as Mm,f as Om,g as dc,i as pc}from"./item.Bx-rtsOD.js";import{p as Nm}from"./index.Du0sVlOV.js";class Cl extends Lm{constructor(e,t=null,r={},i=[]){super(e,t,r,i)}getAll(){return[]}}class Dm extends Cm{constructor(e,t=null){super(e,t)}}class Um extends Cl{constructor(e,t=null){const r={collections:i=>i.map(s=>s instanceof Da?s:new Da(s))};super(e,t,r)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return Ll(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return Af(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class If extends Cl{constructor(e,t=null){const r={features:i=>i.map(s=>s instanceof Bs?s:new Bs(s))};super(e,t,r)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Ll(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return Af(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function as(n,e=!0,t=!1){return e&&(n=Fm.stac(n,t)),n.type==="Feature"?new Bs(n):n.type==="FeatureCollection"?new If(n):n.type==="Collection"||!n.type&&typeof n.extent<"u"&&typeof n.license<"u"?new Da(n):!n.type&&Array.isArray(n.collections)?new Um(n):new Dm(n)}const Bm={Point:$m,LineString:jm,Polygon:Zm,MultiPoint:Xm,MultiLineString:Vm,MultiPolygon:Wm},Gm={Point:qm,LineString:Hm,Polygon:Ym,MultiPoint:Jm,MultiLineString:Km,MultiPolygon:Qm};class zm extends rg{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,r){const i=e,s=gc(i.geometry,t),o=new Ut;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[r];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(e,t){if(t=t||{},e.features){const r=e,i=[],s=r.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return gc(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const r=e.spatialReference.wkid;return he("EPSG:"+r)}return null}writeGeometryObject(e,t){return mc(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={};if(!e.hasProperties())return r.attributes={},r;const i=e.getProperties(),s=e.getGeometry();if(s){r.geometry=mc(s,t);const o=t&&(t.dataProjection||t.featureProjection);o&&(r.geometry.spatialReference={wkid:Number(he(o).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return xg(i)?r.attributes={}:r.attributes=i,r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let i=0,s=e.length;i<s;++i)r.push(this.writeFeatureObject(e[i],t));return{features:r}}}function gc(n,e){if(!n)return null;let t;if(typeof n.x=="number"&&typeof n.y=="number")t="Point";else if(n.points)t="MultiPoint";else if(n.paths)n.paths.length===1?t="LineString":t="MultiLineString";else if(n.rings){const i=n,s=Hn(i),o=km(i.rings,s);o.length===1?(t="Polygon",n=Object.assign({},n,{rings:o[0]})):(t="MultiPolygon",n=Object.assign({},n,{rings:o}))}const r=Bm[t];return ut(r(n),!1,e)}function km(n,e){const t=[],r=[],i=[];let s,o;for(s=0,o=n.length;s<o;++s)t.length=0,ng(t,0,n[s],e.length),ig(t,0,t.length,e.length)?r.push([n[s]]):i.push(n[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=r.length-1;s>=0;s--){const u=r[s][0];if(Rs(new Ra(u).getExtent(),new Ra(a).getExtent())){r[s].push(a),l=!0;break}}l||r.push([a.reverse()])}return r}function $m(n){let e;return n.m!==void 0&&n.z!==void 0?e=new jt([n.x,n.y,n.z,n.m],"XYZM"):n.z!==void 0?e=new jt([n.x,n.y,n.z],"XYZ"):n.m!==void 0?e=new jt([n.x,n.y,n.m],"XYM"):e=new jt([n.x,n.y]),e}function jm(n){const e=Hn(n);return new br(n.paths[0],e)}function Vm(n){const e=Hn(n);return new ki(n.paths,e)}function Hn(n){let e="XY";return n.hasZ===!0&&n.hasM===!0?e="XYZM":n.hasZ===!0?e="XYZ":n.hasM===!0&&(e="XYM"),e}function Xm(n){const e=Hn(n);return new dl(n.points,e)}function Wm(n){const e=Hn(n);return new uo(n.rings,e)}function Zm(n){const e=Hn(n);return new Un(n.rings,e)}function qm(n,e){const t=n.getCoordinates();let r;const i=n.getLayout();if(i==="XYZ")r={x:t[0],y:t[1],z:t[2]};else if(i==="XYM")r={x:t[0],y:t[1],m:t[2]};else if(i==="XYZM")r={x:t[0],y:t[1],z:t[2],m:t[3]};else if(i==="XY")r={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return r}function Zi(n){const e=n.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function Hm(n,e){const t=Zi(n);return{hasZ:t.hasZ,hasM:t.hasM,paths:[n.getCoordinates()]}}function Ym(n,e){const t=Zi(n);return{hasZ:t.hasZ,hasM:t.hasM,rings:n.getCoordinates(!1)}}function Km(n,e){const t=Zi(n);return{hasZ:t.hasZ,hasM:t.hasM,paths:n.getCoordinates()}}function Jm(n,e){const t=Zi(n);return{hasZ:t.hasZ,hasM:t.hasM,points:n.getCoordinates()}}function Qm(n,e){const t=Zi(n),r=n.getCoordinates(!1),i=[];for(let s=0;s<r.length;s++)for(let o=r[s].length-1;o>=0;o--)i.push(r[s][o]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function mc(n,e){const t=Gm[n.getType()];return t(ut(n,!0,e),e)}const yr="http://www.opengis.net/gml",ey=/^\s*$/;class j extends ho{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:X(this.readFeaturesInternal),featureMembers:q(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const r=e.localName;let i=null;if(r=="FeatureCollection")i=B([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(r=="featureMembers"||r=="featureMember"||r=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const l="p",u="p0";if(!o&&e.childNodes){o=[],a={};for(let f=0,p=e.childNodes.length;f<p;++f){const d=e.childNodes[f];if(d.nodeType===1){const g=d.nodeName.split(":").pop();if(!o.includes(g)){let m="",y=0;const _=d.namespaceURI;for(const b in a){if(a[b]===_){m=b;break}++y}m||(m=l+y,a[m]=_),o.push(m+":"+g)}}}r!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const f=a;a={},a[u]=f}const c={},h=Array.isArray(o)?o:[o];for(const f in a){const p={};for(let d=0,g=h.length;d<g;++d)(h[d].includes(":")?h[d].split(":")[0]:u)===f&&(p[h[d].split(":").pop()]=r=="featureMembers"?X(this.readFeatureElement,this):q(this.readFeatureElement,this));c[a[f]]=p}r=="featureMember"||r=="member"?i=B(void 0,c,e,t):i=B([],c,e,t)}return i===null&&(i=[]),i}readGeometryOrExtent(e,t){const r=t[0];return r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension"),B(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const r=t[0],i=this.readGeometryOrExtent(e,t);return i?pl(i,r):void 0}readGeometryElement(e,t){const r=t[0],i=this.readGeometryOrExtent(e,t);return i?ut(i,!1,r):void 0}readFeatureElementInternal(e,t,r){let i;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let u;const c=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(u=Ls(l,!1),ey.test(u)&&(u=void 0)):(r&&(u=c==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),u?c!=="boundedBy"&&(i=c):u=this.readFeatureElementInternal(l,t,!1));const h=l.attributes.length;if(h>0&&!(u instanceof sg)){u={_content_:u};for(let f=0;f<h;f++){const p=l.attributes[f].name;u[p]=l.attributes[f].value}}s[c]?(s[c]instanceof Array||(s[c]=[s[c]]),s[c].push(u)):s[c]=u}if(!r)return s;const o=new Ut(s);i&&o.setGeometryName(i);const a=e.getAttribute("fid")||Dg(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new jt(r,"XYZ")}readMultiPoint(e,t){const r=B([],this.MULTIPOINT_PARSERS,e,t,this);if(r)return new dl(r)}readMultiLineString(e,t){const r=B([],this.MULTILINESTRING_PARSERS,e,t,this);if(r)return new ki(r)}readMultiPolygon(e,t){const r=B([],this.MULTIPOLYGON_PARSERS,e,t,this);if(r)return new uo(r)}pointMemberParser(e,t){Ur(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){Ur(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){Ur(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new br(r,"XYZ")}readFlatLinearRing(e,t){const r=B(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(r)return r}readLinearRing(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new Ra(r,"XYZ")}readPolygon(e,t){const r=B([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(r&&r[0]){const i=r[0],s=[i.length];let o,a;for(o=1,a=r.length;o<a;++o)Ps(i,r[o]),s.push(i.length);return new Un(i,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return B(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const r=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return r||null}readFeaturesFromNode(e,t){const r={featureType:this.featureType,featureNS:this.featureNS};return r&&Object.assign(r,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[r])||[]}readProjectionFromNode(e){return he(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}j.prototype.namespace=yr;j.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};j.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};j.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};j.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:X(j.prototype.pointMemberParser),pointMembers:X(j.prototype.pointMemberParser)}};j.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:X(j.prototype.lineStringMemberParser),lineStringMembers:X(j.prototype.lineStringMemberParser)}};j.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:X(j.prototype.polygonMemberParser),polygonMembers:X(j.prototype.polygonMemberParser)}};j.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:X(j.prototype.readFlatCoordinatesFromNode)}};j.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:X(j.prototype.readLineString)}};j.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:X(j.prototype.readPolygon)}};j.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:q(j.prototype.readFlatLinearRing)}};const ty=yr+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",ry={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class ae extends j{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[yr].featureMember=X(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:ty}readFlatCoordinates(e,t){const r=Ls(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const u=he(s);u&&(o=u.getAxisOrientation())}const a=r.trim().split(/\s+/),l=[];for(let u=0,c=a.length;u<c;u++){const h=a[u].split(/,+/),f=parseFloat(h[0]),p=parseFloat(h[1]),d=h.length===3?parseFloat(h[2]):0;o.startsWith("en")?l.push(f,p,d):l.push(p,f,d)}return l}readBox(e,t){const r=B([null],this.BOX_PARSERS_,e,t,this);return hf(r[1][0],r[1][1],r[1][3],r[1][4])}innerBoundaryIsParser(e,t){const r=B(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}outerBoundaryIsParser(e,t){const r=B(void 0,this.RING_PARSERS,e,t,this);if(r){const i=t[t.length-1];i[0]=r}}GEOMETRY_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(e)?r="Envelope":(r=e.getType(),r==="MultiPolygon"&&s===!0?r="MultiSurface":r==="Polygon"&&o===!0?r="Surface":r==="MultiLineString"&&a===!0&&(r="MultiCurve")),te("http://www.opengis.net/gml",r)}writeFeatureElement(e,t,r){const i=t.getId();i&&e.setAttribute("fid",i);const s=r[r.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],u=[];if(t.hasProperties()){const h=t.getProperties();for(const f in h){const p=h[f];p!=null&&(l.push(f),u.push(p),f==a||typeof p.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=T(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=T(ue)))}}const c=Object.assign({},s);c.node=e,Pe(c,s.serializers,At(void 0,o),u,r,l)}writeCurveOrLineString(e,t,r){const s=r[r.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,r)}else if(e.nodeName==="Curve"){const o=te(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}}writeLineStringOrCurveMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))}writeMultiCurveOrLineString(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();Pe({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeGeometryElement(e,t,r){const i=r[r.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=pl(t,i):o=ut(t,!0,i),Pe(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}createCoordinatesNode_(e){const t=te(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=t.getCoordinates(),l=a.length,u=new Array(l);for(let c=0;c<l;++c){const h=a[c];u[c]=this.getCoords_(h,o,s)}ue(e,u.join(" "))}writeCurveSegments_(e,t,r){const i=te(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)}writeSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();Pe({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if(e.nodeName==="Surface"){const a=te(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,r)}}RING_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),te(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,r){const i=te(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)}writeRing(e,t,r){const i=te(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)}getCoords_(e,t,r){let s=(t?he(t).getAxisOrientation():"enu").startsWith("en")?e[0]+","+e[1]:e[1]+","+e[0];if(r){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),u=this.getCoords_(l,o,s);ue(a,u)}writeMultiPoint(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();Pe({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,At("pointMember"),a,r,void 0,this)}writePointMember(e,t,r){const i=te(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)}writeLinearRing(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,r)}writeMultiSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();Pe({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeSurfaceOrPolygonMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))}writeEnvelope(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];Pe({node:e},this.ENVELOPE_SERIALIZERS,Wn,a,r,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const i=t[t.length-1].node;return te("http://www.opengis.net/gml",ry[i.nodeName])}}ae.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:q(ae.prototype.readFlatCoordinates)}};ae.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:ae.prototype.innerBoundaryIsParser,outerBoundaryIs:ae.prototype.outerBoundaryIsParser}};ae.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:X(ae.prototype.readFlatCoordinates)}};ae.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:q(j.prototype.readPoint),MultiPoint:q(j.prototype.readMultiPoint),LineString:q(j.prototype.readLineString),MultiLineString:q(j.prototype.readMultiLineString),LinearRing:q(j.prototype.readLinearRing),Polygon:q(j.prototype.readPolygon),MultiPolygon:q(j.prototype.readMultiPolygon),Box:q(ae.prototype.readBox)}};ae.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:T(ae.prototype.writeCurveOrLineString),MultiCurve:T(ae.prototype.writeMultiCurveOrLineString),Point:T(ae.prototype.writePoint),MultiPoint:T(ae.prototype.writeMultiPoint),LineString:T(ae.prototype.writeCurveOrLineString),MultiLineString:T(ae.prototype.writeMultiCurveOrLineString),LinearRing:T(ae.prototype.writeLinearRing),Polygon:T(ae.prototype.writeSurfaceOrPolygon),MultiPolygon:T(ae.prototype.writeMultiSurfaceOrPolygon),Surface:T(ae.prototype.writeSurfaceOrPolygon),MultiSurface:T(ae.prototype.writeMultiSurfaceOrPolygon),Envelope:T(ae.prototype.writeEnvelope)}};ae.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:T(ae.prototype.writeLineStringOrCurveMember),curveMember:T(ae.prototype.writeLineStringOrCurveMember)}};ae.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:T(ae.prototype.writeRing),innerBoundaryIs:T(ae.prototype.writeRing)}};ae.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:T(ae.prototype.writePointMember)}};ae.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:T(ae.prototype.writeSurfaceOrPolygonMember),polygonMember:T(ae.prototype.writeSurfaceOrPolygonMember)}};ae.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:T(ue),upperCorner:T(ue)}};const ny=yr+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",iy={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class F extends j{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:ny,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const r=B([],this.MULTICURVE_PARSERS,e,t,this);if(r)return new ki(r)}readFlatCurveRing(e,t){const r=B([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let s=0,o=r.length;s<o;++s)Ps(i,r[s].getFlatCoordinates());return i}readMultiSurface(e,t){const r=B([],this.MULTISURFACE_PARSERS,e,t,this);if(r)return new uo(r)}curveMemberParser(e,t){Ur(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){Ur(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return B([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return B([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return B([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return B([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const r=B(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}exteriorParser(e,t){const r=B(void 0,this.RING_PARSERS,e,t,this);if(r){const i=t[t.length-1];i[0]=r}}readSurface(e,t){const r=B([null],this.SURFACE_PARSERS,e,t,this);if(r&&r[0]){const i=r[0],s=[i.length];let o,a;for(o=1,a=r.length;o<a;++o)Ps(i,r[o]),s.push(i.length);return new Un(i,"XYZ",s)}}readCurve(e,t){const r=B([null],this.CURVE_PARSERS,e,t,this);if(r)return new br(r,"XYZ")}readEnvelope(e,t){const r=B([null],this.ENVELOPE_PARSERS,e,t,this);return hf(r[1][0],r[1][1],r[2][0],r[2][1])}readFlatPos(e,t){let r=Ls(e,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(r);)s.push(parseFloat(o[1])),r=r.substr(o[0].length);if(r!=="")return;const l=t[0].srsName;if((l?he(l).getAxisOrientation():"enu")==="neu")for(let h=0,f=s.length;h<f;h+=3){const p=s[h],d=s[h+1];s[h]=d,s[h+1]=p}const c=s.length;if(c==2&&s.push(0),c!==0)return s}readFlatPosList(e,t){const r=Ls(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],s=i.srsName,o=i.srsDimension,a=s?he(s).getAxisOrientation():"enu",l=r.split(/\s+/);let u=2;e.getAttribute("srsDimension")?u=Fr(e.getAttribute("srsDimension")):e.getAttribute("dimension")?u=Fr(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?u=Fr(e.parentNode.getAttribute("srsDimension")):o&&(u=Fr(o));const c=a.startsWith("en");let h,f,p;const d=[];for(let g=0,m=l.length;g<m;g+=u)h=parseFloat(l[g]),f=parseFloat(l[g+1]),p=u===3?parseFloat(l[g+2]):0,c?d.push(h,f,p):d.push(f,h,p);return d}writePos_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=a?he(a).getAxisOrientation():"enu",u=t.getCoordinates();let c=l.startsWith("en")?u[0]+" "+u[1]:u[1]+" "+u[0];if(s){const h=u[2]||0;c+=" "+h}ue(e,c)}getCoords_(e,t,r){let s=(t?he(t).getAxisOrientation():"enu").startsWith("en")?e[0]+" "+e[1]:e[1]+" "+e[0];if(r){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=t.getCoordinates(),u=l.length,c=new Array(u);let h;for(let f=0;f<u;++f)h=l[f],c[f]=this.getCoords_(h,a,s);ue(e,c.join(" "))}writePoint(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=te(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,r)}writeEnvelope(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];Pe({node:e},this.ENVELOPE_SERIALIZERS,Wn,a,r,o,this)}writeLinearRing(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=te(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}RING_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),te(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();Pe({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if(e.nodeName==="Surface"){const a=te(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,r)}}writeCurveOrLineString(e,t,r){const s=r[r.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=te(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}else if(e.nodeName==="Curve"){const o=te(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}}writeMultiSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();Pe({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeMultiPoint(e,t,r){const i=r[r.length-1],s=i.srsName,o=i.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();Pe({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,At("pointMember"),a,r,void 0,this)}writeMultiCurveOrLineString(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();Pe({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeRing(e,t,r){const i=te(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)}writeSurfaceOrPolygonMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))}writePointMember(e,t,r){const i=te(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)}writeLineStringOrCurveMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))}writeSurfacePatches_(e,t,r){const i=te(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)}writeCurveSegments_(e,t,r){const i=te(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)}writeGeometryElement(e,t,r){const i=r[r.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=pl(t,i):o=ut(t,!0,i),Pe(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}writeFeatureElement(e,t,r){const i=t.getId();i&&e.setAttribute("fid",i);const s=r[r.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],u=[];if(t.hasProperties()){const h=t.getProperties();for(const f in h){const p=h[f];p!=null&&(l.push(f),u.push(p),f==a||typeof p.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=T(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=T(ue)))}}const c=Object.assign({},s);c.node=e,Pe(c,s.serializers,At(void 0,o),u,r,l)}writeFeatureMembers_(e,t,r){const i=r[r.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=T(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=e,Pe(l,a,At(s,o),t,r)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const i=t[t.length-1].node;return te(this.namespace,iy[i.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(e)?r="Envelope":(r=e.getType(),r==="MultiPolygon"&&s===!0?r="MultiSurface":r==="Polygon"&&o===!0?r="Surface":r==="LineString"&&a===!0?r="Curve":r==="MultiLineString"&&l===!0&&(r="MultiCurve")),te(this.namespace,r)}writeGeometryNode(e,t){t=this.adaptOptions(t);const r=te(this.namespace,"geom"),i={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(i,t),this.writeGeometryElement(r,e,[i]),r}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=te(this.namespace,"featureMembers");r.setAttributeNS(Ai,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(i,t),this.writeFeatureMembers_(r,e,[i]),r}}F.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:q(F.prototype.readFlatPos),posList:q(F.prototype.readFlatPosList),coordinates:q(ae.prototype.readFlatCoordinates)}};F.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:F.prototype.interiorParser,exterior:F.prototype.exteriorParser}};F.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:q(j.prototype.readPoint),MultiPoint:q(j.prototype.readMultiPoint),LineString:q(j.prototype.readLineString),MultiLineString:q(j.prototype.readMultiLineString),LinearRing:q(j.prototype.readLinearRing),Polygon:q(j.prototype.readPolygon),MultiPolygon:q(j.prototype.readMultiPolygon),Surface:q(F.prototype.readSurface),MultiSurface:q(F.prototype.readMultiSurface),Curve:q(F.prototype.readCurve),MultiCurve:q(F.prototype.readMultiCurve),Envelope:q(F.prototype.readEnvelope)}};F.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:X(F.prototype.curveMemberParser),curveMembers:X(F.prototype.curveMemberParser)}};F.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:X(F.prototype.surfaceMemberParser),surfaceMembers:X(F.prototype.surfaceMemberParser)}};F.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:X(j.prototype.readLineString),Curve:X(F.prototype.readCurve)}};F.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:X(j.prototype.readPolygon),Surface:X(F.prototype.readSurface)}};F.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:q(F.prototype.readPatch)}};F.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:q(F.prototype.readSegment)}};F.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:X(F.prototype.readFlatPosList),upperCorner:X(F.prototype.readFlatPosList)}};F.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:q(F.prototype.readPolygonPatch)}};F.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:gf(F.prototype.readLineStringSegment)}};j.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:q(j.prototype.readFlatLinearRing),Ring:q(F.prototype.readFlatCurveRing)}};F.prototype.writeFeatures;F.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:T(F.prototype.writeRing),interior:T(F.prototype.writeRing)}};F.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:T(ue),upperCorner:T(ue)}};F.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:T(F.prototype.writeSurfaceOrPolygonMember),polygonMember:T(F.prototype.writeSurfaceOrPolygonMember)}};F.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:T(F.prototype.writePointMember)}};F.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:T(F.prototype.writeLineStringOrCurveMember),curveMember:T(F.prototype.writeLineStringOrCurveMember)}};F.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:T(F.prototype.writeCurveOrLineString),MultiCurve:T(F.prototype.writeMultiCurveOrLineString),Point:T(F.prototype.writePoint),MultiPoint:T(F.prototype.writeMultiPoint),LineString:T(F.prototype.writeCurveOrLineString),MultiLineString:T(F.prototype.writeMultiCurveOrLineString),LinearRing:T(F.prototype.writeLinearRing),Polygon:T(F.prototype.writeSurfaceOrPolygon),MultiPolygon:T(F.prototype.writeMultiSurfaceOrPolygon),Surface:T(F.prototype.writeSurfaceOrPolygon),MultiSurface:T(F.prototype.writeMultiSurfaceOrPolygon),Envelope:T(F.prototype.writeEnvelope)}};const Fl=F;Fl.prototype.writeFeatures;Fl.prototype.writeFeaturesNode;const Oe=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],sy="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",oy={rte:Lf,trk:Cf,wpt:Ff},ay=z(Oe,{rte:X(Lf),trk:X(Cf),wpt:X(Ff)}),ly=z(Oe,{text:v(N,"linkText"),type:v(N,"linkType")}),uy=z(Oe,{name:v(N),email:Dy,link:qi}),cy=z(Oe,{name:v(N),desc:v(N),author:v(My),copyright:v(Oy),link:qi,time:v(fo),keywords:v(N),bounds:Ny,extensions:yo}),hy=z(Oe,{year:v(Ve),license:v(N)}),fy=z(Oe,{rte:T(zy),trk:T(ky),wpt:T(jy)});class dy extends ho{constructor(e){super(),e=e||{},this.dataProjection=he("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,r=e.length;t<r;++t){const i=e[t];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(Cs(e)):Fs(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const r=this.readMetadataFromNode(t);if(r)return r}return null}readMetadataFromNode(e){if(!Oe.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(Oe.includes(t.namespaceURI)&&t.localName==="metadata")return B({},cy,t,[]);return null}readFeatureFromNode(e,t){if(!Oe.includes(e.namespaceURI))return null;const r=oy[e.localName];if(!r)return null;const i=r(e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(e,t){if(!Oe.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const r=B([],ay,e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_(r),r):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=te("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Ai),r.setAttributeNS(Ai,"xsi:schemaLocation",sy),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),Pe({node:r},fy,Fy,e,[t]),r}}const py=z(Oe,{name:v(N),cmt:v(N),desc:v(N),src:v(N),link:qi,number:v(Ve),extensions:yo,type:v(N),rtept:Uy}),gy=z(Oe,{ele:v(lt),time:v(fo)}),my=z(Oe,{name:v(N),cmt:v(N),desc:v(N),src:v(N),link:qi,number:v(Ve),type:v(N),extensions:yo,trkseg:Gy}),yy=z(Oe,{trkpt:By}),_y=z(Oe,{ele:v(lt),time:v(fo)}),by=z(Oe,{ele:v(lt),time:v(fo),magvar:v(lt),geoidheight:v(lt),name:v(N),cmt:v(N),desc:v(N),src:v(N),link:qi,sym:v(N),type:v(N),fix:v(N),sat:v(Ve),hdop:v(lt),vdop:v(lt),pdop:v(lt),ageofdgpsdata:v(lt),dgpsid:v(Ve),extensions:yo}),xy=["text","type"],Ey=z(Oe,{text:T(ue),type:T(ue)}),wy=z(Oe,["name","cmt","desc","src","link","number","type","rtept"]),vy=z(Oe,{name:T(ue),cmt:T(ue),desc:T(ue),src:T(ue),link:T(Nl),number:T(Ms),type:T(ue),rtept:mf(T(Dl))}),Ty=z(Oe,["ele","time"]),Sy=z(Oe,["name","cmt","desc","src","link","number","type","trkseg"]),Ry=z(Oe,{name:T(ue),cmt:T(ue),desc:T(ue),src:T(ue),link:T(Nl),number:T(Ms),type:T(ue),trkseg:mf(T($y))}),Py=At("trkpt"),Ay=z(Oe,{trkpt:T(Dl)}),Iy=z(Oe,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Ly=z(Oe,{ele:T(qr),time:T(Ug),magvar:T(qr),geoidheight:T(qr),name:T(ue),cmt:T(ue),desc:T(ue),src:T(ue),link:T(Nl),sym:T(ue),type:T(ue),fix:T(ue),sat:T(Ms),hdop:T(qr),vdop:T(qr),pdop:T(qr),ageofdgpsdata:T(qr),dgpsid:T(Ms)}),Cy={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Fy(n,e,t){const r=n.getGeometry();if(r){const i=Cy[r.getType()];if(i){const s=e[e.length-1].node;return te(s.namespaceURI,i)}}}function Ml(n,e,t,r){return n.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in r?(n.push(r.ele),delete r.ele,e.hasZ=!0):n.push(0),"time"in r?(n.push(r.time),delete r.time,e.hasM=!0):n.push(0),n}function Ol(n,e,t){let r="XY",i=2;if(n.hasZ&&n.hasM?(r="XYZM",i=4):n.hasZ?(r="XYZ",i=3):n.hasM&&(r="XYM",i=3),i!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*i]=e[s*4],e[s*i+1]=e[s*4+1],n.hasZ&&(e[s*i+2]=e[s*4+2]),n.hasM&&(e[s*i+2]=e[s*4+3]);if(e.length=e.length/4*i,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*i}return r}function My(n,e){const t=B({},uy,n,e);if(t)return t}function Oy(n,e){const t=B({},hy,n,e);if(t){const r=n.getAttribute("author");return r!==null&&(t.author=r),t}}function Ny(n,e){const t=e[e.length-1],r=n.getAttribute("minlat"),i=n.getAttribute("minlon"),s=n.getAttribute("maxlat"),o=n.getAttribute("maxlon");i!==null&&r!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(i),parseFloat(r)],[parseFloat(o),parseFloat(s)]])}function Dy(n,e){const t=e[e.length-1],r=n.getAttribute("id"),i=n.getAttribute("domain");r!==null&&i!==null&&(t.email=`${r}@${i}`)}function qi(n,e){const t=e[e.length-1],r=n.getAttribute("href");r!==null&&(t.link=r),Ur(ly,n,e)}function yo(n,e){const t=e[e.length-1];t.extensionsNode_=n}function Uy(n,e){const t=B({},gy,n,e);if(t){const r=e[e.length-1],i=r.flatCoordinates,s=r.layoutOptions;Ml(i,s,n,t)}}function By(n,e){const t=B({},_y,n,e);if(t){const r=e[e.length-1],i=r.flatCoordinates,s=r.layoutOptions;Ml(i,s,n,t)}}function Gy(n,e){const t=e[e.length-1];Ur(yy,n,e);const r=t.flatCoordinates;t.ends.push(r.length)}function Lf(n,e){const t=e[0],r=B({flatCoordinates:[],layoutOptions:{}},py,n,e);if(!r)return;const i=r.flatCoordinates;delete r.flatCoordinates;const s=r.layoutOptions;delete r.layoutOptions;const o=Ol(s,i),a=new br(i,o);ut(a,!1,t);const l=new Ut(a);return l.setProperties(r,!0),l}function Cf(n,e){const t=e[0],r=B({flatCoordinates:[],ends:[],layoutOptions:{}},my,n,e);if(!r)return;const i=r.flatCoordinates;delete r.flatCoordinates;const s=r.ends;delete r.ends;const o=r.layoutOptions;delete r.layoutOptions;const a=Ol(o,i,s),l=new ki(i,a,s);ut(l,!1,t);const u=new Ut(l);return u.setProperties(r,!0),u}function Ff(n,e){const t=e[0],r=B({},by,n,e);if(!r)return;const i={},s=Ml([],i,n,r),o=Ol(i,s),a=new jt(s,o);ut(a,!1,t);const l=new Ut(a);return l.setProperties(r,!0),l}function Nl(n,e,t){n.setAttribute("href",e);const i=t[t.length-1].properties,s=[i.linkText,i.linkType];Pe({node:n},Ey,Wn,s,t,xy)}function Dl(n,e,t){const r=t[t.length-1],s=r.node.namespaceURI,o=r.properties;switch(n.setAttributeNS(null,"lat",String(e[1])),n.setAttributeNS(null,"lon",String(e[0])),r.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const l=n.nodeName=="rtept"?Ty[s]:Iy[s],u=El(o,l);Pe({node:n,properties:o},Ly,Wn,u,t,l)}function zy(n,e,t){const r=t[0],i=e.getProperties(),s={node:n};s.properties=i;const o=e.getGeometry();if(o.getType()=="LineString"){const c=ut(o,!0,r);s.geometryLayout=c.getLayout(),i.rtept=c.getCoordinates()}const a=t[t.length-1].node,l=wy[a.namespaceURI],u=El(i,l);Pe(s,vy,Wn,u,t,l)}function ky(n,e,t){const r=t[0],i=e.getProperties(),s={node:n};s.properties=i;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const c=ut(o,!0,r);i.trkseg=c.getLineStrings()}const a=t[t.length-1].node,l=Sy[a.namespaceURI],u=El(i,l);Pe(s,Ry,Wn,u,t,l)}function $y(n,e,t){const r={node:n};r.geometryLayout=e.getLayout(),r.properties={},Pe(r,Ay,Py,e.getCoordinates(),t)}function jy(n,e,t){const r=t[0],i=t[t.length-1];i.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=ut(s,!0,r);i.geometryLayout=o.getLayout(),Dl(n,o.getCoordinates(),t)}}const Vy=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Xy=/^H.([A-Z]{3}).*?:(.*)/,Wy=/^HFDTE(\d{2})(\d{2})(\d{2})/,Zy=/^HFDTEDATE:(\d{2})(\d{2})(\d{2}),(\d{2})/,qy=/\r\n|\r|\n/;class Hy extends Rf{constructor(e){super(),e=e||{},this.dataProjection=he("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none",this.lad_=!1,this.lod_=!1,this.ladStart_=0,this.ladStop_=0,this.lodStart_=0,this.lodStop_=0}readFeatureFromText(e,t){const r=this.altitudeMode_,i=e.split(qy),s={},o=[];let a=2e3,l=0,u=1,c=-1,h,f;for(h=0,f=i.length;h<f;++h){const m=i[h];let y;if(m.charAt(0)=="B"){if(y=Vy.exec(m),y){const _=parseInt(y[1],10),b=parseInt(y[2],10),w=parseInt(y[3],10);let x=parseInt(y[4],10)+parseInt(y[5],10)/6e4;this.lad_&&(x+=parseInt(m.slice(this.ladStart_,this.ladStop_),10)/6e4/10**(this.ladStop_-this.ladStart_)),y[6]=="S"&&(x=-x);let E=parseInt(y[7],10)+parseInt(y[8],10)/6e4;if(this.lod_&&(E+=parseInt(m.slice(this.lodStart_,this.lodStop_),10)/6e4/10**(this.lodStop_-this.lodStart_)),y[9]=="W"&&(E=-E),o.push(E,x),r!="none"){let A;r=="gps"?A=parseInt(y[11],10):r=="barometric"?A=parseInt(y[12],10):A=0,o.push(A)}let S=Date.UTC(a,l,u,_,b,w);S<c&&(S=Date.UTC(a,l,u+1,_,b,w)),o.push(S/1e3),c=S}}else if(m.charAt(0)=="H")y=Zy.exec(m),y?(u=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=Wy.exec(m),y?(u=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=Xy.exec(m),y&&(s[y[1]]=y[2].trim())));else if(m.charAt(0)=="I"){const _=parseInt(m.slice(1,3),10);for(let b=0;b<_;b++){const w=m.slice(7+b*7,10+b*7);if(w==="LAD"||w==="LOD"){const x=parseInt(m.slice(3+b*7,5+b*7),10)-1,E=parseInt(m.slice(5+b*7,7+b*7),10);w==="LAD"?(this.lad_=!0,this.ladStart_=x,this.ladStop_=E):w==="LOD"&&(this.lod_=!0,this.lodStart_=x,this.lodStop_=E)}}}}if(o.length===0)return null;const p=r=="none"?"XYM":"XYZM",d=new br(o,p),g=new Ut(ut(d,!1,t));return g.setProperties(s,!0),g}readFeaturesFromText(e,t){const r=this.readFeatureFromText(e,t);return r?[r]:[]}}const Xe={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},un={};un[Xe.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};un[Xe.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};un[Xe.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};un.none={none:{supports:[],formats:[],qualities:[]}};const Yy=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,yc=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Ky=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Jy(n){let e=n.getComplianceLevelSupportedFeatures();return e===void 0&&(e=un[Xe.VERSION1].level0),{url:n.imageInfo["@id"]===void 0?void 0:n.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,n.imageInfo.formats===void 0?[]:n.imageInfo.formats],qualities:[...e.qualities,n.imageInfo.qualities===void 0?[]:n.imageInfo.qualities],resolutions:n.imageInfo.scale_factors,tileSize:n.imageInfo.tile_width!==void 0?n.imageInfo.tile_height!==void 0?[n.imageInfo.tile_width,n.imageInfo.tile_height]:[n.imageInfo.tile_width,n.imageInfo.tile_width]:n.imageInfo.tile_height!=null?[n.imageInfo.tile_height,n.imageInfo.tile_height]:void 0}}function Qy(n){const e=n.getComplianceLevelSupportedFeatures(),t=Array.isArray(n.imageInfo.profile)&&n.imageInfo.profile.length>1,r=t&&n.imageInfo.profile[1].supports?n.imageInfo.profile[1].supports:[],i=t&&n.imageInfo.profile[1].formats?n.imageInfo.profile[1].formats:[],s=t&&n.imageInfo.profile[1].qualities?n.imageInfo.profile[1].qualities:[];return{url:n.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:n.imageInfo.sizes===void 0?void 0:n.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:n.imageInfo.tiles===void 0?void 0:[n.imageInfo.tiles.map(function(o){return o.width})[0],n.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:n.imageInfo.tiles===void 0?void 0:n.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...r],formats:[...e.formats,...i],qualities:[...e.qualities,...s]}}function e_(n){const e=n.getComplianceLevelSupportedFeatures(),t=n.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...n.imageInfo.extraFormats],r=n.imageInfo.preferredFormats!==void 0&&Array.isArray(n.imageInfo.preferredFormats)&&n.imageInfo.preferredFormats.length>0?n.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&t.includes(s)?s:i},void 0):void 0;return{url:n.imageInfo.id,sizes:n.imageInfo.sizes===void 0?void 0:n.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:n.imageInfo.tiles===void 0?void 0:[n.imageInfo.tiles.map(function(i){return i.width})[0],n.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:n.imageInfo.tiles===void 0?void 0:n.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:n.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...n.imageInfo.extraFeatures],formats:t,qualities:n.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...n.imageInfo.extraQualities],preferredFormat:r}}const _o={};_o[Xe.VERSION1]=Jy;_o[Xe.VERSION2]=Qy;_o[Xe.VERSION3]=e_;class t_{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Xe.VERSION1;case"http://iiif.io/api/image/2/context.json":return Xe.VERSION2;case"http://iiif.io/api/image/3/context.json":return Xe.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Xe.VERSION1)&&this.imageInfo.identifier)return Xe.VERSION1;break}Lt(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case Xe.VERSION1:if(Yy.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Xe.VERSION3:if(Ky.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Xe.VERSION2:if(typeof this.imageInfo.profile=="string"&&yc.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&yc.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const r=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(r)?r[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?un.none.none:un[e][t]}getTileSourceOptions(e){const t=e||{},r=this.getImageApiVersion();if(r===void 0)return;const i=r===void 0?void 0:_o[r](this);if(i!==void 0)return{url:i.url,version:r,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:t.format!==void 0&&i.formats.includes(t.format)?t.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:t.quality&&i.qualities.includes(t.quality)?t.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}class Ul{read(e){if(!e)return null;if(typeof e=="string"){const t=Cs(e);return this.readFromDocument(t)}return Fs(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){_l()}}const r_="http://www.w3.org/1999/xlink";function Yn(n){return n.getAttributeNS(r_,"href")}const bt=[null,"http://www.opengis.net/ows/1.1"],n_=z(bt,{ServiceIdentification:v(P_),ServiceProvider:v(I_),OperationsMetadata:v(S_)});class Mf extends Ul{constructor(){super()}readFromNode(e){const t=B({},n_,e,[]);return t||null}}const i_=z(bt,{DeliveryPoint:v(N),City:v(N),AdministrativeArea:v(N),PostalCode:v(N),Country:v(N),ElectronicMailAddress:v(N)}),s_=z(bt,{Value:Ee(L_)}),o_=z(bt,{AllowedValues:v(__)}),a_=z(bt,{Phone:v(R_),Address:v(y_)}),l_=z(bt,{HTTP:v(v_)}),u_=z(bt,{Get:Ee(w_),Post:void 0}),c_=z(bt,{DCP:v(E_)}),h_=z(bt,{Operation:T_}),f_=z(bt,{Voice:v(N),Facsimile:v(N)}),d_=z(bt,{Constraint:Ee(b_)}),p_=z(bt,{IndividualName:v(N),PositionName:v(N),ContactInfo:v(x_)}),g_=z(bt,{Abstract:v(N),AccessConstraints:v(N),Fees:v(N),Title:v(N),ServiceTypeVersion:v(N),ServiceType:v(N)}),m_=z(bt,{ProviderName:v(N),ProviderSite:v(Yn),ServiceContact:v(A_)});function y_(n,e){return B({},i_,n,e)}function __(n,e){return B({},s_,n,e)}function b_(n,e){const t=n.getAttribute("name");if(t)return B({name:t},o_,n,e)}function x_(n,e){return B({},a_,n,e)}function E_(n,e){return B({},l_,n,e)}function w_(n,e){const t=Yn(n);if(t)return B({href:t},d_,n,e)}function v_(n,e){return B({},u_,n,e)}function T_(n,e){const t=n.getAttribute("name"),r=B({},c_,n,e);if(!r)return;const i=e[e.length-1];i[t]=r}function S_(n,e){return B({},h_,n,e)}function R_(n,e){return B({},f_,n,e)}function P_(n,e){return B({},g_,n,e)}function A_(n,e){return B({},p_,n,e)}function I_(n,e){return B({},m_,n,e)}function L_(n,e){return N(n)}function _c(n,e,t,r,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=e;for(;o<t;){const a=n[o++];i[s++]=n[o++],i[s++]=a;for(let l=2;l<r;++l)i[s++]=n[o++]}return i.length=s,i}class C_ extends Rf{constructor(e){super(),e=e||{},this.dataProjection=he("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const r=this.readGeometryFromText(e,t);return new Ut(r)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const r=og(this.geometryLayout_),i=M_(e,r,this.factor_);_c(i,0,i.length,r,i);const s=new br(i,this.geometryLayout_);return ut(s,!1,this.adaptOptions(t))}writeFeatureText(e,t){const r=e.getGeometry();if(r)return this.writeGeometryText(r,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=ut(e,!0,this.adaptOptions(t));const r=e.getFlatCoordinates(),i=e.getStride();return _c(r,0,r.length,i,r),F_(r,i,this.factor_)}}function F_(n,e,t){t=t||1e5;const r=new Array(e).fill(0);for(let i=0,s=n.length;i<s;)for(let o=0;o<e;++o,++i){const a=n[i]*t,l=a<0?Math.ceil(a-.5):Math.round(a),u=l-r[o];r[o]=l,n[i]=u}return O_(n)}function M_(n,e,t){t=t||1e5;const r=new Array(e).fill(0),i=N_(n);for(let s=0,o=i.length;s<o;)for(let a=0;a<e;++a,++s)r[a]+=i[s],i[s]=r[a]/t;return i}function O_(n){for(let e=0,t=n.length;e<t;++e){const r=n[e];n[e]=r<0?~(r<<1):r<<1}return D_(n)}function N_(n){const e=U_(n);for(let t=0,r=e.length;t<r;++t){const i=e[t];e[t]=i&1?~(i>>1):i>>1}return e}function D_(n){let e="";for(let t=0,r=n.length;t<r;++t)e+=B_(n[t]);return e}function U_(n){const e=[];let t=0,r=0;for(let i=0,s=n.length;i<s;++i){const o=n.charCodeAt(i)-63;t|=(o&31)<<r,o<32?(e.push(t),t=0,r=0):r+=5}return e}function B_(n){let e,t="";for(;n>=32;)e=(32|n&31)+63,t+=String.fromCharCode(e),n>>=5;return e=n+63,t+=String.fromCharCode(e),t}class ge extends F{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,r){const i=r[r.length-1];r[r.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(e,t,r)}}ge.prototype.namespace="http://www.opengis.net/gml/3.2";ge.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:q(F.prototype.readFlatPos),posList:q(F.prototype.readFlatPosList),coordinates:q(ae.prototype.readFlatCoordinates)}};ge.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:F.prototype.interiorParser,exterior:F.prototype.exteriorParser}};ge.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:q(j.prototype.readPoint),MultiPoint:q(j.prototype.readMultiPoint),LineString:q(j.prototype.readLineString),MultiLineString:q(j.prototype.readMultiLineString),LinearRing:q(j.prototype.readLinearRing),Polygon:q(j.prototype.readPolygon),MultiPolygon:q(j.prototype.readMultiPolygon),Surface:q(ge.prototype.readSurface),MultiSurface:q(F.prototype.readMultiSurface),Curve:q(ge.prototype.readCurve),MultiCurve:q(F.prototype.readMultiCurve),Envelope:q(ge.prototype.readEnvelope)}};ge.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:X(F.prototype.curveMemberParser),curveMembers:X(F.prototype.curveMemberParser)}};ge.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:X(F.prototype.surfaceMemberParser),surfaceMembers:X(F.prototype.surfaceMemberParser)}};ge.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:X(j.prototype.readLineString),Curve:X(F.prototype.readCurve)}};ge.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:X(j.prototype.readPolygon),Surface:X(F.prototype.readSurface)}};ge.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:q(F.prototype.readPatch)}};ge.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:q(F.prototype.readSegment)}};ge.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:X(F.prototype.readFlatPosList),upperCorner:X(F.prototype.readFlatPosList)}};ge.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:q(F.prototype.readPolygonPatch)}};ge.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:gf(F.prototype.readLineStringSegment)}};ge.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:X(j.prototype.pointMemberParser),pointMembers:X(j.prototype.pointMemberParser)}};ge.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:X(j.prototype.lineStringMemberParser),lineStringMembers:X(j.prototype.lineStringMemberParser)}};ge.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:X(j.prototype.polygonMemberParser),polygonMembers:X(j.prototype.polygonMemberParser)}};ge.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:X(j.prototype.readFlatCoordinatesFromNode)}};ge.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:X(j.prototype.readLineString)}};ge.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:X(j.prototype.readPolygon)}};ge.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:q(j.prototype.readFlatLinearRing),Ring:q(ge.prototype.readFlatCurveRing)}};ge.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:T(F.prototype.writeRing),interior:T(F.prototype.writeRing)}};ge.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:T(ue),upperCorner:T(ue)}};ge.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:T(F.prototype.writeSurfaceOrPolygonMember),polygonMember:T(F.prototype.writeSurfaceOrPolygonMember)}};ge.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:T(F.prototype.writePointMember)}};ge.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:T(F.prototype.writeLineStringOrCurveMember),curveMember:T(F.prototype.writeLineStringOrCurveMember)}};ge.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:T(F.prototype.writeCurveOrLineString),MultiCurve:T(F.prototype.writeMultiCurveOrLineString),Point:T(ge.prototype.writePoint),MultiPoint:T(F.prototype.writeMultiPoint),LineString:T(F.prototype.writeCurveOrLineString),MultiLineString:T(F.prototype.writeMultiCurveOrLineString),LinearRing:T(F.prototype.writeLinearRing),Polygon:T(F.prototype.writeSurfaceOrPolygon),MultiPolygon:T(F.prototype.writeMultiSurfaceOrPolygon),Surface:T(F.prototype.writeSurfaceOrPolygon),MultiSurface:T(F.prototype.writeMultiSurfaceOrPolygon),Envelope:T(F.prototype.writeEnvelope)}};class Of{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}class G_ extends Of{constructor(e,t){super(e),this.conditions=t,Lt(this.conditions.length>=2,"At least 2 conditions are required")}}class z_ extends G_{constructor(e){super("And",Array.prototype.slice.call(arguments))}}class k_ extends Of{constructor(e,t,r){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=r}}function $_(n){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(z_,e))}function j_(n,e,t){return new k_(n,e,t)}const bc={"http://www.opengis.net/gml":{boundedBy:v(j.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:X(j.prototype.readFeaturesInternal)}},V_={"http://www.opengis.net/wfs":{totalInserted:v(Ve),totalUpdated:v(Ve),totalDeleted:v(Ve)},"http://www.opengis.net/wfs/2.0":{totalInserted:v(Ve),totalUpdated:v(Ve),totalDeleted:v(Ve)}},X_={"http://www.opengis.net/wfs":{TransactionSummary:v(Ec,"transactionSummary"),InsertResults:v(vc,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:v(Ec,"transactionSummary"),InsertResults:v(vc,"insertIds")}},W_={"http://www.opengis.net/wfs":{PropertyName:T(ue)},"http://www.opengis.net/wfs/2.0":{PropertyName:T(ue)}},Nf={"http://www.opengis.net/wfs":{Insert:T(Tc),Update:T(Rc),Delete:T(Sc),Property:T(Pc),Native:T(Ac)},"http://www.opengis.net/wfs/2.0":{Insert:T(Tc),Update:T(Rc),Delete:T(Sc),Property:T(Pc),Native:T(Ac)}},Df="feature",Bl="http://www.w3.org/2000/xmlns/",Gl={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Ua={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},zl={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},xc={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},kl={"2.0.0":ge,"1.1.0":F,"1.0.0":ae},Z_="1.1.0";class q_ extends ho{constructor(e){super(),e=e||{},this.version_=e.version?e.version:Z_,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new kl[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:xc[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const r={node:e};Object.assign(r,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(r,this.getReadOptions(e,t||{}));const i=[r];let s;this.version_==="2.0.0"?s=bc:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=B([],s,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=Cs(e);return this.readTransactionResponseFromDocument(t)}return Fs(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=Cs(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Fs(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},r=Fr(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,B(t,bc,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return B({},X_,e,[])}writeGetFeature(e){const t=te(Ua[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Ai,"xsi:schemaLocation",this.schemaLocation_);const r={node:t};if(Object.assign(r,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),Lt(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let i=e.filter;e.bbox&&(Lt(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(r,{geometryName:e.geometryName,filter:i}),Bc(t,e.featureTypes,[r])}else e.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(r,{geometryName:i.geometryName,filter:s}),Bc(t,[i.name],[r])});return t}combineBboxAndFilter(e,t,r,i){const s=j_(e,t,r);return i?$_(i,s):s}writeTransaction(e,t,r,i){const s=[],o=i.version?i.version:this.version_,a=te(Ua[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(Ai,"xsi:schemaLocation",xc[o]);const u=H_(a,l,o,i);return e&&ls("Insert",e,s,u),t&&ls("Update",t,s,u),r&&ls("Delete",r,s,u),i.nativeElements&&ls("Native",i.nativeElements,s,u),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const r=[{}];return this.gmlFormat_.readGeometryElement(t,r),he(r.pop().srsName)}}return null}}function H_(n,e,t,r){const i=r.featurePrefix?r.featurePrefix:Df;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:n},{version:t,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:i,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},e)}function ls(n,e,t,r){Pe(r,Nf,At(n),e,t)}function Ec(n,e){return B({},V_,n,e)}const Y_={"http://www.opengis.net/ogc":{FeatureId:X(function(n,e){return n.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:X(function(n,e){return n.getAttribute("fid")})}};function wc(n,e){Ur(Y_,n,e)}const K_={"http://www.opengis.net/wfs":{Feature:wc},"http://www.opengis.net/wfs/2.0":{Feature:wc}};function vc(n,e){return B([],K_,n,e)}function Tc(n,e,t){const r=t[t.length-1],i=r.featureType,s=r.featureNS,o=r.gmlVersion,a=te(s,i);n.appendChild(a),o===2?ae.prototype.writeFeatureElement(a,e,t):o===3?F.prototype.writeFeatureElement(a,e,t):ge.prototype.writeFeatureElement(a,e,t)}function Uf(n,e,t){const i=t[t.length-1].version,s=Gl[i],o=te(s,"Filter"),a=te(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),n.appendChild(o)}function $l(n,e){n=n||Df;const t=n+":";return e.startsWith(t)?e:t+e}function Sc(n,e,t){const r=t[t.length-1];Lt(e.getId()!==void 0,"Features must have an id set");const i=r.featureType,s=r.featurePrefix,o=r.featureNS,a=$l(s,i);n.setAttribute("typeName",a),n.setAttributeNS(Bl,"xmlns:"+s,o);const l=e.getId();l!==void 0&&Uf(n,l,t)}function Rc(n,e,t){const r=t[t.length-1];Lt(e.getId()!==void 0,"Features must have an id set");const i=r.version,s=r.featureType,o=r.featurePrefix,a=r.featureNS,l=$l(o,s),u=e.getGeometryName();n.setAttribute("typeName",l),n.setAttributeNS(Bl,"xmlns:"+o,a);const c=e.getId();if(c!==void 0){const h=e.getKeys(),f=[];for(let p=0,d=h.length;p<d;p++){const g=e.get(h[p]);if(g!==void 0){let m=h[p];g&&typeof g.getSimplifiedGeometry=="function"&&(m=u),f.push({name:m,value:g})}}Pe({version:i,gmlVersion:r.gmlVersion,node:n,hasZ:r.hasZ,srsName:r.srsName},Nf,At("Property"),f,t),Uf(n,c,t)}}function Pc(n,e,t){const r=t[t.length-1],i=r.version,s=Ua[i],a=te(s,i==="2.0.0"?"ValueReference":"Name"),l=r.gmlVersion;if(n.appendChild(a),ue(a,e.name),e.value!==void 0&&e.value!==null){const u=te(s,"Value");n.appendChild(u),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?ae.prototype.writeGeometryElement(u,e.value,t):l===3?F.prototype.writeGeometryElement(u,e.value,t):ge.prototype.writeGeometryElement(u,e.value,t):ue(u,e.value)}}function Ac(n,e,t){e.vendorId&&n.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&n.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&ue(n,e.value)}const bo={"http://www.opengis.net/wfs":{Query:T(Ic)},"http://www.opengis.net/wfs/2.0":{Query:T(Ic)},"http://www.opengis.net/ogc":{During:T(Fc),And:T(us),Or:T(us),Not:T(Mc),BBOX:T(Lc),Contains:T(Ir),Intersects:T(Ir),Within:T(Ir),DWithin:T(Cc),PropertyIsEqualTo:T(Ft),PropertyIsNotEqualTo:T(Ft),PropertyIsLessThan:T(Ft),PropertyIsLessThanOrEqualTo:T(Ft),PropertyIsGreaterThan:T(Ft),PropertyIsGreaterThanOrEqualTo:T(Ft),PropertyIsNull:T(Oc),PropertyIsBetween:T(Nc),PropertyIsLike:T(Dc)},"http://www.opengis.net/fes/2.0":{During:T(Fc),And:T(us),Or:T(us),Not:T(Mc),BBOX:T(Lc),Contains:T(Ir),Disjoint:T(Ir),Intersects:T(Ir),ResourceId:T(Q_),Within:T(Ir),DWithin:T(Cc),PropertyIsEqualTo:T(Ft),PropertyIsNotEqualTo:T(Ft),PropertyIsLessThan:T(Ft),PropertyIsLessThanOrEqualTo:T(Ft),PropertyIsGreaterThan:T(Ft),PropertyIsGreaterThanOrEqualTo:T(Ft),PropertyIsNull:T(Oc),PropertyIsBetween:T(Nc),PropertyIsLike:T(Dc)}};function Ic(n,e,t){const r=t[t.length-1],i=r.version,s=r.featurePrefix,o=r.featureNS,a=r.propertyNames,l=r.srsName;let u;s?u=$l(s,e):u=e;let c;i==="2.0.0"?c="typeNames":c="typeName",n.setAttribute(c,u),l&&n.setAttribute("srsName",l),o&&n.setAttributeNS(Bl,"xmlns:"+s,o);const h=Object.assign({},r);h.node=n,Pe(h,W_,At("PropertyName"),a,t);const f=r.filter;if(f){const p=te(xo(i),"Filter");n.appendChild(p),J_(p,f,t)}}function J_(n,e,t){const r=t[t.length-1],i={node:n};Object.assign(i,{context:r}),Pe(i,bo,At(e.getTagName()),[e],t)}function Lc(n,e,t){const r=t[t.length-1],s=r.context.version;r.srsName=e.srsName;const o=kl[s];Kn(s,n,e.geometryName),o.prototype.writeGeometryElement(n,e.extent,t)}function Q_(n,e,t){n.setAttribute("rid",e.rid)}function Ir(n,e,t){const r=t[t.length-1],s=r.context.version;r.srsName=e.srsName;const o=kl[s];Kn(s,n,e.geometryName),o.prototype.writeGeometryElement(n,e.geometry,t)}function Cc(n,e,t){const s=t[t.length-1].context.version;Ir(n,e,t);const o=te(xo(s),"Distance");ue(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),n.appendChild(o)}function Fc(n,e,t){const s=t[t.length-1].context.version;Gs(zl[s],"ValueReference",n,e.propertyName);const o=te(yr,"TimePeriod");n.appendChild(o);const a=te(yr,"begin");o.appendChild(a),Uc(a,e.begin);const l=te(yr,"end");o.appendChild(l),Uc(l,e.end)}function us(n,e,t){const i=t[t.length-1].context,s={node:n};Object.assign(s,{context:i});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const u=o[a];Pe(s,bo,At(u.getTagName()),[u],t)}}function Mc(n,e,t){const i=t[t.length-1].context,s={node:n};Object.assign(s,{context:i});const o=e.condition;Pe(s,bo,At(o.getTagName()),[o],t)}function Ft(n,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),Kn(s,n,e.propertyName),zs(s,n,""+e.expression)}function Oc(n,e,t){const s=t[t.length-1].context.version;Kn(s,n,e.propertyName)}function Nc(n,e,t){const s=t[t.length-1].context.version,o=xo(s);Kn(s,n,e.propertyName);const a=te(o,"LowerBoundary");n.appendChild(a),zs(s,a,""+e.lowerBoundary);const l=te(o,"UpperBoundary");n.appendChild(l),zs(s,l,""+e.upperBoundary)}function Dc(n,e,t){const s=t[t.length-1].context.version;n.setAttribute("wildCard",e.wildCard),n.setAttribute("singleChar",e.singleChar),n.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),Kn(s,n,e.propertyName),zs(s,n,""+e.pattern)}function Gs(n,e,t,r){const i=te(n,e);ue(i,r),t.appendChild(i)}function zs(n,e,t){Gs(xo(n),"Literal",e,t)}function Kn(n,e,t){n==="2.0.0"?Gs(zl[n],"ValueReference",e,t):Gs(Gl[n],"PropertyName",e,t)}function Uc(n,e){const t=te(yr,"TimeInstant");n.appendChild(t);const r=te(yr,"timePosition");t.appendChild(r),ue(r,e)}function Bc(n,e,t){const r=t[t.length-1],i=Object.assign({},r);i.node=n,Pe(i,bo,At("Query"),e,t)}function xo(n){let e;return n==="2.0.0"?e=zl[n]:e=Gl[n],e}const we={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class Gc{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readLineString());return t}readWkbHeader(e){const r=this.readUint8()>0,i=this.readUint32(r),s=Math.floor((i&268435455)/1e3),o=!!(i&2147483648)||s===1||s===3,a=!!(i&1073741824)||s===2||s===3,l=!!(i&536870912),u=(i&268435455)%1e3,c=["XY",o?"Z":"",a?"M":""].join(""),h=l?this.readUint32(r):null;if(e!==void 0&&e!==u)throw new Error("Unexpected WKB geometry type "+u);if(this.initialized_){if(this.isLittleEndian_!==r)throw new Error("Inconsistent endian");if(this.layout_!==c)throw new Error("Inconsistent geometry layout");if(h&&this.srid_!==h)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=r,this.hasZ_=o,this.hasM_=a,this.layout_=c,this.srid_=h,this.initialized_=!0;return u}readWkbPayload(e){switch(e){case we.POINT:return this.readPoint();case we.LINE_STRING:return this.readLineString();case we.POLYGON:case we.TRIANGLE:return this.readPolygon();case we.MULTI_POINT:return this.readMultiPoint();case we.MULTI_LINE_STRING:return this.readMultiLineString();case we.MULTI_POLYGON:case we.POLYHEDRAL_SURFACE:case we.TIN:return this.readMultiPolygon();case we.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const r=this.readUint32(),i=[];for(let s=0;s<r;s++){const o=e.call(this,t);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,we.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,we.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,we.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case we.POINT:return new jt(t,this.layout_);case we.LINE_STRING:return new br(t,this.layout_);case we.POLYGON:case we.TRIANGLE:return new Un(t,this.layout_);case we.MULTI_POINT:return new dl(t,this.layout_);case we.MULTI_LINE_STRING:return new ki(t,this.layout_);case we.MULTI_POLYGON:case we.POLYHEDRAL_SURFACE:case we.TIN:return new uo(t,this.layout_);case we.GEOMETRY_COLLECTION:return new wi(t);default:return null}}getSrid(){return this.srid_}}class e0{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const r=Object.assign.apply(null,t.split("").map((i,s)=>({[i]:e[s]})));for(const i of this.layout_)this.writeDouble(i in r?r[i]:this.nodata_[i])}writeLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writePoint(e[r],t)}writePolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeLineString(e[r],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(1),this.writePoint(e[r],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(2),this.writeLineString(e[r],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(3),this.writePolygon(e[r],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const r=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(e instanceof rc)return r(e.getLayout(),t);if(e instanceof wi){const i=e.getGeometriesArray();for(let s=0;s<i.length&&t!=="XY";s++)t=this.findMinimumLayout(i[s],t)}return t}writeGeometry(e,t){const r={Point:we.POINT,LineString:we.LINE_STRING,Polygon:we.POLYGON,MultiPoint:we.MULTI_POINT,MultiLineString:we.MULTI_LINE_STRING,MultiPolygon:we.MULTI_POLYGON,GeometryCollection:we.GEOMETRY_COLLECTION},i=e.getType(),s=r[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof rc?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,e.getCoordinates(),e.getLayout()):e instanceof wi&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,o)=>s+o[0],0),t=new ArrayBuffer(e),r=new DataView(t);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:r.setUint8(i,s[1]);break;case 4:r.setUint32(i,s[1],this.isLittleEndian_);break;case 8:r.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),t}}class t0 extends ag{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new Ut({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let r=[];const i=this.readGeometry(e,t);return this.splitCollection&&i instanceof wi?r=i.getGeometriesArray():r=[i],r.map(s=>new Ut({geometry:s}))}readGeometry(e,t){const r=zc(e);if(!r)return null;const s=new Gc(r).readGeometry();return this.viewCache_=r,t=this.getReadOptions(e,t),this.viewCache_=null,ut(s,!1,t)}readProjection(e){const t=this.viewCache_||zc(e);if(!t)return;const r=new Gc(t);return r.readWkbHeader(),r.getSrid()&&he("EPSG:"+r.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new wi(e.map(r=>r.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const r=new e0({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=t.dataProjection&&he(t.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}r.writeGeometry(ut(e,!0,t),i);const s=r.getBuffer();return this.hex_?r0(s):s}}function r0(n){const e=new Uint8Array(n);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function n0(n){const e=new Uint8Array(n.length/2);for(let t=0;t<n.length/2;t++)e[t]=parseInt(n.substr(t*2,2),16);return new DataView(e.buffer)}function zc(n){return typeof n=="string"?n0(n):ArrayBuffer.isView(n)?n instanceof DataView?n:new DataView(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?new DataView(n):null}const qe=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function Hi(n){return lg(n[0].version,"1.3")>=0}const i0=z(qe,{Service:v(R0),Capability:v(S0)}),s0=z(qe,{Request:v(N0),Exception:v(L0),Layer:v(C0),UserDefinedSymbolization:v(v0)});class o0 extends Ul{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=B({version:this.version},i0,e,[]);return t||null}}const Bf={Name:v(N),Title:v(N),Abstract:v(N),KeywordList:v(Vf),OnlineResource:v(Yn),ContactInformation:v(P0),Fees:v(N),AccessConstraints:v(N)},a0=z(qe,Bf),l0=z(qe,{...Bf,LayerLimit:v(Ve),MaxWidth:v(Ve),MaxHeight:v(Ve)}),u0=z(qe,{ContactPersonPrimary:v(A0),ContactPosition:v(N),ContactAddress:v(I0),ContactVoiceTelephone:v(N),ContactFacsimileTelephone:v(N),ContactElectronicMailAddress:v(N)}),c0=z(qe,{ContactPerson:v(N),ContactOrganization:v(N)}),h0=z(qe,{AddressType:v(N),Address:v(N),City:v(N),StateOrProvince:v(N),PostCode:v(N),Country:v(N)}),f0=z(qe,{Format:X(N)}),Gf={Name:v(N),Title:v(N),Abstract:v(N),KeywordList:v(Vf),BoundingBox:Ee($f),Dimension:Ee(F0),Attribution:v(w0),AuthorityURL:Ee(B0),Identifier:Ee(N),MetadataURL:Ee(G0),DataURL:Ee(Er),FeatureListURL:Ee(Er),Style:Ee(z0),Layer:Ee(Eo)},zf=z(qe,{...Gf,SRS:Ee(N),Extent:v(M0),ScaleHint:Ee(O0),LatLonBoundingBox:v((n,e)=>$f(n,e,!1)),Layer:Ee(Eo)}),kf=z(qe,{...Gf,CRS:Ee(N),EX_GeographicBoundingBox:v(T0),MinScaleDenominator:v(lt),MaxScaleDenominator:v(lt),Layer:Ee(Eo)}),d0=z(qe,{Title:v(N),OnlineResource:v(Yn),LogoURL:v(jf)}),p0=z(qe,{westBoundLongitude:v(lt),eastBoundLongitude:v(lt),southBoundLatitude:v(lt),northBoundLatitude:v(lt)}),g0=z(qe,{GetCapabilities:v(li),GetMap:v(li),GetFeatureInfo:v(li),DescribeLayer:v(li),GetLegendGraphic:v(li)}),m0=z(qe,{Format:Ee(N),DCPType:Ee(D0)}),y0=z(qe,{HTTP:v(U0)}),_0=z(qe,{Get:v(Er),Post:v(Er)}),b0=z(qe,{Name:v(N),Title:v(N),Abstract:v(N),LegendURL:Ee(jf),StyleSheetURL:v(Er),StyleURL:v(Er)}),x0=z(qe,{Format:v(N),OnlineResource:v(Yn)}),E0=z(qe,{Keyword:X(N)});function w0(n,e){return B({},d0,n,e)}function v0(n,e){return{SupportSLD:!!wt(n.getAttribute("SupportSLD")),UserLayer:!!wt(n.getAttribute("UserLayer")),UserStyle:!!wt(n.getAttribute("UserStyle")),RemoteWFS:!!wt(n.getAttribute("RemoteWFS")),InlineFeatureData:!!wt(n.getAttribute("InlineFeatureData")),RemoteWCS:!!wt(n.getAttribute("RemoteWCS"))}}function $f(n,e,t=!0){const r=[tr(n.getAttribute("minx")),tr(n.getAttribute("miny")),tr(n.getAttribute("maxx")),tr(n.getAttribute("maxy"))],i=[tr(n.getAttribute("resx")),tr(n.getAttribute("resy"))],s={extent:r,res:i};return t&&(Hi(e)?s.crs=n.getAttribute("CRS"):s.srs=n.getAttribute("SRS")),s}function T0(n,e){const t=B({},p0,n,e);if(!t)return;const r=t.westBoundLongitude,i=t.southBoundLatitude,s=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(r===void 0||i===void 0||s===void 0||o===void 0))return[r,i,s,o]}function S0(n,e){return B({},s0,n,e)}function R0(n,e){return B({},Hi(e)?l0:a0,n,e)}function P0(n,e){return B({},u0,n,e)}function A0(n,e){return B({},c0,n,e)}function I0(n,e){return B({},h0,n,e)}function L0(n,e){return B([],f0,n,e)}function C0(n,e){const t=B({},Hi(e)?kf:zf,n,e);return t.Layer===void 0?Object.assign(t,Eo(n,e)):t}function Eo(n,e){const t=Hi(e),r=e[e.length-1],i=B({},t?kf:zf,n,e);if(!i)return;let s=wt(n.getAttribute("queryable"));s===void 0&&(s=r.queryable),i.queryable=s!==void 0?s:!1;let o=Fr(n.getAttribute("cascaded"));o===void 0&&(o=r.cascaded),i.cascaded=o;let a=wt(n.getAttribute("opaque"));a===void 0&&(a=r.opaque),i.opaque=a!==void 0?a:!1;let l=wt(n.getAttribute("noSubsets"));l===void 0&&(l=r.noSubsets),i.noSubsets=l!==void 0?l:!1;let u=tr(n.getAttribute("fixedWidth"));u||(u=r.fixedWidth),i.fixedWidth=u;let c=tr(n.getAttribute("fixedHeight"));c||(c=r.fixedHeight),i.fixedHeight=c;const h=["Style","AuthorityURL"];t?h.push("CRS"):h.push("SRS","Dimension"),h.forEach(function(p){if(p in r){const d=i[p]||[];i[p]=d.concat(r[p])}});const f=["BoundingBox","Attribution"];return t?f.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):f.push("LatLonBoundingBox","ScaleHint","Extent"),f.forEach(function(p){if(!(p in i)){const d=r[p];i[p]=d}}),i}function F0(n,e){const t={name:n.getAttribute("name"),units:n.getAttribute("units"),unitSymbol:n.getAttribute("unitSymbol")};return Hi(e)&&Object.assign(t,{default:n.getAttribute("default"),multipleValues:wt(n.getAttribute("multipleValues")),nearestValue:wt(n.getAttribute("nearestValue")),current:wt(n.getAttribute("current")),values:N(n)}),t}function M0(n,e){return{name:n.getAttribute("name"),default:n.getAttribute("default"),nearestValue:wt(n.getAttribute("nearestValue"))}}function O0(n,e){return{min:tr(n.getAttribute("min")),max:tr(n.getAttribute("max"))}}function Er(n,e){return B({},x0,n,e)}function N0(n,e){return B({},g0,n,e)}function D0(n,e){return B({},y0,n,e)}function U0(n,e){return B({},_0,n,e)}function li(n,e){return B({},m0,n,e)}function jf(n,e){const t=Er(n,e);if(t){const r=[Fr(n.getAttribute("width")),Fr(n.getAttribute("height"))];return t.size=r,t}}function B0(n,e){const t=Er(n,e);if(t)return t.name=n.getAttribute("name"),t}function G0(n,e){const t=Er(n,e);if(t)return t.type=n.getAttribute("type"),t}function z0(n,e){return B({},b0,n,e)}function Vf(n,e){return B([],E0,n,e)}const k0="_feature",$0="_layer";class j0 extends ho{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new ae,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const r=e.localName;let i=[];if(e.childNodes.length===0)return i;if(r=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,u=t[0],c=$0,h=l.localName.replace(c,"");if(this.layers_&&!this.layers_.includes(h))continue;const f=h+k0;u.featureType=f,u.featureNS=this.featureNS_;const p={};p[f]=X(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const d=z([u.featureNS,null],p);l.setAttribute("namespaceURI",this.featureNS_);const g=B([],d,l,t,this.gmlFormat_);g&&Ps(i,g)}if(r=="FeatureCollection"){const s=B([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(e,t){const r={};return t&&Object.assign(r,this.getReadOptions(e,t)),this.readFeatures_(e,[r])}}const hr=[null,"http://www.opengis.net/wmts/1.0"],Jn=[null,"http://www.opengis.net/ows/1.1"],V0=z(hr,{Contents:v(eb)});let jl=class extends Ul{constructor(){super(),this.owsParser_=new Mf}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let r=this.owsParser_.readFromNode(e);return r?(r.version=t,r=B(r,V0,e,[]),r||null):null}};const X0=z(hr,{Layer:Ee(tb),TileMatrixSet:Ee(rb)}),W0=z(hr,{Style:Ee(nb),Format:Ee(N),TileMatrixSetLink:Ee(ib),Dimension:Ee(sb),ResourceURL:Ee(ob)},z(Jn,{Title:v(N),Abstract:v(N),WGS84BoundingBox:v(Wf),BoundingBox:Ee(ab),Identifier:v(N)})),Z0=z(hr,{LegendURL:Ee(lb)},z(Jn,{Title:v(N),Identifier:v(N)})),q0=z(hr,{TileMatrixSet:v(N),TileMatrixSetLimits:v(cb)}),H0=z(hr,{TileMatrixLimits:X(hb)}),Y0=z(hr,{TileMatrix:v(N),MinTileRow:v(Ve),MaxTileRow:v(Ve),MinTileCol:v(Ve),MaxTileCol:v(Ve)}),K0=z(hr,{Default:v(N),Value:Ee(N)},z(Jn,{Identifier:v(N)})),Xf=z(Jn,{LowerCorner:X(Ba),UpperCorner:X(Ba)}),J0=z(hr,{WellKnownScaleSet:v(N),TileMatrix:Ee(ub)},z(Jn,{SupportedCRS:v(N),Identifier:v(N),BoundingBox:v(Wf)})),Q0=z(hr,{TopLeftCorner:v(Ba),ScaleDenominator:v(lt),TileWidth:v(Ve),TileHeight:v(Ve),MatrixWidth:v(Ve),MatrixHeight:v(Ve)},z(Jn,{Identifier:v(N)}));function eb(n,e){return B({},X0,n,e)}function tb(n,e){return B({},W0,n,e)}function rb(n,e){return B({},J0,n,e)}function nb(n,e){const t=B({},Z0,n,e);if(!t)return;const r=n.getAttribute("isDefault")==="true";return t.isDefault=r,t}function ib(n,e){return B({},q0,n,e)}function sb(n,e){return B({},K0,n,e)}function ob(n,e){const t=n.getAttribute("format"),r=n.getAttribute("template"),i=n.getAttribute("resourceType"),s={};return t&&(s.format=t),r&&(s.template=r),i&&(s.resourceType=i),s}function Wf(n,e){const t=B([],Xf,n,e);if(t.length==2)return bl(t)}function ab(n,e){const t=n.getAttribute("crs"),r=B([],Xf,n,e);if(r.length==2)return{extent:bl(r),crs:t}}function lb(n,e){const t={};return t.format=n.getAttribute("format"),t.href=Yn(n),t}function Ba(n,e){const t=N(n).split(/\s+/);if(!t||t.length!=2)return;const r=+t[0],i=+t[1];if(!(isNaN(r)||isNaN(i)))return[r,i]}function ub(n,e){return B({},Q0,n,e)}function cb(n,e){return B([],H0,n,e)}function hb(n,e){return B({},Y0,n,e)}window.eoxMapAdvancedOlFormats={EsriJSON:zm,GML:Fl,GPX:dy,IGC:Hy,IIIFInfo:t_,KML:Gg,OWS:Mf,Polyline:C_,TopoJSON:Bg,WFS:q_,WKB:t0,WKT:Am,WMSCapabilities:o0,WMSGetFeatureInfo:j0,WMTSCapabilities:jl};function Zf(n,e,t){const r=[];let i=n(0),s=n(1),o=e(i),a=e(s);const l=[s,i],u=[a,o],c=[1,0],h={};let f=1e5,p,d,g,m,y,_;for(;--f>0&&c.length>0;)g=c.pop(),i=l.pop(),o=u.pop(),_=g.toString(),_ in h||(r.push(o[0],o[1]),h[_]=!0),m=c.pop(),s=l.pop(),a=u.pop(),y=(g+m)/2,p=n(y),d=e(p),Eg(d[0],d[1],o[0],o[1],a[0],a[1])<t?(r.push(a[0],a[1]),_=m.toString(),h[_]=!0):(c.push(m,y,y,g),u.push(a,d,d,o),l.push(s,p,p,i));return r}function fb(n,e,t,r,i){const s=he("EPSG:4326");return Zf(function(o){return[n,e+(t-e)*o]},Ts(s,r),i)}function db(n,e,t,r,i){const s=he("EPSG:4326");return Zf(function(o){return[e+(t-e)*o,n]},Ts(s,r),i)}function pb(n){if(!(n.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=n.inversePixelTransform[0],t=n.inversePixelTransform[1],r=Math.sqrt(e*e+t*t),i=n.frameState,s=vi(n.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=zg(i.viewState.resolution,r);let a;return new kg(n.context,r,i.extent,s,i.viewState.rotation,o,a)}const gb=new Mr({color:"rgba(0,0,0,0.2)"}),mb=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class yb extends ji{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:gb,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?nc.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?nc.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new rr({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new La({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Or({color:"rgba(0,0,0,1)"}),stroke:new Mr({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=r=>{const i=r.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new rr({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new La({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Or({color:"rgba(0,0,0,1)"}),stroke:new Mr({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=r=>{const i=r.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(Jr.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:mb,this.setSource(new Br({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Im,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new rr({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let r=e.slice();return this.projection_&&this.getSource().getWrapX()&&wg(r,this.projection_),this.loadedExtent_&&(vg(this.loadedExtent_,r,t)?r=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[r]}loaderFunction(e,t,r){this.loadedExtent_=e;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=ir(s,e);if(this.renderedExtent_&&Ri(this.renderedExtent_,o)&&this.renderedResolution_===t||(this.renderedExtent_=o,this.renderedResolution_=t,co(o)))return;const a=sr(o),l=t*t/4;(!this.projection_||!gi(this.projection_,r))&&this.updateProjectionInfo_(r),this.createGraticule_(o,a,t,l);let c=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(c+=this.meridians_.length),this.parallelsLabels_&&(c+=this.parallels_.length);let h;for(;c>this.featurePool_.length;)h=new Ut,this.featurePool_.push(h);const f=i.getFeaturesCollection();f.clear();let p=0,d,g;for(d=0,g=this.meridians_.length;d<g;++d)h=this.featurePool_[p++],h.setGeometry(this.meridians_[d]),h.setStyle(this.lineStyle_),f.push(h);for(d=0,g=this.parallels_.length;d<g;++d)h=this.featurePool_[p++],h.setGeometry(this.parallels_[d]),h.setStyle(this.lineStyle_),f.push(h)}addMeridian_(e,t,r,i,s,o){const a=this.getMeridian_(e,t,r,i,o);if(Bn(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new jt([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(e,t,r,i,s,o){const a=this.getParallel_(e,t,r,i,o);if(Bn(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new jt([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(e){const t=e.frameState.viewState.rotation,r=e.frameState.viewState.resolution,i=e.frameState.size,s=e.frameState.extent,o=sr(s);let a=s;if(t){const d=i[0]*r,g=i[1]*r;a=[o[0]-d/2,o[1]-g/2,o[0]+d/2,o[1]+g/2]}let l=0,u=0,c=this.latLabelPosition_<.5;const h=this.projection_.getExtent(),f=nt(h);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Rs(h,s)){l=Math.floor((s[0]-h[0])/f),u=Math.ceil((s[2]-h[2])/f);const d=Math.abs(t)>Math.PI/2;c=c!==d}const p=pb(e);for(let d=l;d<=u;++d){let g=this.meridians_.length+this.parallels_.length,m,y,_,b;if(this.meridiansLabels_)for(y=0,_=this.meridiansLabels_.length;y<_;++y){const w=this.meridians_[y];if(!t&&d===0)b=this.getMeridianPoint_(w,s,y);else{const x=w.clone();x.translate(d*f,0),x.rotate(-t,o),b=this.getMeridianPoint_(x,a,y),b.rotate(t,o)}m=this.featurePool_[g++],m.setGeometry(b),m.set("graticule_label",this.meridiansLabels_[y].text),p.drawFeature(m,this.lonLabelStyle_(m))}if(this.parallelsLabels_&&(d===l&&c||d===u&&!c))for(y=0,_=this.parallels_.length;y<_;++y){const w=this.parallels_[y];if(!t&&d===0)b=this.getParallelPoint_(w,s,y);else{const x=w.clone();x.translate(d*f,0),x.rotate(-t,o),b=this.getParallelPoint_(x,a,y),b.rotate(t,o)}m=this.featurePool_[g++],m.setGeometry(b),m.set("graticule_label",this.parallelsLabels_[y].text),p.drawFeature(m,this.latLabelStyle_(m))}}}createGraticule_(e,t,r,i){const s=this.getInterval_(r);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=nt(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Rs(a,e)&&(nt(e)>=l?(e[0]=a[0],e[2]=a[2]):o=!0);const u=[De(t[0],this.minX_,this.maxX_),De(t[1],this.minY_,this.maxY_)],c=this.toLonLatTransform_(u);isNaN(c[1])&&(c[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let h=De(c[0],this.minLon_,this.maxLon_),f=De(c[1],this.minLat_,this.maxLat_);const p=this.maxLines_;let d,g,m,y,_=e;o||(_=[De(e[0],this.minX_,this.maxX_),De(e[1],this.minY_,this.maxY_),De(e[2],this.minX_,this.maxX_),De(e[3],this.minY_,this.maxY_)]);const b=Gn(_,this.toLonLatTransform_,void 0,8);let w=b[3],x=b[2],E=b[1],S=b[0];if(o||(In(_,this.bottomLeft_)&&(S=this.minLon_,E=this.minLat_),In(_,this.bottomRight_)&&(x=this.maxLon_,E=this.minLat_),In(_,this.topLeft_)&&(S=this.minLon_,w=this.maxLat_),In(_,this.topRight_)&&(x=this.maxLon_,w=this.maxLat_),w=De(w,f,this.maxLat_),x=De(x,h,this.maxLon_),E=De(E,this.minLat_,f),S=De(S,this.minLon_,h)),h=Math.floor(h/s)*s,y=De(h,this.minLon_,this.maxLon_),g=this.addMeridian_(y,E,w,i,e,0),d=0,o)for(;(y-=s)>=S&&d++<p;)g=this.addMeridian_(y,E,w,i,e,g);else for(;y!=this.minLon_&&d++<p;)y=Math.max(y-s,this.minLon_),g=this.addMeridian_(y,E,w,i,e,g);if(y=De(h,this.minLon_,this.maxLon_),d=0,o)for(;(y+=s)<=x&&d++<p;)g=this.addMeridian_(y,E,w,i,e,g);else for(;y!=this.maxLon_&&d++<p;)y=Math.min(y+s,this.maxLon_),g=this.addMeridian_(y,E,w,i,e,g);for(this.meridians_.length=g,this.meridiansLabels_&&(this.meridiansLabels_.length=g),f=Math.floor(f/s)*s,m=De(f,this.minLat_,this.maxLat_),g=this.addParallel_(m,S,x,i,e,0),d=0;m!=this.minLat_&&d++<p;)m=Math.max(m-s,this.minLat_),g=this.addParallel_(m,S,x,i,e,g);for(m=De(f,this.minLat_,this.maxLat_),d=0;m!=this.maxLat_&&d++<p;)m=Math.min(m+s,this.maxLat_),g=this.addParallel_(m,S,x,i,e,g);this.parallels_.length=g,this.parallelsLabels_&&(this.parallelsLabels_.length=g)}getInterval_(e){const t=this.projectionCenterLonLat_[0],r=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*e,2),o=[],a=[];for(let l=0,u=this.intervals_.length;l<u;++l){const c=De(this.intervals_[l]/2,0,90),h=De(r,-90+c,90-c);if(o[0]=t-c,o[1]=h-c,a[0]=t+c,a[1]=h+c,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(e,t,r,i,s){const o=fb(e,t,r,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new br(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(e,t,r){const i=e.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(t[1],i[s]),l=Math.min(t[3],i[o]),u=De(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,a,l),h=[i[s-1]+(i[o-1]-i[s-1])*(u-i[s])/(i[o]-i[s]),u],f=this.meridiansLabels_[r].geom;return f.setCoordinates(h),f}getMeridians(){return this.meridians_}getParallel_(e,t,r,i,s){const o=db(e,t,r,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new br(o,"XY"),a}getParallelPoint_(e,t,r){const i=e.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(t[0],i[s]),l=Math.min(t[2],i[o]),u=De(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,a,l),c=i[s+1]+(i[o+1]-i[s+1])*(u-i[s])/(i[o]-i[s]),h=[u,c],f=this.parallelsLabels_[r].geom;return f.setCoordinates(h),f}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=he("EPSG:4326"),r=e.getWorldExtent();this.maxLat_=r[3],this.maxLon_=r[2],this.minLat_=r[1],this.minLon_=r[0];const i=Ts(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,u){u=u||2;const c=i(a,l,u);for(let h=0,f=c.length;h<f;h+=u)c[h]<o&&(c[h]+=360);return c}}this.fromLonLatTransform_=Ts(t,e);const s=Gn([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(sr(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}function gn(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ks(n,e){return n[0]=e[0],n[1]=e[1],n[4]=e[2],n[5]=e[3],n[12]=e[4],n[13]=e[5],n}function Ga(n,e,t,r,i,s,o){o=o??gn();const a=1/(n-e),l=1/(t-r),u=1/(i-s);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*u,o[11]=0,o[12]=(n+e)*a,o[13]=(r+t)*l,o[14]=(s+i)*u,o[15]=1,o}function kc(n,e,t,r,i){return i=i??gn(),i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=n[3]*e,i[4]=n[4]*t,i[5]=n[5]*t,i[6]=n[6]*t,i[7]=n[7]*t,i[8]=n[8]*r,i[9]=n[9]*r,i[10]=n[10]*r,i[11]=n[11]*r,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i}function _b(n,e,t,r,i){i=i??gn();let s,o,a,l,u,c,h,f,p,d,g,m;return n===i?(i[12]=n[0]*e+n[4]*t+n[8]*r+n[12],i[13]=n[1]*e+n[5]*t+n[9]*r+n[13],i[14]=n[2]*e+n[6]*t+n[10]*r+n[14],i[15]=n[3]*e+n[7]*t+n[11]*r+n[15]):(s=n[0],o=n[1],a=n[2],l=n[3],u=n[4],c=n[5],h=n[6],f=n[7],p=n[8],d=n[9],g=n[10],m=n[11],i[0]=s,i[1]=o,i[2]=a,i[3]=l,i[4]=u,i[5]=c,i[6]=h,i[7]=f,i[8]=p,i[9]=d,i[10]=g,i[11]=m,i[12]=s*e+u*t+p*r+n[12],i[13]=o*e+c*t+d*r+n[13],i[14]=a*e+h*t+g*r+n[14],i[15]=l*e+f*t+m*r+n[15]),i}function bb(n,e,t,r){return r=r??gn(),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n,r[13]=e,r[14]=t,r[15]=1,r}const cn=34962,Yi=34963,Vl=35044,Fn=35048,xb=5121,Eb=5123,wb=5125,qf=5126,$c=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function vb(n,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!$g},e);const t=$c.length;for(let r=0;r<t;++r)try{const i=n.getContext($c[r],e);if(i)return i}catch{}return null}const Tb={STATIC_DRAW:Vl};class Gr{constructor(e,t){this.array_=null,this.type_=e,Lt(e===cn||e===Yi,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:Tb.STATIC_DRAW}ofSize(e){return this.array_=new(cs(this.type_))(e),this}fromArray(e){return this.array_=cs(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(cs(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=cs(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function cs(n){switch(n){case cn:return Float32Array;case Yi:return Uint32Array;default:return Float32Array}}const hs={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Sb=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Rb=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class jc{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||Sb),t.compileShader(r);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||Rb),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;const i=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,u=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,r[0],r[1],o,a,l,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r[0],r[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,r,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=me(s.canvas);if(!e.renderTargets[l]){const u=s.getContextAttributes();u&&u.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),r&&r(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let r,i=1;this.uniforms_.forEach(function(s){if(r=typeof s.value=="function"?s.value(e):s.value,r instanceof HTMLCanvasElement||r instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(s.location,i++);else if(Array.isArray(r))switch(r.length){case 2:t.uniform2f(s.location,r[0],r[1]);return;case 3:t.uniform3f(s.location,r[0],r[1],r[2]);return;case 4:t.uniform4f(s.location,r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(s.location,r)})}}const er={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},ze={UNSIGNED_BYTE:xb,UNSIGNED_SHORT:Eb,UNSIGNED_INT:wb,FLOAT:qf},$s={};function Vc(n){return"shared/"+n}let Xc=0;function Pb(){const n="unique/"+Xc;return Xc+=1,n}function Ab(n){let e=$s[n];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:vb(t)},$s[n]=e}return e.users+=1,e.context}function Ib(n){const e=$s[n];if(!e||(e.users-=1,e.users>0))return;const t=e.context,r=t.getExtension("WEBGL_lose_context");r&&r.loseContext();const i=t.canvas;i.width=1,i.height=1,delete $s[n]}class Lb extends ff{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Vc(e.canvasCacheKey):Pb(),this.gl_=Ab(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(hs.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(hs.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=rt(),this.offsetScaleMatrix_=rt(),this.tmpMat4_=gn(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(r=>new jc({webGlContext:this.gl_,scaleRatio:r.scaleRatio,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms})):[new jc({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Vc(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}getInstancedRenderingExtension_(){const e=this.getExtension("ANGLE_instanced_arrays");return Lt(!!e,"WebGL extension 'ANGLE_instanced_arrays' is required for vector rendering"),e}bindBuffer(e){const t=this.gl_,r=me(e);let i=this.bufferCache_[r];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[r]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=me(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(hs.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(hs.RESTORED,this.boundHandleWebGLContextRestored_),Ib(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,r){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),r?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(e,t){const r=this.getGL();r.bindFramebuffer(r.FRAMEBUFFER,e),t&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const r=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}bindTexture(e,t,r){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(r),t)}bindAttribute(e,t,r){const i=this.getGL();this.bindBuffer(e);const s=this.getAttributeLocation(t);i.enableVertexAttribArray(s),i.vertexAttribPointer(s,r,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,r,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,r?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const r=this.gl_;this.getExtension("OES_element_index_uint");const i=r.UNSIGNED_INT,s=4,o=t-e,a=e*s;r.drawElements(r.TRIANGLES,o,i,a)}drawElementsInstanced(e,t,r){const i=this.gl_;this.getExtension("OES_element_index_uint");const s=this.getInstancedRenderingExtension_(),o=i.UNSIGNED_INT,a=4,l=t-e,u=e*a;s.drawElementsInstancedANGLE(i.TRIANGLES,l,o,u,r);for(let c=0;c<this.maxAttributeCount_;c++)s.vertexAttribDivisorANGLE(c,0)}finalizeDraw(e,t,r){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,r):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,r=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(er.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(er.ZOOM,e.viewState.zoom),this.setUniformFloatValue(er.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(er.PIXEL_RATIO,i),this.setUniformFloatVec2(er.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(er.ROTATION,r)}applyHitDetectionUniform(e){const t=this.getUniformLocation(er.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(er.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let r,i=0;this.uniforms_.forEach(s=>{if(r=typeof s.value=="function"?s.value(e):s.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=r):s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(r instanceof HTMLImageElement)||r.complete;!(r instanceof WebGLTexture)&&o&&s.prevValue!==r&&(s.prevValue=r,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),i++}else if(Array.isArray(r)&&r.length===6)this.setUniformMatrixValue(s.name,ks(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:t.uniform2f(this.getUniformLocation(s.name),r[0],r[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),r[0],r[1],r[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(this.getUniformLocation(s.name),r)})}useProgram(e,t){this.disableAllAttributes_(),this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const r=this.gl_,i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}getProgram(e,t){const r=this.gl_,i=this.compileShader(e,r.FRAGMENT_SHADER),s=this.compileShader(t,r.VERTEX_SHADER),o=r.createProgram();if(r.attachShader(o,i),r.attachShader(o,s),r.linkProgram(o),!r.getShaderParameter(i,r.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${r.getShaderInfoLog(i)}`;throw new Error(a)}if(r.deleteShader(i),!r.getShaderParameter(s,r.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${r.getShaderInfoLog(s)}`;throw new Error(a)}if(r.deleteShader(s),!r.getProgramParameter(o,r.LINK_STATUS)){const a=`GL program linking failed: ${r.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=me(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=me(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const r=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return gl(t,0,0,2/(s*r[0]),2/(s*r[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}disableAllAttributes_(){for(let e=0;e<this.maxAttributeCount_;e++)this.gl_.disableVertexAttribArray(e)}enableAttributeArray_(e,t,r,i,s,o){const a=this.getAttributeLocation(e);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,t,r,!1,i,s),o&&this.getInstancedRenderingExtension_().vertexAttribDivisorANGLE(a,1))}enableAttributes_(e,t){const r=Cb(e);let i=0;for(let s=0;s<e.length;s++){const o=e[s];o.name&&this.enableAttributeArray_(o.name,o.size,o.type||qf,r,i,t),i+=o.size*Hf(o.type)}}enableAttributes(e){this.enableAttributes_(e,!1)}enableAttributesInstanced(e){this.enableAttributes_(e,!0)}handleWebGLContextLost(e){Tg(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,r,i){const s=this.gl_;r=r||s.createTexture();const o=i?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const a=0,l=s.RGBA,u=0,c=s.RGBA,h=s.UNSIGNED_BYTE;return t instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],u,c,h,t):t?s.texImage2D(s.TEXTURE_2D,a,l,c,h,t):s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],u,c,h,null),r}}function Cb(n){let e=0;for(let t=0;t<n.length;t++){const r=n[t];e+=r.size*Hf(r.type)}return e}function Hf(n){switch(n){case ze.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case ze.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case ze.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case ze.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Fb extends Sg{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(pt.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===ee.LOADED,this.loaded)this.uploadTile();else{if(e instanceof wl){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(pt.CHANGE,this.handleTileChange_)}}uploadTile(){_l()}setReady(){this.ready=!0,this.dispatchEvent(pt.CHANGE)}handleTileChange_(){this.tile.getState()===ee.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(pt.CHANGE,this.handleTileChange_)}}function Yf(n,e,t){const r=t?n.LINEAR:n.NEAREST;n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r)}function Mb(n,e,t,r){Yf(n,e,r),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}function Wc(n,e,t,r,i,s){const o=n.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,n.getExtension("OES_texture_float"),l=n.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),Yf(o,e,s&&l);const u=t.byteLength/r[1];let c=1;u%8===0?c=8:u%4===0?c=4:u%2===0&&(c=2);let h;switch(i){case 1:{h=o.LUMINANCE;break}case 2:{h=o.LUMINANCE_ALPHA;break}case 3:{h=o.RGB;break}case 4:{h=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,h,r[0],r[1],0,h,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}let Tn=null;function Ob(){Tn=kr(1,1,void 0,{willReadFrequently:!0})}class Nb extends Fb{constructor(e){super(e),this.textures=[],this.renderSize_=Zt(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new Gr(cn,Vl);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){var r;const t=(r=this.helper)==null?void 0:r.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let i=0;i<this.textures.length;++i)t.deleteTexture(this.textures[i])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){const e=this.helper,t=e.getGL(),r=this.tile;this.textures.length=0;let i;r instanceof wl||r instanceof jg?i=r.getImage():i=r.getData();const s=Fa(i);if(s){const _=t.createTexture();this.textures.push(_),this.bandCount=4,Mb(t,_,s,r.interpolate),this.setReady();return}i=Ca(i);const o=r.getSize(),a=[o[0]+2*this.gutter,o[1]+2*this.gutter],l=i instanceof Float32Array,u=a[0]*a[1],c=l?Float32Array:Uint8Array,h=c.BYTES_PER_ELEMENT,f=i.byteLength/a[1];this.bandCount=Math.floor(f/h/a[0]);const p=Math.ceil(this.bandCount/4);if(p===1){const _=t.createTexture();this.textures.push(_),Wc(e,_,i,a,this.bandCount,r.interpolate),this.setReady();return}const d=new Array(p);for(let _=0;_<p;++_){const b=t.createTexture();this.textures.push(b);const w=_<p-1?4:(this.bandCount-1)%4+1;d[_]=new c(u*w)}let g=0,m=0;const y=a[0]*this.bandCount;for(let _=0;_<a[1];++_){for(let b=0;b<y;++b){const w=i[m+b],x=Math.floor(g/this.bandCount),E=b%this.bandCount,S=Math.floor(E/4),A=d[S],P=A.length/u,R=E%4;A[x*P+R]=w,++g}m+=f/h}for(let _=0;_<p;++_){const b=this.textures[_],w=d[_],x=w.length/u;Wc(e,b,w,a,x,r.interpolate)}this.setReady()}getImagePixelData_(e,t,r){const i=this.gutter,s=this.renderSize_[0],o=this.renderSize_[1];Tn||Ob(),Tn.clearRect(0,0,1,1);const a=e.width,l=e.height,u=a-2*i,c=l-2*i,h=i+Math.floor(u*(t/s)),f=i+Math.floor(c*(r/o));let p;try{Tn.drawImage(e,h,f,1,1,0,0,1,1),p=Tn.getImageData(0,0,1,1).data}catch{return Tn=null,null}return p}getArrayPixelData_(e,t,r,i){const s=this.gutter,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],u=t[1],c=l+2*s,h=u+2*s,f=s+Math.floor(l*(r/o)),p=s+Math.floor(u*(i/a));if(e instanceof DataView){const g=e.byteLength/(c*h),m=g*(p*c+f),y=e.buffer.slice(m,m+g);return new DataView(y)}const d=this.bandCount*(p*c+f);return e.slice(d,d+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof vl){const r=this.tile.getData(),i=Ca(r);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(Fa(r),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class Ki extends Vg{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=rt(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(Na.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(Jr.PRECOMPOSE)){const i=new Ko(Jr.PRECOMPOSE,void 0,t,e);r.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(Jr.POSTCOMPOSE)){const i=new Ko(Jr.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,r=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,u=l.getRenderer();if(!(u instanceof Ki)){t=!0;continue}const c=l.getClassName();if((t||c!==i)&&(r+=1,t=!1),i=c,u===this)break}const s="map/"+e.mapId+"/group/"+r;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Lb({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){var e;this.clearCache(),this.removeHelper(),(e=this.getLayer())==null||e.removeChangeListener(Na.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){gl(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const s=new Ko(e,this.inversePixelTransform_,r,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(Jr.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Jr.POSTRENDER,e,t)}}const Db={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function Zc(n){return 1/(n+2)}function Ub(){return{tileIds:new Set,representationsByZ:{}}}function qc(n,e){return n.tileIds.has(me(e))}function Hc(n,e,t){const r=n.representationsByZ;t in r||(r[t]=new Set),r[t].add(e),n.tileIds.add(me(e.tile))}function Qo(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=ir(e,lf(t.extent,n.viewState.projection)));const r=t.layer.getRenderSource();if(!r.getWrapX()){const i=r.getTileGridForProjection(n.viewState.projection).getExtent();i&&(e=ir(e,i))}return e}function za(n,e){return`${me(n)},${n.getKey()},${n.getRevision()},${vn(e)}`}class Bb extends Ki{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=rt(),this.tempMat4=gn(),this.tempTileRange_=new Xg(0,0,0,0),this.tempTileCoord_=Ma(0,0,0),this.tempSize_=[0,0];const r=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new yf(r),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;const r=this.getLayer().getRenderSource();return!r||co(Qo(e,e.extent))?!1:r.getState()==="ready"}createTileRepresentation(e){return _l()}enqueueTiles(e,t,r,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),u=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),h=me(l);h in e.wantedTiles||(e.wantedTiles[h]={});const f=e.wantedTiles[h],p=this.tileRepresentationCache,d=a.getMapInternal(),g=Math.max(r-s,u.getMinZoom(),u.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):u.getResolution(0)),l.zDirection)),m=o.rotation,y=m?Rg(o.center,o.resolution,m,e.size):void 0;for(let _=r;_>=g;--_){const b=u.getTileRangeForExtentAndZ(t,_,this.tempTileRange_),w=u.getResolution(_);for(let x=b.minX;x<=b.maxX;++x)for(let E=b.minY;E<=b.maxY;++E){if(m&&!u.tileCoordIntersectsViewport([_,x,E],y))continue;const S=Ma(_,x,E,this.tempTileCoord_),A=za(l,S);let P,R;if(p.containsKey(A)&&(P=p.get(A),R=P.tile),(!P||P.tile.key!==l.getKey())&&(R=l.getTile(_,x,E,e.pixelRatio,o.projection),!R)||qc(i,R))continue;P?P.setTile(R):(P=this.createTileRepresentation({tile:R,grid:u,helper:this.helper,gutter:c}),p.set(A,P)),Hc(i,P,_);const I=R.getKey();f[I]=!0,R.getState()===ee.IDLE&&(e.tileQueue.isKeyQueued(I)||e.tileQueue.enqueue([R,h,u.getTileCoordCenter(S),w]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,r,i,s,o,a,l,u,c,h){}renderTileMask(e,t,r,i){}drawTile_(e,t,r,i,s,o,a){if(!t.ready)return;const u=t.tile.tileCoord,c=vn(u),h=c in o?o[c]:1,f=a.getResolution(r),p=Zt(a.getTileSize(r),this.tempSize_),d=a.getOrigin(r),g=a.getTileCoordExtent(u),m=h<1?-1:Zc(r);h<1&&(e.animate=!0);const y=e.viewState,_=y.center[0],b=y.center[1],w=p[0]+2*i,x=p[1]+2*i,E=w/x,S=(_-d[0])/(p[0]*f),A=(d[1]-b)/(p[1]*f),P=y.resolution/f,R=u[1],I=u[2];ug(this.tileTransform_),ic(this.tileTransform_,2/(e.size[0]*P/w),-2/(e.size[1]*P/w)),cg(this.tileTransform_,y.rotation),ic(this.tileTransform_,1,1/E),ml(this.tileTransform_,(p[0]*(R-S)-i)/w,(p[1]*(I-A)-i)/x),this.renderTile(t,this.tileTransform_,e,s,f,p,d,g,m,i,h)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const r=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(r.projection),a=s.getGutterForProjection(r.projection),l=Qo(e,e.extent),u=o.getZForResolution(r.resolution,s.zDirection),c=Ub(),h=i.getPreload();if(e.nextExtent){const b=o.getZForResolution(r.nextResolution,s.zDirection),w=Qo(e,e.nextExtent);this.enqueueTiles(e,w,b,c,h)}this.enqueueTiles(e,l,u,c,0),h>0&&setTimeout(()=>{this.enqueueTiles(e,l,u-1,c,h-1)},0);const f={};let p=!1;const d=c.representationsByZ;if(u in d){const b=me(this),w=e.time;for(const x of d[u]){const E=x.tile;if(E.getState()===ee.EMPTY)continue;const S=E.tileCoord;if(x.ready){const R=E.getAlpha(b,w);if(R===1){E.endTransition(b);continue}p=!0;const I=vn(S);f[I]=R}if(this.renderComplete=!1,this.findAltTiles_(o,S,u+1,c))continue;const P=o.getMinZoom();for(let R=u-1;R>=P&&!this.findAltTiles_(o,S,R,c);--R);}}const g=Object.keys(d).map(Number).sort(Pg);if(this.beforeTilesMaskRender(e))for(let b=0,w=g.length;b<w;++b){const x=g[b];for(const E of d[x]){const S=E.tile.tileCoord;if(vn(S)in f)continue;const P=o.getTileCoordExtent(S);this.renderTileMask(E,x,P,Zc(x))}}this.beforeTilesRender(e,p);for(let b=0,w=g.length;b<w;++b){const x=g[b];for(const E of d[x]){const S=E.tile.tileCoord;vn(S)in f||this.drawTile_(e,E,x,a,l,f,o)}}if(u in d)for(const b of d[u]){const w=b.tile.tileCoord;vn(w)in f&&this.drawTile_(e,b,u,a,l,f,o)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const y=this.helper.getCanvas();return this.tileRepresentationCache.expireCache(),this.postRender(t,e),y}beforeFinalize(e){}findAltTiles_(e,t,r,i){const s=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let u=s.minX;u<=s.maxX;++u)for(let c=s.minY;c<=s.maxY;++c){const h=za(l,[r,u,c]);let f=!1;if(a.containsKey(h)){const p=a.get(h);p.ready&&!qc(i,p.tile)&&(Hc(i,p,r),f=!0)}f||(o=!1)}return o}clearCache(){super.clearCache();const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const J={...Db,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},xs={TEXTURE_COORD:"a_textureCoord"},Gb=[{name:xs.TEXTURE_COORD,size:2,type:ze.FLOAT}];class zb extends Bb{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new Gr(Yi,Vl),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const t=this.helper.getGL();for(const r of this.paletteTextures_)r.delete(t)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const t=this.helper.getGL();for(const r of this.paletteTextures_)r.getTexture(t)}}afterHelperCreated(){super.afterHelperCreated();const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new Nb(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,r,i,s,o,a,l,u,c,h){const f=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Gb);let p=0;for(;p<e.textures.length;){const E=`${J.TILE_TEXTURE_ARRAY}[${p}]`;this.helper.bindTexture(e.textures[p],p,E),++p}for(let E=0;E<this.paletteTextures_.length;++E){const S=this.paletteTextures_[E],A=S.getTexture(f);this.helper.bindTexture(A,p,S.name),++p}const d=r.viewState,g=o[0]+2*c,m=o[1]+2*c,_=e.tile.tileCoord,b=_[1],w=_[2];this.helper.setUniformMatrixValue(J.TILE_TRANSFORM,ks(this.tempMat4,t)),this.helper.setUniformFloatValue(J.TRANSITION_ALPHA,h),this.helper.setUniformFloatValue(J.DEPTH,u);let x=i;c>0&&(x=l,ir(x,i,x)),this.helper.setUniformFloatVec4(J.RENDER_EXTENT,x),this.helper.setUniformFloatValue(J.RESOLUTION,d.resolution),this.helper.setUniformFloatValue(J.ZOOM,d.zoom),this.helper.setUniformFloatValue(J.TEXTURE_PIXEL_WIDTH,g),this.helper.setUniformFloatValue(J.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(J.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(J.TEXTURE_ORIGIN_X,a[0]+b*o[0]*s-c*s),this.helper.setUniformFloatValue(J.TEXTURE_ORIGIN_Y,a[1]-w*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const r=this.frameState;if(!r)return null;const i=this.getLayer(),s=xr(r.pixelToCoordinateTransform,e.slice()),o=r.viewState,a=i.getExtent();if(a&&!In(lf(a,o.projection),s))return null;const l=i.getSources(bl([s]),o.resolution);let u,c,h;for(u=l.length-1;u>=0;--u)if(c=l[u],c.getState()==="ready"){if(h=c.getTileGridForProjection(o.projection),c.getWrapX())break;const p=h.getExtent();if(!p||In(p,s))break}if(u<0)return null;const f=this.tileRepresentationCache;for(let p=h.getZForResolution(o.resolution);p>=h.getMinZoom();--p){const d=h.getTileCoordForCoordAndZ(s,p),g=za(c,d);if(!f.containsKey(g))continue;const m=f.get(g);if(m.tile.getState()===ee.EMPTY)return null;if(!m.loaded)continue;const _=h.getOrigin(p),b=Zt(h.getTileSize(p)),w=h.getResolution(p),x=(s[0]-_[0])/w-d[1]*b[0],E=(_[1]-s[1])/w-d[2]*b[1];return m.getPixelData(x,E)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const r of this.paletteTextures_)r.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}class kb{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}function $b(n,e){return`operator_${n}_${Object.keys(e.functions).length}`}function zr(n){const e=n.toString();return e.includes(".")?e:e+".0"}function Xl(n){if(n.length<2||n.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${n.length}(${n.map(zr).join(", ")})`}function Es(n){const e=Vi(n),t=e.length>3?e[3]:1;return Xl([e[0]/255,e[1]/255,e[2]/255,t])}function jb(n){const e=Zt(n);return Xl(e)}const ea={};let Vb=0;function zn(n){return n in ea||(ea[n]=Vb++),ea[n]}function pr(n){return zr(zn(n))}function wo(n){return"u_var_"+n}function Wl(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const ta="getBandValue",Kf="u_paletteTextures",Jf="featureId",Qf="geometryType",ka=-9999999;function Xb(n,e,t,r){const i=Wg(n,e,t);return Zl(i,e,r)}function ye(n){return(e,t,r)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=Zl(t.args[o],r,e);return n(s,e)}}const Wb={[re.Get]:(n,e)=>{const r=e.args[0].value;r in n.properties||(n.properties[r]={name:r,type:e.type});let s="a_prop_"+r;return cc(e.type,Ii)&&(s=`(${s} > 0.0)`),s},[re.Id]:n=>(n.featureId=!0,"a_"+Jf),[re.GeometryType]:n=>(n.geometryType=!0,"a_"+Qf),[re.LineMetric]:()=>"currentLineMetric",[re.Var]:(n,e)=>{const r=e.args[0].value;r in n.variables||(n.variables[r]={name:r,type:e.type});let s=wo(r);return cc(e.type,Ii)&&(s=`(${s} > 0.0)`),s},[re.Has]:(n,e)=>{const r=e.args[0].value;return r in n.properties||(n.properties[r]={name:r,type:e.type}),`(a_prop_${r} != ${zr(ka)})`},[re.Resolution]:()=>"u_resolution",[re.Zoom]:()=>"u_zoom",[re.Time]:()=>"u_time",[re.Any]:ye(n=>`(${n.join(" || ")})`),[re.All]:ye(n=>`(${n.join(" && ")})`),[re.Not]:ye(([n])=>`(!${n})`),[re.Equal]:ye(([n,e])=>`(${n} == ${e})`),[re.NotEqual]:ye(([n,e])=>`(${n} != ${e})`),[re.GreaterThan]:ye(([n,e])=>`(${n} > ${e})`),[re.GreaterThanOrEqualTo]:ye(([n,e])=>`(${n} >= ${e})`),[re.LessThan]:ye(([n,e])=>`(${n} < ${e})`),[re.LessThanOrEqualTo]:ye(([n,e])=>`(${n} <= ${e})`),[re.Multiply]:ye(n=>`(${n.join(" * ")})`),[re.Divide]:ye(([n,e])=>`(${n} / ${e})`),[re.Add]:ye(n=>`(${n.join(" + ")})`),[re.Subtract]:ye(([n,e])=>`(${n} - ${e})`),[re.Clamp]:ye(([n,e,t])=>`clamp(${n}, ${e}, ${t})`),[re.Mod]:ye(([n,e])=>`mod(${n}, ${e})`),[re.Pow]:ye(([n,e])=>`pow(${n}, ${e})`),[re.Abs]:ye(([n])=>`abs(${n})`),[re.Floor]:ye(([n])=>`floor(${n})`),[re.Ceil]:ye(([n])=>`ceil(${n})`),[re.Round]:ye(([n])=>`floor(${n} + 0.5)`),[re.Sin]:ye(([n])=>`sin(${n})`),[re.Cos]:ye(([n])=>`cos(${n})`),[re.Atan]:ye(([n,e])=>e!==void 0?`atan(${n}, ${e})`:`atan(${n})`),[re.Sqrt]:ye(([n])=>`sqrt(${n})`),[re.Match]:ye(n=>{const e=n[0],t=n[n.length-1];let r=null;for(let i=n.length-3;i>=1;i-=2){const s=n[i],o=n[i+1];r=`(${e} == ${s} ? ${o} : ${r||t})`}return r}),[re.Between]:ye(([n,e,t])=>`(${n} >= ${e} && ${n} <= ${t})`),[re.Interpolate]:ye(([n,e,...t])=>{let r="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=r||t[i+1],a=t[i+2],l=t[i+3];let u;n===zr(1)?u=`(${e} - ${s}) / (${a} - ${s})`:u=`(pow(${n}, (${e} - ${s})) - 1.0) / (pow(${n}, (${a} - ${s})) - 1.0)`,r=`mix(${o}, ${l}, clamp(${u}, 0.0, 1.0))`}return r}),[re.Case]:ye(n=>{const e=n[n.length-1];let t=null;for(let r=n.length-3;r>=0;r-=2){const i=n[r],s=n[r+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[re.In]:ye(([n,...e],t)=>{const r=$b("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[r]=`bool ${r}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${r}(${n})`}),[re.Array]:ye(n=>`vec${n.length}(${n.join(", ")})`),[re.Color]:ye(n=>{if(n.length===1)return`vec4(vec3(${n[0]} / 255.0), 1.0)`;if(n.length===2)return`vec4(vec3(${n[0]} / 255.0), ${n[1]})`;const e=n.slice(0,3).map(r=>`${r} / 255.0`);if(n.length===3)return`vec4(${e.join(", ")}, 1.0)`;const t=n[3];return`vec4(${e.join(", ")}, ${t})`}),[re.Band]:ye(([n,e,t],r)=>{if(!(ta in r.functions)){let i="";const s=r.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const u=`${J.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${u}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}r.functions[ta]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${J.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${J.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${ta}(${n}, ${e??"0.0"}, ${t??"0.0"})`}),[re.Palette]:(n,e)=>{const[t,...r]=e.args,i=r.length,s=new Uint8Array(i*4);for(let u=0;u<r.length;u++){const c=r[u].value,h=Vi(c),f=u*4;s[f]=h[0],s[f+1]=h[1],s[f+2]=h[2],s[f+3]=h[3]*255}n.paletteTextures||(n.paletteTextures=[]);const o=`${Kf}[${n.paletteTextures.length}]`,a=new kb(o,s);n.paletteTextures.push(a);const l=Zl(t,pe,n);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function Zl(n,e,t){if(n instanceof Zg){const r=Wb[n.operator];if(r===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(n.operator)}`);return r(t,n,e)}if((n.type&pe)>0)return zr(n.value);if((n.type&Ii)>0)return n.value.toString();if((n.type&Li)>0)return pr(n.value.toString());if((n.type&_t)>0)return Es(n.value);if((n.type&ln)>0)return Xl(n.value);if((n.type&fn)>0)return jb(n.value);throw new Error(`Unexpected expression ${n.value} (expected type ${qg(e)})`)}function Zb(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Yc=.985;function Z(n,e,t){const r=Hg();return Xb(e,t,r,n)}function qb(n){const e=Vi(n),t=e[0]*256,r=e[1],i=e[2]*256,s=Math.round(e[3]*255);return[t+r,i+s]}const Hb=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    min(floor(packedColor[0] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[0], 256.0) / 255.0, 1.0),
    min(floor(packedColor[1] / 256.0) / 255.0, 1.0),
    min(mod(packedColor[1], 256.0) / 255.0, 1.0)
  );
}`;function ql(n){return n===_t||n===fn?2:n===ln?4:1}function $a(n){const e=ql(n);return e>1?`vec${e}`:"float"}function ed(n,e){for(const t in e.variables){const r=e.variables[t],i=wo(r.name);let s=$a(r.type);r.type===_t&&(s="vec4"),n.addUniform(i,s)}for(const t in e.properties){const r=e.properties[t],i=$a(r.type),s=`a_prop_${r.name}`;r.type===_t?n.addAttribute(s,i,`unpackColor(${s})`,"vec4"):n.addAttribute(s,i)}for(const t in e.functions)n.addVertexShaderFunction(e.functions[t]),n.addFragmentShaderFunction(e.functions[t])}function td(n,e){const t={};for(const r in n.variables){const i=n.variables[r],s=wo(i.name);t[s]=()=>{const o=e[i.name];if(typeof o=="number")return o;if(typeof o=="boolean")return o?1:0;if(i.type===_t){const a=[...Vi(o||"#eee")];return a[0]/=255,a[1]/=255,a[2]/=255,a[3]??(a[3]=1),a}return typeof o=="string"?zn(o):o}}return t}function rd(n){const e={};for(const t in n.properties){const r=n.properties[t],i=s=>{const o=s.get(r.name);return r.type===_t?qb([...Vi(o||"#eee")]):typeof o=="string"?zn(o):typeof o=="boolean"?o?1:0:o};e[`prop_${r.name}`]={size:ql(r.type),callback:i}}return e}const _n=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders

${Hb}
`,bn=Zb();class nd{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${zr(bn["circle-radius"])} + ${zr(bn["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Es(bn["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=zr(bn["stroke-width"]),this.strokeColorExpression_=Es(bn["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=pr("round"),this.strokeJoinExpression_=pr("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.strokePatternLengthExpression_=null,this.hasFill_=!1,this.fillColorExpression_=Es(bn["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e,t){return this.uniforms_.push({name:e,type:t}),this}addAttribute(e,t,r,i){return this.attributes_.push({name:e,type:t,varyingName:e.replace(/^a_/,"v_"),varyingType:i??t,varyingExpression:r??e}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setStrokePatternLengthExpression(e){return this.strokePatternLengthExpression_=e,this}getStrokePatternLengthExpression(){return this.strokePatternLengthExpression_}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){return this.vertexShaderFunctions_.includes(e)?this:(this.vertexShaderFunctions_.push(e),this)}addFragmentShaderFunction(e){return this.fragmentShaderFunctions_.includes(e)?this:(this.fragmentShaderFunctions_.push(e),this)}getSymbolVertexShader(){return this.hasSymbol_?`${_n}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_localPosition;
attribute vec2 a_hitColor;

varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx + a_localPosition * halfSizePx * vec2(1., -1.);
  float angle = ${this.symbolRotationExpression_}${this.symbolRotateWithView_?" + u_rotation":""};
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = mix(texCoord.s, texCoord.p, a_localPosition.x * 0.5 + 0.5);
  float v = mix(texCoord.t, texCoord.q, a_localPosition.y * 0.5 + 0.5);
  v_texCoord = vec2(u, v);
  v_hitColor = unpackColor(a_hitColor);
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y);
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${_n}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${_n}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute vec2 a_localPosition;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_angleTangentSum;
attribute float a_distanceLow;
attribute float a_distanceHigh;
attribute vec2 a_joinAngles;
attribute vec2 a_hitColor;

varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float startEndRatio = a_localPosition.x * 0.5 + 0.5;
  currentLineMetric = mix(a_measureStart, a_measureEnd, startEndRatio);
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);

  // compute current vertex position
  float normalDir = -1. * a_localPosition.y;
  float tangentDir = -1. * a_localPosition.x;
  float angle = mix(v_angleStart, v_angleEnd, startEndRatio);
  vec2 joinDirection;
  vec2 positionPx = mix(segmentStartPx, segmentEndPx, startEndRatio);
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Yc} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStartPx = segmentStartPx;
  v_segmentEndPx = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = unpackColor(a_hitColor);

  v_distancePx = a_distanceLow / u_resolution - (lineOffsetPx * a_angleTangentSum);
  float distanceHighPx = a_distanceHigh / u_resolution;
  ${this.strokePatternLengthExpression_!==null?`v_distancePx = mod(v_distancePx, ${this.strokePatternLengthExpression_});
  distanceHighPx = mod(distanceHighPx, ${this.strokePatternLengthExpression_});
  `:""}v_distancePx += distanceHighPx;

  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${_n}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec2 v_segmentStartPx;
varying vec2 v_segmentEndPx;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distancePx;
varying float v_measureStart;
varying float v_measureEnd;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Yc}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${pr("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${pr("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${pr("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${pr("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

float distanceFromSegment(vec2 point, vec2 start, vec2 end) {
  vec2 tangent = end - start;
  vec2 startToPoint = point - start;
  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/
  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);
  return length(startToPoint - tangent * h);
}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}

  vec2 currentPointPx = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPointPx);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLengthPx = length(v_segmentEndPx - v_segmentStartPx);
  segmentLengthPx = max(segmentLengthPx, 1.17549429e-38); // avoid divide by zero
  vec2 segmentTangent = (v_segmentEndPx - v_segmentStartPx) / segmentLengthPx;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPointPx = currentPointPx - v_segmentStartPx;
  float lengthToPointPx = max(0., min(dot(segmentTangent, startToPointPx), segmentLengthPx));
  float currentLengthPx = lengthToPointPx + v_distancePx;
  float currentRadiusPx = distanceFromSegment(currentPointPx, v_segmentStartPx, v_segmentEndPx);
  float currentRadiusRatio = dot(segmentNormal, startToPointPx) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPointPx / segmentLengthPx);

  if (${this.discardExpression_}) { discard; }

  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPointPx, v_segmentEndPx, v_segmentStartPx, v_width, v_angleEnd, capType, joinType);
  float distanceField = max(
    segmentDistanceField(currentPointPx, v_segmentStartPx, v_segmentEndPx, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});

  vec4 color = ${this.strokeColorExpression_};
  color.a *= smoothstep(0.5, -0.5, distanceField);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${_n}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
attribute vec2 a_position;
attribute vec2 a_hitColor;

varying vec4 v_hitColor;

${this.attributes_.map(e=>`attribute ${e.type} ${e.name};
varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = unpackColor(a_hitColor);
${this.attributes_.map(e=>`  ${e.varyingName} = ${e.varyingExpression};`).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${_n}
${this.uniforms_.map(e=>`uniform ${e.type} ${e.name};`).join(`
`)}
varying vec4 v_hitColor;
${this.attributes_.map(e=>`varying ${e.varyingType} ${e.varyingName};`).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
${this.attributes_.map(e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`).join(`
`)}
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}class js{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let r=0;r<e.length;r++)this.addFeature(e[r],t)}addFeature(e,t){let r=e.getGeometry();r&&(t&&(r=r.clone(),r.applyTransform(t)),this.addGeometry_(r,e))}clearFeatureEntryInPointBatch_(e){const t=me(e),r=this.pointBatch.entries[t];if(r)return this.pointBatch.geometriesCount-=r.flatCoordss.length,delete this.pointBatch.entries[t],r}clearFeatureEntryInLineStringBatch_(e){const t=me(e),r=this.lineStringBatch.entries[t];if(r)return this.lineStringBatch.verticesCount-=r.verticesCount,this.lineStringBatch.geometriesCount-=r.flatCoordss.length,delete this.lineStringBatch.entries[t],r}clearFeatureEntryInPolygonBatch_(e){const t=me(e),r=this.polygonBatch.entries[t];if(r)return this.polygonBatch.verticesCount-=r.verticesCount,this.polygonBatch.ringsCount-=r.ringsCount,this.polygonBatch.geometriesCount-=r.flatCoordss.length,delete this.polygonBatch.entries[t],r}addGeometry_(e,t){var i;const r=e.getType();switch(r){case"GeometryCollection":{const s=e.getGeometriesArray();for(const o of s)this.addGeometry_(o,t);break}case"MultiPolygon":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEndss(),t,me(t),s.getStride());break}case"MultiLineString":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEnds(),t,me(t),s.getStride());break}case"MultiPoint":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),null,t,me(t),s.getStride());break}case"Polygon":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEnds(),t,me(t),s.getStride());break}case"Point":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),null,t,me(t),s.getStride());break}case"LineString":case"LinearRing":{const s=e,o=s.getStride();this.addCoordinates_(r,s.getFlatCoordinates(),null,t,me(t),o,(i=s.getLayout)==null?void 0:i.call(s));break}}}addCoordinates_(e,t,r,i,s,o,a){let l;switch(e){case"MultiPolygon":{const u=r;for(let c=0,h=u.length;c<h;c++){let f=u[c];const p=c>0?u[c-1]:null,d=p?p[p.length-1]:0,g=f[f.length-1];f=d>0?f.map(m=>m-d):f,this.addCoordinates_("Polygon",t.slice(d,g),f,i,s,o,a)}break}case"MultiLineString":{const u=r;for(let c=0,h=u.length;c<h;c++){const f=c>0?u[c-1]:0;this.addCoordinates_("LineString",t.slice(f,u[c]),null,i,s,o,a)}break}case"MultiPoint":for(let u=0,c=t.length;u<c;u+=o)this.addCoordinates_("Point",t.slice(u,u+2),null,i,s,null,null);break;case"Polygon":{const u=r;if(i instanceof uf){const f=hg(t,u);if(f.length>1){this.addCoordinates_("MultiPolygon",t,f,i,s,o,a);return}}this.polygonBatch.entries[s]||(this.polygonBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=t.length/o;const c=r.length,h=r.map((f,p,d)=>p>0?(f-d[p-1])/o:f/o);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=c,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[s].flatCoordss.push(Yb(t,o)),this.polygonBatch.entries[s].ringsVerticesCounts.push(h),this.polygonBatch.entries[s].verticesCount+=l,this.polygonBatch.entries[s].ringsCount+=c;for(let f=0,p=u.length;f<p;f++){const d=f>0?u[f-1]:0;this.addCoordinates_("LinearRing",t.slice(d,u[f]),null,i,s,o,a)}break}case"Point":this.pointBatch.entries[s]||(this.pointBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[s].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[s]||(this.lineStringBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0})),l=t.length/o,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[s].flatCoordss.push(Kb(t,o,a)),this.lineStringBatch.entries[s].verticesCount+=l;break}}addRefToEntry_(e,t){const r=this.uidToRef_.get(e),i=r||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=i,r||(this.refToFeature_.set(i,t.feature),this.uidToRef_.set(e,i)),t}removeRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e,t){if(!this.uidToRef_.get(me(e)))return;this.removeFeature(e);let r=e.getGeometry();r&&(t&&(r=r.clone(),r.applyTransform(t)),this.addGeometry_(r,e))}removeFeature(e){let t=this.clearFeatureEntryInPointBatch_(e);t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.removeRef_(t.ref,me(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}isEmpty(){return this.globalCounter_===0}filter(e){const t=new js;t.globalCounter_=this.globalCounter_,t.uidToRef_=this.uidToRef_,t.refToFeature_=this.refToFeature_;let r=!0;for(const i of this.refToFeature_.values())e(i)&&(t.addFeature(i),r=!1);return r?new js:t}}function Yb(n,e){return e===2?n:n.filter((t,r)=>r%e<2)}function Kb(n,e,t){return e===3&&t==="XYM"?n:e===4?n.filter((r,i)=>i%e!==2):e===3?n.map((r,i)=>i%e!==2?r:0):new Array(n.length*1.5).fill(0).map((r,i)=>i%3===2?0:n[Math.round(i/1.5)])}function id(){const n='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let f=e(t,0,i,x,!0);const l=[];if(!f||f.next===f.prev)return l;let c,y,h;if(o&&(f=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const f=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);f===f.next&&(f.steiner=!0),o.push(a(f))}o.sort(u);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,f,x)),t.length>80*x){c=t[0],y=t[1];let e=c,n=y;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<y&&(y=o),x>e&&(e=x),o>n&&(n=o)}h=Math.max(e-c,n-y),h=0!==h?32767/h:0}return r(f,l,x,c,y,h,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=d(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=d(x/r|0,t[x],t[x+1],o);return o&&b(o,o.next)&&(w(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!b(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(w(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,u,s,l,a,y){if(!t)return;!y&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,f=0;for(let t=0;t<n&&(f++,i=i.nextZ,i);t++);let u=n;for(;f>0||u>0&&i;)0!==f&&(0===u||!i||x.z<=i.z)?(r=x,x=x.nextZ,f--):(r=i,i=i.nextZ,u--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let h=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),w(t),t=p.next,h=p.next;else if((t=p)===h){y?1===y?r(t=i(n(t),e),e,u,s,l,a,2):2===y&&f(t,e,u,s,l,a):r(n(t),e,u,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,f=e.y,u=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(f,u,s),a=Math.max(x,o,i),y=Math.max(f,u,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=y&&h(x,f,o,u,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const f=x.x,u=o.x,s=i.x,l=x.y,a=o.y,y=i.y,p=Math.min(f,u,s),b=Math.min(l,a,y),M=Math.max(f,u,s),m=Math.max(l,a,y),A=c(p,b,e,n,r),g=c(M,m,e,n,r);let Z=t.prevZ,d=t.nextZ;for(;Z&&Z.z>=A&&d&&d.z<=g;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;if(Z=Z.prevZ,d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;Z&&Z.z>=A;){if(Z.x>=p&&Z.x<=M&&Z.y>=b&&Z.y<=m&&Z!==x&&Z!==i&&h(f,l,u,a,s,y,Z.x,Z.y)&&v(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;d&&d.z<=g;){if(d.x>=p&&d.x<=M&&d.y>=b&&d.y<=m&&d!==x&&d!==i&&h(f,l,u,a,s,y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!b(n,x)&&M(n,r,r.next,x)&&g(n,x)&&g(x,n)&&(e.push(n.i,r.i,x.i),w(r),w(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function f(t,e,x,o,i,f){let u=t;do{let t=u.next.next;for(;t!==u.prev;){if(u.i!==t.i&&p(u,t)){let s=Z(u,t);return u=n(u,u.next),s=n(s,s.next),r(u,e,x,o,i,f,0),void r(s,e,x,o,i,f,0)}t=t.next}u=u.next}while(u!==t)}function u(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(b(t,n))return n;do{if(b(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const f=o,u=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=u&&r!==n.x&&y(x<s?r:i,x,u,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);g(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==f);return o}(t,e);if(!r)return e;const x=Z(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,x,o,i,f){return(x-i)*(e-f)>=(t-i)*(o-f)&&(t-i)*(r-f)>=(n-i)*(e-f)&&(n-i)*(o-f)>=(x-i)*(r-f)}function h(t,e,n,r,x,o,i,f){return!(t===i&&e===f)&&y(t,e,n,r,x,o,i,f)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&M(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(g(t,e)&&g(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||b(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function M(t,e,n,r){const x=A(v(t,e,n)),o=A(v(t,e,r)),i=A(v(n,r,t)),f=A(v(n,r,e));return x!==o&&i!==f||(!(0!==x||!m(t,n,e))||(!(0!==o||!m(t,r,e))||(!(0!==i||!m(n,t,r))||!(0!==f||!m(n,e,r)))))}function m(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function A(t){return t>0?1:t<0?-1:0}function g(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function Z(t,e){const n=F(t.i,t.x,t.y),r=F(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function d(t,e,n,r){const x=F(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function F(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function E(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function I(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],f=e[3],u=e[4],s=e[5];return t[0]=f/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-f*u)/n,t[5]=-(x*s-o*u)/n,t}new Array(6);const z=[],B={vertexAttributesPosition:0,instanceAttributesPosition:0,indicesPosition:0};function P(t,e,n,r,x){const o=t[e++],i=t[e++],f=z;f.length=r;for(let n=0;n<f.length;n++)f[n]=t[e+n];let u=x?x.instanceAttributesPosition:0;return n[u++]=o,n[u++]=i,f.length&&(n.set(f,u),u+=f.length),B.instanceAttributesPosition=u,B}function N(t,e,n,r,x,o,i,f,u,s){const l=[t[e],t[e+1]],c=[t[n],t[n+1]],a=t[e+2],y=t[n+2],h=E(f,[...l]),p=E(f,[...c]);function v(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),f=[(n[0]-t[0])/i,(n[1]-t[1])/i];let u=0===r||0===i?0:Math.acos((s=f[0]*x[0]+f[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;u=Math.max(u,1e-5);return f[0]*o[0]+f[1]*o[1]>0?u:2*Math.PI-u}let b=-1,M=-1,m=s;const A=null!==x;if(null!==r){b=v(h,p,E(f,[...[t[r],t[r+1]]])),Math.cos(b)<=.985&&(m+=Math.tan((b-Math.PI)/2))}if(A){M=v(p,h,E(f,[...[t[x],t[x+1]]])),Math.cos(M)<=.985&&(m+=Math.tan((Math.PI-M)/2))}const g=Math.pow(2,24),Z=u%g,d=Math.floor(u/g)*g;return o.push(l[0],l[1],a,c[0],c[1],y,b,M,Z,d,s),o.push(...i),{length:u+Math.sqrt((p[0]-h[0])*(p[0]-h[0])+(p[1]-h[1])*(p[1]-h[1])),angle:m}}function R(e,n,r,x,o){const i=2+o;let f=n;const u=e.slice(f,f+o);f+=o;const s=e[f++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[f++],t<s-1&&(c[t]=l);const a=e.slice(f,f+2*l),y=t(a,c,2);for(let t=0;t<y.length;t++)x.push(y[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...u);return f+2*l}const S="GENERATE_POLYGON_BUFFERS",T="GENERATE_POINT_BUFFERS",_="GENERATE_LINE_STRING_BUFFERS",O=self;O.onmessage=t=>{const e=t.data;switch(e.type){case T:{const t=2,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x*(t+r),f=Uint32Array.from([0,1,3,1,2,3]),u=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),s=new Float32Array(i);let l;for(let t=0;t<o.length;t+=x)l=P(o,t,s,r,l);const c=Object.assign({indicesBuffer:f.buffer,vertexAttributesBuffer:u.buffer,instanceAttributesBuffer:s.buffer,renderInstructions:o.buffer},e);O.postMessage(c,[u.buffer,s.buffer,f.buffer,o.buffer]);break}case _:{const t=[],n=e.customAttributesSize,r=3,x=new Float32Array(e.renderInstructions);let o=0;const i=[1,0,0,1,0,0];let f,u;for(I(i,e.renderInstructionsTransform);o<x.length;){u=Array.from(x.slice(o,o+n)),o+=n,f=x[o++];const e=o,s=o+(f-1)*r,l=x[e]===x[s]&&x[e+1]===x[s+1];let c=0,a=0;for(let n=0;n<f-1;n++){let y=null;n>0?y=o+(n-1)*r:l&&(y=s-r);let h=null;n<f-2?h=o+(n+2)*r:l&&(h=e+r);const p=N(x,o+n*r,o+(n+1)*r,y,h,t,u,i,c,a);c=p.length,a=p.angle}o+=f*r}const s=Uint32Array.from([0,1,3,1,2,3]),l=Float32Array.from([-1,-1,1,-1,1,1,-1,1]),c=Float32Array.from(t),a=Object.assign({indicesBuffer:s.buffer,vertexAttributesBuffer:l.buffer,instanceAttributesBuffer:c.buffer,renderInstructions:x.buffer},e);O.postMessage(a,[l.buffer,c.buffer,s.buffer,x.buffer]);break}case S:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=R(x,o,t,n,r);const i=Uint32Array.from(n),f=Float32Array.from(t),u=Float32Array.from([]),s=Object.assign({indicesBuffer:i.buffer,vertexAttributesBuffer:f.buffer,instanceAttributesBuffer:u.buffer,renderInstructions:x.buffer},e);O.postMessage(s,[f.buffer,u.buffer,i.buffer,x.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(n,"binary").toString("base64"):URL.createObjectURL(new Blob([n],{type:"application/javascript"})))}const mi={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"};function sd(n,e){e=e||[];const t=256,r=t-1,i=Math.floor(n/t/t/t)/r,s=Math.floor(n/t/t)%t/r,o=Math.floor(n/t)%t/r,a=n%t/r;return e[0]=i*256*255+s*255,e[1]=o*256*255+a*255,e}function od(n){let e=0;const t=256,r=t-1;return e+=Math.round(n[0]*t*t*t*r),e+=Math.round(n[1]*t*t*r),e+=Math.round(n[2]*t*r),e+=Math.round(n[3]*r),e}function Hl(n,e,t,r){let i=0;for(const s in e){const o=e[s],a=o.callback.call(t,t.feature);let l=(a==null?void 0:a[0])??a;l===ka&&console.warn('The "has" operator might return false positives.'),l===void 0?l=ka:l===null&&(l=0),n[r+i++]=l,!(!o.size||o.size===1)&&(n[r+i++]=a[1],!(o.size<3)&&(n[r+i++]=a[2],!(o.size<4)&&(n[r+i++]=a[3])))}return i}function vo(n){return Object.keys(n).reduce((e,t)=>e+(n[t].size||1),0)}function Jb(n,e,t,r){const i=(2+vo(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let u=0,c=l.flatCoordss.length;u<c;u++)s[0]=l.flatCoordss[u][0],s[1]=l.flatCoordss[u][1],xr(r,s),e[o++]=s[0],e[o++]=s[1],o+=Hl(e,t,l,o)}return e}function Qb(n,e,t,r){const i=3*n.verticesCount+(1+vo(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let u=0,c=l.flatCoordss.length;u<c;u++){s.length=l.flatCoordss[u].length,cf(l.flatCoordss[u],0,s.length,3,r,s,3),o+=Hl(e,t,l,o),e[o++]=s.length/3;for(let h=0,f=s.length;h<f;h+=3)e[o++]=s[h],e[o++]=s[h+1],e[o++]=s[h+2]}}return e}function ex(n,e,t,r){const i=2*n.verticesCount+(1+vo(t))*n.geometriesCount+n.ringsCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let u=0,c=l.flatCoordss.length;u<c;u++){s.length=l.flatCoordss[u].length,cf(l.flatCoordss[u],0,s.length,2,r,s),o+=Hl(e,t,l,o),e[o++]=l.ringsVerticesCounts[u].length;for(let h=0,f=l.ringsVerticesCounts[u].length;h<f;h++)e[o++]=l.ringsVerticesCounts[u][h];for(let h=0,f=s.length;h<f;h+=2)e[o++]=s[h],e[o++]=s[h+1]}}return e}function Vs(n){return(JSON.stringify(n).split("").reduce((t,r)=>(t<<5)-t+r.charCodeAt(0),0)>>>0).toString()}function Yl(n,e,t,r){if(`${r}radius`in n&&r!=="icon-"){let i=Z(t,n[`${r}radius`],pe);if(`${r}radius2`in n){const s=Z(t,n[`${r}radius2`],pe);i=`max(${i}, ${s})`}`${r}stroke-width`in n&&(i=`(${i} + ${Z(t,n[`${r}stroke-width`],pe)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${r}scale`in n){const i=Z(t,n[`${r}scale`],fn);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${i}`)}`${r}displacement`in n&&e.setSymbolOffsetExpression(Z(t,n[`${r}displacement`],ln)),`${r}rotation`in n&&e.setSymbolRotationExpression(Z(t,n[`${r}rotation`],pe)),`${r}rotate-with-view`in n&&e.setSymbolRotateWithView(!!n[`${r}rotate-with-view`])}function ad(n,e,t,r,i){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&r!==null){const l=`smoothstep(-${r} + 0.63, -${r} - 0.58, ${n})`;s=`mix(${t}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${n}))`;let a=`${s} * vec4(1.0, 1.0, 1.0, ${o})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function Kl(n,e,t,r,i){const s=new Image;s.crossOrigin=n[`${r}cross-origin`]===void 0?"anonymous":n[`${r}cross-origin`],Lt(typeof n[`${r}src`]=="string",`WebGL layers do not support expressions for the ${r}src style property`),s.src=n[`${r}src`],t[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`u_texture${i}_size`,"vec2");const o=`u_texture${i}_size`;return t[`u_texture${i}`]=s,e.addUniform(`u_texture${i}`,"sampler2D"),o}function Jl(n,e,t,r,i){let s=Z(t,n[`${e}offset`],fn);if(`${e}offset-origin`in n)switch(n[`${e}offset-origin`]){case"top-right":s=`vec2(${r}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${r}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${r} - ${i} - ${s}`;break}return s}function tx(n,e,t,r){r.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Yl(n,e,r,"circle-");let i=null;"circle-opacity"in n&&(i=Z(r,n["circle-opacity"],pe));let s="coordsPx";"circle-scale"in n&&(s=`coordsPx / ${Z(r,n["circle-scale"],fn)}`);let o=null;"circle-fill-color"in n&&(o=Z(r,n["circle-fill-color"],_t));let a=null;"circle-stroke-color"in n&&(a=Z(r,n["circle-stroke-color"],_t));let l=Z(r,n["circle-radius"],pe),u=null;"circle-stroke-width"in n&&(u=Z(r,n["circle-stroke-width"],pe),l=`(${l} + ${u} * 0.5)`);const c=`circleDistanceField(${s}, ${l})`,h=ad(c,o,a,u,i);e.setSymbolColorExpression(h)}function rx(n,e,t,r){r.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,r.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,r.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Yl(n,e,r,"shape-");let i=null;"shape-opacity"in n&&(i=Z(r,n["shape-opacity"],pe));let s="coordsPx";"shape-scale"in n&&(s=`coordsPx / ${Z(r,n["shape-scale"],fn)}`);let o=null;"shape-fill-color"in n&&(o=Z(r,n["shape-fill-color"],_t));let a=null;"shape-stroke-color"in n&&(a=Z(r,n["shape-stroke-color"],_t));let l=null;"shape-stroke-width"in n&&(l=Z(r,n["shape-stroke-width"],pe));const u=Z(r,n["shape-points"],pe);let c="0.";"shape-angle"in n&&(c=Z(r,n["shape-angle"],pe));let h,f=Z(r,n["shape-radius"],pe);if(l!==null&&(f=`${f} + ${l} * 0.5`),"shape-radius2"in n){let d=Z(r,n["shape-radius2"],pe);l!==null&&(d=`${d} + ${l} * 0.5`),h=`starDistanceField(${s}, ${u}, ${f}, ${d}, ${c})`}else h=`regularDistanceField(${s}, ${u}, ${f}, ${c})`;const p=ad(h,o,a,l,i);e.setSymbolColorExpression(p)}function nx(n,e,t,r){let i="vec4(1.0)";"icon-color"in n&&(i=Z(r,n["icon-color"],_t)),"icon-opacity"in n&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${Z(r,n["icon-opacity"],pe)})`);const s=Vs(n["icon-src"]),o=Kl(n,e,t,"icon-",s);if(e.setSymbolColorExpression(`${i} * texture2D(u_texture${s}, v_texCoord)`).setSymbolSizeExpression(o),"icon-width"in n&&"icon-height"in n&&e.setSymbolSizeExpression(`vec2(${Z(r,n["icon-width"],pe)}, ${Z(r,n["icon-height"],pe)})`),"icon-offset"in n&&"icon-size"in n){const a=Z(r,n["icon-size"],ln),l=e.getSymbolSizeExpression();e.setSymbolSizeExpression(a);const u=Jl(n,"icon-",r,"v_quadSizePx",a);e.setTextureCoordinateExpression(`(vec4((${u}).xyxy) + vec4(0., 0., ${a})) / (${l}).xyxy`)}if(Yl(n,e,r,"icon-"),"icon-anchor"in n){const a=Z(r,n["icon-anchor"],ln);let l="1.0";"icon-scale"in n&&(l=Z(r,n["icon-scale"],fn));let u;n["icon-anchor-x-units"]==="pixels"&&n["icon-anchor-y-units"]==="pixels"?u=`${a} * ${l}`:n["icon-anchor-x-units"]==="pixels"?u=`${a} * vec2(vec2(${l}).x, v_quadSizePx.y)`:n["icon-anchor-y-units"]==="pixels"?u=`${a} * vec2(v_quadSizePx.x, vec2(${l}).x)`:u=`${a} * v_quadSizePx`;let c=`v_quadSizePx * vec2(0.5, -0.5) + ${u} * vec2(-1., 1.)`;if("icon-anchor-origin"in n)switch(n["icon-anchor-origin"]){case"top-right":c=`v_quadSizePx * -0.5 + ${u}`;break;case"bottom-left":c=`v_quadSizePx * 0.5 - ${u}`;break;case"bottom-right":c=`v_quadSizePx * vec2(-0.5, 0.5) + ${u} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${c}`)}}function ix(n,e,t,r){if("stroke-color"in n&&e.setStrokeColorExpression(Z(r,n["stroke-color"],_t)),"stroke-pattern-src"in n){const i=Vs(n["stroke-pattern-src"]),s=Kl(n,e,t,"stroke-pattern-",i);let o=s,a="vec2(0.)";"stroke-pattern-offset"in n&&"stroke-pattern-size"in n&&(o=Z(r,n["stroke-pattern-size"],ln),a=Jl(n,"stroke-pattern-",r,s,o));let l="0.";"stroke-pattern-spacing"in n&&(l=Z(r,n["stroke-pattern-spacing"],pe));let u="0.";"stroke-pattern-start-offset"in n&&(u=Z(r,n["stroke-pattern-start-offset"],pe)),r.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float startOffsetPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = (currentLengthPx - startOffsetPx) * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  float isInsideOfPattern = step(uCoordPx, sampleSize.x);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  vCoordPx = clamp(vCoordPx, 0.5, sampleSize.y - 0.5);
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord) * vec4(1.0, 1.0, 1.0, isInsideOfPattern);
}`;const c=`u_texture${i}`;let h="1.";"stroke-color"in n&&(h=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${h} * sampleStrokePattern(${c}, ${s}, ${a}, ${o}, ${l}, ${u}, currentLengthPx, currentRadiusRatio, v_width)`),r.functions.computeStrokePatternLength=`float computeStrokePatternLength(vec2 sampleSize, float spacingPx, float lineWidth) {
  float patternLengthPx = sampleSize.x / sampleSize.y * lineWidth;
  return patternLengthPx + spacingPx;
}`,e.setStrokePatternLengthExpression(`computeStrokePatternLength(${o}, ${l}, v_width)`)}if("stroke-width"in n&&e.setStrokeWidthExpression(Z(r,n["stroke-width"],pe)),"stroke-offset"in n&&e.setStrokeOffsetExpression(Z(r,n["stroke-offset"],pe)),"stroke-line-cap"in n&&e.setStrokeCapExpression(Z(r,n["stroke-line-cap"],Li)),"stroke-line-join"in n&&e.setStrokeJoinExpression(Z(r,n["stroke-line-join"],Li)),"stroke-miter-limit"in n&&e.setStrokeMiterLimitExpression(Z(r,n["stroke-miter-limit"],pe)),"stroke-line-dash"in n){r.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${pr("square")}) {
    distanceSegment -= lineWidth * 0.5;
  } else if (capType == ${pr("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);
  }
  return distanceSegment;
}`;let i=n["stroke-line-dash"].map(d=>Z(r,d,pe));i.length%2===1&&(i=[...i,...i]);let s="0.";"stroke-line-dash-offset"in n&&(s=Z(r,n["stroke-line-dash-offset"],pe));const a=`dashDistanceField_${Vs(n["stroke-line-dash"])}`,l=i.map((d,g)=>`float dashLength${g}`).join(", "),u=i.map((d,g)=>`dashLength${g}`).join(" + ");let c="0.",h=`getSingleDashDistance(distance, radius, ${c}, dashLength0, totalDashLength, capType, lineWidth)`;for(let d=2;d<i.length;d+=2)c=`${c} + dashLength${d-2} + dashLength${d-1}`,h=`min(${h}, getSingleDashDistance(distance, radius, ${c}, dashLength${d}, totalDashLength, capType, lineWidth))`;r.functions[a]=`float ${a}(float distance, float radius, float capType, float lineWidth, ${l}) {
  float totalDashLength = ${u};
  return ${h};
}`;const f=i.map((d,g)=>`${d}`).join(", ");e.setStrokeDistanceFieldExpression(`${a}(currentLengthPx + ${s}, currentRadiusPx, capType, v_width, ${f})`);let p=i.join(" + ");e.getStrokePatternLengthExpression()&&(r.functions.combinePatternLengths=`float combinePatternLengths(float patternLength1, float patternLength2) {
  return patternLength1 * patternLength2;
}`,p=`combinePatternLengths(${e.getStrokePatternLengthExpression()}, ${p})`),e.setStrokePatternLengthExpression(p)}}function sx(n,e,t,r){if("fill-color"in n&&e.setFillColorExpression(Z(r,n["fill-color"],_t)),"fill-pattern-src"in n){const i=Vs(n["fill-pattern-src"]),s=Kl(n,e,t,"fill-pattern-",i);let o=s,a="vec2(0.)";"fill-pattern-offset"in n&&"fill-pattern-size"in n&&(o=Z(r,n["fill-pattern-size"],ln),a=Jl(n,"fill-pattern-",r,s,o)),r.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const l=`u_texture${i}`;let u="1.";"fill-color"in n&&(u=e.getFillColorExpression()),e.setFillColorExpression(`${u} * sampleFillPattern(${l}, ${s}, ${a}, ${o}, pxOrigin, pxPos)`)}}function ja(n,e,t){const r=Wl(),i=new nd,s={};if("icon-src"in n?nx(n,i,s,r):"shape-points"in n?rx(n,i,s,r):"circle-radius"in n&&tx(n,i,s,r),ix(n,i,s,r),sx(n,i,s,r),t){const l=Z(r,t,Ii);i.setFragmentDiscardExpression(`!${l}`)}const o={};function a(l,u,c,h){if(!r[l])return;const f=$a(c),p=ql(c);i.addAttribute(`a_${u}`,f),o[u]={size:p,callback:h}}return a("geometryType",Qf,Li,l=>zn(Yg(l.getGeometry()))),a("featureId",Jf,Li|pe,l=>{const u=l.getId()??null;return typeof u=="string"?zn(u):u}),ed(i,r),{builder:i,attributes:{...o,...rd(r)},uniforms:{...s,...td(r,e)}}}const ox=[];let ra;function ax(){return ra||(ra=id()),ra}let lx=0;const Mt={POSITION:"a_position",LOCAL_POSITION:"a_localPosition",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",ANGLE_TANGENT_SUM:"a_angleTangentSum",JOIN_ANGLES:"a_joinAngles",DISTANCE_LOW:"a_distanceLow",DISTANCE_HIGH:"a_distanceHigh"};class ux{constructor(e,t,r,i){this.helper_,this.hitDetectionEnabled_=!!i,this.styleShaders=cx(e,t),this.customAttributes_={},this.uniforms_={},this.hitDetectionEnabled_&&(this.customAttributes_.hitColor={callback(){return sd(this.ref,ox)},size:2});for(const s of this.styleShaders){for(const o in s.attributes)o in this.customAttributes_||(this.customAttributes_[o]=s.attributes[o]);for(const o in s.uniforms)o in this.uniforms_||(this.uniforms_[o]=s.uniforms[o])}this.renderPasses_=this.styleShaders.map(s=>{const o={},a=Object.entries(this.customAttributes_).map(([l,u])=>({name:l in s.attributes||l==="hitColor"?`a_${l}`:null,size:u.size||1,type:ze.FLOAT}));return s.builder.getFillVertexShader()&&(o.fillRenderPass={vertexShader:s.builder.getFillVertexShader(),fragmentShader:s.builder.getFillFragmentShader(),attributesDesc:[{name:Mt.POSITION,size:2,type:ze.FLOAT},...a],instancedAttributesDesc:[],instancePrimitiveVertexCount:3}),s.builder.getStrokeVertexShader()&&(o.strokeRenderPass={vertexShader:s.builder.getStrokeVertexShader(),fragmentShader:s.builder.getStrokeFragmentShader(),attributesDesc:[{name:Mt.LOCAL_POSITION,size:2,type:ze.FLOAT}],instancedAttributesDesc:[{name:Mt.SEGMENT_START,size:2,type:ze.FLOAT},{name:Mt.MEASURE_START,size:1,type:ze.FLOAT},{name:Mt.SEGMENT_END,size:2,type:ze.FLOAT},{name:Mt.MEASURE_END,size:1,type:ze.FLOAT},{name:Mt.JOIN_ANGLES,size:2,type:ze.FLOAT},{name:Mt.DISTANCE_LOW,size:1,type:ze.FLOAT},{name:Mt.DISTANCE_HIGH,size:1,type:ze.FLOAT},{name:Mt.ANGLE_TANGENT_SUM,size:1,type:ze.FLOAT},...a],instancePrimitiveVertexCount:6}),s.builder.getSymbolVertexShader()&&(o.symbolRenderPass={vertexShader:s.builder.getSymbolVertexShader(),fragmentShader:s.builder.getSymbolFragmentShader(),attributesDesc:[{name:Mt.LOCAL_POSITION,size:2,type:ze.FLOAT}],instancedAttributesDesc:[{name:Mt.POSITION,size:2,type:ze.FLOAT},...a],instancePrimitiveVertexCount:6}),o}),this.hasFill_=this.renderPasses_.some(s=>s.fillRenderPass),this.hasStroke_=this.renderPasses_.some(s=>s.strokeRenderPass),this.hasSymbol_=this.renderPasses_.some(s=>s.symbolRenderPass),this.setHelper(r)}async generateBuffers(e,t){if(e.isEmpty())return null;const r=this.generateRenderInstructions_(e,t),[i,s,o]=await Promise.all([this.generateBuffersForType_(r.polygonInstructions,"Polygon",t),this.generateBuffersForType_(r.lineStringInstructions,"LineString",t),this.generateBuffersForType_(r.pointInstructions,"Point",t)]),a=Ti(rt(),t);return{polygonBuffers:i,lineStringBuffers:s,pointBuffers:o,invertVerticesTransform:a}}generateRenderInstructions_(e,t){const r=this.hasFill_?ex(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,i=this.hasStroke_?Qb(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,s=this.hasSymbol_?Jb(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null;return{polygonInstructions:r,lineStringInstructions:i,pointInstructions:s}}generateBuffersForType_(e,t,r){if(e===null)return null;const i=lx++;let s;switch(t){case"Polygon":s=mi.GENERATE_POLYGON_BUFFERS;break;case"LineString":s=mi.GENERATE_LINE_STRING_BUFFERS;break;case"Point":s=mi.GENERATE_POINT_BUFFERS;break}const o={id:i,type:s,renderInstructions:e.buffer,renderInstructionsTransform:r,customAttributesSize:vo(this.customAttributes_)},a=ax();return a.postMessage(o,[e.buffer]),e=null,new Promise(l=>{const u=c=>{const h=c.data;if(h.id!==i||(a.removeEventListener("message",u),!this.helper_.getGL()))return;const f=new Gr(Yi,Fn).fromArrayBuffer(h.indicesBuffer),p=new Gr(cn,Fn).fromArrayBuffer(h.vertexAttributesBuffer),d=new Gr(cn,Fn).fromArrayBuffer(h.instanceAttributesBuffer);this.helper_.flushBufferData(f),this.helper_.flushBufferData(p),this.helper_.flushBufferData(d),l([f,p,d])};a.addEventListener("message",u)})}render(e,t,r){for(const i of this.renderPasses_)i.fillRenderPass&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],e.polygonBuffers[2],i.fillRenderPass,t,r),i.strokeRenderPass&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],e.lineStringBuffers[2],i.strokeRenderPass,t,r),i.symbolRenderPass&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],e.pointBuffers[2],i.symbolRenderPass,t,r)}renderInternal_(e,t,r,i,s,o){const a=e.getSize();if(a===0)return;const l=i.instancedAttributesDesc.length;if(this.helper_.useProgram(i.program,s),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(i.attributesDesc),this.helper_.bindBuffer(r),this.helper_.enableAttributesInstanced(i.instancedAttributesDesc),o(),l){const u=i.instancedAttributesDesc.reduce((h,f)=>h+(f.size||1),0),c=r.getSize()/u;this.helper_.drawElementsInstanced(0,a,c)}else this.helper_.drawElements(0,a)}setHelper(e,t=null){this.helper_=e;for(const r of this.renderPasses_)r.fillRenderPass&&(r.fillRenderPass.program=this.helper_.getProgram(r.fillRenderPass.fragmentShader,r.fillRenderPass.vertexShader)),r.strokeRenderPass&&(r.strokeRenderPass.program=this.helper_.getProgram(r.strokeRenderPass.fragmentShader,r.strokeRenderPass.vertexShader)),r.symbolRenderPass&&(r.symbolRenderPass.program=this.helper_.getProgram(r.symbolRenderPass.fragmentShader,r.symbolRenderPass.vertexShader));this.helper_.addUniforms(this.uniforms_),t&&(t.polygonBuffers&&(this.helper_.flushBufferData(t.polygonBuffers[0]),this.helper_.flushBufferData(t.polygonBuffers[1]),this.helper_.flushBufferData(t.polygonBuffers[2])),t.lineStringBuffers&&(this.helper_.flushBufferData(t.lineStringBuffers[0]),this.helper_.flushBufferData(t.lineStringBuffers[1]),this.helper_.flushBufferData(t.lineStringBuffers[2])),t.pointBuffers&&(this.helper_.flushBufferData(t.pointBuffers[0]),this.helper_.flushBufferData(t.pointBuffers[1]),this.helper_.flushBufferData(t.pointBuffers[2])))}}function cx(n,e){const t=Array.isArray(n)?n:[n];if("style"in t[0]){const r=[],i=t,s=[];for(const o of i){const a=Array.isArray(o.style)?o.style:[o.style];let l=o.filter;o.else&&s.length&&(l=["all",...s.map(c=>["!",c])],o.filter&&l.push(o.filter),l.length<3&&(l=l[1])),o.filter&&s.push(o.filter);const u=a.map(c=>ja(c,e,l));r.push(...u)}return r}return"builder"in t[0]?t:t.map(r=>ja(r,e,null))}const Yt=new Uint8Array(4);class ld{constructor(e,t){this.helper_=e;const r=e.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.depthbuffer_=r.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){Ag(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return Yt[0]=0,Yt[1]=0,Yt[2]=0,Yt[3]=0,Yt;this.readAll();const r=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return Yt[0]=this.data_[r*4],Yt[1]=this.data_[r*4+1],Yt[2]=this.data_[r*4+2],Yt[3]=this.data_[r*4+3],Yt}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}function ud(n,e){const t=n.viewState.projection,i=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),o=n.extent,a=i?nt(s):null,l=i?Math.ceil((o[2]-s[2])/a)+1:1;return[i?Math.floor((o[0]-s[0])/a):0,l,a]}const xn={...er,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class cd extends Ki{constructor(e,t){const r={[xn.RENDER_EXTENT]:[0,0,0,0],[xn.PATTERN_ORIGIN]:[0,0],[xn.GLOBAL_ALPHA]:1};super(e,{uniforms:r,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=$i(),this.currentTransform_=rt(),this.tmpCoords_=[0,0],this.tmpTransform_=rt(),this.tmpMat4_=gn(),this.currentFrameStateTransform_=rt(),this.styleVariables_={},this.style_=[],this.styleRenderer_=null,this.buffers_=null,this.applyOptions_(t),this.batch_=new js,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource();let r;this.batch_.addFeatures(t.getFeatures(),r),this.sourceListenKeys_=[gr(t,Nr.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,r)),gr(t,Nr.CHANGEFEATURE,this.handleSourceFeatureChanged_.bind(this,r),this),gr(t,Nr.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),gr(t,Nr.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.style_=e.style}createRenderers_(){this.buffers_=null,this.styleRenderer_=new ux(this.style_,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderer_?this.styleRenderer_.setHelper(this.helper,this.buffers_):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new ld(this.helper))}handleSourceFeatureAdded_(e,t){const r=t.feature;this.batch_.addFeature(r,e)}handleSourceFeatureChanged_(e,t){const r=t.feature;this.batch_.changeFeature(r,e)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){fg(this.tmpTransform_,this.currentFrameStateTransform_),vi(this.tmpTransform_,e),this.helper.setUniformMatrixValue(xn.PROJECTION_MATRIX,ks(this.tmpMat4_,this.tmpTransform_)),Ti(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(xn.SCREEN_TO_WORLD_MATRIX,ks(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,Ti(this.tmpTransform_,e),xr(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(xn.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,s]=ud(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,r,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),o}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),r=t.getSource(),i=e.viewState,s=!e.viewHints[$r.ANIMATING]&&!e.viewHints[$r.INTERACTING],o=!Ri(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),s&&(o||a)){const l=i.projection,u=i.resolution,c=t instanceof po?t.getRenderBuffer():0,h=xl(e.extent,c*u);r.loadFeatures(h,u,l),this.ready=!1;const f=this.helper.makeProjectionTransform(e,rt());this.styleRenderer_.generateBuffers(this.batch_,f).then(p=>{this.buffers_&&this.disposeBuffers(this.buffers_),this.buffers_=p,this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,r,i,s){let o=r;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),ml(this.currentFrameStateTransform_,o*s,0),this.buffers_&&this.styleRenderer_.render(this.buffers_,e,()=>{this.applyUniforms_(this.buffers_.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)});while(++o<i)}forEachFeatureAtCoordinate(e,t,r,i,s){if(Lt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderer_||!this.hitDetectionEnabled_)return;const o=xr(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],u=od(l),c=this.batch_.getFeatureFromRef(u);if(c)return i(c,this.getLayer(),null)}disposeBuffers(e){const t=r=>{for(const i of r)i&&this.helper.deleteBuffer(i)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_&&this.disposeBuffers(this.buffers_),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){As(e)}),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}}const dr={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},hx=["#00f","#0ff","#0f0","#ff0","#f00"];class fx extends po{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.filter_=e.filter??!0,this.styleVariables_=e.variables||{},this.gradient_=null,this.addChangeListener(dr.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:hx),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const r=e.weight?e.weight:"weight";this.weight_=r,this.setRenderOrder(null)}getBlur(){return this.get(dr.BLUR)}getGradient(){return this.get(dr.GRADIENT)}getRadius(){return this.get(dr.RADIUS)}handleGradientChanged_(){this.gradient_=dx(this.getGradient())}setBlur(e){const t=this.get(dr.BLUR);if(this.set(dr.BLUR,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setGradient(e){this.set(dr.GRADIENT,e)}setRadius(e){const t=this.get(dr.RADIUS);if(this.set(dr.RADIUS,e),typeof e=="number"&&typeof t=="number"){this.changed();return}this.clearRenderer()}setFilter(e){this.filter_=e,this.changed(),this.clearRenderer()}setWeight(e){this.weight_=e,this.changed(),this.clearRenderer()}createRenderer(){const e=new nd,t=Wl(),r=Z(t,this.filter_,Ii);let i=Z(t,this.getRadius(),pe),s=Z(t,this.getBlur(),pe);const o={};typeof this.getBlur()=="number"&&(s="a_blur",o.a_blur=()=>this.getBlur(),e.addUniform("a_blur","float")),typeof this.getRadius()=="number"&&(i="a_radius",o.a_radius=()=>this.getRadius(),e.addUniform("a_radius","float"));const a={};let l=null;if(typeof this.weight_=="string"||typeof this.weight_=="function"){const h=typeof this.weight_=="string"?f=>f.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:f=>{const p=h(f);return p!==void 0?De(p,0,1):1}},l="a_prop_weight",e.addAttribute("a_prop_weight","float")}else{const h=["clamp",this.weight_,0,1];l=Z(t,h,pe)}e.addFragmentShaderFunction(`float getBlurSlope() {
  float blur = max(1., ${s});
  float radius = ${i};
  return radius / blur;
}`).setSymbolSizeExpression(`vec2(${i} + ${s}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${l})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${l})`).setStrokeWidthExpression(`(${i} + ${s}) * 2.`).setFillColorExpression(`vec4(${l})`).setFragmentDiscardExpression(`!${r}`),ed(e,t);const u=rd(t),c=td(t,this.styleVariables_);return new cd(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:e,attributes:{...u,...a},uniforms:{...c,...o}},disableHitDetection:!1,postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}renderDeclutter(){}}function dx(n){const r=kr(1,256),i=r.createLinearGradient(0,0,1,256),s=1/(n.length-1);for(let o=0,a=n.length;o<a;++o)i.addColorStop(o*s,n[o]);return r.fillStyle=i,r.fillRect(0,0,1,256),r.canvas}class Ql extends _f{constructor(e,t,r,i,s){const o=s!==void 0?Qr.IDLE:Qr.LOADED;super(e,t,r,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=Qr.ERROR):this.state=Qr.LOADED,this.changed()}load(){this.state==Qr.IDLE&&(this.state=Qr.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}class px extends Kg{constructor(e){super(e),this.vectorRenderer_=new Jg(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=rt(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=xr(this.coordinateToVectorPixelTransform_,xr(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){var c;const t=e.pixelRatio,r=e.viewState,i=r.resolution,s=e.viewHints,o=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),df(a,this.layerImageRatio_));const l=nt(a)/i,u=Wt(a)/i;if(!s[$r.ANIMATING]&&!s[$r.INTERACTING]&&!co(a)){o.useContainer(null,null);const h=o.context,f=e.layerStatesArray[e.layerIndex],p=Object.assign({},f,{opacity:1}),d=Object.assign({},e,{extent:a,size:[l,u],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[p],layerIndex:0,declutter:null}),g=this.getLayer().getDeclutter();g&&(d.declutter={[g]:new Qg(9)});const m=new Ql(a,i,t,h.canvas,function(y){o.prepareFrame(d)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(d,null),o.renderDeclutter(d),o.renderDeferred(d),y())});m.addEventListener(pt.CHANGE,()=>{if(m.getState()!==Qr.LOADED)return;this.image=m;const y=m.getPixelRatio(),_=em(m.getResolution())*t/y;this.renderedResolution=_,this.coordinateToVectorPixelTransform_=gl(this.coordinateToVectorPixelTransform_,l/2,u/2,1/_,-1/_,0,-r.center[0],-r.center[1])}),m.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!((c=this.getLayer().getSource())!=null&&c.loading)&&!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,r,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,r,i,s):super.forEachFeatureAtCoordinate(e,t,r,i,s)}}class gx extends po{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new px(this)}}class mx extends Ki{constructor(e,t){const r=t.uniforms||{},i=rt();r[er.PROJECTION_MATRIX]=i,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new Gr(cn,Fn),this.instanceAttributesBuffer_=new Gr(cn,Fn),this.indicesBuffer_=new Gr(Yi,Fn),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(a){return{name:"a_"+a.name,size:1,type:ze.FLOAT}}):[];this.attributes=[{name:"a_localPosition",size:2,type:ze.FLOAT}],this.instanceAttributes=[{name:"a_position",size:2,type:ze.FLOAT}],this.hitDetectionEnabled_&&(this.instanceAttributes.push({name:"a_hitColor",size:2,type:ze.FLOAT}),this.instanceAttributes.push({name:"a_featureUid",size:1,type:ze.FLOAT})),this.instanceAttributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=$i(),this.currentTransform_=i,this.renderTransform_=rt(),this.invertRenderTransform_=rt(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=id(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===mi.GENERATE_POINT_BUFFERS){const u=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexAttributesBuffer),this.instanceAttributesBuffer_.fromArrayBuffer(l.instanceAttributesBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.helper.flushBufferData(this.instanceAttributesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indicesBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=u,Ti(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[gr(o,Nr.ADDFEATURE,this.handleSourceFeatureAdded_,this),gr(o,Nr.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),gr(o,Nr.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),gr(o,Nr.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{const l=a.getGeometry();l&&l.getType()==="Point"&&(this.featureCache_[me(a)]={feature:a,properties:a.getProperties(),flatCoordinates:l.getFlatCoordinates()},this.featureCount_++)})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new ld(this.helper)),this.verticesBuffer_.getArray()&&this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.getArray()&&this.helper.flushBufferData(this.indicesBuffer_)}handleSourceFeatureAdded_(e){const t=e.feature,r=t.getGeometry();r&&r.getType()==="Point"&&(this.featureCache_[me(t)]={feature:t,properties:t.getProperties(),flatCoordinates:r.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureChanged_(e){const t=e.feature,r=me(t),i=this.featureCache_[r],s=t.getGeometry();i?s&&s.getType()==="Point"?(i.properties=t.getProperties(),i.flatCoordinates=s.getFlatCoordinates()):(delete this.featureCache_[r],this.featureCount_--):s&&s.getType()==="Point"&&(this.featureCache_[r]={feature:t,properties:t.getProperties(),flatCoordinates:s.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureDelete_(e){const t=e.feature,r=me(t);r in this.featureCache_&&(delete this.featureCache_[r],this.featureCount_--)}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,s]=ud(e,this.getLayer());return this.renderWorlds(e,!1,r,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),i=e.viewState,s=!e.viewHints[$r.ANIMATING]&&!e.viewHints[$r.INTERACTING],o=!Ri(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),s&&(o||a)){const l=i.projection,u=i.resolution,c=t instanceof po?t.getRenderBuffer():0,h=xl(e.extent,c*u);r.loadFeatures(h,u,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),!0}rebuildBuffers_(e){const t=rt();this.helper.makeProjectionTransform(e,t);const i=(this.hitDetectionEnabled_?5:2)+this.customAttributes.length,s=i*this.featureCount_,o=this.renderInstructions_&&this.renderInstructions_.length===s?this.renderInstructions_:new Float32Array(s);this.renderInstructions_=null;let a=[];const l=[];let u=-1;e.viewState.projection;for(const h in this.featureCache_){const f=this.featureCache_[h];if(a[0]=f.flatCoordinates[0],a[1]=f.flatCoordinates[1],xr(t,a),o[++u]=a[0],o[++u]=a[1],this.hitDetectionEnabled_){const p=sd(u+3,l);o[++u]=p[0],o[++u]=p[1],o[++u]=Number(h)}for(let p=0;p<this.customAttributes.length;p++){const d=this.customAttributes[p].callback(f.feature,f.properties);o[++u]=d}}const c={id:++this.lastSentId,type:mi.GENERATE_POINT_BUFFERS,renderInstructions:o.buffer,customAttributesSize:i-2};c.projectionTransform=t,this.ready=!1,this.worker_.postMessage(c,[o.buffer])}forEachFeatureAtCoordinate(e,t,r,i,s){if(Lt(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=xr(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],u=od(l),c=this.renderInstructions_[u],h=Math.floor(c).toString(),p=this.getLayer().getSource().getFeatureByUid(h);if(p)return i(p,this.getLayer(),null)}renderWorlds(e,t,r,i,s){let o=r;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));const a=this.instanceAttributes.reduce((u,c)=>u+(c.size||1),0),l=this.instanceAttributesBuffer_.getSize()/a;do{this.helper.bindBuffer(this.indicesBuffer_),this.helper.bindBuffer(this.verticesBuffer_),this.helper.enableAttributes(this.attributes),this.helper.bindBuffer(this.instanceAttributesBuffer_),this.helper.enableAttributesInstanced(this.instanceAttributes),this.helper.makeProjectionTransform(e,this.currentTransform_),ml(this.currentTransform_,o*s,0),vi(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const u=this.indicesBuffer_.getSize();this.helper.drawElementsInstanced(0,u,l)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.sourceListenKeys_.forEach(function(e){As(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class yx extends go{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.parseResult_=ja(e.style,this.styleVariables_,e.filter),this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new mx(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}function Kc(n,e){const t=`
    attribute vec2 ${xs.TEXTURE_COORD};
    uniform mat4 ${J.TILE_TRANSFORM};
    uniform float ${J.TEXTURE_PIXEL_WIDTH};
    uniform float ${J.TEXTURE_PIXEL_HEIGHT};
    uniform float ${J.TEXTURE_RESOLUTION};
    uniform float ${J.TEXTURE_ORIGIN_X};
    uniform float ${J.TEXTURE_ORIGIN_Y};
    uniform float ${J.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${xs.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${J.TEXTURE_ORIGIN_X} + ${J.TEXTURE_RESOLUTION} * ${J.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${J.TEXTURE_ORIGIN_Y} - ${J.TEXTURE_RESOLUTION} * ${J.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${J.TILE_TRANSFORM} * vec4(${xs.TEXTURE_COORD}, ${J.DEPTH}, 1.0);
    }
  `,r={...Wl(),bandCount:e},i=[];if(n.color!==void 0){const h=Z(r,n.color,_t);i.push(`color = ${h};`)}if(n.contrast!==void 0){const h=Z(r,n.contrast,pe);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb - (${h} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.exposure!==void 0){const h=Z(r,n.exposure,pe);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.saturation!==void 0){const h=Z(r,n.saturation,pe);i.push(`
      float saturation = ${h} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(n.gamma!==void 0){const h=Z(r,n.gamma,pe);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${h}));`)}if(n.brightness!==void 0){const h=Z(r,n.brightness,pe);i.push(`color.rgb = clamp(color.rgb + ${h}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(r.variables).length;if(o>1&&!n.variables)throw new Error(`Missing variables in style (expected ${r.variables})`);for(let h=0;h<o;++h){const f=r.variables[Object.keys(r.variables)[h]];if(!(f.name in n.variables))throw new Error(`Missing '${f.name}' in style variables`);const p=wo(f.name);s[p]=function(){let d=n.variables[f.name];return typeof d=="string"&&(d=zn(d)),d!==void 0?d:-9999999}}const a=Object.keys(s).map(function(h){return`uniform float ${h};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${J.TILE_TEXTURE_ARRAY}[${l}];`),r.paletteTextures&&a.push(`uniform sampler2D ${Kf}[${r.paletteTextures.length}];`);const u=Object.keys(r.functions).map(function(h){return r.functions[h]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${J.RENDER_EXTENT};
    uniform float ${J.TRANSITION_ALPHA};
    uniform float ${J.TEXTURE_PIXEL_WIDTH};
    uniform float ${J.TEXTURE_PIXEL_HEIGHT};
    uniform float ${J.RESOLUTION};
    uniform float ${J.ZOOM};

    ${a.join(`
`)}

    ${u.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${J.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${J.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${J.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${J.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${J.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${J.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:c,uniforms:s,paletteTextures:r.paletteTextures}}class Xs extends tm{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(Na.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const r=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if(e.getState()==="loading"){const t=()=>{e.getState()==="ready"&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=Kc(this.style_,this.getSourceBandCount_());return new zb(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const r=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],r.prepareFrame(e)&&(i=r.renderFrame(e));return i}render(e,t){this.rendered=!0;const r=e.viewState,i=this.getSources(e.extent,r.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const u=i[a],c=u.getState();if(c=="loading"){const h=()=>{u.getState()=="ready"&&(u.removeEventListener("change",h),this.changed())};u.addEventListener("change",h)}s=s&&c=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=r.resolution,o;if(this.renderedResolution_>.5*r.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const t=Kc(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Xs.prototype.dispose;class _x extends go{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new cd(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style_=e,this.clearRenderer(),this.changed()}}var vt=Uint8Array,Ln=Uint16Array,bx=Int32Array,hd=new vt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fd=new vt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xx=new vt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dd=function(n,e){for(var t=new Ln(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new bx(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},pd=dd(hd,2),gd=pd.b,Ex=pd.r;gd[28]=258,Ex[258]=28;var wx=dd(fd,0),vx=wx.b,Va=new Ln(32768);for(var Me=0;Me<32768;++Me){var Pr=(Me&43690)>>1|(Me&21845)<<1;Pr=(Pr&52428)>>2|(Pr&13107)<<2,Pr=(Pr&61680)>>4|(Pr&3855)<<4,Va[Me]=((Pr&65280)>>8|(Pr&255)<<8)>>1}var yi=function(n,e,t){for(var r=n.length,i=0,s=new Ln(e);i<r;++i)n[i]&&++s[n[i]-1];var o=new Ln(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new Ln(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var u=i<<4|n[i],c=e-n[i],h=o[n[i]-1]++<<c,f=h|(1<<c)-1;h<=f;++h)a[Va[h]>>l]=u}else for(a=new Ln(r),i=0;i<r;++i)n[i]&&(a[i]=Va[o[n[i]-1]++]>>15-n[i]);return a},Ji=new vt(288);for(var Me=0;Me<144;++Me)Ji[Me]=8;for(var Me=144;Me<256;++Me)Ji[Me]=9;for(var Me=256;Me<280;++Me)Ji[Me]=7;for(var Me=280;Me<288;++Me)Ji[Me]=8;var md=new vt(32);for(var Me=0;Me<32;++Me)md[Me]=5;var Tx=yi(Ji,9,1),Sx=yi(md,5,1),na=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Gt=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},ia=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Rx=function(n){return(n+7)/8|0},Px=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new vt(n.subarray(e,t))},Ax=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Et=function(n,e,t){var r=new Error(e||Ax[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,Et),!t)throw r;return r},eu=function(n,e,t,r){var i=n.length,s=0;if(!i||e.f&&!e.l)return t||new vt(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new vt(i*3));var u=function(fr){var ct=t.length;if(fr>ct){var mt=new vt(Math.max(ct*2,fr));mt.set(t),t=mt}},c=e.f||0,h=e.p||0,f=e.b||0,p=e.l,d=e.d,g=e.m,m=e.n,y=i*8;do{if(!p){c=Gt(n,h,1);var _=Gt(n,h+1,3);if(h+=3,_)if(_==1)p=Tx,d=Sx,g=9,m=5;else if(_==2){var E=Gt(n,h,31)+257,S=Gt(n,h+10,15)+4,A=E+Gt(n,h+5,31)+1;h+=14;for(var P=new vt(A),R=new vt(19),I=0;I<S;++I)R[xx[I]]=Gt(n,h+I*3,7);h+=S*3;for(var G=na(R),$=(1<<G)-1,W=yi(R,G,1),I=0;I<A;){var C=W[Gt(n,h,$)];h+=C&15;var b=C>>4;if(b<16)P[I++]=b;else{var O=0,D=0;for(b==16?(D=3+Gt(n,h,3),h+=2,O=P[I-1]):b==17?(D=3+Gt(n,h,7),h+=3):b==18&&(D=11+Gt(n,h,127),h+=7);D--;)P[I++]=O}}var se=P.subarray(0,E),H=P.subarray(E);g=na(se),m=na(H),p=yi(se,g,1),d=yi(H,m,1)}else Et(1);else{var b=Rx(h)+4,w=n[b-4]|n[b-3]<<8,x=b+w;if(x>i){l&&Et(0);break}a&&u(f+w),t.set(n.subarray(b,x),f),e.b=f+=w,e.p=h=x*8,e.f=c;continue}if(h>y){l&&Et(0);break}}a&&u(f+131072);for(var Y=(1<<g)-1,le=(1<<m)-1,Te=h;;Te=h){var O=p[ia(n,h)&Y],K=O>>4;if(h+=O&15,h>y){l&&Et(0);break}if(O||Et(2),K<256)t[f++]=K;else if(K==256){Te=h,p=null;break}else{var M=K-254;if(K>264){var I=K-257,Ce=hd[I];M=Gt(n,h,(1<<Ce)-1)+gd[I],h+=Ce}var Ie=d[ia(n,h)&le],Se=Ie>>4;Ie||Et(3),h+=Ie&15;var H=vx[Se];if(Se>3){var Ce=fd[Se];H+=ia(n,h)&(1<<Ce)-1,h+=Ce}if(h>y){l&&Et(0);break}a&&u(f+131072);var st=f+M;if(f<H){var Be=s-H,He=Math.min(H,st);for(Be+f<0&&Et(3);f<He;++f)t[f]=r[Be+f]}for(;f<st;++f)t[f]=t[f-H]}}e.l=p,e.p=Te,e.b=f,e.f=c,p&&(c=1,e.m=g,e.d=d,e.n=m)}while(!c);return f!=t.length&&o?Px(t,0,f):t.subarray(0,f)},Ix=new vt(0),Lx=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&Et(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!n[t++]);return t+(e&2)},Cx=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},Fx=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&Et(6,"invalid zlib data"),(n[1]>>5&1)==1&&Et(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function Mx(n,e){return eu(n,{i:2},e,e)}function Ox(n,e){var t=Lx(n);return t+8>n.length&&Et(6,"invalid gzip data"),eu(n.subarray(t,-8),{i:2},new vt(Cx(n)),e)}function Nx(n,e){return eu(n.subarray(Fx(n),-4),{i:2},e,e)}function Dx(n,e){return n[0]==31&&n[1]==139&&n[2]==8?Ox(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?Mx(n,e):Nx(n,e)}var Ux=typeof TextDecoder<"u"&&new TextDecoder,Bx=0;try{Ux.decode(Ix,{stream:!0}),Bx=1}catch{}var Gx=Object.defineProperty,_i=Math.pow,Ae=(n,e)=>Gx(n,"name",{value:e,configurable:!0}),Je=(n,e,t)=>new Promise((r,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())});Ae((n,e)=>{let t=!1,r="",i=L.GridLayer.extend({createTile:Ae((s,o)=>{let a=document.createElement("img"),l=new AbortController,u=l.signal;return a.cancel=()=>{l.abort()},t||(n.getHeader().then(c=>{c.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):c.tileType===2?r="image/png":c.tileType===3?r="image/jpeg":c.tileType===4?r="image/webp":c.tileType===5&&(r="image/avif")}),t=!0),n.getZxy(s.z,s.x,s.y,u).then(c=>{if(c){let h=new Blob([c.data],{type:r}),f=window.URL.createObjectURL(h);a.src=f,a.cancel=void 0,o(void 0,a)}}).catch(c=>{if(c.name!=="AbortError")throw c}),a},"createTile"),_removeTile:Ae(function(s){let o=this._tiles[s];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[s],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new i(e)},"leafletRasterLayer");var zx=Ae(n=>(e,t)=>{if(t instanceof AbortController)return n(e,t);let r=new AbortController;return n(e,r).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:Ae(()=>r.abort(),"cancel")}},"v3compat"),kx=class{constructor(e){this.tilev4=Ae((t,r)=>Je(this,null,function*(){if(t.type==="json"){let p=t.url.substr(10),d=this.tiles.get(p);if(d||(d=new Ci(p),this.tiles.set(p,d)),this.metadata)return{data:yield d.getTileJson(t.url)};let g=yield d.getHeader();return(g.minLon>=g.maxLon||g.minLat>=g.maxLat)&&console.error(`Bounds of PMTiles archive ${g.minLon},${g.minLat},${g.maxLon},${g.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:g.minZoom,maxzoom:g.maxZoom,bounds:[g.minLon,g.minLat,g.maxLon,g.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(i);if(!s)throw new Error("Invalid PMTiles protocol URL");let o=s[1],a=this.tiles.get(o);a||(a=new Ci(o),this.tiles.set(o,a));let l=s[2],u=s[3],c=s[4],h=yield a.getHeader(),f=yield a==null?void 0:a.getZxy(+l,+u,+c,r.signal);if(f)return{data:new Uint8Array(f.data),cacheControl:f.cacheControl,expires:f.expires};if(h.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=zx(this.tilev4),this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};Ae(kx,"Protocol");function yd(n,e){return(e>>>0)*4294967296+(n>>>0)}Ae(yd,"toNum");function _d(n,e){let t=e.buf,r=t[e.pos++],i=(r&112)>>4;if(r<128||(r=t[e.pos++],i|=(r&127)<<3,r<128)||(r=t[e.pos++],i|=(r&127)<<10,r<128)||(r=t[e.pos++],i|=(r&127)<<17,r<128)||(r=t[e.pos++],i|=(r&127)<<24,r<128)||(r=t[e.pos++],i|=(r&1)<<31,r<128))return yd(n,i);throw new Error("Expected varint not more than 10 bytes")}Ae(_d,"readVarintRemainder");function Sn(n){let e=n.buf,t=e[n.pos++],r=t&127;return t<128||(t=e[n.pos++],r|=(t&127)<<7,t<128)||(t=e[n.pos++],r|=(t&127)<<14,t<128)||(t=e[n.pos++],r|=(t&127)<<21,t<128)?r:(t=e[n.pos],r|=(t&15)<<28,_d(r,n))}Ae(Sn,"readVarint");function tu(n,e,t,r){if(r===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);let i=e[0];e[0]=e[1],e[1]=i}}Ae(tu,"rotate");function bd(n,e){let t=_i(2,n),r=e,i=e,s=e,o=[0,0],a=1;for(;a<t;)r=1&s/2,i=1&(s^r),tu(a,o,r,i),o[0]+=a*r,o[1]+=a*i,s=s/4,a*=2;return[n,o[0],o[1]]}Ae(bd,"idOnLevel");var $x=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function xd(n,e,t){if(n>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>_i(2,n)-1||t>_i(2,n)-1)throw new Error("tile x/y outside zoom level bounds");let r=$x[n],i=_i(2,n),s=0,o=0,a=0,l=[e,t],u=i/2;for(;u>0;)s=(l[0]&u)>0?1:0,o=(l[1]&u)>0?1:0,a+=u*u*(3*s^o),tu(u,l,s,o),u=u/2;return r+a}Ae(xd,"zxyToTileId");function jx(n){let e=0;for(let t=0;t<27;t++){let r=(1<<t)*(1<<t);if(e+r>n)return bd(t,n-e);e+=r}throw new Error("Tile zoom level exceeds max safe number limit (26)")}Ae(jx,"tileIdToZxy");var Vx=(n=>(n[n.Unknown=0]="Unknown",n[n.None=1]="None",n[n.Gzip=2]="Gzip",n[n.Brotli=3]="Brotli",n[n.Zstd=4]="Zstd",n))(Vx||{});function To(n,e){return Je(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Dx(new Uint8Array(n));let t=new Response(n).body;if(!t)throw new Error("Failed to read response stream");let r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw new Error("Compression method not supported")})}Ae(To,"defaultDecompress");var Rn=(n=>(n[n.Unknown=0]="Unknown",n[n.Mvt=1]="Mvt",n[n.Png=2]="Png",n[n.Jpeg=3]="Jpeg",n[n.Webp=4]="Webp",n[n.Avif=5]="Avif",n))(Rn||{});function Ed(n){return n===1?".mvt":n===2?".png":n===3?".jpg":n===4?".webp":n===5?".avif":""}Ae(Ed,"tileTypeExt");var Xx=127;function wd(n,e){let t=0,r=n.length-1;for(;t<=r;){let i=r+t>>1,s=e-n[i].tileId;if(s>0)t=i+1;else if(s<0)r=i-1;else return n[i]}return r>=0&&(n[r].runLength===0||e-n[r].tileId<n[r].runLength)?n[r]:null}Ae(wd,"findTile");var Wx=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return Je(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};Ae(Wx,"FileSource");var vd=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let r="";"navigator"in globalThis&&(r=globalThis.navigator.userAgent||"");let i=r.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(r);this.chromeWindowsNoCache=!1,i&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,i){return Je(this,null,function*(){let s,o;r?o=r:(s=new AbortController,o=s.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let u=yield fetch(this.url,{signal:o,cache:l,headers:a});if(e===0&&u.status===416){let f=u.headers.get("Content-Range");if(!f||!f.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let p=+f.substr(8);u=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${p-1}`}})}let c=u.headers.get("Etag");if(c!=null&&c.startsWith("W/")&&(c=null),u.status===416||i&&c&&c!==i)throw this.mustReload=!0,new Xa(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(u.status>=300)throw new Error(`Bad response code: ${u.status}`);let h=u.headers.get("Content-Length");if(u.status===200&&(!h||+h>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield u.arrayBuffer(),etag:c||void 0,cacheControl:u.headers.get("Cache-Control")||void 0,expires:u.headers.get("Expires")||void 0}})}};Ae(vd,"FetchSource");var Zx=vd;function Ot(n,e){let t=n.getUint32(e+4,!0),r=n.getUint32(e+0,!0);return t*_i(2,32)+r}Ae(Ot,"getUint64");function Td(n,e){let t=new DataView(n),r=t.getUint8(7);if(r>3)throw new Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:Ot(t,8),rootDirectoryLength:Ot(t,16),jsonMetadataOffset:Ot(t,24),jsonMetadataLength:Ot(t,32),leafDirectoryOffset:Ot(t,40),leafDirectoryLength:Ot(t,48),tileDataOffset:Ot(t,56),tileDataLength:Ot(t,64),numAddressedTiles:Ot(t,72),numTileEntries:Ot(t,80),numTileContents:Ot(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}Ae(Td,"bytesToHeader");function ru(n){let e={buf:new Uint8Array(n),pos:0},t=Sn(e),r=[],i=0;for(let s=0;s<t;s++){let o=Sn(e);r.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)r[s].runLength=Sn(e);for(let s=0;s<t;s++)r[s].length=Sn(e);for(let s=0;s<t;s++){let o=Sn(e);o===0&&s>0?r[s].offset=r[s-1].offset+r[s-1].length:r[s].offset=o-1}return r}Ae(ru,"deserializeIndex");var Sd=class extends Error{};Ae(Sd,"EtagMismatch");var Xa=Sd;function nu(n,e){return Je(this,null,function*(){let t=yield n.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let r=t.data.slice(0,Xx),i=Td(r,t.etag),s=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${n.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,a=ru(yield e(s,i.internalCompression));return[i,[o,a.length,a]]})}Ae(nu,"getHeaderAndRoot");function iu(n,e,t,r,i){return Je(this,null,function*(){let s=yield n.getBytes(t,r,void 0,i.etag),o=yield e(s.data,i.internalCompression),a=ru(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}Ae(iu,"getDirectory");var qx=class{constructor(e=100,t=!0,r=To){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return Je(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,r.data;let i=yield nu(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,r,i){return Je(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,o.data;let a=yield iu(e,this.decompress,t,r,i);return this.cache.set(s,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,i)=>{r.lastUsed<e&&(e=r.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return Je(this,null,function*(){this.cache.delete(e.getKey())})}};Ae(qx,"ResolvedValueCache");var Rd=class{constructor(e=100,t=!0,r=To){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return Je(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;let i=new Promise((s,o)=>{nu(e,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),s(a[0]),this.prune()}).catch(a=>{o(a)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,r,i){return Je(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,yield o.data;let a=new Promise((l,u)=>{iu(e,this.decompress,t,r,i).then(c=>{l(c),this.prune()}).catch(c=>{u(c)})});return this.cache.set(s,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,i)=>{r.lastUsed<e&&(e=r.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return Je(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let r=new Promise((i,s)=>{this.getHeader(e).then(o=>{i(),this.invalidations.delete(t)}).catch(o=>{s(o)})});this.invalidations.set(t,r)})}};Ae(Rd,"SharedPromiseCache");var Hx=Rd,Pd=class{constructor(e,t,r){typeof e=="string"?this.source=new Zx(e):this.source=e,r?this.decompress=r:this.decompress=To,t?this.cache=t:this.cache=new Hx}getHeader(){return Je(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,r,i){return Je(this,null,function*(){let s=xd(e,t,r),o=yield this.cache.getHeader(this.source);if(e<o.minZoom||e>o.maxZoom)return;let a=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let u=0;u<=3;u++){let c=yield this.cache.getDirectory(this.source,a,l,o),h=wd(c,s);if(h){if(h.runLength>0){let f=yield this.source.getBytes(o.tileDataOffset+h.offset,h.length,i,o.etag);return{data:yield this.decompress(f.data,o.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}a=o.leafDirectoryOffset+h.offset,l=h.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,r,i){return Je(this,null,function*(){try{return yield this.getZxyAttempt(e,t,r,i)}catch(s){if(s instanceof Xa)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,i);throw s}})}getMetadataAttempt(){return Je(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return Je(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof Xa)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return Je(this,null,function*(){let t=yield this.getHeader(),r=yield this.getMetadata(),i=Ed(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};Ae(Pd,"PMTiles");var Ci=Pd;class Yx extends pf{constructor(e){super(pt.ERROR),this.error=e}}function it(n){return(e,...t)=>Kx(n,e,t)}function Qn(n,e){return it(Ad(n,e).get)}const{apply:Kx,getOwnPropertyDescriptor:Ad,getPrototypeOf:su,ownKeys:Jx}=Reflect,{iterator:Qi,toStringTag:Qx}=Symbol,eE=Object,{create:ou,defineProperty:tE}=eE,rE=Array,nE=rE.prototype,Id=nE[Qi],iE=it(Id),Ld=ArrayBuffer,sE=Ld.prototype;Qn(sE,"byteLength");const Jc=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Jc&&Qn(Jc.prototype,"byteLength");const Cd=su(Uint8Array);Cd.from;const gt=Cd.prototype;gt[Qi];it(gt.keys);it(gt.values);it(gt.entries);it(gt.set);it(gt.reverse);it(gt.fill);it(gt.copyWithin);it(gt.sort);it(gt.slice);it(gt.subarray);Qn(gt,"buffer");Qn(gt,"byteOffset");Qn(gt,"length");Qn(gt,Qx);const oE=Uint8Array,Fd=Uint16Array,au=Uint32Array,aE=Float32Array,Fi=su([][Qi]()),Md=it(Fi.next),lE=it(function*(){}().next),uE=su(Fi),cE=DataView.prototype,hE=it(cE.getUint16),lu=WeakMap,Od=lu.prototype,Nd=it(Od.get),fE=it(Od.set),Dd=new lu,dE=ou(null,{next:{value:function(){const e=Nd(Dd,this);return Md(e)}},[Qi]:{value:function(){return this}}});function pE(n){if(n[Qi]===Id&&Fi.next===Md)return n;const e=ou(dE);return fE(Dd,e,iE(n)),e}const gE=new lu,mE=ou(uE,{next:{value:function(){const e=Nd(gE,this);return lE(e)},writable:!0,configurable:!0}});for(const n of Jx(Fi))n!=="next"&&tE(mE,n,Ad(Fi,n));const Ud=new Ld(4),yE=new aE(Ud),_E=new au(Ud),Kt=new Fd(512),Jt=new oE(512);for(let n=0;n<256;++n){const e=n-127;e<-24?(Kt[n]=0,Kt[n|256]=32768,Jt[n]=24,Jt[n|256]=24):e<-14?(Kt[n]=1024>>-e-14,Kt[n|256]=1024>>-e-14|32768,Jt[n]=-e-1,Jt[n|256]=-e-1):e<=15?(Kt[n]=e+15<<10,Kt[n|256]=e+15<<10|32768,Jt[n]=13,Jt[n|256]=13):e<128?(Kt[n]=31744,Kt[n|256]=64512,Jt[n]=24,Jt[n|256]=24):(Kt[n]=31744,Kt[n|256]=64512,Jt[n]=13,Jt[n|256]=13)}const uu=new au(2048);for(let n=1;n<1024;++n){let e=n<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,uu[n]=e|t}for(let n=1024;n<2048;++n)uu[n]=939524096+(n-1024<<13);const ei=new au(64);for(let n=1;n<31;++n)ei[n]=n<<23;ei[31]=1199570944;ei[32]=2147483648;for(let n=33;n<63;++n)ei[n]=2147483648+(n-32<<23);ei[63]=3347054592;const Bd=new Fd(64);for(let n=1;n<64;++n)n!==32&&(Bd[n]=1024);function bE(n){const e=n>>10;return _E[0]=uu[Bd[e]+(n&1023)]+ei[e],yE[0]}function Gd(n,e,...t){return bE(hE(n,e,...pE(t)))}var cu={exports:{}};function zd(n,e,t){const r=t&&t.debug||!1;r&&console.log("[xml-utils] getting "+e+" in "+n);const i=typeof n=="object"?n.outer:n,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],u=e+"\\="+l+"([^"+l+"]*)"+l;r&&console.log("[xml-utils] pattern:",u);const h=new RegExp(u).exec(s);if(r&&console.log("[xml-utils] match:",h),h)return h[1]}}cu.exports=zd;cu.exports.default=zd;var xE=cu.exports;const sa=Pf(xE);var hu={exports:{}},fu={exports:{}},du={exports:{}};function kd(n,e,t){const i=new RegExp(e).exec(n.slice(t));return i?t+i.index:-1}du.exports=kd;du.exports.default=kd;var EE=du.exports,pu={exports:{}};function $d(n,e,t){const i=new RegExp(e).exec(n.slice(t));return i?t+i.index+i[0].length-1:-1}pu.exports=$d;pu.exports.default=$d;var wE=pu.exports,gu={exports:{}};function jd(n,e){const t=new RegExp(e,"g"),r=n.match(t);return r?r.length:0}gu.exports=jd;gu.exports.default=jd;var vE=gu.exports;const TE=EE,oa=wE,Qc=vE;function Vd(n,e,t){const r=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;r&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=TE(n,`<${e}[ 
>/]`,s);if(r&&console.log("[xml-utils] start:",o),o===-1)return;const a=n.slice(o+e.length);let l=oa(a,"^[^<]*[ /]>",0);const u=l!==-1&&a[l-1]==="/";if(r&&console.log("[xml-utils] selfClosing:",u),u===!1)if(i){let p=0,d=1,g=0;for(;(l=oa(a,"[ /]"+e+">",p))!==-1;){const m=a.substring(p,l+1);if(d+=Qc(m,"<"+e+`[ 
	>]`),g+=Qc(m,"</"+e+">"),g>=d)break;p=l}}else l=oa(a,"[ /]"+e+">",0);const c=o+e.length+l+1;if(r&&console.log("[xml-utils] end:",c),c===-1)return;const h=n.slice(o,c);let f;return u?f=null:f=h.slice(h.indexOf(">")+1,h.lastIndexOf("<")),{inner:f,outer:h,start:o,end:c}}fu.exports=Vd;fu.exports.default=Vd;var SE=fu.exports;const RE=SE;function Xd(n,e,t){const r=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=RE(n,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,r.push(a);return i&&console.log("findTagsByName found",r.length,"tags"),r}hu.exports=Xd;hu.exports.default=Xd;var PE=hu.exports;const AE=Pf(PE),bi={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Qt={};for(const n in bi)bi.hasOwnProperty(n)&&(Qt[bi[n]]=parseInt(n,10));const IE=[Qt.BitsPerSample,Qt.ExtraSamples,Qt.SampleFormat,Qt.StripByteCounts,Qt.StripOffsets,Qt.StripRowCounts,Qt.TileByteCounts,Qt.TileOffsets,Qt.SubIFDs],aa={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ie={};for(const n in aa)aa.hasOwnProperty(n)&&(ie[aa[n]]=parseInt(n,10));const yt={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},LE={Unspecified:0},OR={AddCompression:1},NR={None:0,Deflate:1,Zstandard:2},CE={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function FE(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=256-n[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function ME(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=n[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function OE(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<n.length;++a,l+=3){const u=n[a];i[l]=e[u]/65536*256,i[l+1]=e[u+s]/65536*256,i[l+2]=e[u+o]/65536*256}return i}function NE(n){const{width:e,height:t}=n,r=new Uint8Array(e*t*3);for(let i=0,s=0;i<n.length;i+=4,s+=3){const o=n[i],a=n[i+1],l=n[i+2],u=n[i+3];r[s]=255*((255-o)/256)*((255-u)/256),r[s+1]=255*((255-a)/256)*((255-u)/256),r[s+2]=255*((255-l)/256)*((255-u)/256)}return r}function DE(n){const{width:e,height:t}=n,r=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<n.length;i+=3,s+=3){const o=n[i],a=n[i+1],l=n[i+2];r[s]=o+1.402*(l-128),r[s+1]=o-.34414*(a-128)-.71414*(l-128),r[s+2]=o+1.772*(a-128)}return r}const UE=.95047,BE=1,GE=1.08883;function zE(n){const{width:e,height:t}=n,r=new Uint8Array(e*t*3);for(let i=0,s=0;i<n.length;i+=3,s+=3){const o=n[i+0],a=n[i+1]<<24>>24,l=n[i+2]<<24>>24;let u=(o+16)/116,c=a/500+u,h=u-l/200,f,p,d;c=UE*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),u=BE*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),h=GE*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),f=c*3.2406+u*-1.5372+h*-.4986,p=c*-.9689+u*1.8758+h*.0415,d=c*.0557+u*-.204+h*1.057,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,r[s]=Math.max(0,Math.min(1,f))*255,r[s+1]=Math.max(0,Math.min(1,p))*255,r[s+2]=Math.max(0,Math.min(1,d))*255}return r}const Wd=new Map;function Wr(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>Wd.set(t,e))}async function Zd(n){const e=Wd.get(n.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${n.Compression}`);const t=await e();return new t(n)}Wr([void 0,1],()=>Xr(()=>import("./raw.DxtaBMev.js"),__vite__mapDeps([0,1])).then(n=>n.default));Wr(5,()=>Xr(()=>import("./lzw.BikwkTY2.js"),__vite__mapDeps([2,1])).then(n=>n.default));Wr(6,()=>{throw new Error("old style JPEG compression is not supported.")});Wr(7,()=>Xr(()=>import("./jpeg.CbvpOiPg.js"),__vite__mapDeps([3,1])).then(n=>n.default));Wr([8,32946],()=>Xr(()=>import("./deflate.B4_27dB1.js"),__vite__mapDeps([4,5,1])).then(n=>n.default));Wr(32773,()=>Xr(()=>import("./packbits.D6Qr5eNi.js"),__vite__mapDeps([6,1])).then(n=>n.default));Wr(34887,()=>Xr(()=>import("./lerc.CPxTxhBR.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13,14,15,16])).then(async n=>(await n.zstd.init(),n)).then(n=>n.default));Wr(50001,()=>Xr(()=>import("./webimage.CU41Mh7j.js"),__vite__mapDeps([17,1])).then(n=>n.default));function So(n,e,t,r=1){return new(Object.getPrototypeOf(n)).constructor(e*t*r)}function kE(n,e,t,r,i){const s=e/r,o=t/i;return n.map(a=>{const l=So(a,r,i);for(let u=0;u<i;++u){const c=Math.min(Math.round(o*u),t-1);for(let h=0;h<r;++h){const f=Math.min(Math.round(s*h),e-1),p=a[c*e+f];l[u*r+h]=p}}return l})}function Mn(n,e,t){return(1-t)*n+t*e}function $E(n,e,t,r,i){const s=e/r,o=t/i;return n.map(a=>{const l=So(a,r,i);for(let u=0;u<i;++u){const c=o*u,h=Math.floor(c),f=Math.min(Math.ceil(c),t-1);for(let p=0;p<r;++p){const d=s*p,g=d%1,m=Math.floor(d),y=Math.min(Math.ceil(d),e-1),_=a[h*e+m],b=a[h*e+y],w=a[f*e+m],x=a[f*e+y],E=Mn(Mn(_,b,g),Mn(w,x,g),c%1);l[u*r+p]=E}}return l})}function jE(n,e,t,r,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return kE(n,e,t,r,i);case"bilinear":case"linear":return $E(n,e,t,r,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function VE(n,e,t,r,i,s){const o=e/r,a=t/i,l=So(n,r,i,s);for(let u=0;u<i;++u){const c=Math.min(Math.round(a*u),t-1);for(let h=0;h<r;++h){const f=Math.min(Math.round(o*h),e-1);for(let p=0;p<s;++p){const d=n[c*e*s+f*s+p];l[u*r*s+h*s+p]=d}}}return l}function XE(n,e,t,r,i,s){const o=e/r,a=t/i,l=So(n,r,i,s);for(let u=0;u<i;++u){const c=a*u,h=Math.floor(c),f=Math.min(Math.ceil(c),t-1);for(let p=0;p<r;++p){const d=o*p,g=d%1,m=Math.floor(d),y=Math.min(Math.ceil(d),e-1);for(let _=0;_<s;++_){const b=n[h*e*s+m*s+_],w=n[h*e*s+y*s+_],x=n[f*e*s+m*s+_],E=n[f*e*s+y*s+_],S=Mn(Mn(b,w,g),Mn(x,E,g),c%1);l[u*r*s+p*s+_]=S}}}return l}function WE(n,e,t,r,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return VE(n,e,t,r,i,s);case"bilinear":case"linear":return XE(n,e,t,r,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function ZE(n,e,t){let r=0;for(let i=e;i<t;++i)r+=n[i];return r}function Wa(n,e,t){switch(n){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function qE(n,e){return(n===1||n===2)&&e<=32&&e%8===0?!1:!(n===3&&(e===16||e===32||e===64))}function HE(n,e,t,r,i,s,o){const a=new DataView(n),l=t===2?o*s:o*s*r,u=t===2?1:r,c=Wa(e,i,l),h=parseInt("1".repeat(i),2);if(e===1){let f;t===1?f=r*i:f=i;let p=s*f;p&7&&(p=p+7&-8);for(let d=0;d<o;++d){const g=d*p;for(let m=0;m<s;++m){const y=g+m*u*i;for(let _=0;_<u;++_){const b=y+_*i,w=(d*s+m)*u+_,x=Math.floor(b/8),E=b%8;if(E+i<=8)c[w]=a.getUint8(x)>>8-i-E&h;else if(E+i<=16)c[w]=a.getUint16(x)>>16-i-E&h;else if(E+i<=24){const S=a.getUint16(x)<<8|a.getUint8(x+2);c[w]=S>>24-i-E&h}else c[w]=a.getUint32(x)>>32-i-E&h}}}}return c.buffer}class qd{constructor(e,t,r,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(i,s){return Gd(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const r=this.getSampleFormat(e),i=this.getBitsPerSample(e);return Wa(r,i,t)}async getTileOrStrip(e,t,r,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:u}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=r*o*a+t*o+e);let c,h;this.isTiled?(c=this.fileDirectory.TileOffsets[l],h=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],h=this.fileDirectory.StripByteCounts[l]);const f=(await this.source.fetch([{offset:c,length:h}],s))[0];let p;return u===null||!u[l]?(p=(async()=>{let d=await i.decode(this.fileDirectory,f);const g=this.getSampleFormat(),m=this.getBitsPerSample();return qE(g,m)&&(d=HE(d,g,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(t))),d})(),u!==null&&(u[l]=p)):p=u[l],{x:e,y:t,sample:r,data:await p}}async _readRaster(e,t,r,i,s,o,a,l,u){const c=this.getTileWidth(),h=this.getTileHeight(),f=this.getWidth(),p=this.getHeight(),d=Math.max(Math.floor(e[0]/c),0),g=Math.min(Math.ceil(e[2]/c),Math.ceil(f/c)),m=Math.max(Math.floor(e[1]/h),0),y=Math.min(Math.ceil(e[3]/h),Math.ceil(p/h)),_=e[2]-e[0];let b=this.getBytesPerPixel();const w=[],x=[];for(let A=0;A<t.length;++A)this.planarConfiguration===1?w.push(ZE(this.fileDirectory.BitsPerSample,0,t[A])/8):w.push(0),x.push(this.getReaderForSample(t[A]));const E=[],{littleEndian:S}=this;for(let A=m;A<y;++A)for(let P=d;P<g;++P){let R;this.planarConfiguration===1&&(R=this.getTileOrStrip(P,A,0,s,u));for(let I=0;I<t.length;++I){const G=I,$=t[I];this.planarConfiguration===2&&(b=this.getSampleByteSize($),R=this.getTileOrStrip(P,A,$,s,u));const W=R.then(C=>{const O=C.data,D=new DataView(O),se=this.getBlockHeight(C.y),H=C.y*h,Y=C.x*c,le=H+se,Te=(C.x+1)*c,K=x[G],M=Math.min(se,se-(le-e[3]),p-H),Ce=Math.min(c,c-(Te-e[2]),f-Y);for(let Ie=Math.max(0,e[1]-H);Ie<M;++Ie)for(let Se=Math.max(0,e[0]-Y);Se<Ce;++Se){const st=(Ie*c+Se)*b,Be=K.call(D,st+w[G],S);let He;i?(He=(Ie+H-e[1])*_*t.length+(Se+Y-e[0])*t.length+G,r[He]=Be):(He=(Ie+H-e[1])*_+Se+Y-e[0],r[G][He]=Be)}});E.push(W)}}if(await Promise.all(E),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let A;return i?A=WE(r,e[2]-e[0],e[3]-e[1],o,a,t.length,l):A=jE(r,e[2]-e[0],e[3]-e[1],o,a,l),A.width=o,A.height=a,A}return r.width=o||e[2]-e[0],r.height=a||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:u}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const h=c[2]-c[0],f=c[3]-c[1],p=h*f,d=this.getSamplesPerPixel();if(!t||!t.length)for(let _=0;_<d;++_)t.push(_);else for(let _=0;_<t.length;++_)if(t[_]>=d)return Promise.reject(new RangeError(`Invalid sample index '${t[_]}'.`));let g;if(r){const _=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,b=Math.max.apply(null,this.fileDirectory.BitsPerSample);g=Wa(_,b,p*t.length),l&&g.fill(l)}else{g=[];for(let _=0;_<t.length;++_){const b=this.getArrayForSample(t[_],p);Array.isArray(l)&&_<l.length?b.fill(l[_]):l&&!Array.isArray(l)&&b.fill(l),g.push(b)}}const m=i||await Zd(this.fileDirectory);return await this._readRaster(c,t,g,r,m,s,o,a,u)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===yt.RGB){let y=[0,1,2];if(this.fileDirectory.ExtraSamples!==LE.Unspecified&&a){y=[];for(let _=0;_<this.fileDirectory.BitsPerSample.length;_+=1)y.push(_)}return this.readRasters({window:e,interleave:t,samples:y,pool:r,width:i,height:s,resampleMethod:o,signal:l})}let h;switch(c){case yt.WhiteIsZero:case yt.BlackIsZero:case yt.Palette:h=[0];break;case yt.CMYK:h=[0,1,2,3];break;case yt.YCbCr:case yt.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:u,interleave:!0,samples:h,pool:r,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:p}=this,d=await this.readRasters(f),g=2**this.fileDirectory.BitsPerSample[0];let m;switch(c){case yt.WhiteIsZero:m=FE(d,g);break;case yt.BlackIsZero:m=ME(d,g);break;case yt.Palette:m=OE(d,p.ColorMap);break;case yt.CMYK:m=NE(d);break;case yt.YCbCr:m=DE(d);break;case yt.CIELab:m=zE(d);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const y=new Uint8Array(m.length/3),_=new Uint8Array(m.length/3),b=new Uint8Array(m.length/3);for(let w=0,x=0;w<m.length;w+=3,++x)y[x]=m[w],_[x]=m[w+1],b[x]=m[w+2];m=[y,_,b]}return m.width=d.width,m.height=d.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const r=this.fileDirectory.GDAL_METADATA;let i=AE(r,"Item");e===null?i=i.filter(s=>sa(s,"sample")===void 0):i=i.filter(s=>Number(sa(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[sa(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return r[1]===0&&r[4]===0?[r[0],-r[5],r[10]]:[Math.sqrt(r[0]*r[0]+r[4]*r[4]),-Math.sqrt(r[1]*r[1]+r[5]*r[5]),r[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,s,o,a,l,u,c,h]=this.fileDirectory.ModelTransformation,p=[[0,0],[0,t],[r,0],[r,t]].map(([m,y])=>[a+i*m+s*y,h+l*m+u*y]),d=p.map(m=>m[0]),g=p.map(m=>m[1]);return[Math.min(...d),Math.min(...g),Math.max(...d),Math.max(...g)]}else{const i=this.getOrigin(),s=this.getResolution(),o=i[0],a=i[1],l=o+s[0]*r,u=a+s[1]*t;return[Math.min(o,l),Math.min(a,u),Math.max(o,l),Math.max(a,u)]}}}class YE{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const r=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=r+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*r+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let r=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),r+=a*256**o}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Gd(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class KE{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),r=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const r=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));r&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const JE=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class QE{constructor(e=JE,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(r=>{Xr(()=>import("./decoder.tqM1uIvc.js"),[]).then(i=>{r(i.create)})}),this._awaitingDecoder.then(r=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:r(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Zd(e).then(r=>r.decode(e,t)):new Promise(r=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,r(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const eh=`\r
\r
`;function Hd(n){if(typeof Object.fromEntries<"u")return Object.fromEntries(n);const e={};for(const[t,r]of n)e[t.toLowerCase()]=r;return e}function ew(n){const e=n.split(`\r
`).map(t=>{const r=t.split(":").map(i=>i.trim());return r[0]=r[0].toLowerCase(),r});return Hd(e)}function tw(n){const[e,...t]=n.split(";").map(i=>i.trim()),r=t.map(i=>i.split("="));return{type:e,params:Hd(r)}}function Za(n){let e,t,r;return n&&([,e,t,r]=n.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),r=parseInt(r,10)),{start:e,end:t,total:r}}function rw(n,e){let t=null;const r=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)r.decode(new Uint8Array(n,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<n.byteLength;){const a=r.decode(new Uint8Array(n,t,Math.min(s.length+1024,n.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const u=l.indexOf(eh),c=ew(l.substr(0,u)),{start:h,end:f,total:p}=Za(c["content-range"]),d=t+s.length+u+eh.length,g=parseInt(f,10)+1-parseInt(h,10);i.push({headers:c,data:n.slice(d,d+g),offset:h,length:g,fileSize:p}),t=d+g+4}return i}class mu{async fetch(e,t=void 0){return Promise.all(e.map(r=>this.fetchSlice(r,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class nw extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield e)}for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){const i=typeof r=="number"&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[r,i]of this.entriesAscending())e.call(t,i,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function iw(n){return new Promise(e=>setTimeout(e,n))}function sw(n,e){const t=Array.isArray(n)?n:Array.from(n),r=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,r[s]])}class kn extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,kn),this.name="AbortError"}}class ow extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const aw=ow;class lw{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class th{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class uw extends mu{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new nw({maxSize:r,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const r=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:f,length:p}of e){let d=f+p;const{fileSize:g}=this;g!==null&&(d=Math.min(d,g));const m=Math.floor(f/this.blockSize)*this.blockSize;for(let y=m;y<d;y+=this.blockSize){const _=Math.floor(y/this.blockSize);!this.blockCache.has(_)&&!this.blockRequests.has(_)&&(this.blockIdsToFetch.add(_),i.push(_)),this.blockRequests.has(_)&&r.push(this.blockRequests.get(_)),s.push(_)}}await iw(),this.fetchBlocks(t);const o=[];for(const f of i)this.blockRequests.has(f)&&o.push(this.blockRequests.get(f));await Promise.allSettled(r),await Promise.allSettled(o);const a=[],l=s.filter(f=>this.abortedBlockIds.has(f)||!this.blockCache.has(f));if(l.forEach(f=>this.blockIdsToFetch.add(f)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const f of l){const p=this.blockRequests.get(f);if(!p)throw new Error(`Block ${f} is not in the block requests`);a.push(p)}await Promise.allSettled(a)}if(t&&t.aborted)throw new kn("Request was aborted");const u=s.map(f=>this.blockCache.get(f)||this.evictedBlocks.get(f)),c=u.filter(f=>!f);if(c.length)throw new aw(c,"Request failed");const h=new Map(sw(s,u));return this.readSliceData(e,h)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await r)[i],l=o*this.blockSize,u=l-a.offset,c=Math.min(u+this.blockSize,a.data.byteLength),h=a.data.slice(u,c),f=new lw(l,h.byteLength,h,o);this.blockCache.set(o,f),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let r=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(r.push(o),i=o):(s.push(new th(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[o],i=o);return s.push(new th(r[0]*this.blockSize,r.length*this.blockSize,r)),s}readSliceData(e,t){return e.map(r=>{let i=r.offset+r.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(r.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(r.length),l=new Uint8Array(a);for(let u=s;u<=o;++u){const c=t.get(u),h=c.offset-r.offset,f=c.top-i;let p=0,d=0,g;h<0?p=-h:h>0&&(d=h),f<0?g=c.length-p:g=i-c.offset-p;const m=new Uint8Array(c.data,p,g);l.set(m,d)}return a})}}class yu{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class _u{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class cw extends yu{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class hw extends _u{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const r=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new cw(r)}}class fw extends yu{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class dw extends _u{constructRequest(e,t){return new Promise((r,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;r(new fw(s,o))},s.onerror=i,s.onabort=()=>i(new kn("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const la={};class pw extends yu{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class gw extends _u{constructor(e){super(e),this.parsedUrl=la.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",la)}constructRequest(e,t){return new Promise((r,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const u=[];o.on("data",c=>{u.push(c)}),o.on("end",()=>{const c=Buffer.concat(u).buffer;l(c)}),o.on("error",i)});r(new pw(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new kn("Request aborted")),t.addEventListener("abort",()=>s.destroy(new kn("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class bu extends mu{constructor(e,t,r,i){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(r=>this.fetchSlice(r,t))))}async fetchSlices(e,t){const r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(r.ok)if(r.status===206){const{type:i,params:s}=tw(r.getHeader("content-type"));if(i==="multipart/byteranges"){const h=rw(await r.getData(),s.boundary);return this._fileSize=h[0].fileSize||null,h}const o=await r.getData(),{start:a,end:l,total:u}=Za(r.getHeader("content-range"));this._fileSize=u||null;const c=[{data:o,offset:a,length:l-a}];if(e.length>1){const h=await Promise.all(e.slice(1).map(f=>this.fetchSlice(f,t)));return c.concat(h)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await r.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:r,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=Za(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:r,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function xu(n,{blockSize:e,cacheSize:t}){return e===null?n:new uw(n,{blockSize:e,cacheSize:t})}function mw(n,{headers:e={},credentials:t,maxRanges:r=0,allowFullFile:i=!1,...s}={}){const o=new hw(n,t),a=new bu(o,e,r,i);return xu(a,s)}function yw(n,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const s=new dw(n),o=new bu(s,e,t,r);return xu(o,i)}function _w(n,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const s=new gw(n),o=new bu(s,e,t,r);return xu(o,i)}function qa(n,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?mw(n,t):typeof XMLHttpRequest<"u"?yw(n,t):_w(n,t)}class bw extends mu{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((r,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>r(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function xw(n){return new bw(n)}function Ha(n){switch(n){case ie.BYTE:case ie.ASCII:case ie.SBYTE:case ie.UNDEFINED:return 1;case ie.SHORT:case ie.SSHORT:return 2;case ie.LONG:case ie.SLONG:case ie.FLOAT:case ie.IFD:return 4;case ie.RATIONAL:case ie.SRATIONAL:case ie.DOUBLE:case ie.LONG8:case ie.SLONG8:case ie.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${n}`)}}function Ew(n){const e=n.GeoKeyDirectory;if(!e)return null;const t={};for(let r=4;r<=e[3]*4;r+=4){const i=CE[e[r]],s=e[r+1]?bi[e[r+1]]:null,o=e[r+2],a=e[r+3];let l=null;if(!s)l=a;else{if(l=n[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function En(n,e,t,r){let i=null,s=null;const o=Ha(e);switch(e){case ie.BYTE:case ie.ASCII:case ie.UNDEFINED:i=new Uint8Array(t),s=n.readUint8;break;case ie.SBYTE:i=new Int8Array(t),s=n.readInt8;break;case ie.SHORT:i=new Uint16Array(t),s=n.readUint16;break;case ie.SSHORT:i=new Int16Array(t),s=n.readInt16;break;case ie.LONG:case ie.IFD:i=new Uint32Array(t),s=n.readUint32;break;case ie.SLONG:i=new Int32Array(t),s=n.readInt32;break;case ie.LONG8:case ie.IFD8:i=new Array(t),s=n.readUint64;break;case ie.SLONG8:i=new Array(t),s=n.readInt64;break;case ie.RATIONAL:i=new Uint32Array(t*2),s=n.readUint32;break;case ie.SRATIONAL:i=new Int32Array(t*2),s=n.readInt32;break;case ie.FLOAT:i=new Float32Array(t),s=n.readFloat32;break;case ie.DOUBLE:i=new Float64Array(t),s=n.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===ie.RATIONAL||e===ie.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(n,r+a*o),i[a+1]=s.call(n,r+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(n,r+a*o);return e===ie.ASCII?new TextDecoder("utf-8").decode(i):i}class ww{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class fs extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Yd{async readRasters(e={}){const{window:t,width:r,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let u=l;const c=await this.getImageCount(),h=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(r||i){if(t){const[d,g]=l.getOrigin(),[m,y]=l.getResolution();a=[d+t[0]*m,g+t[1]*y,d+t[2]*m,g+t[3]*y]}const p=a||h;if(r){if(s)throw new Error("Both width and resX passed");s=(p[2]-p[0])/r}if(i){if(o)throw new Error("Both width and resY passed");o=(p[3]-p[1])/i}}if(s||o){const p=[];for(let d=0;d<c;++d){const g=await this.getImage(d),{SubfileType:m,NewSubfileType:y}=g.fileDirectory;(d===0||m===2||y&1)&&p.push(g)}p.sort((d,g)=>d.getWidth()-g.getWidth());for(let d=0;d<p.length;++d){const g=p[d],m=(h[2]-h[0])/g.getWidth(),y=(h[3]-h[1])/g.getHeight();if(u=g,s&&s>m||o&&o>y)break}}let f=t;if(a){const[p,d]=l.getOrigin(),[g,m]=u.getResolution(l);f=[Math.round((a[0]-p)/g),Math.round((a[1]-d)/m),Math.round((a[2]-p)/g),Math.round((a[3]-d)/m)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return u.readRasters({...e,window:f})}}class $n extends Yd{constructor(e,t,r,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const r=this.bigTiff?4048:1024;return new KE((await this.source.fetch([{offset:e,length:typeof t<"u"?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let h=0;h<s;l+=t,++h){const f=i.readUint16(l),p=i.readUint16(l+2),d=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let g,m;const y=Ha(p),_=l+(this.bigTiff?12:8);if(y*d<=(this.bigTiff?8:4))g=En(i,p,d,_);else{const b=i.readOffset(_),w=Ha(p)*d;if(i.covers(b,w))g=En(i,p,d,b);else{const x=await this.getSlice(b,w);g=En(x,p,d,b)}}d===1&&IE.indexOf(f)===-1&&!(p===ie.RATIONAL||p===ie.SRATIONAL)?m=g[0]:m=g,a[bi[f]]=m}const u=Ew(a),c=i.readOffset(e+r+t*s);return new ww(a,u,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof fs?new fs(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new fs(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new qd(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(r){if(r instanceof fs)t=!1;else throw r}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100;let i=await this.getSlice(e,r);if(t===En(i,ie.ASCII,t.length,e)){const o=En(i,ie.ASCII,r,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>r&&(i=await this.getSlice(e,a));const l=En(i,ie.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(u=>u.length>0).map(u=>u.split("=")).forEach(([u,c])=>{this.ghostValues[u]=c})}return this.ghostValues}static async fromSource(e,t,r){const i=(await e.fetch([{offset:0,length:1024}],r))[0],s=new YE(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let u;if(l===42)u=!1;else if(l===43){if(u=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=u?s.getUint64(8,a):s.getUint32(4,a);return new $n(e,a,u,c,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class vw extends Yd{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,r=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(r);return new qd(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,r++}r=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,r)=>t+r,0),this.imageCount}}async function Tw(n,e={},t){return $n.fromSource(qa(n,e),t)}async function Sw(n,e){return $n.fromSource(xw(n),e)}async function Rw(n,e=[],t={},r){const i=await $n.fromSource(qa(n,t),r),s=await Promise.all(e.map(o=>$n.fromSource(qa(o,t))));return new vw(i,s)}const Pw=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,Aw=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class Iw{constructor(e){this.gl_=e,this.program_=Ya(e,Aw,Pw),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,r,i,s,o,a,l,u,c,h,f,p){const d=this.gl_;l===void 0&&(l=i),u===void 0&&(u=s),o===void 0&&(o=t),a===void 0&&(a=r),c===void 0&&(c=o),h===void 0&&(h=a),f===void 0&&(f=d.canvas.width),p===void 0&&(p=d.canvas.height),d.bindTexture(d.TEXTURE_2D,e),d.useProgram(this.program_),d.bindBuffer(d.ARRAY_BUFFER,this.positionBuffer),d.enableVertexAttribArray(this.positionLocation),d.vertexAttribPointer(this.positionLocation,2,d.FLOAT,!1,0,0),d.bindBuffer(d.ARRAY_BUFFER,this.texcoordBuffer),d.enableVertexAttribArray(this.texcoordLocation),d.vertexAttribPointer(this.texcoordLocation,2,d.FLOAT,!1,0,0);let g=Ga(0,f,0,p,-1,1);g=_b(g,l,u,0),g=kc(g,c,h,1),d.uniformMatrix4fv(this.matrixLocation,!1,g);let m=bb(i/t,s/r,0);m=kc(m,o/t,a/r,1),d.uniformMatrix4fv(this.textureMatrixLocation,!1,m),d.uniform1i(this.textureLocation,0),d.drawArrays(d.TRIANGLES,0,this.positions.length/2)}}function rh(n,e,t){const r=n.createShader(e);if(r===null)throw new Error("Shader compilation failed");if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS)){const i=n.getShaderInfoLog(r);throw i===null?new Error("Shader info log creation failed"):new Error(i)}return r}function Ya(n,e,t){const r=n.createProgram(),i=rh(n,n.VERTEX_SHADER,t),s=rh(n,n.FRAGMENT_SHADER,e);if(r===null)throw new Error("Program creation failed");if(n.attachShader(r,i),n.attachShader(r,s),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw n.getProgramInfoLog(r)===null?new Error("Program info log creation failed"):new Error;return r}const Lw=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,Cw=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,Fw=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,Mw=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function Ow(n,e,t,r){let i;return t&&t.length?i=t.shift():Xi?i=new OffscreenCanvas(n||300,e||300):i=document.createElement("canvas"),n&&(i.width=n),e&&(i.height=e),i.getContext("webgl",r)}function Nw(n){const e=n.canvas;e.width=1,e.height=1,n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT)}const nh=[];function Dw(n,e,t,r,i,s,o,a,l,u,c,h,f,p){const d=Math.round(r*e),g=Math.round(r*t);n.canvas.width=d,n.canvas.height=g;let m,y;if(y=n.createTexture(),n.bindTexture(n.TEXTURE_2D,y),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),f?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,d,g,0,n.RGBA,c,null),m=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,m),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,y,0),m===null)throw new Error("Could not create framebuffer");if(y===null)throw new Error("Could not create texture");if(l.length===0)return{width:d,height:g,framebuffer:m,texture:y};const _=$i();l.forEach(function(R,I,G){Ig(_,R.extent)});let b,w,x;const E=1/i;{if(b=n.createTexture(),y===null)throw new Error("Could not create texture");w=Math.round(nt(_)*E),x=Math.round(Wt(_)*E);const R=n.getParameter(n.MAX_TEXTURE_SIZE),I=Math.max(w,x),G=I>R?R/I:1,$=Math.round(w*G),W=Math.round(x*G);n.bindTexture(n.TEXTURE_2D,b),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),f?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,$,W,0,n.RGBA,c,null);const C=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,C),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,b,0);const O=new Iw(n);l.forEach(function(D,se,H){const Y=(D.extent[0]-_[0])*E*G,le=-(D.extent[3]-_[3])*E*G,Te=nt(D.extent)*E*G,K=Wt(D.extent)*E*G;if(n.bindFramebuffer(n.FRAMEBUFFER,C),n.viewport(0,0,$,W),D.clipExtent){const M=(D.clipExtent[0]-_[0])*E*G,Ce=-(D.clipExtent[3]-_[3])*E*G,Ie=nt(D.clipExtent)*E*G,Se=Wt(D.clipExtent)*E*G;n.enable(n.SCISSOR_TEST),n.scissor(f?M:Math.round(M),f?Ce:Math.round(Ce),f?Ie:Math.round(M+Ie)-Math.round(M),f?Se:Math.round(Ce+Se)-Math.round(Ce))}O.drawImage(D.texture,D.width,D.height,u,u,D.width-2*u,D.height-2*u,f?Y:Math.round(Y),f?le:Math.round(le),f?Te:Math.round(Y+Te)-Math.round(Y),f?K:Math.round(le+K)-Math.round(le),$,W),n.disable(n.SCISSOR_TEST)}),n.deleteFramebuffer(C)}const S=Is(o),A=Is(_),P=R=>{const I=(R[0][0]-S[0])/s*r,G=-(R[0][1]-S[1])/s*r,$=(R[1][0]-S[0])/s*r,W=-(R[1][1]-S[1])/s*r,C=(R[2][0]-S[0])/s*r,O=-(R[2][1]-S[1])/s*r;return{u1:$,v1:W,u0:I,v0:G,u2:C,v2:O}};n.bindFramebuffer(n.FRAMEBUFFER,m),n.viewport(0,0,d,g);{const R=[],I=[],G=Ya(n,Mw,Fw);n.useProgram(G);const $=n.getUniformLocation(G,"u_texture");n.bindTexture(n.TEXTURE_2D,b),n.uniform1i($,0),a.getTriangles().forEach(function(Y,le,Te){const K=Y.source,M=Y.target,{u1:Ce,v1:Ie,u0:Se,v0:st,u2:Be,v2:He}=P(M),fr=(K[0][0]-A[0])/i/w,ct=-(K[0][1]-A[1])/i/x,mt=(K[1][0]-A[0])/i/w,k=-(K[1][1]-A[1])/i/x,Tr=(K[2][0]-A[0])/i/w,mn=-(K[2][1]-A[1])/i/x;R.push(Ce,Ie,Se,st,Be,He),I.push(mt,k,fr,ct,Tr,mn)});const W=Ga(0,d,g,0,-1,1),C=n.getUniformLocation(G,"u_matrix");n.uniformMatrix4fv(C,!1,W);const O=n.getAttribLocation(G,"a_position"),D=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,D),n.bufferData(n.ARRAY_BUFFER,new Float32Array(R),n.STATIC_DRAW),n.vertexAttribPointer(O,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(O);const se=n.getAttribLocation(G,"a_texcoord"),H=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,H),n.bufferData(n.ARRAY_BUFFER,new Float32Array(I),n.STATIC_DRAW),n.vertexAttribPointer(se,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(se),n.drawArrays(n.TRIANGLES,0,R.length/2)}if(h){const R=Ya(n,Cw,Lw);n.useProgram(R);const I=Ga(0,d,g,0,-1,1),G=n.getUniformLocation(R,"u_matrix");n.uniformMatrix4fv(G,!1,I);const $=Array.isArray(h)?h:[0,0,0,255],W=n.getUniformLocation(R,"u_val");n.uniform4fv(W,$);const C=n.getAttribLocation(R,"a_position"),O=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,O),n.vertexAttribPointer(C,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(C);const D=a.getTriangles().reduce(function(se,H){const Y=H.target,{u1:le,v1:Te,u0:K,v0:M,u2:Ce,v2:Ie}=P(Y);return se.concat([le,Te,K,M,K,M,Ce,Ie,Ce,Ie,le,Te])},[]);n.bufferData(n.ARRAY_BUFFER,new Float32Array(D),n.STATIC_DRAW),n.drawArrays(n.LINES,0,D.length/2)}return{width:d,height:g,framebuffer:m,texture:y}}class Uw extends vl{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,r=t.getExtent(),i=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?i?ir(r,i):r:i;const s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=o?ir(s,o):s;if(lc(l)===0){this.state=ee.EMPTY;return}r&&(a?a=ir(a,r):a=r);const u=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),c=e.targetProj,h=rm(t,c,l,u);if(!isFinite(h)||h<=0){this.state=ee.EMPTY;return}const f=e.errorThreshold!==void 0?e.errorThreshold:nm;if(this.triangulation_=new im(t,c,l,a,h*f,u,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=ee.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(h);let p=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(p[1]=De(p[1],a[1],a[3]),p[3]=De(p[3],a[1],a[3])):p=ir(p,a)),!lc(p))this.state=ee.EMPTY;else{let d=0,g=0;t.canWrapX()&&(d=nt(r),g=Math.floor((p[0]-r[0])/d)),Lg(p.slice(),t,!0).forEach(y=>{const _=this.sourceTileGrid_.getTileRangeForExtentAndZ(y,this.sourceZ_),b=e.getTileFunction;for(let w=_.minX;w<=_.maxX;w++)for(let x=_.minY;x<=_.maxY;x++){const E=b(this.sourceZ_,w,x,this.pixelRatio_);if(E){const S=g*d;this.sourceTiles_.push({tile:E,offset:S})}}++g}),this.sourceTiles_.length===0&&(this.state=ee.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(w=>{var le;const x=w.tile;if(!x||x.getState()!==ee.LOADED)return;const E=x.getSize(),S=this.gutter_;let A;const P=Ca(x.getData());P?A=P:(t=!0,A=sm(Fa(x.getData())));const R=[E[0]+2*S,E[1]+2*S],I=A instanceof Float32Array,G=R[0]*R[1],$=I?Float32Array:Uint8ClampedArray,W=new $(A.buffer),C=$.BYTES_PER_ELEMENT,O=C*W.length/G,D=W.byteLength/R[1],se=Math.floor(D/C/R[0]),H=this.sourceTileGrid_.getTileCoordExtent(x.tileCoord);H[0]+=w.offset,H[2]+=w.offset;const Y=(le=this.clipExtent_)==null?void 0:le.slice();Y&&(Y[0]+=w.offset,Y[2]+=w.offset),e.push({extent:H,clipExtent:Y,data:W,dataType:$,bytesPerPixel:O,pixelSize:R,bandCount:se})}),this.sourceTiles_.length=0,e.length===0){this.state=ee.ERROR,this.changed();return}const r=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(r),s=typeof i=="number"?i:i[0],o=typeof i=="number"?i:i[1],a=Math.round(s*this.pixelRatio_),l=Math.round(o*this.pixelRatio_),u=this.targetTileGrid_.getResolution(r),c=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),f=e[0].bandCount,p=new e[0].dataType(f*a*l),d=Ow(a,l,nh,{premultipliedAlpha:!1,antialias:!1});let g;const m=d.RGBA;let y;e[0].dataType==Float32Array?(y=d.FLOAT,d.getExtension("WEBGL_color_buffer_float"),d.getExtension("OES_texture_float"),d.getExtension("EXT_float_blend"),g=d.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(y=d.UNSIGNED_BYTE,g=this.interpolate);const _=4,b=Math.ceil(f/_);for(let w=b-1;w>=0;--w){const x=[];for(let $=0,W=e.length;$<W;++$){const C=e[$],O=C.pixelSize,D=O[0],se=O[1],H=new C.dataType(_*D*se),Y=C.data;let le=w*_;for(let K=0,M=H.length;K<M;K+=_)H[K]=Y[le],H[K+1]=Y[le+1],H[K+2]=Y[le+2],H[K+3]=Y[le+3],le+=f;const Te=d.createTexture();d.bindTexture(d.TEXTURE_2D,Te),g?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST)),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texImage2D(d.TEXTURE_2D,0,m,D,se,0,m,y,H),x.push({extent:C.extent,clipExtent:C.clipExtent,texture:Te,width:D,height:se})}const{framebuffer:E,width:S,height:A}=Dw(d,s,o,this.pixelRatio_,c,u,h,this.triangulation_,x,this.gutter_,y,this.renderEdges_,g),P=S,R=A*_,I=new e[0].dataType(P*R);d.bindFramebuffer(d.FRAMEBUFFER,E),d.readPixels(0,0,S,A,d.RGBA,y,I);let G=w*_;for(let $=0,W=I.length;$<W;$+=_){const C=(P-1-($/R|0))*R+$%R;p[G]=I[C],p[G+1]=I[C+1],p[G+2]=I[C+2],p[G+3]=I[C+3],G+=f}}if(Nw(d),nh.push(d.canvas),t){const w=kr(s,o),x=new ImageData(p,s);w.putImageData(x,0,0),this.reprojData_=w.canvas}else this.reprojData_=p;this.reprojSize_=[a,l],this.state=ee.LOADED,this.changed()}load(){if(this.state!==ee.IDLE&&this.state!==ee.ERROR)return;this.state=ee.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const r=t.getState();if(r!==ee.IDLE&&r!==ee.LOADING)return;e++;const i=gr(t,pt.CHANGE,()=>{const s=t.getState();(s==ee.LOADED||s==ee.ERROR||s==ee.EMPTY)&&(As(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==ee.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(As),this.sourcesListenerKeys_=null}}class es extends Tl{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let r=e.tileGrid;r===void 0&&t&&(r=Vr({extent:dn(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:r,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Zt(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?Zt(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||gi(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,r,i,s,o){const a=this.tileGrid||this.getTileGridForProjection(s||i),l=Math.max.apply(null,a.getResolutions().map((d,g)=>{const m=Zt(a.getTileSize(g)),y=this.getTileSize(g);return Math.max(y[0]/m[0],y[1]/m[1])})),u=this.getTileGridForProjection(i),c=[e,t,r],h=this.getTileCoordForTileUrlFunction(c,i),f=Object.assign({sourceProj:s||i,sourceTileGrid:a,targetProj:i,targetTileGrid:u,tileCoord:c,wrappedTileCoord:h,pixelRatio:l,gutter:this.gutter_,getTileFunction:(d,g,m,y)=>this.getTile(d,g,m,y,void 0,o),transformMatrix:this.transformMatrix},this.tileOptions),p=new Uw(f);return p.key=this.getKey(),p}getTile(e,t,r,i,s,o){var E;const a=this.getProjection();if(s&&(a&&!gi(a,s)||this.transformMatrix))return this.getReprojTile_(e,t,r,s,a,o);const l=this.getTileSize(e),u=this.loader_,c=new AbortController,h={signal:c.signal,crossOrigin:this.crossOrigin_},f=this.getTileCoordForTileUrlFunction([e,t,r]);if(!f)return null;const p=this.getKey(),d=om(this,p,e,t,r);if(o&&o.containsKey(d))return o.get(d);const g=f[0],m=f[1],y=f[2],_=(E=this.getTileGrid())==null?void 0:E.getFullTileRange(g);_&&(h.maxY=_.getHeight()-1);function b(){return Pi(function(){return u(g,m,y,h)})}const w=Object.assign({tileCoord:[e,t,r],loader:b,size:l,controller:c},this.tileOptions),x=new vl(w);return x.key=this.getKey(),x.addEventListener(pt.CHANGE,this.handleTileChange_),o==null||o.set(d,x),x}handleTileChange_(e){const t=e.target,r=me(t),i=t.getState();let s;i==ee.LOADING?(this.tileLoadingKeys_[r]=!0,s=Jo.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],s=i==ee.ERROR?Jo.TILELOADERROR:i==ee.LOADED?Jo.TILELOADEND:void 0),s&&this.dispatchEvent(new am(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||gi(t,e))&&!this.transformMatrix)return this.tileGrid;const r=me(e);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=lm(e)),this.tileGridForProjection_[r]}setTileGridForProjection(e,t){const r=he(e);if(r){const i=me(r);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=t)}}}function Bw(n){return((n.fileDirectory.NewSubfileType||0)&4)===4}function Gw(n,e){if(!n)return!1;if(n===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,r=yt;return t===r.CMYK||t===r.YCbCr||t===r.CIELab||t===r.ICCLab}const ih="STATISTICS_MAXIMUM",sh="STATISTICS_MINIMUM",ua=256;let ca;function zw(){return ca||(ca=new QE),ca}function kw(n){try{return n.getBoundingBox(!0)}catch{return[0,0,n.getWidth(),n.getHeight()]}}function $w(n){try{return n.getOrigin().slice(0,2)}catch{return[0,n.getHeight()]}}function jw(n,e){try{return n.getResolution(e)}catch{return[e.getWidth()/n.getWidth(),e.getHeight()/n.getHeight()]}}function Vw(n){const e=n.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let r=he(t);if(!r){const i=sc(e.ProjLinearUnitsGeoKey);i&&(r=new oc({code:t,units:i}))}return r}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let r=he(t);if(!r){const i=sc(e.GeogAngularUnitsGeoKey);i&&(r=new oc({code:t,units:i}))}return r}return null}function Xw(n){return n.getImageCount().then(function(e){const t=new Array(e);for(let r=0;r<e;++r)t[r]=n.getImage(r);return Promise.all(t)})}function Ww(n,e){let t;return n.blob?t=Sw(n.blob):n.overviews?t=Rw(n.url,n.overviews,e):t=Tw(n.url,e),t.then(Xw)}function di(n,e,t,r,i){if(Array.isArray(n)){const s=n.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(r);throw i(o),o}for(let o=0;o<s;++o)di(n[o],e[o],t,r,i);return}if(e=e,Math.abs(n-e)>t*n)throw new Error(r)}function Zw(n){return n instanceof Int8Array?-128:n instanceof Int16Array?-32768:n instanceof Int32Array?-2147483648:n instanceof Float32Array?12e-39:0}function qw(n){return n instanceof Int8Array?127:n instanceof Uint8Array||n instanceof Uint8ClampedArray?255:n instanceof Int16Array?32767:n instanceof Uint16Array?65535:n instanceof Int32Array?2147483647:n instanceof Uint32Array?4294967295:n instanceof Float32Array?34e37:255}class Eu extends es{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const r=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=Ww(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){r.configure_(s)}).catch(function(s){Si(s),r.error_=s,r.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const i=t[r],s=Vw(i);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const s=t[r].fileDirectory.ModelTransformation;if(s){const[o,a,l,u,c,h,f,p]=s,d=vi(vi([1/Math.sqrt(o*o+c*c),0,0,-1/Math.sqrt(a*a+h*h),u,p],[o,c,a,h,0,0]),[1,0,0,1,-u,-p]);this.transformMatrix=d,this.addAlpha_=!0;break}}}configure_(e){let t,r,i,s,o;const a=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let c=0;const h=e.length;for(let m=0;m<h;++m){const y=[],_=[];e[m].forEach(P=>{Bw(P)?_.push(P):y.push(P)});const b=y.length;if(_.length>0&&_.length!==b)throw new Error(`Expected one mask per image found ${_.length} masks and ${b} images`);let w,x;const E=new Array(b),S=new Array(b),A=new Array(b);l[m]=new Array(b),u[m]=new Array(b);for(let P=0;P<b;++P){const R=y[P],I=R.getGDALNoData();u[m][P]=R.getGDALMetadata(0),l[m][P]=I;const G=this.sourceInfo_[m].bands;a[m]=G?G.length:R.getSamplesPerPixel();const $=b-(P+1);w||(w=kw(R)),x||(x=$w(R));const W=jw(R,y[0]);A[$]=W[0];const C=[R.getTileWidth(),R.getTileHeight()];C[0]!==C[1]&&C[1]<ua&&(C[0]=ua,C[1]=ua),E[$]=C;const O=W[0]/Math.abs(W[1]);S[$]=[C[0],C[1]/O]}if(t?ir(t,w,t):t=w,!r)r=x;else{const P=`Origin mismatch for source ${m}, got [${x}] but expected [${r}]`;di(r,x,0,P,this.viewRejector)}if(!o)o=A,this.resolutionFactors_[m]=1;else{o.length-c>A.length&&(c=o.length-A.length);const P=o[o.length-1]/A[A.length-1];this.resolutionFactors_[m]=P;const R=A.map(G=>G*=P),I=`Resolution mismatch for source ${m}, got [${R}] but expected [${o}]`;di(o.slice(c,o.length),R,.02,I,this.viewRejector)}i?di(i.slice(c,i.length),S,.01,`Tile size mismatch for source ${m}`,this.viewRejector):i=S,s?di(s.slice(c,s.length),E,0,`Tile size mismatch for source ${m}`,this.viewRejector):s=E,this.sourceImagery_[m]=y.reverse(),this.sourceMasks_[m]=_.reverse()}for(let m=0,y=this.sourceImagery_.length;m<y;++m){const _=this.sourceImagery_[m];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=u;e:for(let m=0;m<h;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const y=l[m],_=this.sourceInfo_[m].bands;if(_){for(let b=0;b<_.length;++b)if(y[_[b]-1]!==null){this.addAlpha_=!0;break e}continue}for(let b=0;b<y.length;++b)if(y[b]!==null){this.addAlpha_=!0;break e}}let f=this.addAlpha_?1:0;for(let m=0;m<h;++m)f+=a[m];this.bandCount=f;const p=new Wi({extent:t,minZoom:c,origin:r,resolutions:o,tileSizes:i});this.tileGrid=p,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const d=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let g=t;if(this.transformMatrix){const m=Ti(rt(),this.transformMatrix.slice()),y=dg(_=>xr(m,_));g=Gn(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:gg(sr(g),this.projection),extent:pg(g,this.projection),zoom:d})}loadTile_(e,t,r,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,u=this.sourceInfo_,c=zw();for(let h=0;h<o;++h){const f=u[h],p=this.resolutionFactors_[h],d=[Math.round(t*(s[0]*p)),Math.round(r*(s[1]*p)),Math.round((t+1)*(s[0]*p)),Math.round((r+1)*(s[1]*p))],g=this.sourceImagery_[h][e];let m;f.bands&&(m=f.bands.map(function(x){return x-1}));let y;"nodata"in f&&f.nodata!==null?y=f.nodata:m?y=m.map(function(x){return l[h][x]}):y=l[h];const _={window:d,width:s[0],height:s[1],samples:m,fillValue:y,pool:c,interleave:!1,signal:i.signal};Gw(this.convertToRGB_,g)?a[h]=g.readRGB(_):a[h]=g.readRasters(_);const b=o+h,w=this.sourceMasks_[h][e];if(!w){a[b]=Promise.resolve(null);continue}a[b]=w.readRasters({window:d,width:s[0],height:s[1],samples:[0],pool:c,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(h){throw Si(h),h})}composeTile_(e,t){const r=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,c=this.addAlpha_,h=e[0]*e[1],f=h*o;let p;u?p=new Uint8Array(f):p=new Float32Array(f);let d=0;for(let g=0;g<h;++g){let m=c;for(let y=0;y<s;++y){const _=i[y];let b=_.min,w=_.max,x,E;if(u){const S=r[y][0];b===void 0&&(S&&sh in S?b=parseFloat(S[sh]):b=Zw(t[y][0])),w===void 0&&(S&&ih in S?w=parseFloat(S[ih]):w=qw(t[y][0])),x=255/(w-b),E=-b*x}for(let S=0;S<a[y];++S){const A=t[y][S][g];let P;if(u?P=De(x*A+E,0,255):P=A,!c)p[d]=P;else{let R=_.nodata;if(R===void 0){let G;_.bands?G=_.bands[S]-1:G=S,R=l[y][G]}const I=isNaN(R);(!I&&A!==R||I&&!isNaN(A))&&(m=!1,p[d]=P)}d++}if(!m){const S=s+y,A=t[S];A&&!A[0][g]&&(m=!0)}}c&&(m||(p[d]=255),d++)}return p}}Eu.prototype.getView;class Fe{constructor(e){this.name=e}toString(){return this.name}}Fe.GeoTIFF=new Fe("GeoTIFF");Fe.ImageStatic=new Fe("ImageStatic");Fe.PMTilesRaster=new Fe("PMTilesRaster");Fe.PMTilesVector=new Fe("PMTilesVector");Fe.TileJSON=new Fe("TileJSON");Fe.TileWMS=new Fe("TileWMS");Fe.WMTS=new Fe("WMTS");Fe.XYZ=new Fe("XYZ");function Hw(n){const e=n.load||Zn,t=n.imageExtent,r=n.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=r,e(i,n.url).then(s=>{const o=nt(t)/s.width,a=Wt(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class Kd extends pn{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,r=e.imageLoadFunction!==void 0?e.imageLoadFunction:Sl;super({attributions:e.attributions,interpolate:e.interpolate,projection:he(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new _f(this.imageExtent_,void 0,1,Hw({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),r(this.image,s),Zn(i))})),this.image.addEventListener(pt.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,r,i){return Bn(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}function wu(n,e,t,r){const i=document.createElement("script"),s="olc_"+me(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=n+(n.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class Yw extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class Kw extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function Jd(n){return new Promise(function(e,t){function r(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(u){const c="Error parsing response text as JSON: "+u.message;t(new Error(c));return}e(l);return}t(new Yw(a))}function i(o){t(new Kw(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",r),s.addEventListener("error",i),s.open("GET",n),s.setRequestHeader("Accept","application/json"),s.send()})}function Qd(n,e){return e.includes("://")?e:new URL(e,n).href}class Ro extends vr{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:he("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)wu(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=he("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const u=yl(t,r);i=Gn(e.bounds,u)}const s=dn(r),o=e.minzoom||0,a=e.maxzoom||22,l=Vr({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=bf(e.tiles,l),e.attribution&&!this.getAttributions()){const u=i!==void 0?i:s;this.setAttributions(function(c){return Bn(u,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const Jw="https://stac-extensions.github.io/label/v1.*/schema.json",ep=new Or({color:"rgba(0,0,0,0)"});function tp(n,e,t="rgba(255,255,255,0.4)",r=5){let i=ep;t&&(i=new Or({color:t}));const s=new Mr({color:n,width:e});return new rr({image:new xf({fill:i,stroke:s,radius:r}),fill:i,stroke:s})}const Qw=tp("#3399CC",3),oh=tp("#ff9933",2,null);function ev(n,e){const t={url:n.getAbsoluteUrl()};let r=n,i=n.getBands();i.length===1&&(r=i[0],i=[]);const{minimum:s,maximum:o}=r.getMinMaxValues();if(typeof s=="number"&&(t.min=s),typeof o=="number"&&(t.max=o),typeof t.min!="number"&&typeof t.max!="number"&&i.length>1)for(const l of i){const{minimum:u,maximum:c}=l.getMinMaxValues();typeof u=="number"&&(typeof t.min>"u"||u<t.min)&&(t.min=u),typeof c=="number"&&(typeof t.max>"u"||c>t.max)&&(t.max=c)}const a=r.getNoDataValues();if(a.length>0)t.nodata=a[0];else if(i.length>1){let l;for(const u of i){const c=u.getNoDataValues();if(c.length>0){if(typeof l>"u")l=c[0];else if(l!==c[0]){l=void 0;break}}}typeof l<"u"&&(t.nodata=l)}if(e.length>0)t.bands=e;else{const l=n.findVisualBands();l&&(t.bands=[l.red.getIndex()+1,l.green.getIndex()+1,l.blue.getIndex()+1])}return t}async function ah(n,e=void 0){let t=e;if(um()){const r=n.getMetadata("proj:code");if(r)try{if(r.startsWith("EPSG:")){const i=parseInt(r.replace("EPSG:",""),10);t=await cm(i)}}catch{}}return t}function lh(n,e){const t=n.clone();return e.hasOnlyBounds()||t.setFill(ep),t}function tv(n){let e=n.href;if(e.includes("{s}"))if(Array.isArray(n["href:servers"])&&n["href:servers"].length>0){const t=Math.random()*n["href:servers"].length|0;e=e.replace("{s}",n["href:servers"][t])}else return null;return e}var rp=Object.defineProperty,uh=Object.getOwnPropertySymbols,rv=Object.prototype.hasOwnProperty,nv=Object.prototype.propertyIsEnumerable,ch=(n,e,t)=>e in n?rp(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ws=(n,e)=>{for(var t in e||(e={}))rv.call(e,t)&&ch(n,t,e[t]);if(uh)for(var t of uh(e))nv.call(e,t)&&ch(n,t,e[t]);return n},Po=(n,e)=>rp(n,"name",{value:e,configurable:!0}),iv=(n,e,t)=>new Promise((r,i)=>{var s=l=>{try{a(t.next(l))}catch(u){i(u)}},o=l=>{try{a(t.throw(l))}catch(u){i(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())}),np=class extends es{constructor(e){super(Ws(Ws({},e),{state:"loading"})),this.loadImage=Po(r=>new Promise((i,s)=>{const o=new Image;o.addEventListener("load",()=>i(o)),o.addEventListener("error",()=>s(new Error("load failed"))),o.src=r}),"loadImage");const t=new Ci(e.url);t.getHeader().then(r=>{const i=e.projection===void 0?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||Vr({extent:dn(i),maxResolution:e.maxResolution,minZoom:r.minZoom,maxZoom:r.maxZoom,tileSize:e.tileSize}),this.setLoader((s,o,a)=>iv(this,null,function*(){const l=yield t.getZxy(s,o,a);if(!l)return new Uint8Array;const u=URL.createObjectURL(new Blob([l.data])),c=yield this.loadImage(u);return URL.revokeObjectURL(u),c})),this.setState("ready")})}};Po(np,"PMTilesRasterSource");var hh=np,ip=class extends qn{constructor(e){super(Ws(Ws({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new Rl})),this.tileLoadFunction=Po((t,r)=>{const i=t,s=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),o=r.match(s);if(!(o&&o.length>=4))throw Error("Could not parse tile URL");const a=+o[1],l=+o[2],u=+o[3];i.setLoader((c,h,f)=>{this.pmtiles_.getZxy(a,l,u).then(p=>{if(p){const d=i.getFormat();i.setFeatures(d.readFeatures(p.data,{extent:c,featureProjection:f})),i.setState(ee.LOADED)}else i.setFeatures([]),i.setState(ee.EMPTY)}).catch(p=>{i.setFeatures([]),i.setState(ee.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new Ci(e.url),this.pmtiles_.getHeader().then(t=>{const r=e.projection||"EPSG:3857",i=e.extent||dn(r);this.tileGrid=e.tileGrid||Vr({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};Po(ip,"PMTilesVectorSource");var sv=ip;class vu extends Il{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(r=>t[r]=e[r]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||Qw,this.collectionStyle_=e.collectionStyle||oh,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data){try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(r){this.handleError_(r)}return}if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(r=>this.configure_(r,e.url,e.children,e.assets,e.bands)).catch(r=>this.handleError_(r))}async fetch_(e,t="json"){const r=await fetch(e);if(!r.ok)throw new Error(`Unexpected response from ${e}: ${r.status}`);return t==="json"?await r.json():t==="text"?await r.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;if(this.getLayers().getLength()>1)return!1;const r=(e=this.getData())===null||e===void 0?void 0:e.getBoundingBox();return!r||co(r)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(e){this.dispatch_(new Yx(e))}configure_(e,t=null,r=null,i=null,s=[]){let o;e instanceof os||e instanceof ai?o=e:(o=as(e,!this.disableMigration_),t&&t.includes("://")&&o.setAbsoluteUrl(t)),this.set("stac",o),this.bands_=s,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(lh(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const l=c=>this.handleError_(c),u=[];r&&u.push(this.setChildren(r,null,!1).catch(l)),i&&u.push(this.setAssets(i,!1).catch(l)),Promise.all(u).then(()=>this.updateLayers().catch(l)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const r=e.map(i=>{const s={data:i,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},o=new vu(Object.assign(s,t));return o.on("sourceready",()=>{o.map_&&this.setMap_(o.map_)}),this.addLayer_(o,null),o});return await Promise.all(r)}async addPreviewImage_(e){const t=await ah(e,"EPSG:4326"),r=e.getContext().getBoundingBoxes();if(r.length!==1)return;const i=r[0];let s={url:e.getAbsoluteUrl(),projection:t,imageExtent:Pa(i,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(Fe.ImageStatic,s,e));const o=new Pl({source:new Kd(s)});return this.addLayer_(o,e),o}async addLayerForLink(e){const t=tv(e);if(!t)return;const r={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new Ci(r.url).getHeader();let l;switch(a.tileType){case Rn.Mvt:l=new sv(await i(Fe.PMTilesVector,r));break;case Rn.Avif:case Rn.Jpeg:case Rn.Png:case Rn.Webp:l=new hh(await i(Fe.PMTilesRaster,r));break;default:return}s.push(l);break;case"tilejson":s.push(new Ro(await i(Fe.TileJSON,r)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const h in e["wms:layers"]){const f=e["wms:layers"][h]||"";let p="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][h]=="string"&&(p=e["wms:styles"][h]);const d=Object.assign({LAYERS:f,STYLES:p},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(d.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(d.FORMAT=e.type);const g=await i(Fe.TileWMS,Object.assign({},r,{params:d}));s.push(new fm(g))}break;case"wmts":const u=await this.getWmtsCapabilities_(t);if(!u)return;let c=[];Array.isArray(e["wmts:layer"])?c=e["wmts:layer"]:typeof e["wmts:layer"]=="string"&&(c=[e["wmts:layer"]]);for(const h of c){let f=Object.assign({},r,{layer:h});typeof e.type=="string"&&e.type.startsWith("image/")&&(f.format=e.type),f=await i(Fe.WMTS,f);const p=Ef(u,f);p!==null&&s.push(new hm(p))}break;case"xyz":s.push(new Os(await i(Fe.XYZ,r)));break;default:return}return s.map(o=>{let a;return o instanceof qn?a=new Cn({source:o,declutter:!0}):o instanceof hh?a=new Xs({source:o}):a=new Ns({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let r={sources:[ev(e,this.bands_)],convertToRGB:"auto"};const i=await ah(e);i&&(r.projection=i),this.getSourceOptions_&&(r=await this.getSourceOptions_(Fe.GeoTIFF,r,e));const s=new Eu(r),o=new Promise((a,l)=>{s.on("error",l),s.on("change",()=>{s.getState()==="error"?l(s.getError()):a()})});try{await o;const a=new Xs({source:s});return this.addLayer_(a,e),a}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let r={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(r=await this.getSourceOptions_(Fe.XYZ,r,e));const i=new Ns({source:new Os(r)});return this.addLayer_(i,e),i}addLayer_(e,t=null,r=0){t&&e.set("stac",t),e.setZIndex(r),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=Mm(t.getBoundingBox()):e=t.toGeoJSON(),e){const r=this.createGeoJsonLayer_(e,lh(this.boundsStyle_,this),this.displayFootprint_);return r.set("bounds",!0),r.on("change",()=>this.setMap_(r.getMapInternal())),this.addLayer_(r,t,1),r}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),r=this.createGeoJsonLayer_(t);return this.addLayer_(r,e),r}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,r=!0){const i=new Ss,s=new Br({format:i,loader:(o,a,l)=>{e=Om(e);const u=i.readFeatures(e,{featureProjection:l});s.addFeatures(u)}});return t||(t=oh),new ji({source:s,style:t,visible:r})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof Bs))return;let t=e.getAssetsWithRoles(["labels","labels-vector"],!0),r;t.length>1&&(r=t.find(s=>s.roles.includes("labels-vector"))),r||(r=e.getAsset("vector_labels")),r||(t=e.getAssets().filter(s=>s.type===dc&&!s.roles),t.length===1&&(r=t[0]));const i=e.getLinksWithRels(["source"]);if(r&&i.length>0){const s=i.map(async a=>{try{const l=await this.fetch_(a.getAbsoluteUrl());return as(l)}catch(l){return this.handleError_(l),null}}),o=(await Promise.all(s)).filter(a=>a instanceof ai);await this.addChildren_(o,{displayFootprint:!1})}try{await this.addGeoJson_(r)}catch(s){this.handleError_(s)}}async updateLayers(e=!0){const t=this.getLayers();for(let s=t.getLength()-1;s>=0;s--){const o=t.item(s);o.get("stac")&&!o.get("bounds")&&t.removeAt(s)}const r=this.getData();if(Array.isArray(this.displayWebMapLink_)){const s=this.getWebMapLinks().map(async o=>await this.addLayerForLink(o));await Promise.all(s)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const i=this.getAssets();if(i){const s=i.map(async o=>{if(o){if(o.type===dc)return await this.addGeoJson_(o);if(o.isGeoTIFF())return await this.addGeoTiff_(o);if(o.canBrowserDisplayImage())return await this.addPreviewImage_(o)}});await Promise.all(s)}if(this.hasOnlyBounds()){if(r instanceof Cl)await this.addChildren_(r.getAll(),this.childrenOptions_);else if(r instanceof ai){if(r.isItem()&&r.supportsExtension(Jw)&&r.getMetadata("label:type")==="vector"){await this.addLabelExtension_(),e&&this.dispatch_("layersready");return}const s=this.getWebMapLinks();if(s.length>0)await this.addLayerForLink(s[0]);else{const o=r.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let a;if(o&&this.displayOverview_&&(a=await this.addGeoTiff_(o)),this.displayPreview_&&(!o||!a)){const l=r.getThumbnails(!0,"overview");l.length>0&&await this.addPreviewImage_(l[0])}}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(r=>r!==e)>"u"}getWebMapLinks(){const e=this.getData();if(e instanceof os)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let r=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?r=this.displayWebMapLink_.map(i=>{if(typeof i=="string"){const s=r.find(o=>o.id===i);return s||null}return i}).filter(i=>!!i):r.sort((i,s)=>{const o=t.indexOf(i.rel),a=t.indexOf(s.rel);return o-a}),r}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const r=this.getData();this.assets_=e.map(i=>r instanceof ai&&typeof i=="string"?r.getAsset(i):i instanceof os?i:new os(i))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,r=!0){e instanceof If?this.children_=e.getAll():pc(e)&&e.type==="FeatureCollection"?this.children_=as(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(i=>i instanceof ai?i:as(i,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.children_&&pc(t)&&(this.childrenOptions_=t),r&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const r=this.getData();r&&(t=r.getBoundingBox());const i=this.getChildren();if(i){const s=i.map(o=>o.getBoundingBox());t=Ll(s)}if(t)return Pa(t,"EPSG:4326",e.getProjection())}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const r=t.getMetadata("attribution");r&&r.push(r)}return e}getSource(){return null}async getWmtsCapabilities_(e){try{const t=new URL(e);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");const r=await this.fetch_(t.toString(),"text");return new jl().read(r)}catch{return null}}}var ov=8,av={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},lv={"*":{type:"source"}},uv=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],cv={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},hv={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},fv={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},dv={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},pv={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},gv={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},mv={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},yv=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],_v={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},bv={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},xv={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Ev={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},wv={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},vv={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Tv={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Sv={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Rv={type:"array",value:"*"},Pv={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},Av={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},Iv={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},Lv={type:"array",value:"*",minimum:1},Cv={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},Fv={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},Mv={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},Ov={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},Nv=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],Dv={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},Uv={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},Bv={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},Gv={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},zv={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},kv={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},$v={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},jv={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},Vv={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},Xv={"*":{type:"string"}},Wv={$version:ov,$root:av,sources:lv,source:uv,source_vector:cv,source_raster:hv,source_raster_dem:fv,source_geojson:dv,source_video:pv,source_image:gv,layer:mv,layout:yv,layout_background:_v,layout_fill:bv,layout_circle:xv,layout_heatmap:Ev,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:wv,layout_symbol:vv,layout_raster:Tv,layout_hillshade:Sv,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:Rv,filter_operator:Pv,geometry_type:Av,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:Iv,expression:Lv,light:Cv,sky:Fv,terrain:Mv,projection:Ov,paint:Nv,paint_fill:Dv,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:Uv,paint_circle:Bv,paint_heatmap:Gv,paint_symbol:zv,paint_raster:kv,paint_hillshade:$v,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:jv,transition:Vv,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:Xv};const Zv=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qv(n,e){const t={};for(const r in n)r!=="ref"&&(t[r]=n[r]);return Zv.forEach(r=>{r in e&&(t[r]=e[r])}),t}function sp(n){n=n.slice();const e=Object.create(null);for(let t=0;t<n.length;t++)e[n[t].id]=n[t];for(let t=0;t<n.length;t++)"ref"in n[t]&&(n[t]=qv(n[t],e[n[t].ref]));return n}class nr extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Tu{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[r,i]of t)this.bindings[r]=i}concat(e){return new Tu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const Ao={kind:"null"},U={kind:"number"},oe={kind:"string"},ne={kind:"boolean"},or={kind:"color"},Io={kind:"projectionDefinition"},rn={kind:"object"},Q={kind:"value"},Hv={kind:"error"},Lo={kind:"collator"},Co={kind:"formatted"},Fo={kind:"padding"},Mi={kind:"colorArray"},Mo={kind:"numberArray"},ts={kind:"resolvedImage"},Oo={kind:"variableAnchorOffsetCollection"};function Tt(n,e){return{kind:"array",itemType:n,N:e}}function Ue(n){if(n.kind==="array"){const e=Ue(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}else return n.kind}const Yv=[Ao,U,oe,ne,or,Io,Co,rn,Tt(Q),Fo,Mo,Mi,ts,Oo];function Oi(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Oi(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const t of Yv)if(!Oi(t,e))return null}}return`Expected ${Ue(n)} but found ${Ue(e)} instead.`}function Su(n,e){return e.some(t=>t.kind===n.kind)}function nn(n,e){return e.some(t=>t==="null"?n===null:t==="array"?Array.isArray(n):t==="object"?n&&!Array.isArray(n)&&typeof n=="object":t===typeof n)}function Ar(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const op=.96422,ap=1,lp=.82521,up=4/29,On=6/29,cp=3*On*On,Kv=On*On*On,Jv=Math.PI/180,Qv=180/Math.PI;function hp(n){return n=n%360,n<0&&(n+=360),n}function fp([n,e,t,r]){n=ha(n),e=ha(e),t=ha(t);let i,s;const o=fa((.2225045*n+.7168786*e+.0606169*t)/ap);n===e&&e===t?i=s=o:(i=fa((.4360747*n+.3850649*e+.1430804*t)/op),s=fa((.0139322*n+.0971045*e+.7141733*t)/lp));const a=116*o-16;return[a<0?0:a,500*(i-o),200*(o-s),r]}function ha(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function fa(n){return n>Kv?Math.pow(n,1/3):n/cp+up}function dp([n,e,t,r]){let i=(n+16)/116,s=isNaN(e)?i:i+e/500,o=isNaN(t)?i:i-t/200;return i=ap*pa(i),s=op*pa(s),o=lp*pa(o),[da(3.1338561*s-1.6168667*i-.4906146*o),da(-.9787684*s+1.9161415*i+.033454*o),da(.0719453*s-.2289914*i+1.4052427*o),r]}function da(n){return n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055,n<0?0:n>1?1:n}function pa(n){return n>On?n*n*n:cp*(n-up)}function e1(n){const[e,t,r,i]=fp(n),s=Math.sqrt(t*t+r*r);return[Math.round(s*1e4)?hp(Math.atan2(r,t)*Qv):NaN,s,e,i]}function t1([n,e,t,r]){return n=isNaN(n)?0:n*Jv,dp([t,Math.cos(n)*e,Math.sin(n)*e,r])}function r1([n,e,t,r]){n=hp(n),e/=100,t/=100;function i(s){const o=(s+n/30)%12,a=e*Math.min(t,1-t);return t-a*Math.max(-1,Math.min(o-3,9-o,1))}return[i(0),i(8),i(4),r]}const n1=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function pp(n,e){return n1(n,e)?n[e]:void 0}function i1(n){if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];const e=pp(s1,n);if(e){const[i,s,o]=e;return[i/255,s/255,o/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const s=n.length<6?1:2;let o=1;return[ds(n.slice(o,o+=s)),ds(n.slice(o,o+=s)),ds(n.slice(o,o+=s)),ds(n.slice(o,o+s)||"ff")]}if(n.startsWith("rgb")){const i=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=n.match(i);if(s){const[o,a,l,u,c,h,f,p,d,g,m,y]=s,_=[u||" ",f||" ",g].join("");if(_==="  "||_==="  /"||_===",,"||_===",,,"){const b=[l,h,d].join(""),w=b==="%%%"?100:b===""?255:0;if(w){const x=[Pn(+a/w,0,1),Pn(+c/w,0,1),Pn(+p/w,0,1),m?fh(+m,y):1];if(dh(x))return x}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=n.match(t);if(r){const[i,s,o,a,l,u,c,h,f]=r,p=[o||" ",l||" ",c].join("");if(p==="  "||p==="  /"||p===",,"||p===",,,"){const d=[+s,Pn(+a,0,100),Pn(+u,0,100),h?fh(+h,f):1];if(dh(d))return r1(d)}}}function ds(n){return parseInt(n.padEnd(2,n),16)/255}function fh(n,e){return Pn(e?n/100:n,0,1)}function Pn(n,e,t){return Math.min(Math.max(e,n),t)}function dh(n){return!n.some(Number.isNaN)}const s1={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function sn(n,e,t){return n+t*(e-n)}function Ni(n,e,t){return n.map((r,i)=>sn(r,e[i],t))}class ve{constructor(e,t,r,i=1,s=!0){this.r=e,this.g=t,this.b=r,this.a=i,s||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,r,i]))}static parse(e){if(e instanceof ve)return e;if(typeof e!="string")return;const t=i1(e);if(t)return new ve(...t,!1)}get rgb(){const{r:e,g:t,b:r,a:i}=this,s=i||1/0;return this.overwriteGetter("rgb",[e/s,t/s,r/s,i])}get hcl(){return this.overwriteGetter("hcl",e1(this.rgb))}get lab(){return this.overwriteGetter("lab",fp(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,r,i]=this.rgb;return`rgba(${[e,t,r].map(s=>Math.round(s*255)).join(",")},${i})`}static interpolate(e,t,r,i="rgb"){switch(i){case"rgb":{const[s,o,a,l]=Ni(e.rgb,t.rgb,r);return new ve(s,o,a,l,!1)}case"hcl":{const[s,o,a,l]=e.hcl,[u,c,h,f]=t.hcl;let p,d;if(!isNaN(s)&&!isNaN(u)){let b=u-s;u>s&&b>180?b-=360:u<s&&s-u>180&&(b+=360),p=s+r*b}else isNaN(s)?isNaN(u)?p=NaN:(p=u,(a===1||a===0)&&(d=c)):(p=s,(h===1||h===0)&&(d=o));const[g,m,y,_]=t1([p,d??sn(o,c,r),sn(a,h,r),sn(l,f,r)]);return new ve(g,m,y,_,!1)}case"lab":{const[s,o,a,l]=dp(Ni(e.lab,t.lab,r));return new ve(s,o,a,l,!1)}}}}ve.black=new ve(0,0,0,1);ve.white=new ve(1,1,1,1);ve.transparent=new ve(0,0,0,0);ve.red=new ve(1,0,0,1);class Ru{constructor(e,t,r){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const o1=["bottom","center","top"];class Ka{constructor(e,t,r,i,s,o){this.text=e,this.image=t,this.scale=r,this.fontStack=i,this.textColor=s,this.verticalAlign=o}}class _r{constructor(e){this.sections=e}static fromString(e){return new _r([new Ka(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof _r?e:_r.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Vt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Vt)return e;if(typeof e=="number")return new Vt([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new Vt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){return new Vt(Ni(e.values,t.values,r))}}class Xt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Xt)return e;if(typeof e=="number")return new Xt([e]);if(Array.isArray(e)){for(const t of e)if(typeof t!="number")return;return new Xt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){return new Xt(Ni(e.values,t.values,r))}}class St{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof St)return e;if(typeof e=="string"){const r=ve.parse(e);return r?new St([r]):void 0}if(!Array.isArray(e))return;const t=[];for(const r of e){if(typeof r!="string")return;const i=ve.parse(r);if(!i)return;t.push(i)}return new St(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r,i="rgb"){const s=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let o=0;o<e.values.length;o++)s.push(ve.interpolate(e.values[o],t.values[o],r,i));return new St(s)}}class ke extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const a1=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ar{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ar)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const r=e[t],i=e[t+1];if(typeof r!="string"||!a1.has(r)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new ar(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){const i=e.values,s=t.values;if(i.length!==s.length)throw new ke(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let a=0;a<i.length;a+=2){if(i[a]!==s[a])throw new ke(`Cannot interpolate values containing mismatched anchors. from[${a}]: ${i[a]}, to[${a}]: ${s[a]}`);o.push(i[a]);const[l,u]=i[a+1],[c,h]=s[a+1];o.push([sn(l,c,r),sn(u,h,r)])}return new ar(o)}}class Zr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Zr({name:e,available:!1}):null}}class zt{constructor(e,t,r){this.from=e,this.to=t,this.transition=r}static interpolate(e,t,r){return new zt(e,t,r)}static parse(e){if(e instanceof zt)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new zt(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new zt(e.from,e.to,e.transition);if(typeof e=="string")return new zt(e,e,1)}}function gp(n,e,t,r){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof r>"u"||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[n,e,t,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[n,e,t,r]:[n,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Di(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof zt||n instanceof ve||n instanceof Ru||n instanceof _r||n instanceof Vt||n instanceof Xt||n instanceof St||n instanceof ar||n instanceof Zr)return!0;if(Array.isArray(n)){for(const e of n)if(!Di(e))return!1;return!0}else if(typeof n=="object"){for(const e in n)if(!Di(n[e]))return!1;return!0}else return!1}function We(n){if(n===null)return Ao;if(typeof n=="string")return oe;if(typeof n=="boolean")return ne;if(typeof n=="number")return U;if(n instanceof ve)return or;if(n instanceof zt)return Io;if(n instanceof Ru)return Lo;if(n instanceof _r)return Co;if(n instanceof Vt)return Fo;if(n instanceof Xt)return Mo;if(n instanceof St)return Mi;if(n instanceof ar)return Oo;if(n instanceof Zr)return ts;if(Array.isArray(n)){const e=n.length;let t;for(const r of n){const i=We(r);if(!t)t=i;else{if(t===i)continue;t=Q;break}}return Tt(t||Q,e)}else return rn}function xi(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof ve||n instanceof zt||n instanceof _r||n instanceof Vt||n instanceof Xt||n instanceof St||n instanceof ar||n instanceof Zr?n.toString():JSON.stringify(n)}class jn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Di(e[1]))return t.error("invalid value");const r=e[1];let i=We(r);const s=t.expectedType;return i.kind==="array"&&i.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(i=s),new jn(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ps={string:oe,number:U,boolean:ne,object:rn};class kt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=1,i;const s=e[0];if(s==="array"){let a;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in ps)||u==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=ps[u],r++}else a=Q;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],r++}i=Tt(a,l)}else{if(!ps[s])throw new Error(`Types doesn't contain name = ${s}`);i=ps[s]}const o=[];for(;r<e.length;r++){const a=t.parse(e[r],r,Q);if(!a)return null;o.push(a)}return new kt(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(Oi(this.type,We(r))){if(t===this.args.length-1)throw new ke(`Expected value to be of type ${Ue(this.type)}, but found ${Ue(We(r))} instead.`)}else return r}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ph={"to-boolean":ne,"to-color":or,"to-number":U,"to-string":oe};class Dr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if(!ph[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");const i=ph[r],s=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,Q);if(!a)return null;s.push(a)}return new Dr(i,s)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,r;for(const i of this.args){if(t=i.evaluate(e),r=null,t instanceof ve)return t;if(typeof t=="string"){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(t.length<3||t.length>4?r=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:r=gp(t[0],t[1],t[2],t[3]),!r))return new ve(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ke(r||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const r of this.args){t=r.evaluate(e);const i=Vt.parse(t);if(i)return i}throw new ke(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const r of this.args){t=r.evaluate(e);const i=Xt.parse(t);if(i)return i}throw new ke(`Could not parse numberArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const r of this.args){t=r.evaluate(e);const i=St.parse(t);if(i)return i}throw new ke(`Could not parse colorArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const r of this.args){t=r.evaluate(e);const i=ar.parse(t);if(i)return i}throw new ke(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const r of this.args){if(t=r.evaluate(e),t===null)return 0;const i=Number(t);if(!isNaN(i))return i}throw new ke(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return _r.fromString(xi(this.args[0].evaluate(e)));case"resolvedImage":return Zr.fromString(xi(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return xi(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const l1=["Unknown","Point","LineString","Polygon"];class mp{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?l1[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=ve.parse(e),this._parseColorCache.set(e,t)),t}}class No{constructor(e,t,r=[],i,s=new Tu,o=[]){this.registry=e,this.path=r,this.key=r.map(a=>`[${a}]`).join(""),this.scope=s,this.errors=o,this.expectedType=i,this._isConstant=t}parse(e,t,r,i,s={}){return t?this.concat(t,r,i)._parse(e,s):this._parse(e,s)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function r(i,s,o){return o==="assert"?new kt(s,[i]):o==="coerce"?new Dr(s,[i]):i}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let o=s.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=r(o,a,t.typeAnnotation||"assert");else if(a.kind==="projectionDefinition"&&["string","array"].includes(l.kind)||["color","formatted","resolvedImage"].includes(a.kind)&&["value","string"].includes(l.kind)||["padding","numberArray"].includes(a.kind)&&["value","number","array"].includes(l.kind)||a.kind==="colorArray"&&["value","string","array"].includes(l.kind)||a.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(l.kind))o=r(o,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof jn)&&o.type.kind!=="resolvedImage"&&this._isConstant(o)){const a=new mp;try{o=new jn(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const i=typeof e=="number"?this.path.concat(e):this.path,s=r?this.scope.concat(r):this.scope;return new No(this.registry,this._isConstant,i,t||null,s,this.errors)}error(e,...t){const r=`${this.key}${t.map(i=>`[${i}]`).join("")}`;this.errors.push(new nr(r,e))}checkSubtype(e,t){const r=Oi(e,t);return r&&this.error(r),r}}class Do{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let s=1;s<e.length-1;s+=2){const o=e[s];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=t.parse(e[s+1],s+1);if(!a)return null;r.push([o,a])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return i?new Do(r,i):null}outputDefined(){return this.result.outputDefined()}}class Uo{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Uo(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Pu{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,U),i=t.parse(e[2],2,Tt(t.expectedType||Q));if(!r||!i)return null;const s=i.type;return new Pu(s.itemType,r,i)}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new ke(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new ke(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new ke(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Au{constructor(e,t){this.type=ne,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Q),i=t.parse(e[2],2,Q);return!r||!i?null:Su(r.type,[ne,oe,U,Ao,Q])?new Au(r,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(r.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!nn(t,["boolean","string","number","null"]))throw new ke(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(We(t))} instead.`);if(!nn(r,["string","array"]))throw new ke(`Expected second argument to be of type array or string, but found ${Ue(We(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Zs{constructor(e,t,r){this.type=U,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Q),i=t.parse(e[2],2,Q);if(!r||!i)return null;if(!Su(r.type,[ne,oe,U,Ao,Q]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(r.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,U);return s?new Zs(r,i,s):null}else return new Zs(r,i)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!nn(t,["boolean","string","number","null"]))throw new ke(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(We(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),nn(r,["string"])){const s=r.indexOf(t,i);return s===-1?-1:[...r.slice(0,s)].length}else{if(nn(r,["array"]))return r.indexOf(t,i);throw new ke(`Expected second argument to be of type array or string, but found ${Ue(We(r))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Iu{constructor(e,t,r,i,s,o){this.inputType=e,this.type=t,this.input=r,this.cases=i,this.outputs=s,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let r,i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const s={},o=[];for(let u=2;u<e.length-1;u+=2){let c=e[u];const h=e[u+1];Array.isArray(c)||(c=[c]);const f=t.concat(u);if(c.length===0)return f.error("Expected at least one branch label.");for(const d of c){if(typeof d!="number"&&typeof d!="string")return f.error("Branch labels must be numbers or strings.");if(typeof d=="number"&&Math.abs(d)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof d=="number"&&Math.floor(d)!==d)return f.error("Numeric branch labels must be integer values.");if(!r)r=We(d);else if(f.checkSubtype(r,We(d)))return null;if(typeof s[String(d)]<"u")return f.error("Branch labels must be unique.");s[String(d)]=o.length}const p=t.parse(h,u,i);if(!p)return null;i=i||p.type,o.push(p)}const a=t.parse(e[1],1,Q);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,i);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(r,a.type)?null:new Iu(r,i,a,s,o,l)}evaluate(e){const t=this.input.evaluate(e);return(We(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Lu{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,ne);if(!a)return null;const l=t.parse(e[o+1],o+1,r);if(!l)return null;i.push([a,l]),r=r||l.type}const s=t.parse(e[e.length-1],e.length-1,r);if(!s)return null;if(!r)throw new Error("Can't infer output type");return new Lu(r,i,s)}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class qs{constructor(e,t,r,i){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Q),i=t.parse(e[2],2,U);if(!r||!i)return null;if(!Su(r.type,[Tt(Q),oe,Q]))return t.error(`Expected first argument to be of type array or string, but found ${Ue(r.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,U);return s?new qs(r.type,r,i,s):null}else return new qs(r.type,r,i)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),nn(t,["string"]))return[...t].slice(r,i).join("");if(nn(t,["array"]))return t.slice(r,i);throw new ke(`Expected first argument to be of type array or string, but found ${Ue(We(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function yp(n,e){const t=n.length-1;let r=0,i=t,s=0,o,a;for(;r<=i;)if(s=Math.floor((r+i)/2),o=n[s],a=n[s+1],o<=e){if(s===t||e<a)return s;r=s+1}else if(o>e)i=s-1;else throw new ke("Input is not a number.");return 0}class Bo{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,s]of r)this.labels.push(i),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,U);if(!r)return null;const i=[];let s=null;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],u=o,c=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const h=t.parse(l,c,s);if(!h)return null;s=s||h.type,i.push([a,h])}return new Bo(s,r,i)}evaluate(e){const t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);const s=t.length;if(i>=t[s-1])return r[s-1].evaluate(e);const o=yp(t,i);return r[o].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function u1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ga,gh;function c1(){if(gh)return ga;gh=1,ga=n;function n(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=i}return n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,i=0;i<8;i++){var s=this.sampleCurveX(r)-e;if(Math.abs(s)<t)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r=r-s/o}var a=0,l=1;for(r=e,i=0;i<20&&(s=this.sampleCurveX(r),!(Math.abs(s-e)<t));i++)e>s?a=r:l=r,r=(l-a)*.5+a;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},ga}var h1=c1(),f1=u1(h1);class lr{constructor(e,t,r,i,s){this.type=e,this.operator=t,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,r,i){let s=0;if(e.name==="exponential")s=ma(t,e.base,r,i);else if(e.name==="linear")s=ma(t,1,r,i);else if(e.name==="cubic-bezier"){const o=e.controlPoints;s=new f1(o[0],o[1],o[2],o[3]).solve(ma(t,1,r,i))}return s}static parse(e,t){let[r,i,s,...o]=e;if(!Array.isArray(i)||i.length===0)return t.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else if(i[0]==="cubic-bezier"){const u=i.slice(1);if(u.length!==4||u.some(c=>typeof c!="number"||c<0||c>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}else return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,U),!s)return null;const a=[];let l=null;(r==="interpolate-hcl"||r==="interpolate-lab")&&t.expectedType!=Mi?l=or:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let u=0;u<o.length;u+=2){const c=o[u],h=o[u+1],f=u+3,p=u+4;if(typeof c!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(a.length&&a[a.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);const d=t.parse(h,p,l);if(!d)return null;l=l||d.type,a.push([c,d])}return!Ar(l,U)&&!Ar(l,Io)&&!Ar(l,or)&&!Ar(l,Fo)&&!Ar(l,Mo)&&!Ar(l,Mi)&&!Ar(l,Oo)&&!Ar(l,Tt(U))?t.error(`Type ${Ue(l)} is not interpolatable.`):new lr(l,r,i,s,a)}evaluate(e){const t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);const s=t.length;if(i>=t[s-1])return r[s-1].evaluate(e);const o=yp(t,i),a=t[o],l=t[o+1],u=lr.interpolationFactor(this.interpolation,i,a,l),c=r[o].evaluate(e),h=r[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return sn(c,h,u);case"color":return ve.interpolate(c,h,u);case"padding":return Vt.interpolate(c,h,u);case"colorArray":return St.interpolate(c,h,u);case"numberArray":return Xt.interpolate(c,h,u);case"variableAnchorOffsetCollection":return ar.interpolate(c,h,u);case"array":return Ni(c,h,u);case"projectionDefinition":return zt.interpolate(c,h,u)}case"interpolate-hcl":switch(this.type.kind){case"color":return ve.interpolate(c,h,u,"hcl");case"colorArray":return St.interpolate(c,h,u,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ve.interpolate(c,h,u,"lab");case"colorArray":return St.interpolate(c,h,u,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ma(n,e,t,r){const i=r-t,s=n-t;return i===0?0:e===1?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}class Ui{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=null;const i=t.expectedType;i&&i.kind!=="value"&&(r=i);const s=[];for(const a of e.slice(1)){const l=t.parse(a,1+s.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,s.push(l)}if(!r)throw new Error("No output type");return i&&s.some(a=>Oi(i,a.type))?new Ui(Q,s):new Ui(r,s)}evaluate(e){let t=null,r=0,i;for(const s of this.args)if(r++,t=s.evaluate(e),t&&t instanceof Zr&&!t.available&&(i||(i=t.name),t=null,r===this.args.length&&(t=i)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function mh(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function d1(n,e,t){return e===t}function p1(n,e,t){return e!==t}function g1(n,e,t){return e<t}function m1(n,e,t){return e>t}function y1(n,e,t){return e<=t}function _1(n,e,t){return e>=t}function _p(n,e,t,r){return r.compare(e,t)===0}function b1(n,e,t,r){return!_p(n,e,t,r)}function x1(n,e,t,r){return r.compare(e,t)<0}function E1(n,e,t,r){return r.compare(e,t)>0}function w1(n,e,t,r){return r.compare(e,t)<=0}function v1(n,e,t,r){return r.compare(e,t)>=0}function ti(n,e,t){const r=n!=="=="&&n!=="!=";return class bp{constructor(s,o,a){this.type=ne,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let l=o.parse(s[1],1,Q);if(!l)return null;if(!mh(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${Ue(l.type)}'.`);let u=o.parse(s[2],2,Q);if(!u)return null;if(!mh(a,u.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${Ue(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error(`Cannot compare types '${Ue(l.type)}' and '${Ue(u.type)}'.`);r&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new kt(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new kt(l.type,[u])));let c=null;if(s.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(s[3],3,Lo),!c)return null}return new bp(l,u,c)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(r&&this.hasUntypedArgument){const l=We(o),u=We(a);if(l.kind!==u.kind||!(l.kind==="string"||l.kind==="number"))throw new ke(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const l=We(o),u=We(a);if(l.kind!=="string"||u.kind!=="string")return e(s,o,a)}return this.collator?t(s,o,a,this.collator.evaluate(s)):e(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}const T1=ti("==",d1,_p),S1=ti("!=",p1,b1),R1=ti("<",g1,x1),P1=ti(">",m1,E1),A1=ti("<=",y1,w1),I1=ti(">=",_1,v1);class Go{constructor(e,t,r){this.type=Lo,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");const i=t.parse(r["case-sensitive"]===void 0?!1:r["case-sensitive"],1,ne);if(!i)return null;const s=t.parse(r["diacritic-sensitive"]===void 0?!1:r["diacritic-sensitive"],1,ne);if(!s)return null;let o=null;return r.locale&&(o=t.parse(r.locale,1,oe),!o)?null:new Go(i,s,o)}evaluate(e){return new Ru(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Cu{constructor(e,t,r,i,s){this.type=oe,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const r=t.parse(e[1],1,U);if(!r)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=t.parse(i.locale,1,oe),!s))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,oe),!o))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,U),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,U),!l)?null:new Cu(r,s,o,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Fu{constructor(e){this.type=Co,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");const i=[];let s=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,U),!l))return null;let u=null;if(a["text-font"]&&(u=t.parse(a["text-font"],1,Tt(oe)),!u))return null;let c=null;if(a["text-color"]&&(c=t.parse(a["text-color"],1,or),!c))return null;let h=null;if(a["vertical-align"]){if(typeof a["vertical-align"]=="string"&&!o1.includes(a["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${a["vertical-align"]}' instead.`);if(h=t.parse(a["vertical-align"],1,oe),!h)return null}const f=i[i.length-1];f.scale=l,f.font=u,f.textColor=c,f.verticalAlign=h}else{const l=t.parse(e[o],1,Q);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Fu(i)}evaluate(e){const t=r=>{const i=r.content.evaluate(e);return We(i)===ts?new Ka("",i,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new Ka(xi(i),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)};return new _r(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class Mu{constructor(e){this.type=ts,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const r=t.parse(e[1],1,oe);return r?new Mu(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=Zr.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ou{constructor(e){this.type=U,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Ue(r.type)} instead.`):new Ou(r):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new ke(`Expected value to be of type string or array, but found ${Ue(We(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ur=8192;function L1(n,e){const t=C1(n[0]),r=M1(n[1]),i=Math.pow(2,e.z);return[Math.round(t*i*ur),Math.round(r*i*ur)]}function Nu(n,e){const t=Math.pow(2,e.z),r=(n[0]/ur+e.x)/t,i=(n[1]/ur+e.y)/t;return[F1(r),O1(i)]}function C1(n){return(180+n)/360}function F1(n){return n*360-180}function M1(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function O1(n){return 360/Math.PI*Math.atan(Math.exp((180-n*360)*Math.PI/180))-90}function rs(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Bi(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function N1(n,e,t){return e[1]>n[1]!=t[1]>n[1]&&n[0]<(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1])+e[0]}function D1(n,e,t){const r=n[0]-e[0],i=n[1]-e[1],s=n[0]-t[0],o=n[1]-t[1];return r*o-s*i===0&&r*s<=0&&i*o<=0}function zo(n,e,t,r){const i=[e[0]-n[0],e[1]-n[1]],s=[r[0]-t[0],r[1]-t[1]];return z1(s,i)===0?!1:!!(yh(n,e,t,r)&&yh(t,r,n,e))}function U1(n,e,t){for(const r of t)for(let i=0;i<r.length-1;++i)if(zo(n,e,r[i],r[i+1]))return!0;return!1}function ri(n,e,t=!1){let r=!1;for(const i of e)for(let s=0;s<i.length-1;s++){if(D1(n,i[s],i[s+1]))return t;N1(n,i[s],i[s+1])&&(r=!r)}return r}function B1(n,e){for(const t of e)if(ri(n,t))return!0;return!1}function xp(n,e){for(const t of n)if(!ri(t,e))return!1;for(let t=0;t<n.length-1;++t)if(U1(n[t],n[t+1],e))return!1;return!0}function G1(n,e){for(const t of e)if(xp(n,t))return!0;return!1}function z1(n,e){return n[0]*e[1]-n[1]*e[0]}function yh(n,e,t,r){const i=n[0]-t[0],s=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],l=r[0]-t[0],u=r[1]-t[1],c=i*u-l*s,h=o*u-l*a;return c>0&&h<0||c<0&&h>0}function Du(n,e,t){const r=[];for(let i=0;i<n.length;i++){const s=[];for(let o=0;o<n[i].length;o++){const a=L1(n[i][o],t);rs(e,a),s.push(a)}r.push(s)}return r}function Ep(n,e,t){const r=[];for(let i=0;i<n.length;i++){const s=Du(n[i],e,t);r.push(s)}return r}function wp(n,e,t,r){if(n[0]<t[0]||n[0]>t[2]){const i=r*.5;let s=n[0]-t[0]>i?-r:t[0]-n[0]>i?r:0;s===0&&(s=n[0]-t[2]>i?-r:t[2]-n[0]>i?r:0),n[0]+=s}rs(e,n)}function k1(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function _h(n,e,t,r){const i=Math.pow(2,r.z)*ur,s=[r.x*ur,r.y*ur],o=[];for(const a of n)for(const l of a){const u=[l.x+s[0],l.y+s[1]];wp(u,e,t,i),o.push(u)}return o}function bh(n,e,t,r){const i=Math.pow(2,r.z)*ur,s=[r.x*ur,r.y*ur],o=[];for(const a of n){const l=[];for(const u of a){const c=[u.x+s[0],u.y+s[1]];rs(e,c),l.push(c)}o.push(l)}if(e[2]-e[0]<=i/2){k1(e);for(const a of o)for(const l of a)wp(l,e,t,i)}return o}function $1(n,e){const t=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(e.type==="Polygon"){const s=Du(e.coordinates,r,i),o=_h(n.geometry(),t,r,i);if(!Bi(t,r))return!1;for(const a of o)if(!ri(a,s))return!1}if(e.type==="MultiPolygon"){const s=Ep(e.coordinates,r,i),o=_h(n.geometry(),t,r,i);if(!Bi(t,r))return!1;for(const a of o)if(!B1(a,s))return!1}return!0}function j1(n,e){const t=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(e.type==="Polygon"){const s=Du(e.coordinates,r,i),o=bh(n.geometry(),t,r,i);if(!Bi(t,r))return!1;for(const a of o)if(!xp(a,s))return!1}if(e.type==="MultiPolygon"){const s=Ep(e.coordinates,r,i),o=bh(n.geometry(),t,r,i);if(!Bi(t,r))return!1;for(const a of o)if(!G1(a,s))return!1}return!0}class on{constructor(e,t){this.type=ne,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Di(e[1])){const r=e[1];if(r.type==="FeatureCollection"){const i=[];for(const s of r.features){const{type:o,coordinates:a}=s.geometry;o==="Polygon"&&i.push(a),o==="MultiPolygon"&&i.push(...a)}if(i.length){const s={type:"MultiPolygon",coordinates:i};return new on(r,s)}}else if(r.type==="Feature"){const i=r.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new on(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new on(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return $1(e,this.geometries);if(e.geometryType()==="LineString")return j1(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class vp{constructor(e=[],t=(r,i)=>r<i?-1:r>i?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,i=t[e];for(;e>0;){const s=e-1>>1,o=t[s];if(r(i,o)>=0)break;t[e]=o,e=s}t[e]=i}_down(e){const{data:t,compare:r}=this,i=this.length>>1,s=t[e];for(;e<i;){let o=(e<<1)+1;const a=o+1;if(a<this.length&&r(t[a],t[o])<0&&(o=a),r(t[o],s)>=0)break;t[e]=t[o],e=o}t[e]=s}}function V1(n,e){if(n.length<=1)return[n];const r=[];let i,s;for(const o of n){const a=X1(o);a!==0&&(o.area=Math.abs(a),s===void 0&&(s=a<0),s===a<0?(i&&r.push(i),i=[o]):i.push(o))}return i&&r.push(i),r}function X1(n){let e=0;for(let t=0,r=n.length,i=r-1,s,o;t<r;i=t++)s=n[t],o=n[i],e+=(o.x-s.x)*(s.y+o.y);return e}const W1=6378.137,xh=1/298.257223563,Eh=xh*(2-xh),wh=Math.PI/180;class Uu{constructor(e){const t=wh*W1*1e3,r=Math.cos(e*wh),i=1/(1-Eh*(1-r*r)),s=Math.sqrt(i);this.kx=t*s*r,this.ky=t*s*i*(1-Eh)}distance(e,t){const r=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+i*i)}pointOnLine(e,t){let r=1/0,i,s,o,a;for(let l=0;l<e.length-1;l++){let u=e[l][0],c=e[l][1],h=this.wrap(e[l+1][0]-u)*this.kx,f=(e[l+1][1]-c)*this.ky,p=0;(h!==0||f!==0)&&(p=(this.wrap(t[0]-u)*this.kx*h+(t[1]-c)*this.ky*f)/(h*h+f*f),p>1?(u=e[l+1][0],c=e[l+1][1]):p>0&&(u+=h/this.kx*p,c+=f/this.ky*p)),h=this.wrap(t[0]-u)*this.kx,f=(t[1]-c)*this.ky;const d=h*h+f*f;d<r&&(r=d,i=u,s=c,o=l,a=p)}return{point:[i,s],index:o,t:Math.max(0,Math.min(1,a))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const Ja=100,Qa=50;function Tp(n,e){return e[0]-n[0]}function Hs(n){return n[1]-n[0]+1}function wr(n,e){return n[1]>=n[0]&&n[1]<e}function el(n,e){if(n[0]>n[1])return[null,null];const t=Hs(n);if(e){if(t===2)return[n,null];const i=Math.floor(t/2);return[[n[0],n[0]+i],[n[0]+i,n[1]]]}if(t===1)return[n,null];const r=Math.floor(t/2)-1;return[[n[0],n[0]+r],[n[0]+r+1,n[1]]]}function tl(n,e){if(!wr(e,n.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let r=e[0];r<=e[1];++r)rs(t,n[r]);return t}function rl(n){const e=[1/0,1/0,-1/0,-1/0];for(const t of n)for(const r of t)rs(e,r);return e}function vh(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Bu(n,e,t){if(!vh(n)||!vh(e))return NaN;let r=0,i=0;return n[2]<e[0]&&(r=e[0]-n[2]),n[0]>e[2]&&(r=n[0]-e[2]),n[1]>e[3]&&(i=n[1]-e[3]),n[3]<e[1]&&(i=e[1]-n[3]),t.distance([0,0],[r,i])}function tn(n,e,t){const r=t.pointOnLine(e,n);return t.distance(n,r.point)}function Gu(n,e,t,r,i){const s=Math.min(tn(n,[t,r],i),tn(e,[t,r],i)),o=Math.min(tn(t,[n,e],i),tn(r,[n,e],i));return Math.min(s,o)}function Z1(n,e,t,r,i){if(!(wr(e,n.length)&&wr(r,t.length)))return 1/0;let o=1/0;for(let a=e[0];a<e[1];++a){const l=n[a],u=n[a+1];for(let c=r[0];c<r[1];++c){const h=t[c],f=t[c+1];if(zo(l,u,h,f))return 0;o=Math.min(o,Gu(l,u,h,f,i))}}return o}function q1(n,e,t,r,i){if(!(wr(e,n.length)&&wr(r,t.length)))return NaN;let o=1/0;for(let a=e[0];a<=e[1];++a)for(let l=r[0];l<=r[1];++l)if(o=Math.min(o,i.distance(n[a],t[l])),o===0)return o;return o}function H1(n,e,t){if(ri(n,e,!0))return 0;let r=1/0;for(const i of e){const s=i[0],o=i[i.length-1];if(s!==o&&(r=Math.min(r,tn(n,[o,s],t)),r===0))return r;const a=t.pointOnLine(i,n);if(r=Math.min(r,t.distance(n,a.point)),r===0)return r}return r}function Y1(n,e,t,r){if(!wr(e,n.length))return NaN;for(let s=e[0];s<=e[1];++s)if(ri(n[s],t,!0))return 0;let i=1/0;for(let s=e[0];s<e[1];++s){const o=n[s],a=n[s+1];for(const l of t)for(let u=0,c=l.length,h=c-1;u<c;h=u++){const f=l[h],p=l[u];if(zo(o,a,f,p))return 0;i=Math.min(i,Gu(o,a,f,p,r))}}return i}function Th(n,e){for(const t of n)for(const r of t)if(ri(r,e,!0))return!0;return!1}function K1(n,e,t,r=1/0){const i=rl(n),s=rl(e);if(r!==1/0&&Bu(i,s,t)>=r)return r;if(Bi(i,s)){if(Th(n,e))return 0}else if(Th(e,n))return 0;let o=1/0;for(const a of n)for(let l=0,u=a.length,c=u-1;l<u;c=l++){const h=a[c],f=a[l];for(const p of e)for(let d=0,g=p.length,m=g-1;d<g;m=d++){const y=p[m],_=p[d];if(zo(h,f,y,_))return 0;o=Math.min(o,Gu(h,f,y,_,t))}}return o}function Sh(n,e,t,r,i,s){if(!s)return;const o=Bu(tl(r,s),i,t);o<e&&n.push([o,s,[0,0]])}function gs(n,e,t,r,i,s,o){if(!s||!o)return;const a=Bu(tl(r,s),tl(i,o),t);a<e&&n.push([a,s,o])}function Ys(n,e,t,r,i=1/0){let s=Math.min(r.distance(n[0],t[0][0]),i);if(s===0)return s;const o=new vp([[0,[0,n.length-1],[0,0]]],Tp),a=rl(t);for(;o.length>0;){const l=o.pop();if(l[0]>=s)continue;const u=l[1],c=e?Qa:Ja;if(Hs(u)<=c){if(!wr(u,n.length))return NaN;if(e){const h=Y1(n,u,t,r);if(isNaN(h)||h===0)return h;s=Math.min(s,h)}else for(let h=u[0];h<=u[1];++h){const f=H1(n[h],t,r);if(s=Math.min(s,f),s===0)return 0}}else{const h=el(u,e);Sh(o,s,r,n,a,h[0]),Sh(o,s,r,n,a,h[1])}}return s}function Ks(n,e,t,r,i,s=1/0){let o=Math.min(s,i.distance(n[0],t[0]));if(o===0)return o;const a=new vp([[0,[0,n.length-1],[0,t.length-1]]],Tp);for(;a.length>0;){const l=a.pop();if(l[0]>=o)continue;const u=l[1],c=l[2],h=e?Qa:Ja,f=r?Qa:Ja;if(Hs(u)<=h&&Hs(c)<=f){if(!wr(u,n.length)&&wr(c,t.length))return NaN;let p;if(e&&r)p=Z1(n,u,t,c,i),o=Math.min(o,p);else if(e&&!r){const d=n.slice(u[0],u[1]+1);for(let g=c[0];g<=c[1];++g)if(p=tn(t[g],d,i),o=Math.min(o,p),o===0)return o}else if(!e&&r){const d=t.slice(c[0],c[1]+1);for(let g=u[0];g<=u[1];++g)if(p=tn(n[g],d,i),o=Math.min(o,p),o===0)return o}else p=q1(n,u,t,c,i),o=Math.min(o,p)}else{const p=el(u,e),d=el(c,r);gs(a,o,i,n,t,p[0],d[0]),gs(a,o,i,n,t,p[0],d[1]),gs(a,o,i,n,t,p[1],d[0]),gs(a,o,i,n,t,p[1],d[1])}}return o}function J1(n,e){const t=n.geometry(),r=t.flat().map(o=>Nu([o.x,o.y],n.canonical));if(t.length===0)return NaN;const i=new Uu(r[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,Ks(r,!1,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,Ks(r,!1,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Ys(r,!1,o.coordinates,i,s));break}if(s===0)return s}return s}function Q1(n,e){const t=n.geometry(),r=t.flat().map(o=>Nu([o.x,o.y],n.canonical));if(t.length===0)return NaN;const i=new Uu(r[0][1]);let s=1/0;for(const o of e){switch(o.type){case"Point":s=Math.min(s,Ks(r,!0,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,Ks(r,!0,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Ys(r,!0,o.coordinates,i,s));break}if(s===0)return s}return s}function eT(n,e){const t=n.geometry();if(t.length===0||t[0].length===0)return NaN;const r=V1(t).map(o=>o.map(a=>a.map(l=>Nu([l.x,l.y],n.canonical)))),i=new Uu(r[0][0][0][1]);let s=1/0;for(const o of e)for(const a of r){switch(o.type){case"Point":s=Math.min(s,Ys([o.coordinates],!1,a,i,s));break;case"LineString":s=Math.min(s,Ys(o.coordinates,!0,a,i,s));break;case"Polygon":s=Math.min(s,K1(a,o.coordinates,i,s));break}if(s===0)return s}return s}function ya(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class an{constructor(e,t){this.type=U,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Di(e[1])){const r=e[1];if(r.type==="FeatureCollection")return new an(r,r.features.map(i=>ya(i.geometry)).flat());if(r.type==="Feature")return new an(r,ya(r.geometry));if("type"in r&&"coordinates"in r)return new an(r,ya(r))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return J1(e,this.geometries);if(e.geometryType()==="LineString")return Q1(e,this.geometries);if(e.geometryType()==="Polygon")return eT(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ns{constructor(e){this.type=Q,this.key=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=e[1];return r==null?t.error("Global state property must be defined."):typeof r!="string"?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new ns(r)}evaluate(e){var t;const r=(t=e.globals)===null||t===void 0?void 0:t.globalState;return!r||Object.keys(r).length===0?null:pp(r,this.key)}eachChild(){}outputDefined(){return!1}}const ko={"==":T1,"!=":S1,">":P1,"<":R1,">=":I1,"<=":A1,array:kt,at:Pu,boolean:kt,case:Lu,coalesce:Ui,collator:Go,format:Fu,image:Mu,in:Au,"index-of":Zs,interpolate:lr,"interpolate-hcl":lr,"interpolate-lab":lr,length:Ou,let:Do,literal:jn,match:Iu,number:kt,"number-format":Cu,object:kt,slice:qs,step:Bo,string:kt,"to-boolean":Dr,"to-color":Dr,"to-number":Dr,"to-string":Dr,var:Uo,within:on,distance:an,"global-state":ns};class Rt{constructor(e,t,r,i){this.name=e,this.type=t,this._evaluate=r,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const r=e[0],i=Rt.definitions[r];if(!i)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=o.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,c]of a){l=new No(t.registry,Js,t.path,null,t.scope);const h=[];let f=!1;for(let p=1;p<e.length;p++){const d=e[p],g=Array.isArray(u)?u[p-1]:u.type,m=l.parse(d,1+h.length,g);if(!m){f=!0;break}h.push(m)}if(!f){if(Array.isArray(u)&&u.length!==h.length){l.error(`Expected ${u.length} arguments, but found ${h.length} instead.`);continue}for(let p=0;p<h.length;p++){const d=Array.isArray(u)?u[p]:u.type,g=h[p];l.concat(p+1).checkSubtype(d,g.type)}if(l.errors.length===0)return new Rt(r,s,c,h)}}if(a.length===1)t.errors.push(...l.errors);else{const c=(a.length?a:o).map(([f])=>rT(f)).join(" | "),h=[];for(let f=1;f<e.length;f++){const p=t.parse(e[f],1+h.length);if(!p)return null;h.push(Ue(p.type))}t.error(`Expected arguments of type ${c}, but found (${h.join(", ")}) instead.`)}return null}static register(e,t){Rt.definitions=t;for(const r in t)e[r]=Rt}}function Rh(n,[e,t,r,i]){e=e.evaluate(n),t=t.evaluate(n),r=r.evaluate(n);const s=i?i.evaluate(n):1,o=gp(e,t,r,s);if(o)throw new ke(o);return new ve(e/255,t/255,r/255,s,!1)}function Ph(n,e){return n in e}function _a(n,e){const t=e[n];return typeof t>"u"?null:t}function tT(n,e,t,r){for(;t<=r;){const i=t+r>>1;if(e[i]===n)return!0;e[i]>n?r=i-1:t=i+1}return!1}function Hr(n){return{type:n}}Rt.register(ko,{error:[Hv,[oe],(n,[e])=>{throw new ke(e.evaluate(n))}],typeof:[oe,[Q],(n,[e])=>Ue(We(e.evaluate(n)))],"to-rgba":[Tt(U,4),[or],(n,[e])=>{const[t,r,i,s]=e.evaluate(n).rgb;return[t*255,r*255,i*255,s]}],rgb:[or,[U,U,U],Rh],rgba:[or,[U,U,U,U],Rh],has:{type:ne,overloads:[[[oe],(n,[e])=>Ph(e.evaluate(n),n.properties())],[[oe,rn],(n,[e,t])=>Ph(e.evaluate(n),t.evaluate(n))]]},get:{type:Q,overloads:[[[oe],(n,[e])=>_a(e.evaluate(n),n.properties())],[[oe,rn],(n,[e,t])=>_a(e.evaluate(n),t.evaluate(n))]]},"feature-state":[Q,[oe],(n,[e])=>_a(e.evaluate(n),n.featureState||{})],properties:[rn,[],n=>n.properties()],"geometry-type":[oe,[],n=>n.geometryType()],id:[Q,[],n=>n.id()],zoom:[U,[],n=>n.globals.zoom],"heatmap-density":[U,[],n=>n.globals.heatmapDensity||0],elevation:[U,[],n=>n.globals.elevation||0],"line-progress":[U,[],n=>n.globals.lineProgress||0],accumulated:[Q,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[U,Hr(U),(n,e)=>{let t=0;for(const r of e)t+=r.evaluate(n);return t}],"*":[U,Hr(U),(n,e)=>{let t=1;for(const r of e)t*=r.evaluate(n);return t}],"-":{type:U,overloads:[[[U,U],(n,[e,t])=>e.evaluate(n)-t.evaluate(n)],[[U],(n,[e])=>-e.evaluate(n)]]},"/":[U,[U,U],(n,[e,t])=>e.evaluate(n)/t.evaluate(n)],"%":[U,[U,U],(n,[e,t])=>e.evaluate(n)%t.evaluate(n)],ln2:[U,[],()=>Math.LN2],pi:[U,[],()=>Math.PI],e:[U,[],()=>Math.E],"^":[U,[U,U],(n,[e,t])=>Math.pow(e.evaluate(n),t.evaluate(n))],sqrt:[U,[U],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[U,[U],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[U,[U],(n,[e])=>Math.log(e.evaluate(n))],log2:[U,[U],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[U,[U],(n,[e])=>Math.sin(e.evaluate(n))],cos:[U,[U],(n,[e])=>Math.cos(e.evaluate(n))],tan:[U,[U],(n,[e])=>Math.tan(e.evaluate(n))],asin:[U,[U],(n,[e])=>Math.asin(e.evaluate(n))],acos:[U,[U],(n,[e])=>Math.acos(e.evaluate(n))],atan:[U,[U],(n,[e])=>Math.atan(e.evaluate(n))],min:[U,Hr(U),(n,e)=>Math.min(...e.map(t=>t.evaluate(n)))],max:[U,Hr(U),(n,e)=>Math.max(...e.map(t=>t.evaluate(n)))],abs:[U,[U],(n,[e])=>Math.abs(e.evaluate(n))],round:[U,[U],(n,[e])=>{const t=e.evaluate(n);return t<0?-Math.round(-t):Math.round(t)}],floor:[U,[U],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[U,[U],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[ne,[oe,Q],(n,[e,t])=>n.properties()[e.value]===t.value],"filter-id-==":[ne,[Q],(n,[e])=>n.id()===e.value],"filter-type-==":[ne,[oe],(n,[e])=>n.geometryType()===e.value],"filter-<":[ne,[oe,Q],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r<i}],"filter-id-<":[ne,[Q],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t<r}],"filter->":[ne,[oe,Q],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r>i}],"filter-id->":[ne,[Q],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t>r}],"filter-<=":[ne,[oe,Q],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[ne,[Q],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t<=r}],"filter->=":[ne,[oe,Q],(n,[e,t])=>{const r=n.properties()[e.value],i=t.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[ne,[Q],(n,[e])=>{const t=n.id(),r=e.value;return typeof t==typeof r&&t>=r}],"filter-has":[ne,[Q],(n,[e])=>e.value in n.properties()],"filter-has-id":[ne,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ne,[Tt(oe)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[ne,[Tt(Q)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[ne,[oe,Tt(Q)],(n,[e,t])=>t.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[ne,[oe,Tt(Q)],(n,[e,t])=>tT(n.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ne,overloads:[[[ne,ne],(n,[e,t])=>e.evaluate(n)&&t.evaluate(n)],[Hr(ne),(n,e)=>{for(const t of e)if(!t.evaluate(n))return!1;return!0}]]},any:{type:ne,overloads:[[[ne,ne],(n,[e,t])=>e.evaluate(n)||t.evaluate(n)],[Hr(ne),(n,e)=>{for(const t of e)if(t.evaluate(n))return!0;return!1}]]},"!":[ne,[ne],(n,[e])=>!e.evaluate(n)],"is-supported-script":[ne,[oe],(n,[e])=>{const t=n.globals&&n.globals.isSupportedScript;return t?t(e.evaluate(n)):!0}],upcase:[oe,[oe],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[oe,[oe],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[oe,Hr(Q),(n,e)=>e.map(t=>xi(t.evaluate(n))).join("")],"resolved-locale":[oe,[Lo],(n,[e])=>e.evaluate(n).resolvedLocale()]});function rT(n){return Array.isArray(n)?`(${n.map(Ue).join(", ")})`:`(${Ue(n.type)}...)`}function Js(n){if(n instanceof Uo)return Js(n.boundExpression);if(n instanceof Rt&&n.name==="error")return!1;if(n instanceof Go)return!1;if(n instanceof on)return!1;if(n instanceof an)return!1;if(n instanceof ns)return!1;const e=n instanceof Dr||n instanceof kt;let t=!0;return n.eachChild(r=>{e?t=t&&Js(r):t=t&&r instanceof jn}),t?zu(n)&&$u(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function zu(n){if(n instanceof Rt){if(n.name==="get"&&n.args.length===1)return!1;if(n.name==="feature-state")return!1;if(n.name==="has"&&n.args.length===1)return!1;if(n.name==="properties"||n.name==="geometry-type"||n.name==="id")return!1;if(/^filter-/.test(n.name))return!1}if(n instanceof on||n instanceof an)return!1;let e=!0;return n.eachChild(t=>{e&&!zu(t)&&(e=!1)}),e}function ku(n){if(n instanceof Rt&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(t=>{e&&!ku(t)&&(e=!1)}),e}function $u(n,e){if(n instanceof Rt&&e.indexOf(n.name)>=0)return!1;let t=!0;return n.eachChild(r=>{t&&!$u(r,e)&&(t=!1)}),t}function nl(n){return{result:"success",value:n}}function An(n){return{result:"error",value:n}}function nT(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function iT(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function sT(n){return!!n.expression&&n.expression.interpolated}function Sp(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&We(n)===rn}class oT{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new mp,this._defaultValue=t?cT(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,i,s,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null;try{const a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!==a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ke(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}}function aT(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in ko}function Rp(n,e){const t=new No(ko,Js,[],e?uT(e):void 0),r=t.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?nl(new oT(r,e)):An(t.errors)}class Ah{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ku(t.expression),this.globalStateRefs=$o(t.expression)}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,s,o)}evaluate(e,t,r,i,s,o){return this._styleExpression.evaluate(e,t,r,i,s,o)}}class Ih{constructor(e,t,r,i){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ku(t.expression),this.globalStateRefs=$o(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,r,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,s,o)}evaluate(e,t,r,i,s,o){return this._styleExpression.evaluate(e,t,r,i,s,o)}interpolationFactor(e,t,r){return this.interpolationType?lr.interpolationFactor(this.interpolationType,e,t,r):0}}function lT(n,e){const t=Rp(n,e);if(t.result==="error")return t;const r=t.value.expression,i=zu(r);if(!i&&!nT(e))return An([new nr("","data expressions not supported")]);const s=$u(r,["zoom"]);if(!s&&!iT(e))return An([new nr("","zoom expressions not supported")]);const o=ws(r);if(!o&&!s)return An([new nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof nr)return An([o]);if(o instanceof lr&&!sT(e))return An([new nr("",'"interpolate" expressions cannot be used with this property')]);if(!o)return nl(i?new Ah("constant",t.value):new Ah("source",t.value));const a=o instanceof lr?o.interpolation:void 0;return nl(i?new Ih("camera",t.value,o.labels,a):new Ih("composite",t.value,o.labels,a))}function ws(n){let e=null;if(n instanceof Do)e=ws(n.result);else if(n instanceof Ui){for(const t of n.args)if(e=ws(t),e)break}else(n instanceof Bo||n instanceof lr)&&n.input instanceof Rt&&n.input.name==="zoom"&&(e=n);return e instanceof nr||n.eachChild(t=>{const r=ws(t);r instanceof nr?e=r:!e&&r?e=new nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new nr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function $o(n,e=new Set){return n instanceof ns&&e.add(n.key),n.eachChild(t=>{$o(t,e)}),e}function uT(n){const e={color:or,string:oe,number:U,enum:oe,boolean:ne,formatted:Co,padding:Fo,numberArray:Mo,colorArray:Mi,projectionDefinition:Io,resolvedImage:ts,variableAnchorOffsetCollection:Oo};return n.type==="array"?Tt(e[n.value]||Q,n.length):e[n.type]}function cT(n){if(n.type==="color"&&Sp(n.default))return new ve(0,0,0,0);switch(n.type){case"color":return ve.parse(n.default)||null;case"padding":return Vt.parse(n.default)||null;case"numberArray":return Xt.parse(n.default)||null;case"colorArray":return St.parse(n.default)||null;case"variableAnchorOffsetCollection":return ar.parse(n.default)||null;case"projectionDefinition":return zt.parse(n.default)||null;default:return n.default===void 0?null:n.default}}function Pp(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Pp(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const hT={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fT(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Pp(n)||(n=Qs(n));const e=Rp(n,hT);if(e.result==="error")throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));{const t=Ap(n);return{filter:(r,i,s)=>e.value.evaluate(r,i,{},s),needGeometry:t,getGlobalStateRefs:()=>$o(e.value.expression)}}}function dT(n,e){return n<e?-1:n>e?1:0}function Ap(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Ap(n[e]))return!0;return!1}function Qs(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?ba(n[1],n[2],"=="):e==="!="?ms(ba(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ba(n[1],n[2],e):e==="any"?pT(n.slice(1)):e==="all"?["all"].concat(n.slice(1).map(Qs)):e==="none"?["all"].concat(n.slice(1).map(Qs).map(ms)):e==="in"?Lh(n[1],n.slice(2)):e==="!in"?ms(Lh(n[1],n.slice(2))):e==="has"?Ch(n[1]):e==="!has"?ms(Ch(n[1])):!0}function ba(n,e,t){switch(n){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,n,e]}}function pT(n){return["any"].concat(n.map(Qs))}function Lh(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",n,["literal",e.sort(dT)]]:["filter-in-small",n,["literal",e]]}}function Ch(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ms(n){return["!",n]}function Gi(n){return typeof n=="object"?["literal",n]:n}function gT(n,e){let t=n.stops;if(!t)return mT(n,e);const r=t&&typeof t[0][0]=="object",i=r||n.property!==void 0,s=r||!i;return t=t.map(o=>!i&&e.tokens&&typeof o[1]=="string"?[o[0],xT(o[1])]:[o[0],Gi(o[1])]),r?yT(n,e,t):s?bT(n,e,t):il(n,e,t)}function mT(n,e){const t=["get",n.property];if(n.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,n.default];{const r=[e.type==="color"?"to-color":e.type,t,Gi(n.default)];return e.type==="array"&&r.splice(1,0,e.value,e.length||null),r}}function ju(n){switch(n.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function yT(n,e,t){const r={},i={},s=[];for(let a=0;a<t.length;a++){const l=t[a],u=l[0].zoom;r[u]===void 0&&(r[u]={zoom:u,type:n.type,property:n.property,default:n.default},i[u]=[],s.push(u)),i[u].push([l[0].value,l[1]])}if(Xu({},e)==="exponential"){const a=[ju(n),["linear"],["zoom"]];for(const l of s){const u=il(r[l],e,i[l]);Nn(a,l,u,!1)}return a}else{const a=["step",["zoom"]];for(const l of s){const u=il(r[l],e,i[l]);Nn(a,l,u,!0)}return Vu(a),a}}function _T(n,e){if(n!==void 0)return n;if(e!==void 0)return e}function Fh(n,e){const t=Gi(_T(n.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function il(n,e,t){const r=Xu(n,e),i=["get",n.property];if(r==="categorical"&&typeof t[0][0]=="boolean"){const s=["case"];for(const o of t)s.push(["==",i,o[0]],o[1]);return s.push(Fh(n,e)),s}else if(r==="categorical"){const s=["match",i];for(const o of t)Nn(s,o[0],o[1],!1);return s.push(Fh(n,e)),s}else if(r==="interval"){const s=["step",["number",i]];for(const o of t)Nn(s,o[0],o[1],!0);return Vu(s),n.default===void 0?s:["case",["==",["typeof",i],"number"],s,Gi(n.default)]}else if(r==="exponential"){const s=n.base!==void 0?n.base:1,o=[ju(n),s===1?["linear"]:["exponential",s],["number",i]];for(const a of t)Nn(o,a[0],a[1],!1);return n.default===void 0?o:["case",["==",["typeof",i],"number"],o,Gi(n.default)]}else throw new Error(`Unknown property function type ${r}`)}function bT(n,e,t,r=["zoom"]){const i=Xu(n,e);let s,o=!1;if(i==="interval")s=["step",r],o=!0;else if(i==="exponential"){const a=n.base!==void 0?n.base:1;s=[ju(n),a===1?["linear"]:["exponential",a],r]}else throw new Error(`Unknown zoom function type "${i}"`);for(const a of t)Nn(s,a[0],a[1],o);return Vu(s),s}function Vu(n){n[0]==="step"&&n.length===3&&(n.push(0),n.push(n[3]))}function Nn(n,e,t,r){n.length>3&&e===n[n.length-2]||(r&&n.length===2||n.push(e),n.push(t))}function Xu(n,e){return n.type?n.type:e.expression.interpolated?"exponential":"interval"}function xT(n){const e=["concat"],t=/{([^{}]+)}/g;let r=0;for(let i=t.exec(n);i!==null;i=t.exec(n)){const s=n.slice(r,t.lastIndex-i[0].length);r=t.lastIndex,s.length>0&&e.push(s),e.push(["get",i[1]])}if(e.length===1)return n;if(r<n.length)e.push(n.slice(r));else if(e.length===2)return["to-string",e[1]];return e}const ET=Wv;var Mh={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},ui=" ",Oh=/(italic|oblique)$/i,Nh={};function sl(n,e,t){var r=Nh[n];if(!r){Array.isArray(n)||(n=[n]);for(var i=400,s="normal",o=[],a,l,u=0,c=n.length;u<c;++u){var h=n[u],f=h.split(" "),p=f[f.length-1].toLowerCase();p=="normal"||p=="italic"||p=="oblique"?(s=l?s:p,l=!0,f.pop(),p=f[f.length-1].toLowerCase()):Oh.test(p)&&(p=p.replace(Oh,""),s=l?s:f[f.length-1].replace(p,""),l=!0);for(var d in Mh){var g=f.length>1?f[f.length-2].toLowerCase():"";if(p==d||p==d.replace("-","")||g+"-"+p==d){i=a?i:Mh[d],f.pop(),g&&d.startsWith(g)&&f.pop();break}}!a&&typeof p=="number"&&(i=p,a=!0);var m=f.join(ui).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");m.indexOf(ui)!==-1&&(m='"'+m+'"'),o.push(m)}r=Nh[n]=[s,i,o]}return r[0]+ui+r[1]+ui+e+"px"+(t?"/"+t:"")+ui+r[2]}const Ip="https://api.mapbox.com";function Wu(n){const e="mapbox://";return n.indexOf(e)!==0?"":n.slice(e.length)}function wT(n,e,t){if(typeof n=="string")return[{id:"default",url:Dh(n,e,t)}];for(const r of n)r.url=Dh(r.url,e,t);return n}function Dh(n,e,t){const r=Wu(n);if(!r)return decodeURI(new URL(n,t).href);const i="sprites/";if(r.indexOf(i)!==0)throw new Error(`unexpected sprites url: ${n}`);const s=r.slice(i.length);return`${Ip}/styles/v1/${s}/sprite?access_token=${e}`}function eo(n,e){const t=Wu(n);if(!t)return decodeURI(new URL(n,location.href).href);const r="styles/";if(t.indexOf(r)!==0)throw new Error(`unexpected style url: ${n}`);const i=t.slice(r.length);return`${Ip}/styles/v1/${i}?&access_token=${e}`}const vT=["a","b","c","d"];function vs(n,e,t,r){const i=new URL(n,r||location.href),s=Wu(n);if(!s)return e?(i.searchParams.has(t)||i.searchParams.set(t,e),[decodeURI(i.href)]):[decodeURI(i.href)];if(s==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return[`https://api.mapbox.com/v4/${s}/{z}/{x}/{y}${o}.webp?access_token=${e}`]}return vT.map(o=>`https://${o}.tiles.mapbox.com/v4/${s}/{z}/{x}/{y}.vector.pbf?access_token=${e}`)}const $t=Object.freeze({}),Uh={},Bh={};let TT=0;function Zu(n){return n.id||(n.id=TT++),n.id}function ST(n,e){return Zu(n)+"."+me(e)}function Lp(n){let e=Uh[n.id];return e||(e={},Uh[Zu(n)]=e),e}function RT(n){let e=Bh[n.id];return e||(e={},Bh[Zu(n)]=e),e}function xa(n){return n*Math.PI/180}const cr=function(){const n=[];for(let e=78271.51696402048;n.length<=24;e/=2)n.push(e);return n}();function jo(n,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(n,e);const t=document.createElement("canvas");return t.width=n,t.height=e,t}function qu(n,e){let t=0;const r=e.length;for(;t<r;++t)if(e[t]<n&&t+1<r){const s=e[t]/e[t+1];return t+Math.log(e[t]/n)/Math.log(s)}return r-1}function pi(n,e){const t=Math.floor(n),r=Math.pow(2,n-t);return e[t]/r}const wn={};function Vn(n,e,t={},r){if(e in wn)return r&&(r.url=wn[e][0].url),wn[e][1];const i=t.transformRequest&&t.transformRequest(e,n)||e,s=function(l){return delete wn[e],Promise.reject(new Error("Error fetching source "+e))},o=function(l){return delete wn[e],l.ok?l.json():Promise.reject(new Error("Error fetching source "+e))},a=Pi(()=>i).then(l=>l instanceof Response?(r&&(r.url=l.url),o(l)):(l instanceof Request||(l=new Request(l)),l.headers.get("Accept")||l.headers.set("Accept","application/json"),r&&(r.url=l.url),fetch(l).then(o).catch(s))).catch(s);return wn[e]=[i,a],a}function Cp(n,e){if(typeof n=="string")if(n.trim().startsWith("{"))try{const t=JSON.parse(n);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return n=eo(n,e.accessToken),Vn("Style",n,e);else return Promise.resolve(n)}const Gh={};function Fp(n,e,t={}){const r=[e,JSON.stringify(n)].toString();let i=Gh[r];if(!i||t.transformRequest){let s;t.transformRequest&&(s=(a,l)=>{const u=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof dm)a.setLoader((c,h,f)=>{const p=function(d){d.arrayBuffer().then(g=>{const y=a.getFormat().readFeatures(g,{extent:c,featureProjection:f});a.setFeatures(y)})};Pi(()=>u).then(d=>{if(d instanceof Response)return p(d);fetch(d).then(p).catch(g=>a.setState(ee.ERROR))}).catch(d=>a.setState(ee.ERROR))});else{const c=a.getImage();Pi(()=>u).then(h=>{if(typeof h=="string"){c.src=h;return}const f=p=>p.blob().then(d=>{const g=URL.createObjectURL(d);c.addEventListener("load",()=>URL.revokeObjectURL(g)),c.addEventListener("error",()=>URL.revokeObjectURL(g)),c.src=g});if(h instanceof Response)return f(h);fetch(h).then(f).catch(p=>a.setState(ee.ERROR))}).catch(h=>a.setState(ee.ERROR))}});const o=n.url;if(o&&!n.tiles){const a=vs(o,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))i=Promise.resolve({tileJson:Object.assign({},n,{url:void 0,tiles:a}),tileLoadFunction:s});else{const l={};i=Vn("Source",a[0],t,l).then(function(u){return u.tiles=u.tiles.map(function(c){return u.scheme==="tms"&&(c=c.replace("{y}","{-y}")),vs(c,t.accessToken,t.accessTokenParam||"access_token",l.url)[0]}),Promise.resolve({tileJson:u,tileLoadFunction:s})})}}else n.tiles?(n=Object.assign({},n,{tiles:n.tiles.map(function(a){return n.scheme==="tms"&&(a=a.replace("{y}","{-y}")),vs(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)[0]})}),i=Promise.resolve({tileJson:Object.assign({},n),tileLoadFunction:s})):i=Promise.reject(new Error("source has no `tiles` nor `url`"));Gh[r]=i}return i}function zh(n,e,t,r){const i=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height],s=jo(i[0],i[1]),o=s.getContext("2d");o.drawImage(n,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=o.getImageData(0,0,i[0],i[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${r.r*255},${r.g*255},${r.b*255},${r.a})`;const l=a.data;for(let u=0,c=a.width;u<c;++u)for(let h=0,f=a.height;h<f;++h){const p=(h*c+u)*4;l[p+3]>0&&o.arc(u,h,t*e.pixelRatio,0,2*Math.PI)}return o.fill(),s}function PT(n,e,t){const r=Math.max(0,Math.min(1,(t-n)/(e-n)));return r*r*(3-2*r)}function kh(n,e,t){const r=jo(e.width,e.height),i=r.getContext("2d");i.drawImage(n,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),o=s.data;for(let a=0,l=s.width;a<l;++a)for(let u=0,c=s.height;u<c;++u){const h=(u*l+a)*4,f=o[h+3]/255,p=.75,d=.1,g=PT(p-d,p+d,f);g>0?(o[h+0]=Math.round(255*t.r*g),o[h+1]=Math.round(255*t.g*g),o[h+2]=Math.round(255*t.b*g),o[h+3]=Math.round(255*g)):o[h+3]=0}return i.putImageData(s,0,0),r}const AT=Array(256).join("");function ol(n,e){if(e>=.05){let t="";const r=n.split(`
`),i=AT.slice(0,Math.round(e/.1));for(let s=0,o=r.length;s<o;++s)s>0&&(t+=`
`),t+=r[s].split("").join(i);return t}return n}let Ea;function Mp(){return Ea||(Ea=jo(1,1).getContext("2d")),Ea}function Yr(n,e){return Mp().measureText(n).width+(n.length-1)*e}const to={};pm.on("propertychange",()=>{for(const n in to)delete to[n]});function al(n,e,t,r){if(n.indexOf(`
`)!==-1){const o=n.split(`
`),a=[];for(let l=0,u=o.length;l<u;++l)a.push(al(o[l],e,t,r));return a.join(`
`)}const i=t+","+e+","+n+","+r;let s=to[i];if(!s){const o=n.split(" ");if(o.length>1){const a=Mp();a.font=e;const u=a.measureText("M").width*t;let c="";const h=[];for(let f=0,p=o.length;f<p;++f){const d=o[f],g=c+(c?" ":"")+d;Yr(g,r)<=u?c=g:(c&&h.push(c),c=d)}c&&h.push(c);for(let f=0,p=h.length;f<p&&p>1;++f){const d=h[f];if(Yr(d,r)<u*.35){const g=f>0?Yr(h[f-1],r):1/0,m=f<p-1?Yr(h[f+1],r):1/0;h.splice(f,1),p-=1,g<m?(h[f-1]+=" "+d,f-=1):h[f]=d+" "+h[f]}}for(let f=0,p=h.length-1;f<p;++f){const d=h[f],g=h[f+1];if(Yr(d,r)>u*.7&&Yr(g,r)<u*.6){const m=d.split(" "),y=m.pop();Yr(y,r)<u*.2&&(h[f]=m.join(" "),h[f+1]=y+" "+g),p-=1}}s=h.join(`
`)}else s=n;s=ol(s,r),to[i]=s}return s}const IT=["Arial","Courier New","Times New Roman","Verdana","sans-serif","serif","monospace","cursive","fantasy"],$h={};function LT(n,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){if(Xi)return n;let t;for(let r=0,i=n.length;r<i;++r){const s=n[r];if(s in $h)continue;$h[s]=!0;const a=sl(s,16).split(" ");t||(t=[]),t.push([a.slice(3).join(" ").replace(/"/g,""),a[1],a[0]])}return t&&(async()=>{await document.fonts.ready;for(let r=0,i=t.length;r<i;++r){const s=t[r],o=s[0];if(IT.includes(o))continue;const a=s[1],l=s[2];if(!(await document.fonts.load(`${l} ${a} 16px "${o}"`)).some(c=>c.family.replace(/^['"]|['"]$/g,"").toLowerCase()===o.toLowerCase()&&c.weight==a&&c.style===l)){const c=e.replace("{font-family}",o.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",o.replace(/ /g,"+")).replace("{fontweight}",a).replace("{-fontstyle}",l.replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",l);if(!document.querySelector('link[href="'+c+'"]')){const h=document.createElement("link");h.href=c,h.rel="stylesheet",document.head.appendChild(h)}}}})(),n}const CT={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},FT={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},MT=function(n,e){const t=lT(n,e);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return t.value},It={zoom:0,distanceFromCenter:0};Rt.register(ko,{...Rt.definitions,pitch:[{kind:"number"},[],n=>It.pitch||90],"distance-from-center":[{kind:"number"},[],n=>It.distanceFromCenter||0]});let ys,wa;function V(n,e,t,r,i,s){const o=n.id;i||(i={},console.warn("No functionCache provided to getValue()")),i[o]||(i[o]={});const a=i[o];if(!a[t]){let l=(n[e]||$t)[t];const u=ET[`${e}_${n.type}`][t];l===void 0&&(l=u.default);let c=aT(l);if(!c&&Sp(l)&&(l=gT(l,u),c=!0),c){const h=MT(l,u);a[t]=h.evaluate.bind(h)}else u.type=="color"&&(l=ve.parse(l)),a[t]=function(){return l}}return a[t](It,r,s)}function jh(n,e,t,r){return V(n,"layout",`${t}-allow-overlap`,e,r)?V(n,"layout",`${t}-ignore-placement`,e,r)?"none":"obstacle":"declutter"}function OT(n,e,t,r){if(r||console.warn("No filterCache provided to evaluateFilter()"),!(n in r))try{r[n]=fT(e).filter}catch(i){console.warn("Filter will evaluate to false: "+i.message),r[n]=function(){return!1}}return r[n](It,t)}function Lr(n,e){if(n){if(n.a===0||e===0)return;const t=n.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(n.r*255/t)+","+Math.round(n.g*255/t)+","+Math.round(n.b*255/t)+","+t*e+")"}return n}const NT=/\{[^{}}]*\}/g;function va(n,e){return n.replace(NT,function(t){return e[t.slice(1,-1)]||""})}function Vh(n,e){let t=n.split(":")[0];return t===n&&(t="default"),e[t]}const DT={};function UT(n,e,t,r=cr,i=void 0,s=void 0,o=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");DT[ST(e,n)]=Array.from(arguments);const l={};(typeof s=="string"||s instanceof Request||s instanceof Response||s instanceof Promise)&&(s={default:s});for(const x in s){const E=s[x];Pi(()=>E).then(async S=>{let A;if(typeof Image<"u"){const P=new Image;if(typeof S=="string")P.crossOrigin="anonymous",P.src=S;else{let R;S instanceof Request?R=await fetch(S):S instanceof Response&&(R=S);const I=await R.blob();A=URL.createObjectURL(I),P.src=A}P.addEventListener("load",function R(){P.removeEventListener("load",R),l[x]={image:P,size:[P.width,P.height]},n.changed(),A&&URL.revokeObjectURL(A)}),P.addEventListener("error",function R(){URL.revokeObjectURL(A),P.removeEventListener("error",R)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const P=self;P.postMessage({action:"loadImage",src:S}),P.addEventListener("message",function(I){I.data.action==="imageLoaded"&&I.data.src===S&&(l[x]={image:I.data.image,size:[I.data.image.width,I.data.image.height]})})}})}const u=sp(e.layers),c={},h=[],f={},p={},d=Lp(e),g=RT(e);let m;for(let x=0,E=u.length;x<E;++x){const S=u[x],A=S.id;if(typeof t=="string"&&S.source==t||Array.isArray(t)&&t.indexOf(A)!==-1){const P=S["source-layer"];if(m){if(S.source!==m)throw new Error(`Layer "${A}" does not use source "${m}`)}else{m=S.source;const I=e.sources[m];if(!I)throw new Error(`Source "${m}" is not defined`);const G=I.type;if(G!=="vector"&&G!=="geojson")throw new Error(`Source "${m}" is not of type "vector" or "geojson", but "${G}"`)}let R=c[P];R||(R=[],c[P]=R),R.push({layer:S,index:x}),h.push(A)}}const y=new Mr,_=new Or,b=[],w=function(x,E,S){var se,H,Y;const A=((Y=(H=(se=n.getSource)==null?void 0:se.call(n))==null?void 0:H.format_)==null?void 0:Y.layerName_)??"mvt:layer",P=x.getProperties(),R=c[P[A]];if(!R)return;let I=r.indexOf(E);I==-1&&(I=qu(E,r)),It.zoom=I,It.distanceFromCenter=0;const G=x.getGeometry(),$=CT[G.getType()],W=n.get("map");if(W&&W instanceof Ds&&$===1){const le=W.getSize();if(le){const Te=W.getView().getCenter(),K=sr(G.getExtent());It.distanceFromCenter=mg(Te,K)/E/le[1]}}const C={id:x.getId(),properties:P,type:$},O=n.get("mapbox-featurestate")[x.getId()];let D=-1;for(let le=0,Te=R.length;le<Te;++le){const K=R[le],M=K.layer,Ce=M.id;if(S!==void 0&&S!==Ce)continue;const Ie=M.layout||$t,Se=M.paint||$t;if(Ie.visibility==="none"||"minzoom"in M&&I<M.minzoom||"maxzoom"in M&&I>=M.maxzoom)continue;const st=M.filter;if(!st||OT(Ce,st,C,g)){let Be,He,fr,ct,mt,k;const Tr=K.index;if($==3&&(M.type=="fill"||M.type=="fill-extrusion"))if(He=V(M,"paint",M.type+"-opacity",C,d,O),M.type+"-pattern"in Se){const Ge=V(M,"paint",M.type+"-pattern",C,d,O);if(Ge){const Ne=typeof Ge=="string"?va(Ge,P):Ge.toString(),Le=Vh(Ne,l);if(i&&i[Ne]&&Le){++D,k=b[D],(!k||!k.getFill()||k.getStroke()||k.getText())&&(k=new rr({fill:new Or}),b[D]=k),fr=k.getFill(),k.setZIndex(Tr);const Re=Ne+"."+He;let Ze=p[Re];if(!Ze){const fe=i[Ne],be=jo(fe.width,fe.height),Ye=be.getContext("2d");Ye.globalAlpha=He,Ye.drawImage(Le.image,fe.x,fe.y,fe.width,fe.height,0,0,fe.width,fe.height),Ze=Ye.createPattern(be,"repeat"),p[Re]=Ze}fr.setColor(Ze)}}}else Be=Lr(V(M,"paint",M.type+"-color",C,d,O),He),M.type+"-outline-color"in Se&&(mt=Lr(V(M,"paint",M.type+"-outline-color",C,d,O),He)),mt||(mt=Be),(Be||mt)&&(++D,k=b[D],(!k||Be&&!k.getFill()||!Be&&k.getFill()||mt&&!k.getStroke()||!mt&&k.getStroke()||k.getText())&&(k=new rr({fill:Be?new Or:void 0,stroke:mt?new Mr:void 0}),b[D]=k),Be&&(fr=k.getFill(),fr.setColor(Be)),mt&&(ct=k.getStroke(),ct.setColor(mt),ct.setWidth(.5)),k.setZIndex(Tr));if($!=1&&M.type=="line"){"line-pattern"in Se?Be=void 0:Be=Lr(V(M,"paint","line-color",C,d,O),V(M,"paint","line-opacity",C,d,O));const Ge=V(M,"paint","line-width",C,d,O);Be&&Ge>0&&(++D,k=b[D],(!k||!k.getStroke()||k.getFill()||k.getText())&&(k=new rr({stroke:new Mr}),b[D]=k),ct=k.getStroke(),ct.setLineCap(V(M,"layout","line-cap",C,d,O)),ct.setLineJoin(V(M,"layout","line-join",C,d,O)),ct.setMiterLimit(V(M,"layout","line-miter-limit",C,d,O)),ct.setColor(Be),ct.setWidth(Ge),ct.setLineDash(Se["line-dasharray"]?V(M,"paint","line-dasharray",C,d,O).map(function(Ne){return Ne*Ge}):null),k.setZIndex(Tr))}let mn=!1,_e=null,tc=0,yn,ht,qo;if(($==1||$==2)&&"icon-image"in Ie){const Ge=V(M,"layout","icon-image",C,d,O);if(Ge){yn=typeof Ge=="string"?va(Ge,P):Ge.toString();let Ne;const Le=a?a(n,yn):void 0,Re=Vh(yn,l);if(i&&i[yn]&&Re||Le){const Ze=V(M,"layout","icon-rotation-alignment",C,d,O);if($==2){const fe=x.getGeometry();if(fe.getFlatMidpoint||fe.getFlatMidpoints){const be=fe.getExtent();if(Math.sqrt(Math.max(Math.pow((be[2]-be[0])/E,2),Math.pow((be[3]-be[1])/E,2)))>150){const et=fe.getType()==="MultiLineString"?fe.getFlatMidpoints():fe.getFlatMidpoint();if(wa||(ys=[NaN,NaN],wa=new uf("Point",ys,[],2,{},void 0)),Ne=wa,ys[0]=et[0],ys[1]=et[1],V(M,"layout","symbol-placement",C,d,O)==="line"&&Ze==="map"){const Bt=fe.getStride(),ft=fe.getFlatCoordinates();for(let xt=0,$e=ft.length-Bt;xt<$e;xt+=Bt){const ot=ft[xt],Ct=ft[xt+1],je=ft[xt+Bt],Rr=ft[xt+Bt+1],Yp=Math.min(ot,je),Kp=Math.max(ot,je),Yo=et[0],Jp=et[1],Qp=(Rr-Ct)*(Yo-ot)-(je-ot)*(Jp-Ct);if(Math.abs(Qp)<.001&&Yo<=Kp&&Yo>=Yp){tc=Math.atan2(Ct-Rr,je-ot);break}}}}}}if($!==2||Ne){const fe=V(M,"layout","icon-size",C,d,O),be=Se["icon-color"]!==void 0?V(M,"paint","icon-color",C,d,O):null;if(!be||be.a!==0){const Ye=V(M,"paint","icon-halo-color",C,d,O),et=V(M,"paint","icon-halo-width",C,d,O);let Ht=`${yn}.${fe}.${et}.${Ye}`;if(be!==null&&(Ht+=`.${be}`),ht=f[Ht],!ht){const Bt=jh(M,C,"icon",d);let ft;"icon-offset"in Ie&&(ft=V(M,"layout","icon-offset",C,d,O).slice(0),ft[0]*=fe,ft[1]*=-fe);let xt=be?[be.r*255,be.g*255,be.b*255,be.a]:void 0;if(Le){const $e={color:xt,rotateWithView:Ze==="map",displacement:ft,declutterMode:Bt,scale:fe};typeof Le=="string"?$e.src=Le:($e.img=Le,$e.imgSize=[Le.width,Le.height]),ht=new hc($e)}else{const $e=i[yn];let ot,Ct,je;if(et)$e.sdf?(ot=zh(kh(Re.image,$e,be||[0,0,0,1]),{x:0,y:0,width:$e.width,height:$e.height,pixelRatio:$e.pixelRatio},et,Ye),xt=void 0):ot=zh(Re.image,$e,et,Ye);else{if($e.sdf&&!Re.unSDFed){const Rr=kh(Re.image,{x:0,y:0,width:Re.size[0],height:Re.size[1]},{r:1,g:1,b:1});Re.image=Rr,Re.unSDFed=!0}ot=Re.image,Ct=[$e.width,$e.height],je=[$e.x,$e.y]}ht=new hc({color:xt,img:ot,imgSize:Re.size,size:Ct,offset:je,rotateWithView:Ze==="map",scale:fe/$e.pixelRatio,displacement:ft,declutterMode:Bt})}f[Ht]=ht}}ht&&(++D,k=b[D],(!k||!k.getImage()||k.getFill()||k.getStroke())&&(k=new rr,b[D]=k),k.setGeometry(Ne),ht.setRotation(tc+xa(V(M,"layout","icon-rotate",C,d,O))),ht.setOpacity(V(M,"paint","icon-opacity",C,d,O)),ht.setAnchor(FT[V(M,"layout","icon-anchor",C,d,O)]),k.setImage(ht),_e=k.getText(),k.setText(void 0),k.setZIndex(Tr),mn=!0,qo=!1)}else qo=!0}}}if($==1&&M.type==="circle"){++D,k=b[D],(!k||!k.getImage()||k.getFill()||k.getStroke())&&(k=new rr,b[D]=k);const Ge="circle-radius"in Se?V(M,"paint","circle-radius",C,d,O):5,Ne=Lr(V(M,"paint","circle-stroke-color",C,d,O),V(M,"paint","circle-stroke-opacity",C,d,O)),Le=V(M,"paint","circle-translate",C,d,O),Re=Lr(V(M,"paint","circle-color",C,d,O),V(M,"paint","circle-opacity",C,d,O)),Ze=V(M,"paint","circle-stroke-width",C,d,O),fe=Ge+"."+Ne+"."+Re+"."+Ze+"."+Le[0]+"."+Le[1];ht=f[fe],ht||(ht=new xf({radius:Ge,displacement:[Le[0],-Le[1]],stroke:Ne&&Ze>0?new Mr({width:Ze,color:Ne}):void 0,fill:Re?new Or({color:Re}):void 0,declutterMode:"none"}),f[fe]=ht),k.setImage(ht),_e=k.getText(),k.setText(void 0),k.setGeometry(void 0),k.setZIndex(Tr),mn=!0}let Qe,ii,si,Sr,oi,Ho;if("text-field"in Ie){Sr=Math.round(V(M,"layout","text-size",C,d,O));const Ge=V(M,"layout","text-font",C,d,O);si=V(M,"layout","text-line-height",C,d,O),ii=sl(o?o(Ge,e.metadata?e.metadata["ol:webfonts"]:void 0):Ge,Sr,si),ii.includes("sans-serif")||(ii+=",sans-serif"),oi=V(M,"layout","text-letter-spacing",C,d,O),Ho=V(M,"layout","text-max-width",C,d,O);const Ne=V(M,"layout","text-field",C,d,O);typeof Ne=="object"&&Ne.sections?Ne.sections.length===1?Qe=Ne.toString():Qe=Ne.sections.reduce((Le,Re,Ze)=>{const fe=Re.fontStack?Re.fontStack.split(","):Ge,be=sl(o?o(fe):fe,Sr*(Re.scale||1),si);let Ye=Re.text;if(Ye===`
`)return Le.push(`
`,""),Le;if($==2)return Le.push(ol(Ye,oi),be),Le;Ye=al(Ye,be,Ho,oi).split(`
`);for(let et=0,Ht=Ye.length;et<Ht;++et)et>0&&Le.push(`
`,""),Le.push(Ye[et],be);return Le},[]):Qe=va(Ne,P).trim(),He=V(M,"paint","text-opacity",C,d,O)}if(Qe&&He&&!qo){mn||(++D,k=b[D],(!k||!k.getText()||k.getFill()||k.getStroke())&&(k=new rr,b[D]=k),k.setImage(void 0),k.setGeometry(void 0));const Ge=jh(M,C,"text",d);k.getText()||k.setText(_e),_e=k.getText(),(!_e||"getDeclutterMode"in _e&&_e.getDeclutterMode()!==Ge)&&(_e=new La({padding:[2,2,2,2],declutterMode:Ge}),k.setText(_e));const Ne=V(M,"layout","text-transform",C,d,O);Ne=="uppercase"?Qe=Array.isArray(Qe)?Qe.map((je,Rr)=>Rr%2?je:je.toUpperCase()):Qe.toUpperCase():Ne=="lowercase"&&(Qe=Array.isArray(Qe)?Qe.map((je,Rr)=>Rr%2?je:je.toLowerCase()):Qe.toLowerCase());const Le=Array.isArray(Qe)?Qe:$==2?ol(Qe,oi):al(Qe,ii,Ho,oi);if(_e.setText(Le),_e.setFont(ii),_e.setRotation(xa(V(M,"layout","text-rotate",C,d,O))),typeof _e.setKeepUpright=="function"){const je=V(M,"layout","text-keep-upright",C,d,O);_e.setKeepUpright(je)}const Re=V(M,"layout","text-anchor",C,d,O),Ze=mn||$==1?"point":V(M,"layout","symbol-placement",C,d,O);let fe;if(Ze==="line-center"?(_e.setPlacement("line"),fe="center"):_e.setPlacement(Ze),Ze==="line"&&typeof _e.setRepeat=="function"){const je=V(M,"layout","symbol-spacing",C,d,O);_e.setRepeat(je*2)}_e.setOverflow(Ze==="point");let be=V(M,"paint","text-halo-width",C,d,O);const Ye=V(M,"layout","text-offset",C,d,O),et=V(M,"paint","text-translate",C,d,O);let Ht=0,Bt=0;if(Ze=="point"){fe="center",Re.indexOf("left")!==-1?(fe="left",Bt=be):Re.indexOf("right")!==-1&&(fe="right",Bt=-be);const je=V(M,"layout","text-rotation-alignment",C,d,O);_e.setRotateWithView(je=="map")}else _e.setMaxAngle(xa(V(M,"layout","text-max-angle",C,d,O))*Qe.length/Le.length),_e.setRotateWithView(!1);_e.setTextAlign(fe);let ft="middle";Re.indexOf("bottom")==0?(ft="bottom",Ht=-be-.5*(si-1)*Sr):Re.indexOf("top")==0&&(ft="top",Ht=be+.5*(si-1)*Sr),_e.setTextBaseline(ft);const xt=V(M,"layout","text-justify",C,d,O);_e.setJustify(xt==="auto"?void 0:xt),_e.setOffsetX(Ye[0]*Sr+Bt+et[0]),_e.setOffsetY(Ye[1]*Sr+Ht+et[1]),_.setColor(Lr(V(M,"paint","text-color",C,d,O),He)),_e.setFill(_);const $e=Lr(V(M,"paint","text-halo-color",C,d,O),He);if($e&&be>0){y.setColor($e),be*=2;const je=.5*Sr;y.setWidth(be<=je?be:je),_e.setStroke(y)}else _e.setStroke(void 0);const ot=V(M,"layout","text-padding",C,d,O),Ct=_e.getPadding();ot!==Ct[0]&&(Ct[0]=ot,Ct[1]=ot,Ct[2]=ot,Ct[3]=ot),k.setZIndex(Tr)}}}if(D>-1)return b.length=D+1,b};return n.setStyle(w),n.set("mapbox-layers",h),n.set("mapbox-source",m),n.set("mapbox-featurestate",n.get("mapbox-featurestate")||{}),w}function Op(n){return function(e){const t=e.buffers,r=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(i){const f=new Array(a);for(let d=0;d<a;++d)f[d]=new ImageData(new Uint8ClampedArray(t[d]),s,o);return n(f,r).data.buffer}const u=new Uint8ClampedArray(l),c=new Array(a),h=new Array(a);for(let f=0;f<a;++f)c[f]=new Uint8ClampedArray(t[f]),h[f]=[0,0,0,0];for(let f=0;f<l;f+=4){for(let d=0;d<a;++d){const g=c[d];h[d][0]=g[f],h[d][1]=g[f+1],h[d][2]=g[f+2],h[d][3]=g[f+3]}const p=n(h,r);u[f]=p[0],u[f+1]=p[1],u[f+2]=p[2],u[f+3]=p[3]}return u.buffer}}function BT(n,e){const r=Object.keys(n.lib||{}).map(function(s){return"const "+s+" = "+n.lib[s].toString()+";"}).concat(["const __minion__ = ("+Op.toString()+")(",n.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return i.addEventListener("message",e),i}function GT(n,e){const t=Op(n.operation);let r=!1;return{postMessage:function(i){setTimeout(function(){r||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){r=!0}}}class zT extends ff{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const r=new Array(t);if(t)for(let i=0;i<t;++i)r[i]=BT(e,this.onWorkerMessage_.bind(this,i));else r[0]=GT(e,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,r){this.enqueue_({inputs:e,meta:t,callback:r}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,r=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const u=l*a,c=[];for(let h=0,f=i.length;h<f;++h)c.push(i[h].slice(u,u+a));this.workers_[l].postMessage({buffers:c,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},c)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let r,i;if(t===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;r=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,u=a*o;r.set(new Uint8ClampedArray(l),u),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(r,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const Xh={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Wh extends pf{constructor(e,t,r){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=r}}class Hu extends pn{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=jT(e.sources);const t=this.changed.bind(this);for(let r=0,i=this.layers_.length;r<i;++r)this.layers_[r].addEventListener(pt.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new gm(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:rt(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:$T(this.layers_),pixelRatio:1,pixelToCoordinateTransform:rt(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:me(this),renderTargets:{}},this.setAttributions(function(r){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],u=l instanceof mo?l:l.getSource();if(!u)continue;const c=(s=u.getAttributions())==null?void 0:s(r);typeof c=="string"?i.push(c):c!==void 0&&i.push(...c)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new zT({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,r){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=sr(e);i.size[0]=Math.ceil(nt(e)/t),i.size[1]=Math.ceil(Wt(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=r,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let r=0,i=this.layers_.length;r<i;++r)if(t=this.layers_[r].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,r,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!Ri(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,r=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=kT(this.layers_[s],e);if(o)r[s]=o;else return}const i={};this.dispatchEvent(new Wh(Xh.BEFOREOPERATIONS,e,i)),this.processor_.process(r,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,r,i){if(t||!r)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!Ri(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(nt(s)/o),u=Math.round(Wt(s)/o);a=kr(l,u),this.renderedImageCanvas_=new Ql(s,o,1,a.canvas)}a.putImageData(r,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Wh(Xh.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let r=0,i=this.layers_.length;r<i&&(t=this.layers_[r].getSource().getResolutions(e),!t);++r);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}Hu.prototype.dispose;let Kr=null;function kT(n,e){const t=n.getRenderer();if(!t)throw new Error("Unsupported layer type: "+n);if(!t.prepareFrame(e))return null;const r=e.size[0],i=e.size[1];if(r===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===r&&o.height===i)return o.getContext("2d").getImageData(0,0,r,i)}if(!Kr)Kr=kr(r,i,void 0,{willReadFrequently:!0});else{const a=Kr.canvas;a.width!==r||a.height!==i?Kr=kr(r,i,void 0,{willReadFrequently:!0}):Kr.clearRect(0,0,r,i)}return Kr.drawImage(o,0,0,r,i),Kr.getImageData(0,0,r,i)}function $T(n){return n.map(function(e){return e.getLayerState()})}function jT(n){const e=n.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=VT(n[r]);return t}function VT(n){let e;return n instanceof mo?n instanceof Tl?e=new Ns({source:n}):n instanceof pn&&(e=new Pl({source:n})):e=n,e}function XT(n,e){const t=n[0],r=t.width,i=t.height,s=t.data,o=new Uint8ClampedArray(s.length),a=e.resolution*2,l=r-1,u=i-1,c=[0,0,0,0],h=2*Math.PI,f=Math.PI/2,p=Math.PI*e.sunEl/180,d=Math.PI*e.sunAz/180,g=Math.cos(p),m=Math.sin(p),y=e.highlightColor,_=e.shadowColor,b=e.accentColor,w=e.encoding;let x,E,S,A,P,R,I,G,$,W,C,O,D,se,H,Y,le,Te,K,M,Ce,Ie;function Se(st,Be="mapbox"){if(Be==="mapbox")return(st[0]*256*256+st[1]*256+st[2])*.1-1e4;if(Be==="terrarium")return st[0]*256+st[1]+st[2]/256-32768}for(E=0;E<=u;++E)for(P=E===0?0:E-1,R=E===u?u:E+1,x=0;x<=l;++x)S=x===0?0:x-1,A=x===l?l:x+1,I=(E*r+S)*4,c[0]=s[I],c[1]=s[I+1],c[2]=s[I+2],c[3]=s[I+3],G=e.vert*Se(c,w),I=(E*r+A)*4,c[0]=s[I],c[1]=s[I+1],c[2]=s[I+2],c[3]=s[I+3],$=e.vert*Se(c,w),W=($-G)/a,I=(P*r+x)*4,c[0]=s[I],c[1]=s[I+1],c[2]=s[I+2],c[3]=s[I+3],G=e.vert*Se(c,w),I=(R*r+x)*4,c[0]=s[I],c[1]=s[I+1],c[2]=s[I+2],c[3]=s[I+3],$=e.vert*Se(c,w),C=($-G)/a,D=Math.atan2(C,-W),D<0?D=f-D:D>f?D=h-D+f:D=f-D,O=Math.atan(Math.sqrt(W*W+C*C)),Ie=m*Math.cos(O)+g*Math.sin(O)*Math.cos(d-D),se=Math.cos(O),H=255*Ie,K=Math.min(Math.max(2*e.sunEl,0),1),M=1.875-e.opacity*1.75,Ce=e.opacity!==.5?f*((Math.pow(M,O)-1)/(Math.pow(M,f)-1)):O,le={r:(1-se)*b.r*K*255,g:(1-se)*b.g*K*255,b:(1-se)*b.b*K*255,a:(1-se)*b.a*K*255},Y=Math.abs(((D+d)/Math.PI+.5)%2-1),Te={r:(y.r*(1-Y)+_.r*Y)*H,g:(y.g*(1-Y)+_.g*Y)*H,b:(y.b*(1-Y)+_.b*Y)*H,a:(y.a*(1-Y)+_.a*Y)*H},I=(E*r+x)*4,o[I]=le.r*(1-Y)+Te.r,o[I+1]=le.g*(1-Y)+Te.g,o[I+2]=le.b*(1-Y)+Te.b,o[I+3]=s[I+3]*e.opacity*K*Math.sin(Ce);return new ImageData(o,r,i)}function WT(n,e=512){return n.getExtent()?Vr({extent:n.getExtent(),tileSize:e,maxZoom:22}).getResolutions():cr}function Np(n,e){return e.accessToken||(e=Object.assign({},e),new URL(n).searchParams.forEach((r,i)=>{e.accessToken=r,e.accessTokenParam=i})),e}function ZT(n,e,t="",r={},i=void 0){let s,o,a,l,u=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,r=a):l=t,typeof r=="string"?(s=r,a={}):(s=r.styleUrl,a=r),a.updateSource===!1&&(u=!1),i||(i=a.resolutions),!s&&typeof e=="string"&&!e.trim().startsWith("{")&&(s=e),s&&(s=s.startsWith("data:")?location.href:eo(s,a.accessToken),a=Np(s,a)),new Promise(function(c,h){Cp(e,a).then(function(f){if(f.version!=8)return h(new Error("glStyle version 8 required."));if(!(n instanceof ji||n instanceof Cn))return h(new Error("Can only apply to VectorLayer or VectorTileLayer"));const p=n instanceof Cn?"vector":"geojson";if(l?Array.isArray(l)?o=f.layers.find(function(w){return w.id===l[0]}).source:o=l:(o=f.layers.find(function(w){return w.source&&f.sources[w.source].type===p}).source,l=o),!o)return h(new Error(`No ${p} source found in the glStyle.`));function d(){if(!u)return Promise.resolve();if(n instanceof Cn)return Bp(f.sources[o],s,a).then(function(S){const A=n.getSource();A?S!==A&&(A.setTileUrlFunction(S.getTileUrlFunction()),typeof A.setUrls=="function"&&typeof S.getUrls=="function"&&A.setUrls(S.getUrls()),A.format_||(A.format_=S.format_),A.getAttributions()||A.setAttributions(S.getAttributions()),A.getTileLoadFunction()===ym&&A.setTileLoadFunction(S.getTileLoadFunction()),gi(A.getProjection(),S.getProjection())&&(A.tileGrid=S.getTileGrid())):n.setSource(S);const P=n.getSource().getTileGrid();!isFinite(n.getMaxResolution())&&!isFinite(n.getMinZoom())&&P.getMinZoom()>0&&n.setMaxResolution(pi(Math.max(0,P.getMinZoom()-1e-12),P.getResolutions()))});const w=f.sources[o];let x=n.getSource();(!x||x.get("mapbox-source")!==w)&&(x=kp(w,s,a));const E=n.getSource();return E?x!==E&&(E.getAttributions()||E.setAttributions(x.getAttributions()),E.format_||(E.format_=x.getFormat()),E.url_=x.getUrl()):n.setSource(x),Promise.resolve()}let g,m;const y={},_={};function b(){if(!m&&(!f.sprite||y)){if(a.projection&&!i){const S=he(a.projection).getUnits();S!=="m"&&(i=cr.map(A=>A/Aa[S]))}let w;const x=n.getSource();x instanceof qn&&x.format_ instanceof Rl&&(w=x.format_.layerName_),m=UT(n,f,l,i,y,_,(E,S=a.webfonts)=>LT(E,S),a.getImage,w),n.getStyle()?d().then(c).catch(h):h(new Error(`Nothing to show for source [${o}]`))}else m?(n.setStyle(m),d().then(c).catch(h)):h(new Error("Something went wrong trying to apply style."))}if(f.sprite){const w=wT(f.sprite,a.accessToken,s||location.href);g=Xi?1:window.devicePixelRatio>=1.5?.5:1;const x=g==.5?"@2x":"";Promise.all(w.map(function(E){const S=new URL(E.url);let A=S.origin+S.pathname+x+".json"+S.search;return new Promise(function(P,R){Vn("Sprite",A,a).then(P).catch(function(I){A=S.origin+S.pathname+".json"+S.search,Vn("Sprite",A,a).then(P).catch(R)})}).then(function(P){P===void 0&&h(new Error("No sprites found."));let R;if(R=S.origin+S.pathname+x+".png"+S.search,a.transformRequest){const I=a.transformRequest(R,"SpriteImage")||R;(I instanceof Request||I instanceof Promise)&&(R=I)}_[E.id]=R;for(const I in P){const G=E.id=="default"?I:`${E.id}:${I}`;y[G]=P[I]}}).catch(function(P){h(new Error(`Sprites cannot be loaded: ${A}: ${P.message}`))})})).then(b).catch(h)}else b()}).catch(h)})}function Dp(n,e){let t;return n.some(function(r){if(r.id==e)return t=r.source,!0}),t}function qT(n,e){const t=n.bounds;if(t){const r=Ia([t[0],t[1]],e),i=Ia([t[2],t[3]],e);return[r[0],r[1],i[0],i[1]]}return he(e).getExtent()}function Up(n,e,t){const r=new Ro({tileJSON:e,tileSize:n.tileSize||e.tileSize||512}),i=r.getTileJSON(),s=r.getTileGrid(),o=he(t.projection||"EPSG:3857"),a=qT(i,o),l=o.getExtent(),u=i.minzoom||0,c=i.maxzoom||22,h={attributions:r.getAttributions(),projection:o,tileGrid:new Wi({origin:l?Is(l):s.getOrigin(0),extent:a||s.getExtent(),minZoom:u,resolutions:WT(o,e.tileSize).slice(0,c+1),tileSize:s.getTileSize(0)})};return Array.isArray(i.tiles)?h.urls=i.tiles:h.url=i.tiles,h}function HT(n,e,t,r){const i={id:n.id,type:n.type},s=n.layout||{},o=n.paint||{};i.paint=o,It.zoom=qu(e,t.resolutions||cr),It.distanceFromCenter=0;let a;const l=V(i,"paint","background-color",$t,r);return o["background-opacity"]!==void 0&&(a=V(i,"paint","background-opacity",$t,r)),s.visibility=="none"?void 0:Lr(l,a)}function YT(n,e,t){const r=Xi?{style:{}}:document.createElement("div");return r.className="ol-mapbox-style-background",r.style.position="absolute",r.style.width="100%",r.style.height="100%",new go({source:new mo({}),render(i){const s=HT(n,i.viewState.resolution,e,t);return r.style.backgroundColor=s,r}})}function Bp(n,e,t){return new Promise(function(r,i){Fp(n,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=Up(n,s,t);a.tileLoadFunction=o,a.format=new Rl({layerName:"mvt:layer"});const l=new qn(a);l.set("mapbox-source",n),r(l)}).catch(i)})}function KT(n,e,t){const r=new Cn({declutter:!0,visible:!1});return Bp(n,e,t).then(function(i){r.setSource(i)}).catch(function(i){r.setSource(void 0)}),r}function Gp(n){return`{bbox-${(n?n.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function JT(n,e,t){return new Promise(function(r,i){Fp(n,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=new Ro({interpolate:t.interpolate===void 0?!0:t.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:s});a.tileGrid=Up(n,s,t).tileGrid,t.projection&&(a.projection=he(t.projection));const l=a.getTileUrlFunction();o&&a.setTileLoadFunction(o),a.setTileUrlFunction(function(u,c,h){const f=Gp(h);let p=l(u,c,h);if(p.indexOf(f)!=-1){const d=a.getTileGrid().getTileCoordExtent(u);p=p.replace(f,d.toString())}return p}),a.set("mapbox-source",n),r(a)}).catch(function(s){i(s)})})}function zp(n,e,t){const r=new Ns;return JT(n,e,t).then(function(i){r.setSource(i)}).catch(function(){r.setSource(void 0)}),r}function QT(n,e,t){const r=zp(n,e,t);return new Pl({source:new Hu({operationType:"image",operation:XT,sources:[r]})})}function kp(n,e,t){const r=t.projection?new Ss({dataProjection:t.projection}):new Ss,i=n.data,s={};if(typeof i=="string"){const[a]=vs(i,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const u=(h,f,p)=>{const d=Gp(p);return a.replace(d,`${h.join(",")}`)},c=new Br({attributions:n.attribution,format:r,loader:(h,f,p,d,g)=>{const m=typeof u=="function"?u(h,f,p):u;Vn("GeoJSON",m,t).then(y=>{const _=c.getFormat().readFeatures(y,{featureProjection:p});c.addFeatures(_),d(_)}).catch(y=>{c.removeLoadedExtent(h),g()})},strategy:wf});return c.set("mapbox-source",n),c}const l=new Br({attributions:n.attribution,format:r,url:a,loader:(u,c,h,f,p)=>{Vn("GeoJSON",a,t).then(d=>{const g=l.getFormat().readFeatures(d,{featureProjection:h});l.addFeatures(g),f(g)}).catch(d=>{l.removeLoadedExtent(u),p()})}});return l}s.features=r.readFeatures(i,{featureProjection:"EPSG:3857"});const o=new Br(Object.assign({attributions:n.attribution,format:r},s));return o.set("mapbox-source",n),o}function eS(n,e,t){return new ji({declutter:!0,source:kp(n,e,t),visible:!1})}function tS(n,e,t){let r=null;return function(i){n.paint&&"raster-opacity"in n.paint&&i.frameState.viewState.zoom!==r&&(r=i.frameState.viewState.zoom,delete t[n.id],rS(n,e,r,t))}}function rS(n,e,t,r){It.zoom=t,It.distanceFromCenter=0;const i=V(n,"paint","raster-opacity",$t,r);e.setOpacity(i)}function nS(n,e){function t(){const r=e.get("mapbox-style");if(!r)return;const i=sp(r.layers),s=n.get("mapbox-layers"),o=i.filter(function(a){return s.includes(a.id)}).some(function(a){return!a.layout||!a.layout.visibility||a.layout.visibility==="visible"});n.get("visible")!==o&&n.setVisible(o)}n.on("change",t),t()}function iS(n,e,t,r){const i=Lp(n),s=n.layers,o=t.type,a=t.source||Dp(s,t.ref),l=n.sources[a];let u;if(o=="background")u=YT(t,r,i);else if(l.type=="vector")u=KT(l,e,r);else if(l.type=="raster")u=zp(l,e,r),u.setVisible(t.layout?t.layout.visibility!=="none":!0),u.on("prerender",tS(t,u,i));else if(l.type=="geojson")u=eS(l,e,r);else if(l.type=="raster-dem"&&t.type=="hillshade"){const h=QT(l,e,r);u=h,h.getSource().on("beforeoperations",function(f){const p=f.data;p.resolution=yg(r.projection||"EPSG:3857",f.resolution,sr(f.extent),"m"),It.zoom=qu(f.resolution,r.resolutions||cr),It.distanceFromCenter=0,p.encoding=l.encoding,p.vert=5*V(t,"paint","hillshade-exaggeration",$t,i),p.sunAz=V(t,"paint","hillshade-illumination-direction",$t,i),p.sunEl=35,p.opacity=.3,p.highlightColor=V(t,"paint","hillshade-highlight-color",$t,i),p.shadowColor=V(t,"paint","hillshade-shadow-color",$t,i),p.accentColor=V(t,"paint","hillshade-accent-color",$t,i)}),u.setVisible(t.layout?t.layout.visibility!=="none":!0)}const c=a;return u&&u.set("mapbox-source",c),u}function Zh(n,e,t,r){const i=[];let s=null;if(e instanceof Ds){if(s=e.getView(),!s.isDef()&&!s.getRotation()&&!s.getResolutions()){const h=r.projection?he(r.projection):s.getProjection();s=new mm(Object.assign(s.getProperties(),{maxResolution:cr[0]/Aa[h.getUnits()],projection:r.projection||s.getProjection()})),e.setView(s)}"center"in n&&!s.getCenter()&&s.setCenter(Ia(n.center,s.getProjection())),"zoom"in n&&s.getZoom()===void 0&&s.setResolution(cr[0]/Aa[s.getProjection().getUnits()]/Math.pow(2,n.zoom)),(!s.getCenter()||s.getZoom()===void 0)&&s.fit(s.getProjection().getExtent(),{nearest:!0,size:e.getSize()})}e.set("mapbox-style",n),e.set("mapbox-metadata",{styleUrl:t,options:r});const o=n.layers;let a=[],l,u,c;for(let h=0,f=o.length;h<f;++h){const p=o[h],d=p.type;if(d=="heatmap"){console.debug(`layers[${h}].type "${d}" not supported`);continue}else c=p.source||Dp(o,p.ref),(!c||c!=u)&&(a.length&&(i.push(qh(l,a,n,t,e,r)),a=[]),l=iS(n,t,p,r),l instanceof ji||l instanceof Cn||(a=[]),u=l.get("mapbox-source")),a.push(p.id)}return i.push(qh(l,a,n,t,e,r)),Promise.all(i)}function sS(n,e,t={}){let r,i;if(Xi){if(!(n instanceof Ds)&&!(n instanceof Il))throw new Error("ol-mapbox-style in a web worker requires a Map or a LayerGroup as first argument");i=n}else typeof n=="string"||n instanceof HTMLElement?i=new Ds({target:n}):i=n;if(typeof e=="string"){const s=e.startsWith("data:")?location.href:eo(e,t.accessToken);t=Np(s,t),r=new Promise(function(o,a){Cp(e,t).then(function(l){Zh(l,i,s,t).then(function(){o(i)}).catch(a)}).catch(function(l){a(new Error(`Could not load ${e}: ${l.message}`))})})}else r=new Promise(function(s,o){Zh(e,i,!t.styleUrl||t.styleUrl.startsWith("data:")?location.href:eo(t.styleUrl,t.accessToken),t).then(function(){s(i)}).catch(o)});return r}function qh(n,e,t,r,i,s={}){let o=24,a=0;const l=t.layers;for(let u=0,c=l.length;u<c;++u){const h=l[u];e.indexOf(h.id)!==-1&&(o=Math.min("minzoom"in h?h.minzoom:0,o),a=Math.max("maxzoom"in h?h.maxzoom:24,a))}return new Promise(function(u,c){const h=function(){const p=n.getSource();if(!p||p.getState()==="error"){c(new Error("Error accessing data for source "+n.get("mapbox-source")));return}if("getTileGrid"in p){const d=p.getTileGrid();if(d){const g=d.getMinZoom();(o>0||g>0)&&n.setMaxResolution(Math.min(pi(Math.max(0,o-1e-12),cr),pi(Math.max(0,g-1e-12),d.getResolutions()))),a<24&&n.setMinResolution(pi(a,cr))}}else o>0&&n.setMaxResolution(pi(Math.max(0,o-1e-12),cr));p instanceof Br||p instanceof qn?ZT(n,t,e,Object.assign({styleUrl:r},s)).then(function(){nS(n,i),u()}).catch(c):u()};n.set("mapbox-layers",e);const f=i.getLayers();f.getArray().indexOf(n)===-1&&f.push(n),n.getSource()?h():n.once("change:source",h)})}class oS extends Il{constructor(e={}){const{mapboxStyle:t,applyOptions:r,...i}=e;super(i),t&&this.applyMapboxStyle(t,r)}applyMapboxStyle(e,t){return sS(this,e,t)}}_m(Nm);window.eoxMapAdvancedOlLayers={Graticule:yb,Heatmap:fx,Layer:go,VectorImage:gx,WebGLPoints:yx,WebGLTile:Xs,WebGLVector:_x,STAC:vu,MapboxStyle:oS};function aS(n){const e=n[0],t=new Array(e);let r=1<<e-1,i,s;for(i=0;i<e;++i)s=48,n[1]&r&&(s+=1),n[2]&r&&(s+=2),t[i]=String.fromCharCode(s),r>>=1;return t.join("")}const lS='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class uS extends vr{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:he("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const r=(e.url||"https://dev.virtualearth.net/REST/v1/Imagery/Metadata/")+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(r).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],r=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=dn(i),o=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/o:[t.imageWidth/o,t.imageHeight/o],l=Vr({extent:s,minZoom:t.zoomMin,maxZoom:r,tileSize:a});this.tileGrid=l;const u=this.culture_,c=this.hidpi_,h=this.placeholderTiles_;if(this.tileUrlFunction=Al(t.imageUrlSubdomains.map(function(f){const p=[0,0,0],d=t.imageUrl.replace("{subdomain}",f).replace("{culture}",u);return function(g,m,y){if(!g)return;Ma(g[0],g[1],g[2],p);const _=new URL(d.replace("{quadkey}",aS(p))),b=_.searchParams;return c&&(b.set("dpi","d1"),b.set("device","mobile")),h===!0?b.delete("n"):h===!1&&b.set("n","z"),_.toString()}})),t.imageryProviders){const f=yl(he("EPSG:4326"),this.getProjection());this.setAttributions(p=>{const d=[],g=p.viewState,m=this.getTileGrid(),y=m.getZForResolution(g.resolution,this.zDirection),b=m.getTileCoordForCoordAndZ(g.center,y)[0];return t.imageryProviders.map(function(w){let x=!1;const E=w.coverageAreas;for(let S=0,A=E.length;S<A;++S){const P=E[S];if(b>=P.zoomMin&&b<=P.zoomMax){const R=P.bbox,I=[R[1],R[0],R[3],R[2]],G=Gn(I,f);if(Bn(G,p.extent)){x=!0;break}}}x&&d.push(w.attribution)}),d.push(lS),d})}this.setState("ready")}}class cS extends Os{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const r=new XMLHttpRequest;r.addEventListener("load",this.handleInitResponse_.bind(this,e)),r.addEventListener("error",this.handleInitError_.bind(this)),r.open("POST",t),r.setRequestHeader("Content-type","application/json"),r.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const r=t.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[e]=i,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}const hS=22;class fS extends vr{constructor(e){const t=!!e.highDpi;super({attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const r={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(r.imageFormat=e.imageFormat),e.scale&&(r.scale=e.scale),t&&(r.highDpi=!0),e.layerTypes&&(r.layerTypes=e.layerTypes),e.styles&&(r.styles=e.styles),e.overlay===!0&&(r.overlay=!0),e.apiOptions&&(r.apiOptions=e.apiOptions),this.sessionTokenRequest_=r,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_;const i=e.url||"https://tile.googleapis.com/";this.createSessionUrl_=i+"v1/createSession",this.tileUrl_=i+"v1/2dtiles",this.attributionUrl_=i+"tile/v1/viewport",this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const e=this.createSessionUrl_+"?key="+this.apiKey_,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},r=await this.fetchSessionToken(e,t);if(!r.ok){try{const f=await r.json();this.error_=new Error(f.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await r.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=Vr({extent:dn(this.getProjection()),maxZoom:hS,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const l=this.apiKey_,u=this.tileUrl_;this.tileUrlFunction=function(f,p,d){const g=f[0],m=f[1],y=f[2];return`${u}/${g}/${m}/${y}?session=${a}&key=${l}`};const c=parseInt(i.expiry,10)*1e3,h=Math.max(c-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),h),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(e){if(e.viewHints[$r.ANIMATING]||e.viewHints[$r.INTERACTING]||e.animate)return this.previousViewportAttribution_;const[t,r]=ac(Cg(e.extent),e.viewState.projection),[i,s]=ac(Fg(e.extent),e.viewState.projection),l=`zoom=${this.getTileGrid().getZForResolution(e.viewState.resolution,this.zDirection)}&north=${s}&south=${r}&east=${i}&west=${t}`;if(this.previousViewportExtent_==l)return this.previousViewportAttribution_;this.previousViewportExtent_=l;const u=this.sessionTokenValue_,c=this.apiKey_,f=`${this.attributionUrl_}?session=${u}&key=${c}&${l}`;return this.previousViewportAttribution_=await fetch(f).then(p=>p.json()).then(p=>p.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}let $p=class extends wl{constructor(e,t,r,i,s,o,a){super(t,r,i,s,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==ee.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const r=kr(t[0],t[1]);return r.drawImage(e,0,0),this.zoomifyImage_=r.canvas,r.canvas}return e}};class dS extends vr{constructor(e){const t=e.size,r=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",i=e.tilePixelRatio||1,s=t[0],o=t[1],a=[],l=e.tileSize||Oa;let u=l*i;switch(r){case"default":for(;s>u||o>u;)a.push([Math.ceil(s/u),Math.ceil(o/u)]),u+=u;break;case"truncated":let E=s,S=o;for(;E>u||S>u;)a.push([Math.ceil(E/u),Math.ceil(S/u)]),E>>=1,S>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const c=[i],h=[0];for(let E=1,S=a.length;E<S;E++)c.push(i<<E),h.push(a[E-1][0]*a[E-1][1]+h[E-1]);c.reverse();const f=new Wi({tileSize:l,extent:e.extent||[0,-o,s,0],resolutions:c});let p=e.url;p&&!p.includes("{TileGroup}")&&!p.includes("{tileIndex}")&&(p+="{TileGroup}/{z}-{x}-{y}.jpg");const d=vf(p);let g=l*i;function m(E){return function(S,A,P){if(!S)return;const R=S[0],I=S[1],G=S[2],$=I+G*a[R][0],W=($+h[R])/g|0,C={z:R,x:I,y:G,tileIndex:$,TileGroup:"TileGroup"+W};return E.replace(/\{(\w+?)\}/g,function(O,D){return C[D]})}}const y=Al(d.map(m)),_=$p.bind(null,Zt(l*i));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:_,tileGrid:f,tileUrlFunction:y,transition:e.transition}),this.zDirection=e.zDirection;const b=f.getTileCoordForCoordAndResolution(sr(f.getExtent()),c[c.length-1]),w=y(b,1,null),x=new Image;x.addEventListener("error",()=>{g=l,this.changed()}),x.src=w}}function ci(n){return n.toLocaleString("en",{maximumFractionDigits:10})}class pS extends vr{constructor(e){const t=e||{};let r=t.url||"";r=r+(r.lastIndexOf("/")===r.length-1||r===""?"":"/");const i=t.version||Xe.VERSION2,s=t.sizes||[],o=t.size;Lt(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],u=t.tileSize,c=t.tilePixelRatio||1,h=t.format||"jpg",f=t.quality||(t.version==Xe.VERSION1?"native":"default");let p=t.resolutions||[];const d=t.supports||[],g=t.extent||[0,-l,a,0],m=s!=null&&Array.isArray(s)&&s.length>0,y=u!==void 0&&(typeof u=="number"&&Number.isInteger(u)&&u>0||Array.isArray(u)&&u.length>0),_=d!=null&&Array.isArray(d)&&(d.includes("regionByPx")||d.includes("regionByPct"))&&(d.includes("sizeByWh")||d.includes("sizeByH")||d.includes("sizeByW")||d.includes("sizeByPct"));let b,w,x;if(p.sort(function(P,R){return R-P}),y||_)if(u!=null&&(typeof u=="number"&&Number.isInteger(u)&&u>0?(b=u,w=u):Array.isArray(u)&&u.length>0&&((u.length==1||u[1]==null&&Number.isInteger(u[0]))&&(b=u[0],w=u[0]),u.length==2&&(Number.isInteger(u[0])&&Number.isInteger(u[1])?(b=u[0],w=u[1]):u[0]==null&&Number.isInteger(u[1])&&(b=u[1],w=u[1])))),(b===void 0||w===void 0)&&(b=Oa,w=Oa),p.length==0){x=Math.max(Math.ceil(Math.log(a/b)/Math.LN2),Math.ceil(Math.log(l/w)/Math.LN2));for(let P=x;P>=0;P--)p.push(Math.pow(2,P))}else{const P=Math.max(...p);x=Math.round(Math.log(P)/Math.LN2)}else if(b=a,w=l,p=[],m){s.sort(function(R,I){return R[0]-I[0]}),x=-1;const P=[];for(let R=0;R<s.length;R++){const I=a/s[R][0];if(p.length>0&&p[p.length-1]==I){P.push(R);continue}p.push(I),x++}if(P.length>0)for(let R=0;R<P.length;R++)s.splice(P[R]-R,1)}else p.push(1),s.push([a,l]),x=0;const E=new Wi({tileSize:[b,w],extent:g,origin:Is(g),resolutions:p}),S=function(P,R,I){let G,$;const W=P[0];if(W>x)return;const C=P[1],O=P[2],D=p[W];if(!(C===void 0||O===void 0||D===void 0||C<0||Math.ceil(a/D/b)<=C||O<0||Math.ceil(l/D/w)<=O)){if(_||y){const se=C*b*D,H=O*w*D;let Y=b*D,le=w*D,Te=b,K=w;if(se+Y>a&&(Y=a-se),H+le>l&&(le=l-H),se+b*D>a&&(Te=Math.floor((a-se+D-1)/D)),H+w*D>l&&(K=Math.floor((l-H+D-1)/D)),se==0&&Y==a&&H==0&&le==l)G="full";else if(!_||d.includes("regionByPx"))G=se+","+H+","+Y+","+le;else if(d.includes("regionByPct")){const M=ci(se/a*100),Ce=ci(H/l*100),Ie=ci(Y/a*100),Se=ci(le/l*100);G="pct:"+M+","+Ce+","+Ie+","+Se}i==Xe.VERSION3&&(!_||d.includes("sizeByWh"))?$=Te+","+K:!_||d.includes("sizeByW")?$=Te+",":d.includes("sizeByH")?$=","+K:d.includes("sizeByWh")?$=Te+","+K:d.includes("sizeByPct")&&($="pct:"+ci(100/D))}else if(G="full",m){const se=s[W][0],H=s[W][1];i==Xe.VERSION3?se==a&&H==l?$="max":$=se+","+H:se==a?$="full":$=se+","}else $=i==Xe.VERSION3?"max":"full";return r+G+"/"+$+"/0/"+f+"."+h}},A=$p.bind(null,Zt(u||256).map(function(P){return P*c}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:A,tileGrid:E,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:S,transition:t.transition}),this.zDirection=t.zDirection}}function jp(n,e,t,r,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=t/r,l=[uc(nt(e)/a,fc),uc(Wt(e)/a,fc)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*r:90*r);const u=n.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return Us(u,s)}function gS(n){const e=n.load?n.load:Zn,t=he(n.projection||"EPSG:3857"),r=n.ratio??1.5,i=n.crossOrigin??null;return function(s,o,a){a=n.hidpi?a:1;const l={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(l,n.params),s=Tf(s,o,a,r);const u=jp(n.url,s,o,a,t,l),c=new Image;return c.crossOrigin=i,e(c,u).then(h=>{const f=nt(s)/h.width*a;return{image:h,extent:s,resolution:f,pixelRatio:a}})}}class mS extends pn{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Sl,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=gS({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),Zn(s))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}class yS extends pn{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,r,i){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==r&&Rs(s.getExtent(),e))return s;e=e.slice(),df(e,this.ratio_);const o=nt(e)/t,a=Wt(e)/t,l=[o*r,a*r],u=this.canvasFunction_.call(this,e,t,r,l,i);return u&&(s=new Ql(e,t,r,u)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}function _S(n,e,t,r){const i=nt(n),s=Wt(n),o=e[0],a=e[1],l=.0254/r;return a*i>o*s?i*t/(o*l):s*t/(a*l)}function bS(n,e,t,r,i,s,o){const a=_S(t,r,s,o),l=sr(t),u={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(u,e),Us(n,u)}function xS(n){const e=n.load||Zn,t=n.useOverlay??!1,r=n.metersPerUnit||1,i=n.displayDpi||96,s=n.ratio??1,o=n.crossOrigin??null;return function(a,l,u){const c=new Image;c.crossOrigin=o,a=Tf(a,l,u,s);const h=nt(a)/l,f=Wt(a)/l,p=[h*u,f*u],d=bS(n.url,n.params,a,p,t,r,i);return e(c,d).then(g=>({image:g,extent:a,pixelRatio:u}))}}class ES extends pn{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Sl,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=xS({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),Zn(s))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}const wS=new Error("Image failed to load");function Vp(n,e,t,r,i){return new Promise((s,o)=>{const a=new Image;a.crossOrigin=i.crossOrigin??null,a.addEventListener("load",()=>s(a)),a.addEventListener("error",()=>o(wS)),a.src=Sf(n,e,t,r,i.maxY)})}function Hh(n){return function(e,t,r,i){const s=bm(n,e,t,r);return Vp(s,e,t,r,i)}}function vS(n){return function(e,t,r,i){const s=n(e,t,r,i);return Vp(s,e,t,r,i)}}function Yh(n){let e;if(Array.isArray(n))e=Hh(n);else if(typeof n=="string"){const t=vf(n);e=Hh(t)}else if(typeof n=="function")e=vS(n);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return e}let Kh=0;function Jh(n){return Array.isArray(n)?n.join(`
`):typeof n=="string"?n:(++Kh,"url-function-key-"+Kh)}class Xp extends es{constructor(e){e=e||{};let t=e.loader,r;e.url&&(t=Yh(e.url),r=Jh(e.url));const i=t?e.state:"loading",s=e.wrapX===void 0?!0:e.wrapX;super({loader:t,key:r,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize,gutter:e.gutter,maxResolution:e.maxResolution,projection:e.projection,tileGrid:e.tileGrid,state:i,wrapX:s,transition:e.transition,interpolate:e.interpolate!==!1,crossOrigin:e.crossOrigin,zDirection:e.zDirection})}setUrl(e){const t=Yh(e);this.setLoader(t),this.setKey(Jh(e)),this.getState()!=="ready"&&this.setState("ready")}}const TS={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},SS={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Wp(n,e){if(!e.length)return n;const t=new URL(n,"file:/");if(t.pathname.split("/").includes("collections"))return Si('The "collections" query parameter cannot be added to collection endpoints'),n;const r=e.map(o=>encodeURIComponent(o)).join(",");t.searchParams.append("collections",r);const i=n.split("?")[0],s=decodeURIComponent(t.searchParams.toString());return`${i}?${s}`}function RS(n,e,t){let r,i;for(let s=0;s<n.length;++s){const o=n[s];if(o.rel==="item"){if(o.type===e){r=o.href;break}(TS[o.type]||!i&&o.type.startsWith("image/"))&&(i=o.href)}}if(!r)if(i)r=i;else throw new Error('Could not find "item" link');return t&&(r=Wp(r,t)),r}function PS(n,e,t,r){let i,s;const o={};for(let a=0;a<n.length;++a){const l=n[a];if(o[l.type]=l.href,l.rel==="item"){if(l.type===e){i=l.href;break}SS[l.type]&&(s=l.href)}}if(!i&&t)for(let a=0;a<t.length;++a){const l=t[a];if(o[l]){i=o[l];break}}if(!i)if(s)i=s;else throw new Error('Could not find "item" link');return r&&(i=Wp(i,r)),i}function Qh(n,e,t,r){let i=n.projection;if(!i&&(typeof e.crs=="string"?i=he(e.crs):"uri"in e.crs&&(i=he(e.crs.uri)),!i))throw new Error(`Unsupported CRS: ${JSON.stringify(e.crs)}`);const s=e.orderedAxes,a=!(s?s.slice(0,2).map(E=>E.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation()).startsWith("en"),l=e.tileMatrices,u={};for(let E=0;E<l.length;++E){const S=l[E];u[S.id]=S}const c={},h=[];if(r)for(let E=0;E<r.length;++E){const S=r[E],A=S.tileMatrix;h.push(A),c[A]=S}else for(let E=0;E<l.length;++E){const S=l[E].id;h.push(S)}const f=h.length,p=new Array(f),d=new Array(f),g=new Array(f),m=new Array(f),y=[-1/0,-1/0,1/0,1/0];for(let E=0;E<f;++E){const S=h[E],A=u[S],P=A.pointOfOrigin;a?p[E]=[P[1],P[0]]:p[E]=P,d[E]=A.cellSize,g[E]=[A.matrixWidth,A.matrixHeight],m[E]=[A.tileWidth,A.tileHeight];const R=c[S];if(R){const I=A.cellSize*A.tileWidth,G=p[E][0]+R.minTileCol*I,$=p[E][0]+(R.maxTileCol+1)*I,W=A.cellSize*A.tileHeight,C=A.cornerOfOrigin==="bottomLeft";let O,D;C?(O=p[E][1]+R.minTileRow*W,D=p[E][1]+(R.maxTileRow+1)*W):(O=p[E][1]-(R.maxTileRow+1)*W,D=p[E][1]-R.minTileRow*W),ir(y,[G,O,$,D],y)}}const _=new Wi({origins:p,resolutions:d,sizes:g,tileSizes:m,extent:r?y:void 0}),b=n.context,w=n.url;function x(E,S,A){if(!E)return;const P=h[E[0]],R=u[P],I=R.cornerOfOrigin==="bottomLeft",G={tileMatrix:P,tileCol:E[1],tileRow:I?-E[2]-1:E[2]};if(r){const W=c[R.id];if(G.tileCol<W.minTileCol||G.tileCol>W.maxTileCol||G.tileRow<W.minTileRow||G.tileRow>W.maxTileRow)return}Object.assign(G,{z:G.tileMatrix,x:G.tileCol,y:G.tileRow},b);const $=t.replace(/\{(\w+?)\}/g,function(W,C){return G[C]});return Qd(w,$)}return{grid:_,projection:i,urlTemplate:t,urlFunction:x}}function AS(n,e){const t=e.tileMatrixSetLimits;let r;if(e.dataType==="map")r=RS(e.links,n.mediaType,n.collections);else if(e.dataType==="vector")r=PS(e.links,n.mediaType,n.supportedMediaTypes,n.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return Qh(n,e.tileMatrixSet,r,t);const i=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=Qd(n.url,s);return Jd(o).then(function(a){return Qh(n,a,r,t)})}function Zp(n){return Jd(n.url).then(function(e){return AS(n,e)})}class IS extends vr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null,collections:e.collections};Zp(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Si(e),this.setState("error")}}class LS extends qn{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null,collections:e.collections};Zp(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Si(e),this.setState("error")}}const CS='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',FS='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',MS='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',OS={stamen_terrain:{extension:"png"},stamen_terrain_background:{extension:"png"},stamen_terrain_labels:{extension:"png"},stamen_terrain_lines:{extension:"png"},stamen_toner_background:{extension:"png"},stamen_toner:{extension:"png"},stamen_toner_labels:{extension:"png"},stamen_toner_lines:{extension:"png"},stamen_toner_lite:{extension:"png"},stamen_toner_dark:{extension:"png"},stamen_toner_blacklite:{extension:"png"},stamen_watercolor:{extension:"jpg"},alidade_smooth:{extension:"png"},alidade_smooth_dark:{extension:"png"},alidade_satellite:{extension:"png"},outdoors:{extension:"png"},osm_bright:{extension:"png"}},NS={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_toner_dark:{minZoom:0,maxZoom:20,retina:!0},stamen_toner_blacklite:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class DS extends Os{constructor(e){const t=e.layer.indexOf("-"),r=t==-1?e.layer:e.layer.slice(0,t),i=NS[r]||{minZoom:0,maxZoom:20,retina:!0},s=OS[e.layer],o=e.apiKey?"?api_key="+e.apiKey:"",a=i.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,u=[CS,FS,xm];e.layer.startsWith("stamen_")&&u.splice(1,0,MS),super({attributions:u,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:i.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:i.minZoom,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:a?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}class US extends vr{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=$i(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,r,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const u=Mg(Em(e),a.length);l=a[u]}return jp(l,r,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o)}getTilePixelRatio(e){return this.hidpi_?e:1}setParams(e){this.params_=Object.assign({},e),this.setKey(this.getKeyForParams_())}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,r){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=i.getTileCoordExtent(e,this.tmpExtent_);let o=Zt(i.getTileSize(e[0]),this.tmpSize);t!=1&&(o=wm(o,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,o,s,t,r,a)}}class BS extends Xp{constructor(e){e=e||{};const t=e.template||"z:{z} x:{x} y:{y}",r=e.source,i=e.color||"grey";super({transition:0,wrapX:e.wrapX!==void 0?e.wrapX:r!==void 0?r.getWrapX():void 0});const s=()=>{var a;this.projection=e.projection!==void 0?he(e.projection):r!==void 0?r.getProjection():this.projection,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:r!==void 0?r.getTileGrid():this.tileGrid,this.zDirection=e.zDirection!==void 0?e.zDirection:r!==void 0?r.zDirection:this.zDirection,r instanceof es&&(this.transformMatrix=((a=r.transformMatrix)==null?void 0:a.slice())||null);const o=this.tileGrid;o&&this.setTileSizes(o.getResolutions().map((l,u)=>Zt(o.getTileSize(u)).map(c=>Math.max(Math.floor(c),1)))),this.setLoader((l,u,c,h)=>{const f=Sf(t,l,u,c,h.maxY),[p,d]=this.getTileSize(l),g=kr(p,d);return g.strokeStyle=i,g.strokeRect(.5,.5,p+.5,d+.5),g.fillStyle=i,g.strokeStyle="white",g.textAlign="center",g.textBaseline="middle",g.font="24px sans-serif",g.lineWidth=4,g.strokeText(f,p/2,d/2,p),g.fillText(f,p/2,d/2,p),Promise.resolve(g.canvas)}),this.setState("ready")};if(r===void 0||r.getState()==="ready")s();else{const o=()=>{r.getState()==="ready"&&(r.removeEventListener(pt.CHANGE,o),s())};r.addEventListener(pt.CHANGE,o)}}}class GS extends Sm{constructor(e,t,r,i,s,o){super(e,t),this.src_=r,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),r=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-r)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(t*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(e,t,r){this.state==ee.EMPTY&&r===!0?(this.state=ee.IDLE,Og(this,pt.CHANGE,i=>{t(this.getData(e))}),this.loadInternal_()):r===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=ee.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=ee.LOADED,this.changed()}loadInternal_(){if(this.state==ee.IDLE)if(this.state=ee.LOADING,this.jsonp_)wu(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(r)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(ee.EMPTY)}}class zS extends Tl{constructor(e){if(super({projection:he("EPSG:3857"),state:"loading",wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=vm,this.template_=void 0,this.jsonp_=e.jsonp||!1,this.tileCache_=new yf(512),e.url)if(this.jsonp_)wu(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,r,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,s),a=this.getTile(o[0],o[1],o[2],1,this.getProjection());a.getState()==ee.IDLE&&a.load(),a.forDataAtCoordinate(e,r,i)}else i===!0?setTimeout(function(){r(null)},0):r(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=he("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const c=yl(t,r);i=Gn(e.bounds,c)}const s=dn(r),o=e.minzoom||0,a=e.maxzoom||22,l=Vr({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=e.template;const u=e.grids;if(!u){this.setState("error");return}if(this.tileUrlFunction_=bf(u,l),e.attribution){const c=i!==void 0?i:s;this.setAttributions(function(h){return Bn(c,h.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,r,i,s){const o=[e,t,r],a=this.getTileCoordForTileUrlFunction(o,s),l=this.tileUrlFunction_(a,i,s),u=`${this.getKey()},${Tm(e,t,r)}`;if(this.tileCache_.containsKey(u))return this.tileCache_.get(u);this.tileCache_.expireCache();const c=new GS(o,l!==void 0?ee.IDLE:ee.EMPTY,l!==void 0?l:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_);return this.tileCache_.set(u,c),c}}class kS extends Br{constructor(e){e=e||{},super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const r=t.getGeometry();return Lt(!r||r.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),r},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,r){var i;(i=this.source)==null||i.loadFeatures(e,t,r),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(pt.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(pt.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const r=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==r;this.distance=e,this.minDistance=t,this.interpolationRatio=r,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=$i(),t=this.distance*this.resolution,r=this.source.getFeatures(),i={};for(let s=0,o=r.length;s<o;s++){const a=r[s];if(!(me(a)in i)){const l=this.geometryFunction(a);if(l){const u=l.getCoordinates();Ng(u,e),xl(e,t,e);const c=this.source.getFeaturesInExtent(e).filter(function(h){const f=me(h);return f in i?!1:(i[f]=!0,!0)});this.features.push(this.createCluster(c,e))}}}}createCluster(e,t){const r=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?_g(r,l.getCoordinates()):e.splice(a,1)}bg(r,1/e.length);const i=sr(t),s=this.interpolationRatio,o=new jt([r[0]*(1-s)+i[0]*s,r[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Ut({geometry:o,features:e})}}class ro extends kS{constructor(e={}){super({...e,createCluster:ro.defaultCreateCluster,geometryFunction:ro.defaultGeometryFunction})}static defaultCreateCluster(e,t){const r=t.length===1&&t[0].getGeometry()instanceof Un?t[0].getGeometry():e,i=new Ut({geometry:r,features:t});if(t.length===1){const s=t[0];for(const o in s.getProperties())o!=="geometry"&&i.set(o,s.get(o))}return i}static defaultGeometryFunction(e){const t=e&&e.getGeometry();return t instanceof jt?t:t instanceof Un?t.getInteriorPoint():null}}class $S extends vr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,tilePixelRatio:e.tilePixelRatio,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection,wrapX:e.wrapX}),this.version_=e.version!==void 0?e.version:"1.0.0",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,fetch(e.url).then(t=>t.text()).then(t=>new window.DOMParser().parseFromString(t,"application/xml")).then(t=>{this.handleCapabilitiesResponse(t,e)})}handleCapabilitiesResponse(e,t){const i=new jl().read(e),s=Ef(i,t);this.crossOrigin=s.crossOrigin,this.projection=s.projection,this.tileGrid=s.tileGrid,this.requestEncoding_=s.requestEncoding,this.matrixSet_=s.matrixSet,this.style_=s.style,this.format_=s.format,this.dimensions_=s.dimensions,this.setUrls(s.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=Al(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.getState()!=="ready"&&this.setState("ready")}createFromWMTSTemplate(e){const t=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t==="KVP"&&Object.assign(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t==="KVP"?Us(e,r):e.replace(/\{(\w+?)\}/g,(o,a)=>a.toLowerCase()in r?r[a.toLowerCase()]:o);const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let l=e;return t==="KVP"?l=Us(l,a):l=l.replace(/\{(\w+?)\}/g,(u,c)=>a[c]),l}}}const mr=new Uint8Array([102,103,98,3,102,103,98,0]),Pt=4,hi=4,fi=4,is=4,Cr=new Int32Array(2),ef=new Float32Array(Cr.buffer),tf=new Float64Array(Cr.buffer),_s=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var ll;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(ll||(ll={}));class qt{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new qt(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Cr[0]=this.readInt32(e),ef[0]}readFloat64(e){return Cr[_s?0:1]=this.readInt32(e),Cr[_s?1:0]=this.readInt32(e+4),tf[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){ef[0]=t,this.writeInt32(e,Cr[0])}writeFloat64(e,t){tf[0]=t,this.writeInt32(e,Cr[_s?0:1]),this.writeInt32(e+4,Cr[_s?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+hi+fi)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<fi;t++)e+=String.fromCharCode(this.readInt8(this.position_+hi+t));return e}__offset(e,t){const r=e-this.readInt32(e);return t<this.readInt16(r)?this.readInt16(r+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const r=this.readInt32(e);e+=hi;const i=this.bytes_.subarray(e,e+r);return t===ll.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+hi}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=fi)throw new Error("FlatBuffers: file identifier must be length "+fi);for(let t=0;t<fi;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+hi+t))return!1;return!0}createScalarList(e,t){const r=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&r.push(s)}return r}createObjList(e,t){const r=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&r.push(s.unpack())}return r}}var xe,tt=((xe={})[xe.Byte=0]="Byte",xe[xe.UByte=1]="UByte",xe[xe.Bool=2]="Bool",xe[xe.Short=3]="Short",xe[xe.UShort=4]="UShort",xe[xe.Int=5]="Int",xe[xe.UInt=6]="UInt",xe[xe.Long=7]="Long",xe[xe.ULong=8]="ULong",xe[xe.Float=9]="Float",xe[xe.Double=10]="Double",xe[xe.String=11]="String",xe[xe.Json=12]="Json",xe[xe.DateTime=13]="DateTime",xe[xe.Binary=14]="Binary",xe);class Ke{constructor(){de(this,"bb",null);de(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Ke).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+is),(t||new Ke).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):tt.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,tt.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,r,i,s,o,a,l,u,c,h,f){return Ke.startColumn(e),Ke.addName(e,t),Ke.addType(e,r),Ke.addTitle(e,i),Ke.addDescription(e,s),Ke.addWidth(e,o),Ke.addPrecision(e,a),Ke.addScale(e,l),Ke.addNullable(e,u),Ke.addUnique(e,c),Ke.addPrimaryKey(e,h),Ke.addMetadata(e,f),Ke.endColumn(e)}}var ce,at=((ce={})[ce.Unknown=0]="Unknown",ce[ce.Point=1]="Point",ce[ce.LineString=2]="LineString",ce[ce.Polygon=3]="Polygon",ce[ce.MultiPoint=4]="MultiPoint",ce[ce.MultiLineString=5]="MultiLineString",ce[ce.MultiPolygon=6]="MultiPolygon",ce[ce.GeometryCollection=7]="GeometryCollection",ce[ce.CircularString=8]="CircularString",ce[ce.CompoundCurve=9]="CompoundCurve",ce[ce.CurvePolygon=10]="CurvePolygon",ce[ce.MultiCurve=11]="MultiCurve",ce[ce.MultiSurface=12]="MultiSurface",ce[ce.Curve=13]="Curve",ce[ce.Surface=14]="Surface",ce[ce.PolyhedralSurface=15]="PolyhedralSurface",ce[ce.TIN=16]="TIN",ce[ce.Triangle=17]="Triangle",ce);class dt{constructor(){de(this,"bb",null);de(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new dt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+is),(t||new dt).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):at.Unknown}parts(e,t){let r=this.bb.__offset(this.bb_pos,18);return r?(t||new dt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addInt32(t[r]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addInt64(t[r]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,at.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,r,i,s,o,a,l,u){return dt.startGeometry(e),dt.addEnds(e,t),dt.addXy(e,r),dt.addZ(e,i),dt.addM(e,s),dt.addT(e,o),dt.addTm(e,a),dt.addType(e,l),dt.addParts(e,u),dt.endGeometry(e)}}class Dt{constructor(){de(this,"bb",null);de(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new Dt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+is),(t||new Dt).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new dt).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let r=this.bb.__offset(this.bb_pos,8);return r?(t||new Ke).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let r=t.length-1;r>=0;r--)e.addInt8(t[r]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,r,i){return Dt.startFeature(e),Dt.addGeometry(e,t),Dt.addProperties(e,r),Dt.addColumns(e,i),Dt.endFeature(e)}}function Ta(n,e){let t=[];for(let r=0;r<n.length;r+=2){let i=[n[r],n[r+1]];e&&i.push(e[r>>1]),t.push(i)}return t}new TextEncoder;let rf=new TextDecoder;function jS(n,e){let t={};if(!e||e.length===0)return t;let r=n.propertiesArray();if(!r)return t;let i=new DataView(r.buffer,r.byteOffset),s=n.propertiesLength(),o=0;for(;o<s;){let a=i.getUint16(o,!0);o+=2;let l=e[a],u=l.name;switch(l.type){case tt.Bool:t[u]=!!i.getUint8(o),o+=1;break;case tt.Byte:t[u]=i.getInt8(o),o+=1;break;case tt.UByte:t[u]=i.getUint8(o),o+=1;break;case tt.Short:t[u]=i.getInt16(o,!0),o+=2;break;case tt.UShort:t[u]=i.getUint16(o,!0),o+=2;break;case tt.Int:t[u]=i.getInt32(o,!0),o+=4;break;case tt.UInt:t[u]=i.getUint32(o,!0),o+=4;break;case tt.Long:t[u]=Number(i.getBigInt64(o,!0)),o+=8;break;case tt.ULong:t[u]=Number(i.getBigUint64(o,!0)),o+=8;break;case tt.Float:t[u]=i.getFloat32(o,!0),o+=4;break;case tt.Double:t[u]=i.getFloat64(o,!0),o+=8;break;case tt.DateTime:case tt.String:{let c=i.getUint32(o,!0);o+=4,t[u]=rf.decode(r.subarray(o,o+c)),o+=c;break}case tt.Json:{let c=i.getUint32(o,!0);o+=4;let h=rf.decode(r.subarray(o,o+c));t[u]=JSON.parse(h),o+=c;break}case tt.Binary:{let c=i.getUint32(o,!0);o+=4,t[u]=r.subarray(o,o+c),o+=c;break}default:throw Error(`Unknown type ${l.type}`)}}return t}const Yu=new Uint8Array(0);function VS(){return this._source.cancel()}function XS(n,e){if(!n.length)return e;if(!e.length)return n;var t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function WS(){var n=this,e=n._array.subarray(n._index);return n._source.read().then(function(t){return n._array=Yu,n._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:XS(e,t.value)}})}function ZS(n){if((n|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+n<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=n));var r=new Uint8Array(n);return r.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=Yu,e._index=0,t>0?r.subarray(0,t):null):t+s.value.length>=n?(e._array=s.value,e._index=n-t,r.set(s.value.subarray(0,n-t),t),r):(r.set(s.value,t),t+=s.value.length,i())})}()}function qS(n){return typeof n.slice=="function"?n:new Vo(typeof n.read=="function"?n:n.getReader())}function Vo(n){this._source=n,this._array=Yu,this._index=0}Vo.prototype.read=WS;Vo.prototype.slice=ZS;Vo.prototype.cancel=VS;class Nt{constructor(){de(this,"bb",null);de(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new Nt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+is),(t||new Nt).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,r,i,s,o,a){return Nt.startCrs(e),Nt.addOrg(e,t),Nt.addCode(e,r),Nt.addName(e,i),Nt.addDescription(e,s),Nt.addWkt(e,o),Nt.addCodeString(e,a),Nt.endCrs(e)}}class no{constructor(){de(this,"bb",null);de(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new no).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+is),(t||new no).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):at.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let r=this.bb.__offset(this.bb_pos,18);return r?(t||new Ke).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new Nt).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,at.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function Xo(n){let e=no.getRootAsHeader(n),t=e.featuresCount(),r=e.indexNodeSize(),i=[];for(let a=0;a<e.columnsLength();a++){let l=e.columns(a);if(!l)throw Error("Column unexpectedly missing");if(!l.name())throw Error("Column name unexpectedly missing");i.push({name:l.name(),type:l.type(),title:l.title(),description:l.description(),width:l.width(),precision:l.precision(),scale:l.scale(),nullable:l.nullable(),unique:l.unique(),primary_key:l.primaryKey()})}let s=e.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:r,crs:o,title:e.title(),description:e.description(),metadata:e.metadata()}}const lo=class lo{constructor(){de(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};de(lo,"global",new lo);let io=lo;const HS=40,YS=16;function Wo(n,e){e=Math.min(Math.max(+e,2),65535);let t=n,r=t;do r+=t=Math.ceil(t/e);while(t!==1);return 40*r}function KS(n,e){if(e<2)throw Error("Node size must be at least 2");if(n===0)throw Error("Number of items must be greater than 0");let t=n,r=t,i=[t];do r+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let a of(t=r,i))s.push(t-a),t-=a;let o=[];for(let a=0;a<i.length;a++)o.push([s[a],s[a]+i[a]]);return o}async function*qp(n,e,t,r){class i{constructor(p,d){de(this,"_level");de(this,"nodes");this._level=d,this.nodes=p}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(p){this.nodes[1]=p}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:a,maxY:l}=t,u=KS(n,e),c=u[0][0],h=[new i([0,1],u.length-1)];for(;h.length!==0;){let f=h.shift(),p=f.startNodeIdx(),d=p>=c,g=(()=>{let[,_]=u[f.level()],b=Math.min(f.endNodeIdx()+e,_);return d&&b<_?b+1:b})(),m=g-p,y=new DataView(await r(40*p,40*m));for(let _=p;_<g;_++){let b=_-p,w=40*b;if(a<y.getFloat64(w+0,!0)||l<y.getFloat64(w+8,!0)||s>y.getFloat64(w+16,!0)||o>y.getFloat64(w+24,!0))continue;let x=y.getBigUint64(w+32,!0);if(d){let P=(()=>{if(_<n-1){let I=(b+1)*40;return y.getBigUint64(I+32,!0)-x}return null})(),R=_-c;yield[Number(x),R,Number(P)];continue}let E=io.global.extraRequestThreshold()/40,S=h[h.length-1];if(S!==void 0&&S.level()===f.level()-1&&x<S.endNodeIdx()+E){S.extendEndNodeIdx(Number(x));continue}let A=(()=>{let P=f.level()-1;return new i([Number(x),Number(x)+1],P)})();S!==void 0&&(S.level(),A.level()),h.push(A)}}}class Ku{constructor(e,t,r,i){de(this,"bytes");de(this,"header");de(this,"headerLength");de(this,"indexLength");this.bytes=e,this.header=t,this.headerLength=r,this.indexLength=i}static open(e){if(!e.subarray(0,3).every((o,a)=>mr[a]===o))throw Error("Not a FlatGeobuf file");let t=new DataView(e.buffer).getUint32(8,!0);if(t>10485760||t<8)throw Error("Invalid header size");let r=e.subarray(12,12+t),i=Xo(new qt(r)),s=Wo(i.featuresCount,i.indexNodeSize);return new Ku(e,i,t,s)}async*selectBbox(e){let t=this.lengthBeforeTree(),r=async(i,s)=>{let o=t+i;return this.bytes.slice(o,o+s).buffer};for await(let i of qp(this.header.featuresCount,this.header.indexNodeSize,e,r)){let[s,o]=i,a=this.readFeature(s);yield{id:o,feature:a}}}lengthBeforeTree(){return mr.length+Pt+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(e){let t=e+this.lengthBeforeFeatures(),r=new DataView(this.bytes.buffer).getUint32(t,!0),i=this.bytes.subarray(t+4,t+4+r),s=new Uint8Array(r+Pt);s.set(i,Pt);let o=new qt(s);return o.setPosition(Pt),Dt.getRootAsFeature(o)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ul=function(n,e){return ul=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},ul(n,e)};function JS(n,e){ul(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Xn(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(n,[])).next())})}function jr(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function ni(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zi(n){return this instanceof zi?(this.v=n,this):new zi(n)}function QS(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{l(r[f](p))}catch(d){h(s[0][3],d)}}function l(f){f.value instanceof zi?Promise.resolve(f.value.v).then(u,c):h(s[0][2],f)}function u(f){a("next",f)}function c(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}var Hp=function(n){JS(e,n);function e(t){var r=n.call(this,t)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return e}(Error);(function(){function n(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),n.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();function cl(n){n!=null&&typeof n.then=="function"&&n.then(ao,ao)}var Sa=0,nf=1,hn=2,so=3,hl=4,oo=1024,ao=function(){};function Dn(n){var e=n.err,t=Promise.resolve(n.execution).then(function(r){if(e!=null)throw e;return r});return n.err=void 0,n.execution=t.then(function(){},function(){}),n.pending===void 0?t:n.pending.then(function(){return t})}function en(n,e){var t=n.state>=so;return Promise.resolve(e).then(function(r){return!t&&n.state>=hl?Dn(n).then(function(i){return{value:i,done:!0}}):{value:r,done:t}})}function Ju(n,e){var t,r;if(!(n.state>=hn))if(n.state=hn,n.onnext(),n.onstop(),n.err==null&&(n.err=e),n.pushes.length===0&&(typeof n.buffer>"u"||n.buffer.empty))Ei(n);else try{for(var i=ni(n.pushes),s=i.next();!s.done;s=i.next()){var o=s.value;o.resolve()}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}function Ei(n){var e,t;if(!(n.state>=so)){n.state<hn&&Ju(n),n.state=so,n.buffer=void 0;try{for(var r=ni(n.nexts),i=r.next();!i.done;i=r.next()){var s=i.value,o=n.pending===void 0?Dn(n):n.pending.then(function(){return Dn(n)});s.resolve(en(n,o))}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}n.pushes=[],n.nexts=[]}}function sf(n){n.state>=hl||(n.state<so&&Ei(n),n.state=hl)}function eR(n,e){if(cl(e),n.pushes.length>=oo)throw new Hp("No more than "+oo+" pending calls to push are allowed on a single repeater.");if(n.state>=hn)return Promise.resolve(void 0);var t=n.pending===void 0?Promise.resolve(e):n.pending.then(function(){return e});t=t.catch(function(l){n.state<hn&&(n.err=l),sf(n)});var r;if(n.nexts.length){var i=n.nexts.shift();i.resolve(en(n,t)),n.nexts.length?r=Promise.resolve(n.nexts[0].value):typeof n.buffer<"u"&&!n.buffer.full?r=Promise.resolve(void 0):r=new Promise(function(l){return n.onnext=l})}else typeof n.buffer<"u"&&!n.buffer.full?(n.buffer.add(t),r=Promise.resolve(void 0)):r=new Promise(function(l){return n.pushes.push({resolve:l,value:t})});var s=!0,o={},a=r.catch(function(l){if(s)throw l});return o.then=function(l,u){return s=!1,Promise.prototype.then.call(r,l,u)},o.catch=function(l){return s=!1,Promise.prototype.catch.call(r,l)},o.finally=r.finally.bind(r),n.pending=t.then(function(){return a}).catch(function(l){n.err=l,sf(n)}),o}function tR(n){var e=Ju.bind(null,n),t=new Promise(function(r){return n.onstop=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function rR(n){if(!(n.state>=nf)){n.state=nf;var e=eR.bind(null,n),t=tR(n);n.execution=new Promise(function(r){return r(n.executor(e,t))}),n.execution.catch(function(){return Ju(n)})}}var bs=new WeakMap,ss=function(){function n(e,t){bs.set(this,{executor:e,buffer:t,err:void 0,state:Sa,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:ao,onstop:ao})}return n.prototype.next=function(e){cl(e);var t=bs.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=oo)throw new Hp("No more than "+oo+" pending calls to next are allowed on a single repeater.");if(t.state<=Sa&&rR(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var r=en(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return r}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,en(t,s.value)}else if(t.state>=hn)return Ei(t),en(t,Dn(t));return new Promise(function(o){return t.nexts.push({resolve:o,value:e})})},n.prototype.return=function(e){cl(e);var t=bs.get(this);if(t===void 0)throw new Error("WeakMap error");return Ei(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),en(t,Dn(t))},n.prototype.throw=function(e){var t=bs.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=Sa||t.state>=hn||typeof t.buffer<"u"&&!t.buffer.empty?(Ei(t),t.err==null&&(t.err=e),en(t,Dn(t))):this.next(Promise.reject(e))},n.prototype[Symbol.asyncIterator]=function(){return this},n.race=nR,n.merge=iR,n.zip=sR,n.latest=oR,n}();function Zo(n,e){var t,r,i=[],s=function(u){u!=null&&typeof u[Symbol.asyncIterator]=="function"?i.push(u[Symbol.asyncIterator]()):u!=null&&typeof u[Symbol.iterator]=="function"?i.push(u[Symbol.iterator]()):i.push(function(){return QS(this,arguments,function(){return jr(this,function(f){switch(f.label){case 0:return e.yieldValues?[4,zi(u)]:[3,3];case 1:return[4,f.sent()];case 2:f.sent(),f.label=3;case 3:return e.returnValues?[4,zi(u)]:[3,5];case 4:return[2,f.sent()];case 5:return[2]}})})}())};try{for(var o=ni(n),a=o.next();!a.done;a=o.next()){var l=a.value;s(l)}}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}function nR(n){var e=this,t=Zo(n,{returnValues:!0});return new ss(function(r,i){return Xn(e,void 0,void 0,function(){var s,o,a,l,u,c;return jr(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2];o=!1,i.then(function(){s(),o=!0}),h.label=1;case 1:h.trys.push([1,,5,7]),l=void 0,u=0,c=function(){var f,p,d,g,m,y;return jr(this,function(_){switch(_.label){case 0:f=u;try{for(p=(m=void 0,ni(t)),d=p.next();!d.done;d=p.next())g=d.value,Promise.resolve(g.next()).then(function(b){b.done?(i(),a===void 0&&(a=b)):u===f&&(u++,s(b))},function(b){return i(b)})}catch(b){m={error:b}}finally{try{d&&!d.done&&(y=p.return)&&y.call(p)}finally{if(m)throw m.error}}return[4,new Promise(function(b){return s=b})];case 1:return l=_.sent(),l===void 0?[3,3]:[4,r(l.value)];case 2:_.sent(),_.label=3;case 3:return[2]}})},h.label=2;case 2:return o?[3,4]:[5,c()];case 3:return h.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return i(),[4,Promise.race(t.map(function(f){return f.return&&f.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function iR(n){var e=this,t=Zo(n,{yieldValues:!0});return new ss(function(r,i){return Xn(e,void 0,void 0,function(){var s,o,a,l=this;return jr(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2];s=[],o=!1,i.then(function(){var c,h;o=!0;try{for(var f=ni(s),p=f.next();!p.done;p=f.next()){var d=p.value;d()}}catch(g){c={error:g}}finally{try{p&&!p.done&&(h=f.return)&&h.call(f)}finally{if(c)throw c.error}}}),u.label=1;case 1:return u.trys.push([1,,3,4]),[4,Promise.all(t.map(function(c,h){return Xn(l,void 0,void 0,function(){var f,p;return jr(this,function(d){switch(d.label){case 0:d.trys.push([0,,6,9]),d.label=1;case 1:return o?[3,5]:(Promise.resolve(c.next()).then(function(g){return s[h](g)},function(g){return i(g)}),[4,new Promise(function(g){s[h]=g})]);case 2:return f=d.sent(),f===void 0?[3,4]:f.done?(a=f,[2]):[4,r(f.value)];case 3:d.sent(),d.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return p=c.return,p?[4,c.return()]:[3,8];case 7:p=d.sent(),d.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return u.sent(),[2,a&&a.value];case 3:return i(),[7];case 4:return[2]}})})})}function sR(n){var e=this,t=Zo(n,{returnValues:!0});return new ss(function(r,i){return Xn(e,void 0,void 0,function(){var s,o,a,l;return jr(this,function(u){switch(u.label){case 0:if(!t.length)return i(),[2,[]];o=!1,i.then(function(){s(),o=!0}),u.label=1;case 1:u.trys.push([1,,6,8]),u.label=2;case 2:return o?[3,5]:(Promise.all(t.map(function(c){return c.next()})).then(function(c){return s(c)},function(c){return i(c)}),[4,new Promise(function(c){return s=c})]);case 3:return a=u.sent(),a===void 0?[2]:(l=a.map(function(c){return c.value}),a.some(function(c){return c.done})?[2,l]:[4,r(l)]);case 4:return u.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(c){return c.return&&c.return()}))];case 7:return u.sent(),[7];case 8:return[2]}})})})}function oR(n){var e=this,t=Zo(n,{yieldValues:!0,returnValues:!0});return new ss(function(r,i){return Xn(e,void 0,void 0,function(){var s,o,a,l,u,c=this;return jr(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2,[]];o=[],a=!1,i.then(function(){var f,p;s();try{for(var d=ni(o),g=d.next();!g.done;g=d.next()){var m=g.value;m()}}catch(y){f={error:y}}finally{try{g&&!g.done&&(p=d.return)&&p.call(d)}finally{if(f)throw f.error}}a=!0}),h.label=1;case 1:return h.trys.push([1,,5,7]),Promise.all(t.map(function(f){return f.next()})).then(function(f){return s(f)},function(f){return i(f)}),[4,new Promise(function(f){return s=f})];case 2:return l=h.sent(),l===void 0?[2]:(u=l.map(function(f){return f.value}),l.every(function(f){return f.done})?[2,u]:[4,r(u.slice())]);case 3:return h.sent(),[4,Promise.all(t.map(function(f,p){return Xn(c,void 0,void 0,function(){var d;return jr(this,function(g){switch(g.label){case 0:if(l[p].done)return[2,l[p].value];g.label=1;case 1:return a?[3,4]:(Promise.resolve(f.next()).then(function(m){return o[p](m)},function(m){return i(m)}),[4,new Promise(function(m){return o[p]=m})]);case 2:return d=g.sent(),d===void 0?[2,l[p].value]:d.done?[2,d.value]:(u[p]=d.value,[4,r(u.slice())]);case 3:return g.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,h.sent()];case 5:return i(),[4,Promise.all(t.map(function(f){return f.return&&f.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}class Qu{constructor(e,t,r,i,s,o={}){de(this,"headerClient");de(this,"header");de(this,"headerLength");de(this,"indexLength");de(this,"nocache");de(this,"headers");this.headerClient=e,this.header=t,this.headerLength=r,this.indexLength=i,this.nocache=s,this.headers=o}static async open(e,t,r={}){let i,s=new of(e,t,r),o=2024+(()=>{let c,h=0;for(c=0;c<3;c++)h+=YS**c*HS;return h})();if(!new Uint8Array(await s.getRange(0,8,o,"header")).subarray(0,3).every((c,h)=>mr[h]===c))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,o,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let a=await s.getRange(12,i,o,"header"),l=Xo(new qt(new Uint8Array(a)));if(l.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let u=Wo(l.featuresCount,l.indexNodeSize);return new Qu(s,l,i,u,t,r)}async*selectBbox(e){let t=this.lengthBeforeTree(),r=this.headerClient,i=async(l,u)=>r.getRange(t+l,u,0,"index"),s=[],o=[];for await(let l of qp(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[u,c]=l,[,,h]=l;if(h||(h=4),o.length===0){o.push([u,h,c]);continue}let f=o[o.length-1];u-(f[0]+f[1])>io.global.extraRequestThreshold()&&(s.push(o),o=[]),o.push([u,h,c])}this.headerClient.logUsage("header+index"),o.length>0&&s.push(o);let a=s.flatMap(l=>this.readFeatureBatch(l,this.nocache));yield*ss.merge(a)}lengthBeforeTree(){return mr.length+Pt+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new of(this.headerClient.httpClient,e,this.headers)}async*readFeatureBatch(e,t){let[r]=e[0],[i,s]=e[e.length-1],o=this.buildFeatureClient(t),a=i+s-r;for(let[l,,u]of e){let c=await this.readFeature(o,l,a);yield{id:u,feature:c},a=0}o.logUsage("feature")}async readFeature(e,t,r){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,r,"feature length")).getUint32(0,!0);let o=new Uint8Array(await e.getRange(s+4,i,r,"feature data")),a=new Uint8Array(i+Pt);a.set(o,Pt);let l=new qt(a);return l.setPosition(Pt),Dt.getRootAsFeature(l)}}class of{constructor(e,t,r={}){de(this,"httpClient");de(this,"bytesEverUsed",0);de(this,"bytesEverFetched",0);de(this,"buffer",new ArrayBuffer(0));de(this,"head",0);if(typeof e=="string")this.httpClient=new af(e,t,r);else if(e instanceof af)this.httpClient=e;else throw Error("Unknown source")}async getRange(e,t,r,i){this.bytesEverUsed+=t;let s=e-this.head,o=s+t;if(s>=0&&o<=this.buffer.byteLength)return this.buffer.slice(s,o);let a=Math.max(t,r);return this.bytesEverFetched+=a,this.buffer=await this.httpClient.getRange(e,a,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class af{constructor(e,t,r={}){de(this,"url");de(this,"nocache");de(this,"headers");de(this,"requestsEverMade",0);de(this,"bytesEverRequested",0);this.url=e,this.nocache=t,this.headers=r}async getRange(e,t,r){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i=`bytes=${e}-${e+t-1}`,s=new Headers(this.headers);return s.set("Range",i),this.nocache&&s.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:s})).arrayBuffer()}}async function*aR(n,e,t,r){if(!n.subarray(0,3).every((h,f)=>mr[f]===h))throw Error("Not a FlatGeobuf file");if(t){let h=Ku.open(n);for await(let f of h.selectBbox(t))yield e(f.id,f.feature,h.header);return}let i=new qt(n),s=i.readUint32(mr.length);i.setPosition(mr.length+Pt);let o=Xo(i),a=mr.length+Pt+s,{indexNodeSize:l,featuresCount:u}=o;l>0&&(a+=Wo(u,l));let c=0;for(;a<i.capacity();){let h=i.readUint32(a);i.setPosition(a+Pt);let f=Dt.getRootAsFeature(i);yield e(c++,f,o),a+=Pt+h}}async function*lR(n,e,t){let r,i=qS(n),s=async p=>await i.slice(p),o=new Uint8Array(await s(8));if(!o.subarray(0,3).every((p,d)=>mr[d]===p))throw Error("Not a FlatGeobuf file");o=new Uint8Array(await s(4));let a=new qt(o),l=a.readUint32(0);o=new Uint8Array(await s(l));let u=Xo(a=new qt(o)),{indexNodeSize:c,featuresCount:h}=u;if(c>0){let p=Wo(h,c);await s(p)}let f=0;for(;r=await cR(s,u,e,f++);)yield r}async function*uR(n,e,t,r,i=!1,s={}){let o=await Qu.open(n,i,s);for await(let a of o.selectBbox(e))yield t(a.id,a.feature,o.header)}async function cR(n,e,t,r){let i=new Uint8Array(await n(4,"feature length"));if(i.byteLength===0)return;let s=new qt(i),o=s.readUint32(0);i=new Uint8Array(await n(o,"feature data"));let a=new Uint8Array(o+4);return a.set(i,4),(s=new qt(a)).setPosition(Pt),t(r,Dt.getRootAsFeature(s),e)}function fl(n,e){let t=e;if(t===at.Unknown&&(t=n.type()),t===at.GeometryCollection){let i=[];for(let s=0;s<n.partsLength();s++){let o=n.parts(s),a=o.type();i.push(fl(o,a))}return{type:at[t],geometries:i}}if(t===at.MultiPolygon){let i=[];for(let s=0;s<n.partsLength();s++)i.push(fl(n.parts(s),at.Polygon));return{type:at[t],coordinates:i.map(s=>s.coordinates)}}let r=function(i,s){let o=i.xyArray(),a=i.zArray();switch(s){case at.Point:{let l=Array.from(o);return a&&l.push(a[0]),l}case at.MultiPoint:case at.LineString:return Ta(o,a);case at.MultiLineString:case at.Polygon:return function(l,u,c){let h;if(!c||c.length===0)return[Ta(l,u)];let f=0,p=Array.from(c).map(d=>l.slice(f,f=d<<1));return u&&(f=0,h=Array.from(c).map(d=>u.slice(f,f=d))),p.map((d,g)=>Ta(d,h?h[g]:void 0))}(o,a,i.endsArray())}}(n,t);return{type:at[t],coordinates:r}}function ec(n,e,t){let r=t.columns;return{type:"Feature",id:n,geometry:fl(e.geometry(),t.geometryType),properties:jS(e,r)}}async function*hR(n,e,t){yield*aR(n,ec,e)}function fR(n,e){return lR(n,ec)}function dR(n,e,t,r=!1,i={}){return uR(n,e,ec,t,r,i)}function pR(n,e,t,r=!1,i={}){return n instanceof Uint8Array?hR(n,e):n instanceof ReadableStream?fR(n):dR(n,e,t,r,i)}class gR extends Br{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX,strategy:wf}),this.dataProjection=e.projection||Rm.dataProjection,this.resourceURL=e.url,super.setLoader(this.loader)}fgbBoundingBox(e,t){const r=Pa(e,t.getCode(),this.dataProjection);return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}}async loader(e,t,r,i,s){const o=this.fgbBoundingBox(e,r);try{if(o.minX!==-1/0){const a=[],l=pR(this.resourceURL,o),u=new Ss({featureProjection:r,dataProjection:this.dataProjection});for await(const c of l){const h=u.readFeature(c);a.push(h)}super.clear(),super.addFeatures(a),i(a)}}catch{s()}}}window.eoxMapAdvancedOlSources={BingMaps:uS,CartoDB:cS,Cluster:ro,DataTile:es,GeoTIFF:Eu,Google:fS,IIIF:pS,Image:pn,ImageArcGISRest:mS,ImageCanvas:yS,ImageMapGuide:ES,ImageStatic:Kd,ImageTile:Xp,OGCMapTile:IS,OGCVectorTile:LS,Raster:Hu,Source:mo,StadiaMaps:DS,TileArcGISRest:US,TileDebug:BS,TileImage:vr,TileJSON:Ro,UrlTile:Pm,UTFGrid:zS,Zoomify:dS,WMTSCapabilities:$S,FlatGeoBuf:gR};const GR=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{OR as L,NR as a,GR as i};
