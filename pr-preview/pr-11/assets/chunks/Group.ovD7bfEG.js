import{B as O,b as R,c as _,d as M,a as g,u as E,l as o,e as x,O as v,E as Z,g as m,f as N}from"./extent.B6zYA2nd.js";const l={ADD:"add",REMOVE:"remove"},f={LENGTH:"length"};class y extends R{constructor(e,t,s){super(e),this.element=t,this.index=s}}class A extends O{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e??[],this.unique_)for(let s=1,i=this.array_.length;s<i;++s)this.assertUnique_(this.array_[s],s);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,s=e.length;t<s;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let s=0,i=t.length;s<i;++s)e(t[s],s,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(f.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new y(l.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let s=0,i=t.length;s<i;++s)if(t[s]===e)return this.removeAt(s)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new y(l.REMOVE,t,e)),t}setAt(e,t){const s=this.getLength();if(e>=s){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const i=this.array_[e];this.array_[e]=t,this.dispatchEvent(new y(l.REMOVE,i,e)),this.dispatchEvent(new y(l.ADD,t,e))}updateLength_(){this.set(f.LENGTH,this.array_.length)}assertUnique_(e,t){const s=this.array_;for(let i=0,a=s.length;i<a;++i)if(s[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}const n={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class b extends O{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[n.OPACITY]=e.opacity!==void 0?e.opacity:1,_(typeof t[n.OPACITY]=="number","Layer opacity must be a number"),t[n.VISIBLE]=e.visible!==void 0?e.visible:!0,t[n.Z_INDEX]=e.zIndex,t[n.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[n.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[n.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[n.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},s=this.getZIndex();return t.opacity=M(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=s===void 0&&!t.managed?1/0:s,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return g()}getLayerStatesArray(e){return g()}getExtent(){return this.get(n.EXTENT)}getMaxResolution(){return this.get(n.MAX_RESOLUTION)}getMinResolution(){return this.get(n.MIN_RESOLUTION)}getMinZoom(){return this.get(n.MIN_ZOOM)}getMaxZoom(){return this.get(n.MAX_ZOOM)}getOpacity(){return this.get(n.OPACITY)}getSourceState(){return g()}getVisible(){return this.get(n.VISIBLE)}getZIndex(){return this.get(n.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(n.EXTENT,e)}setMaxResolution(e){this.set(n.MAX_RESOLUTION,e)}setMinResolution(e){this.set(n.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(n.MAX_ZOOM,e)}setMinZoom(e){this.set(n.MIN_ZOOM,e)}setOpacity(e){_(typeof e=="number","Layer opacity must be a number"),this.set(n.OPACITY,e)}setVisible(e){this.set(n.VISIBLE,e)}setZIndex(e){this.set(n.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const h={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class u extends R{constructor(e,t){super(e),this.layer=t}}const L={LAYERS:"layers"};class p extends b{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let s=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(L.LAYERS,this.handleLayersChanged_),s?Array.isArray(s)?s=new A(s.slice(),{unique:!0}):_(typeof s.getArray=="function","Expected `layers` to be an array or a `Collection`"):s=new A(void 0,{unique:!0}),this.setLayers(s)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(E),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(o(e,l.ADD,this.handleLayersAdd_,this),o(e,l.REMOVE,this.handleLayersRemove_,this));for(const s in this.listenerKeys_)this.listenerKeys_[s].forEach(E);x(this.listenerKeys_);const t=e.getArray();for(let s=0,i=t.length;s<i;s++){const a=t[s];this.registerLayerListeners_(a),this.dispatchEvent(new u(h.ADDLAYER,a))}this.changed()}registerLayerListeners_(e){const t=[o(e,v.PROPERTYCHANGE,this.handleLayerChange_,this),o(e,Z.CHANGE,this.handleLayerChange_,this)];e instanceof p&&t.push(o(e,h.ADDLAYER,this.handleLayerGroupAdd_,this),o(e,h.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[m(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new u(h.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new u(h.REMOVELAYER,e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new u(h.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){const t=e.element,s=m(t);this.listenerKeys_[s].forEach(E),delete this.listenerKeys_[s],this.dispatchEvent(new u(h.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(L.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const s=t.getArray();for(let i=0,a=s.length;i<a;++i)this.dispatchEvent(new u(h.REMOVELAYER,s[i]))}this.set(L.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],s=t.length;this.getLayers().forEach(function(c){c.getLayerStatesArray(t)});const i=this.getLayerState();let a=i.zIndex;!e&&i.zIndex===void 0&&(a=0);for(let c=s,I=t.length;c<I;c++){const r=t[c];r.opacity*=i.opacity,r.visible=r.visible&&i.visible,r.maxResolution=Math.min(r.maxResolution,i.maxResolution),r.minResolution=Math.max(r.minResolution,i.minResolution),r.minZoom=Math.max(r.minZoom,i.minZoom),r.maxZoom=Math.min(r.maxZoom,i.maxZoom),i.extent!==void 0&&(r.extent!==void 0?r.extent=N(r.extent,i.extent):r.extent=i.extent),r.zIndex===void 0&&(r.zIndex=a)}return t}getSourceState(){return"ready"}}export{b as B,A as C,u as G,p as L,l as a,n as b};
